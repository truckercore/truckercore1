(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2497],{45019:function(e,t,r){Promise.resolve().then(r.bind(r,4668))},4668:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var n=r(57437),l=r(2265),a=r(29827),s=r(48852),o=r(64250),d=r(63887);function i(e,t,r){var n;return{status:null!=t?t:"number"==typeof(null==e?void 0:e.status)?e.status:500,code:null==e?void 0:e.code,message:null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"Unexpected error",requestId:r}}function u(e){let t="https://dummy.supabase.co",r="dummy_key_here_for_build";return t&&r?{client:(0,d.eI)(t,r,{global:{headers:{"x-request-id":e}}})}:{error:{status:500,code:"env_missing",message:"Supabase env not set",requestId:e}}}async function c(e){let t=crypto.randomUUID();try{let{client:r,error:n}=u(t);if(n)return{data:null,error:n,requestId:t};let l=r.from("ownerop_expenses").select("id,driver_id,load_id,category,amount_usd,miles,occurred_at,note").eq("driver_id",e.driverId).order("occurred_at",{ascending:!1});e.from&&(l=l.gte("occurred_at",e.from)),e.to&&(l=l.lte("occurred_at",e.to));let{data:a,error:s,status:o}=await l;if(s)return{data:null,error:i(s,o,t),requestId:t};return{data:null!=a?a:[],error:null,requestId:t}}catch(e){return{data:null,error:i(e,500,t),requestId:t}}}async function p(e){let t=crypto.randomUUID();try{let{client:r,error:n}=u(t);if(n)return{data:null,error:n,requestId:t};let{data:l,error:a,status:s}=await r.from("ownerop_expenses").insert(e).select("id,driver_id,load_id,category,amount_usd,miles,occurred_at,note").single();if(a||!l)return{data:null,error:i(a,s,t),requestId:t};return{data:l,error:null,requestId:t}}catch(e){return{data:null,error:i(e,500,t),requestId:t}}}async function x(e,t){let r=crypto.randomUUID();try{let{client:n,error:l}=u(r);if(l)return{data:null,error:l,requestId:r};let{data:a,error:s,status:o}=await n.from("ownerop_expenses").update(t).eq("id",e).select("id,driver_id,load_id,category,amount_usd,miles,occurred_at,note").single();if(s||!a)return{data:null,error:i(s,o,r),requestId:r};return{data:a,error:null,requestId:r}}catch(e){return{data:null,error:i(e,500,r),requestId:r}}}async function m(e){let t=crypto.randomUUID();try{let{client:r,error:n}=u(t);if(n)return{data:null,error:n,requestId:t};let{error:l,status:a}=await r.from("ownerop_expenses").delete().eq("id",e);if(l)return{data:null,error:i(l,a,t),requestId:t};return{data:{id:e},error:null,requestId:t}}catch(e){return{data:null,error:i(e,500,t),requestId:t}}}function v(e){let t=e.reduce((e,t)=>{var r;return e+(null!==(r=t.amount_usd)&&void 0!==r?r:0)},0),r=e.reduce((e,t)=>{var r;return e+(null!==(r=t.miles)&&void 0!==r?r:0)},0);return{total:t,miles:r,costPerMile:r>0?t/r:0}}function h(){window.print()}function y(){return"demo-driver"}function j(){var e,t;let r=y(),d=(0,a.NL)(),[i,u]=(0,l.useState)({}),{data:j,isLoading:f,error:b}=(0,s.a)({queryKey:["ownerop","expenses",r,i],queryFn:()=>c({driverId:r,from:i.from,to:i.to}).then(e=>{var t;return null!==(t=e.data)&&void 0!==t?t:[]})}),N=(0,o.D)({mutationFn:e=>p(e).then(e=>e.data),onMutate:async e=>{await d.cancelQueries({queryKey:["ownerop","expenses",r]});let t=d.getQueryData(["ownerop","expenses",r,i])||[],n={...e,id:"tmp-"+Math.random().toString(36).slice(2)};return d.setQueryData(["ownerop","expenses",r,i],[n,...t]),{prev:t}},onError:(e,t,n)=>{(null==n?void 0:n.prev)&&d.setQueryData(["ownerop","expenses",r,i],n.prev)},onSettled:()=>{d.invalidateQueries({queryKey:["ownerop","expenses",r]})}});(0,o.D)({mutationFn:e=>{let{id:t,patch:r}=e;return x(t,r).then(e=>e.data)},onMutate:async e=>{let{id:t,patch:n}=e;await d.cancelQueries({queryKey:["ownerop","expenses",r]});let l=d.getQueryData(["ownerop","expenses",r,i])||[];return d.setQueryData(["ownerop","expenses",r,i],l.map(e=>e.id===t?{...e,...n}:e)),{prev:l}},onError:(e,t,n)=>{(null==n?void 0:n.prev)&&d.setQueryData(["ownerop","expenses",r,i],n.prev)},onSettled:()=>{d.invalidateQueries({queryKey:["ownerop","expenses",r]})}});let _=(0,o.D)({mutationFn:e=>m(e).then(()=>e),onMutate:async e=>{await d.cancelQueries({queryKey:["ownerop","expenses",r]});let t=d.getQueryData(["ownerop","expenses",r,i])||[];return d.setQueryData(["ownerop","expenses",r,i],t.filter(t=>t.id!==e)),{prev:t}},onError:(e,t,n)=>{(null==n?void 0:n.prev)&&d.setQueryData(["ownerop","expenses",r,i],n.prev)},onSettled:()=>{d.invalidateQueries({queryKey:["ownerop","expenses",r]})}}),w=(0,l.useMemo)(()=>v(null!=j?j:[]),[j]);return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"date",className:"border rounded p-1",value:null!==(e=i.from)&&void 0!==e?e:"",onChange:e=>u(t=>({...t,from:e.target.value||void 0}))}),(0,n.jsx)("input",{type:"date",className:"border rounded p-1",value:null!==(t=i.to)&&void 0!==t?t:"",onChange:e=>u(t=>({...t,to:e.target.value||void 0}))}),(0,n.jsx)("button",{className:"ml-auto px-3 py-1 rounded border",onClick:function(){!function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/csv;charset=utf-8;",n=new Blob([e],{type:r}),l=URL.createObjectURL(n),a=document.createElement("a");a.href=l,a.download=t,a.click(),URL.revokeObjectURL(l)}(function(e,t){if(!e.length)return"";let r=null!=t?t:Object.keys(e[0]),n=e=>{if(null==e)return"";let t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'+t.replace(/"/g,'""')+'"':t},l=[r.join(",")];for(let t of e)l.push(r.map(e=>n(t[e])).join(","));return l.join("\n")}((null!=j?j:[]).map(e=>{var t,r,n,l;return{date:null!==(t=e.occurred_at)&&void 0!==t?t:"",category:e.category,amount_usd:e.amount_usd,miles:null!==(r=e.miles)&&void 0!==r?r:"",load_id:null!==(n=e.load_id)&&void 0!==n?n:"",note:null!==(l=e.note)&&void 0!==l?l:""}}),["date","category","amount_usd","miles","load_id","note"]),"expenses.csv")},children:"Export CSV"}),(0,n.jsx)("button",{className:"px-3 py-1 rounded border",onClick:h,children:"Print / PDF"})]}),(0,n.jsx)(g,{onAdd:e=>N.mutate(e)}),(0,n.jsx)("div",{className:"rounded border",children:f?(0,n.jsx)("div",{className:"p-4",children:"Loadingâ€¦"}):b?(0,n.jsx)("div",{className:"p-4 text-red-600",children:"Error loading expenses"}):(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-50 text-left",children:[(0,n.jsx)("th",{className:"p-2",children:"Date"}),(0,n.jsx)("th",{className:"p-2",children:"Category"}),(0,n.jsx)("th",{className:"p-2 text-right",children:"Amount"}),(0,n.jsx)("th",{className:"p-2 text-right",children:"Miles"}),(0,n.jsx)("th",{className:"p-2",children:"Load"}),(0,n.jsx)("th",{className:"p-2",children:"Note"}),(0,n.jsx)("th",{className:"p-2"})]})}),(0,n.jsx)("tbody",{children:(null!=j?j:[]).map(e=>{var t,r,l;return(0,n.jsxs)("tr",{className:"border-t",children:[(0,n.jsx)("td",{className:"p-2",children:e.occurred_at?new Date(e.occurred_at).toLocaleDateString():""}),(0,n.jsx)("td",{className:"p-2",children:e.category}),(0,n.jsxs)("td",{className:"p-2 text-right",children:["$","{","r.amount_usd.toFixed(2)","}"]}),(0,n.jsx)("td",{className:"p-2 text-right",children:null!==(t=e.miles)&&void 0!==t?t:""}),(0,n.jsx)("td",{className:"p-2",children:null!==(r=e.load_id)&&void 0!==r?r:""}),(0,n.jsx)("td",{className:"p-2",children:null!==(l=e.note)&&void 0!==l?l:""}),(0,n.jsx)("td",{className:"p-2 text-right",children:(0,n.jsx)("button",{className:"text-red-600 text-xs",onClick:()=>_.mutate(e.id),children:"Delete"})})]},e.id)})})]})}),(0,n.jsxs)("div",{className:"rounded border p-3 bg-white",children:[(0,n.jsx)("div",{className:"font-medium mb-1",children:"Totals"}),(0,n.jsxs)("div",{className:"text-sm text-gray-700",children:["Total: $","{","summary.total.toFixed(2)","}"," \xb7 Miles: ",w.miles," \xb7 Cost/Mile: $","{","summary.costPerMile.toFixed(2)","}"]})]})]})}function g(e){var t,r,a,s,o;let{onAdd:d}=e,i=y(),[u,c]=(0,l.useState)({driver_id:i,category:"fuel",amount_usd:0,miles:null,load_id:null,occurred_at:new Date().toISOString().slice(0,10),note:""});return(0,n.jsxs)("form",{className:"flex flex-wrap items-end gap-2 bg-white rounded border p-3",onSubmit:e=>{e.preventDefault(),d(u)},children:[(0,n.jsxs)("label",{className:"text-sm",children:["Date",(0,n.jsx)("input",{type:"date",className:"block border rounded p-1",value:null!==(r=null===(t=u.occurred_at)||void 0===t?void 0:t.slice(0,10))&&void 0!==r?r:"",onChange:e=>c(t=>({...t,occurred_at:e.target.value}))})]}),(0,n.jsxs)("label",{className:"text-sm",children:["Category",(0,n.jsxs)("select",{className:"block border rounded p-1",value:u.category,onChange:e=>c(t=>({...t,category:e.target.value})),children:[(0,n.jsx)("option",{value:"fuel",children:"Fuel"}),(0,n.jsx)("option",{value:"toll",children:"Tolls"}),(0,n.jsx)("option",{value:"repair",children:"Repairs"}),(0,n.jsx)("option",{value:"insurance",children:"Insurance"}),(0,n.jsx)("option",{value:"other",children:"Other"})]})]}),(0,n.jsxs)("label",{className:"text-sm",children:["Amount (USD)",(0,n.jsx)("input",{type:"number",step:"0.01",className:"block border rounded p-1",value:u.amount_usd,onChange:e=>c(t=>({...t,amount_usd:Number(e.target.value)}))})]}),(0,n.jsxs)("label",{className:"text-sm",children:["Miles",(0,n.jsx)("input",{type:"number",className:"block border rounded p-1",value:null!==(a=u.miles)&&void 0!==a?a:"",onChange:e=>c(t=>({...t,miles:e.target.value?Number(e.target.value):null}))})]}),(0,n.jsxs)("label",{className:"text-sm",children:["Load ID",(0,n.jsx)("input",{type:"text",className:"block border rounded p-1",value:null!==(s=u.load_id)&&void 0!==s?s:"",onChange:e=>c(t=>({...t,load_id:e.target.value||null}))})]}),(0,n.jsxs)("label",{className:"text-sm grow",children:["Note",(0,n.jsx)("input",{type:"text",className:"block border rounded p-1 w-full",value:null!==(o=u.note)&&void 0!==o?o:"",onChange:e=>c(t=>({...t,note:e.target.value}))})]}),(0,n.jsx)("button",{type:"submit",className:"px-3 py-1 rounded bg-blue-600 text-white",children:"Add"})]})}function f(){let e="demo-driver",{data:t}=(0,s.a)({queryKey:["ownerop","expenses",e],queryFn:()=>c({driverId:e}).then(e=>{var t;return null!==(t=e.data)&&void 0!==t?t:[]})}),r=v(null!=t?t:[]),l=(r.miles,null);return(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,n.jsx)(b,{title:"Gross Revenue",value:"â€”"}),(0,n.jsx)(b,{title:"Total Costs",value:"$".concat(r.total.toFixed(2))}),(0,n.jsx)(b,{title:"Net Profit",value:"â€”"}),(0,n.jsx)(b,{title:"Miles",value:String(r.miles)}),(0,n.jsx)(b,{title:"Cost / Mile",value:"$".concat(r.costPerMile.toFixed(2))}),(0,n.jsx)(b,{title:"PPM (Revenue/Mile)",value:null!=l?"$".concat(l.toFixed(2)):"â€”"})]})}function b(e){let{title:t,value:r}=e;return(0,n.jsxs)("div",{className:"rounded border bg-white p-3",children:[(0,n.jsx)("div",{className:"text-xs text-gray-600",children:t}),(0,n.jsx)("div",{className:"text-lg font-semibold",children:r})]})}function N(){return(0,n.jsxs)("div",{className:"p-4 space-y-4",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold",children:"Owner-Operator"}),(0,n.jsx)(_,{})]})}function _(){let[e,t]=(0,l.useState)("expenses");return(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{className:"px-3 py-1 rounded border ".concat("expenses"===e?"bg-blue-600 text-white":""),onClick:()=>t("expenses"),children:"My Expenses"}),(0,n.jsx)("button",{className:"px-3 py-1 rounded border ".concat("profit"===e?"bg-blue-600 text-white":""),onClick:()=>t("profit"),children:"Profitability"})]}),(0,n.jsx)("div",{children:(0,n.jsx)(l.Suspense,{fallback:(0,n.jsx)("div",{className:"p-4",children:"Loadingâ€¦"}),children:"expenses"===e?(0,n.jsx)(j,{}):(0,n.jsx)(f,{})})})]})}}},function(e){e.O(0,[3887,9406,2971,2117,1744],function(){return e(e.s=45019)}),_N_E=e.O()}]);