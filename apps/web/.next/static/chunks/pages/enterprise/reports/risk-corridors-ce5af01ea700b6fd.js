(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8664],{28497:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/enterprise/reports/risk-corridors",function(){return r(99870)}])},99870:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return c},default:function(){return d}});var n=r(85893),i=r(67294),s=r(24613),o=r.n(s);let l=(0,r(63410).eI)("https://dummy.supabase.co","dummy_key_here_for_build"),u=e=>{let{orgId:t}=e,r=i.useRef(null),s=i.useRef(null),[u,c]=i.useState([]),[d,a]=i.useState(0),[h,p]=i.useState(null),[f,_]=i.useState(3.5),g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,[r,n]=i.useState(e);return i.useEffect(()=>{let r=setTimeout(()=>n(e),t);return()=>clearTimeout(r)},[e,t]),r}(f,200);i.useEffect(()=>{if(!r.current||s.current)return;let e=new(o()).Map({container:r.current,style:"https://demotiles.maplibre.org/style.json",center:[-96,38],zoom:3.5});s.current=e,e.on("moveend",()=>{_(e.getZoom())})},[]),i.useEffect(()=>{let e=s.current;if(!e)return;let r=e.getBounds();if(!r)return;let n=[r.getWest(),r.getSouth(),r.getEast(),r.getNorth()];(async()=>{if(!l)return;let{data:r,error:i}=await l.rpc("rpc_corridors_bounded",{p_org:t,p_bbox:n.join(","),p_limit:500,p_cursor:null});if(i){console.error(i),c([]);return}let s=r||[];c(s),a(s.length),p(new Date().toISOString().slice(11,16)+"Z");let o={type:"FeatureCollection",features:s.map(e=>({type:"Feature",geometry:"string"==typeof e.geojson?JSON.parse(e.geojson):e.geojson,properties:{id:e.id,risk_score:e.risk_score}}))},u="corridors",d=e.getSource(u);d?d.setData(o):(e.addSource(u,{type:"geojson",data:o}),e.addLayer({id:"corridor-line",type:"line",source:u,paint:{"line-color":["interpolate",["linear"],["get","risk_score"],0,"#2E7D32",.2,"#F9A825",.5,"#EF6C00",.8,"#C62828"],"line-width":3,"line-opacity":.8}}))})()},[t,g]);let j=[...u].sort((e,t)=>(t.risk_score||0)-(e.risk_score||0)).slice(0,5);return(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{children:"Top 5 Risk Corridors"}),(0,n.jsx)("div",{ref:r,style:{height:360,borderRadius:8,overflow:"hidden",marginBottom:12}}),(0,n.jsxs)("div",{style:{fontSize:12,opacity:.75,marginBottom:8},children:[d," segments \xb7 updated ",h||"-"]}),(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"#"}),(0,n.jsx)("th",{children:"Risk"}),(0,n.jsx)("th",{children:"ID"})]})}),(0,n.jsx)("tbody",{children:j.map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:t+1}),(0,n.jsx)("td",{children:String(e.risk_score||0)}),(0,n.jsx)("td",{children:String(e.id||"-")})]},String(e.id||t)))})]})]})};var c=!0;function d(){let e=void 0;return(0,n.jsx)("div",{style:{padding:16},children:(0,n.jsx)(u,{orgId:null!=e?e:""})})}}},function(e){e.O(0,[2644,3410,2888,9774,179],function(){return e(e.s=28497)}),_N_E=e.O()}]);