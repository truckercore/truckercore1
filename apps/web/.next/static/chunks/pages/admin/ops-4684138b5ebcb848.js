(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2149],{198:function(e,i,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/ops",function(){return n(58924)}])},58924:function(e,i,n){"use strict";n.r(i),n.d(i,{default:function(){return l}});var t=n(85893),r=n(67294);async function c(e,i){let n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:i?JSON.stringify(i):void 0});if(!n.ok)throw Error("".concat(n.status," ").concat(await n.text()));return n.json().catch(()=>({}))}function l(){let[e,i]=r.useState(""),[n,l]=r.useState([]),[s,d]=r.useState(null);async function a(){d(null);try{let i=await fetch("/api/admin/coi-list?q=".concat(encodeURIComponent(e),"&limit=50"));if(!i.ok)throw Error(await i.text());l(await i.json())}catch(e){d(String((null==e?void 0:e.message)||e))}}async function o(e,i){d(null);try{await c("/api/admin/coi-verify",{id:e,verified:i,note:i?"manual verify":"rejected"}),await a()}catch(e){d(String((null==e?void 0:e.message)||e))}}async function h(e){d(null);try{await c("/api/admin/billing-reconcile",{org_id:e}),alert("Reconcile triggered")}catch(e){d(String((null==e?void 0:e.message)||e))}}return(0,t.jsxs)("div",{style:{padding:20},children:[(0,t.jsx)("h2",{children:"Internal Ops"}),(0,t.jsxs)("section",{style:{marginBottom:24},children:[(0,t.jsx)("h3",{children:"COI Review"}),(0,t.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,t.jsx)("input",{placeholder:"Search by org_id, file_key, user_id…",value:e,onChange:e=>i(e.target.value),style:{minWidth:380}}),(0,t.jsx)("button",{onClick:a,children:"Search"})]}),s&&(0,t.jsx)("pre",{style:{color:"crimson"},children:s}),(0,t.jsxs)("table",{style:{marginTop:12,width:"100%"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"ID"}),(0,t.jsx)("th",{children:"Org"}),(0,t.jsx)("th",{children:"User"}),(0,t.jsx)("th",{children:"File"}),(0,t.jsx)("th",{children:"Verified"}),(0,t.jsx)("th",{children:"Uploaded"}),(0,t.jsx)("th",{children:"Actions"})]})}),(0,t.jsx)("tbody",{children:n.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:e.id}),(0,t.jsx)("td",{children:e.org_id}),(0,t.jsx)("td",{children:e.user_id}),(0,t.jsx)("td",{children:(0,t.jsx)("a",{href:"/api/admin/coi-download?id=".concat(encodeURIComponent(e.id)),target:"_blank",rel:"noreferrer",children:e.file_key})}),(0,t.jsx)("td",{children:String(e.verified)}),(0,t.jsx)("td",{children:new Date(e.uploaded_at).toLocaleString()}),(0,t.jsxs)("td",{style:{display:"flex",gap:8},children:[(0,t.jsx)("button",{onClick:()=>o(e.id,!0),children:"Verify"}),(0,t.jsx)("button",{onClick:()=>o(e.id,!1),children:"Reject"}),(0,t.jsx)("button",{onClick:()=>h(e.org_id),children:"Reconcile Subs"})]})]},e.id))})]})]}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{children:"Entitlements Viewer"}),(0,t.jsx)("p",{children:"Use COI search to fetch org_id, then “Reconcile Subs” to sync plan."})]})]})}}},function(e){e.O(0,[2888,9774,179],function(){return e(e.s=198)}),_N_E=e.O()}]);