"use strict";(()=>{var e={};e.id=8620,e.ids=[8620],e.modules={13688:e=>{e.exports=require("@supabase/auth-js")},52513:e=>{e.exports=require("@supabase/functions-js")},41180:e=>{e.exports=require("@supabase/node-fetch")},19168:e=>{e.exports=require("@supabase/realtime-js")},10401:e=>{e.exports=require("@supabase/storage-js")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},17811:e=>{e.exports=import("@supabase/postgrest-js")},36090:e=>{e.exports=import("stripe")},30184:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{config:()=>p,default:()=>u,routeModule:()=>l});var a=t(71802),i=t(47153),o=t(56249),n=t(85048),c=e([n]);n=(c.then?(await c)():c)[0];let u=(0,o.l)(n,"default"),p=(0,o.l)(n,"config"),l=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/billing/checkout",pathname:"/api/billing/checkout",bundlePath:"",filename:""},userland:n});r()}catch(e){r(e)}})},85048:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{default:()=>n});var a=t(43690),i=t(85611),o=e([a,i]);async function n(e,s){if("POST"!==e.method)return s.status(405).end();let{org_id:t,user_id:r,tier:o}=e.body??{};if(!t||!r||!o)return s.status(400).json({error:"missing"});try{let{data:e}=await i.p.from("billing_customers").select("stripe_customer_id").eq("org_id",t).maybeSingle(),n=e?.stripe_customer_id??(await a.A.customers.create({metadata:{org_id:t}})).id;e?.stripe_customer_id||await i.p.from("billing_customers").upsert({org_id:t,stripe_customer_id:n});let c="premium"===o?process.env.STRIPE_PRICE_PREMIUM:"standard"===o?process.env.STRIPE_PRICE_STANDARD:process.env.STRIPE_PRICE_BASIC,u=await a.A.checkout.sessions.create({mode:"subscription",customer:n,line_items:[{price:c,quantity:1}],success_url:`${process.env.APP_BASE_URL}/billing/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${process.env.APP_BASE_URL}/billing/cancel`,metadata:{org_id:t,user_id:r,tier:o}});s.status(200).json({url:u.url})}catch(e){s.status(500).json({error:e?.message||"checkout_failed"})}}[a,i]=o.then?(await o)():o,r()}catch(e){r(e)}})},43690:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.d(s,{A:()=>o});var a=t(36090),i=e([a]);let o=new(a=(i.then?(await i)():i)[0]).default(process.env.STRIPE_SECRET_KEY,{apiVersion:"2024-06-20"});r()}catch(e){r(e)}})},85611:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.d(s,{p:()=>o});var a=t(4864),i=e([a]);a=(i.then?(await i)():i)[0];let o=(0,a.createClient)(process.env.SUPABASE_URL||"https://dummy.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_SERVICE_ROLE||process.env.SUPABASE_SERVICE_KEY,{auth:{persistSession:!1}});r()}catch(e){r(e)}})}};var s=require("../../../webpack-api-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[6791],()=>t(30184));module.exports=r})();