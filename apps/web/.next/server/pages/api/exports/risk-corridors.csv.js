"use strict";(()=>{var e={};e.id=2417,e.ids=[2417],e.modules={20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},73279:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>c,routeModule:()=>p});var n={};r.r(n),r.d(n,{default:()=>d});var s=r(71802),a=r(47153),o=r(56249),i=r(84770),u=r.n(i);async function d(e,t){try{let r=function(e){let t=(e.headers.authorization||"").match(/^Bearer\s+(.+)$/i);return t?t[1]:null}(e);if(!r)return t.status(401).send("Missing JWT");let n="https://dummy.supabase.co";if(!n)return t.status(500).send("Missing SUPABASE_URL");t.setHeader("Cache-Control","no-store");let s=Math.min(parseInt(String(e.query.limit||"100"),10)||100,1e3),a=e.query.from,o=e.query.to,i=new URLSearchParams;i.set("select","org_id,observed_at,urgent_count,alert_count,types,cell_geojson"),i.set("order","observed_at.desc"),i.set("limit",String(s)),a&&i.set("observed_at",`gte.${encodeURIComponent(a)}`),o&&i.append("observed_at",`lte.${encodeURIComponent(o)}`);let d=`${String(n).replace(/\/$/,"")}/rest/v1/v_risk_corridors_export?${i.toString()}`,c=await fetch(d,{headers:{apikey:"dummy_key_here_for_build",Authorization:`Bearer ${r}`,Accept:"text/csv","Accept-Profile":"public","Content-Profile":"public",Prefer:"count=exact"}}),l=u().randomUUID(),p=c.headers.get("content-range")||"",f=(()=>{let e=p.match(/\/(\d+)$/);return e?parseInt(e[1],10):NaN})();if(!c.ok)return t.status(c.status).send(await c.text());let m=await c.text(),P=u().createHash("sha256").update(m).digest("hex");t.setHeader("Content-Type","text/csv; charset=utf-8"),t.setHeader("Content-Disposition",'attachment; filename="risk-corridors.csv"'),t.setHeader("Cache-Control","no-store, no-cache, must-revalidate"),t.setHeader("X-Export-Id",l),Number.isFinite(f)&&t.setHeader("X-Row-Count",String(f)),t.setHeader("X-Checksum-SHA256",P),t.status(200).send(m)}catch(e){t.status(500).send(e?.message||"error")}}let c=(0,o.l)(n,"default"),l=(0,o.l)(n,"config"),p=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/exports/risk-corridors.csv",pathname:"/api/exports/risk-corridors.csv",bundlePath:"",filename:""},userland:n})},47153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=73279);module.exports=r})();