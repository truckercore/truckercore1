(()=>{var e={};e.id=9652,e.ids=[9652],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},61212:e=>{"use strict";e.exports=require("async_hooks")},84770:e=>{"use strict";e.exports=require("crypto")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},57234:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>d,originalPathname:()=>c,pages:()=>h,routeModule:()=>p,tree:()=>u}),r(96758),r(32029),r(11930),r(12523);var i=r(23191),a=r(88716),n=r(37922),s=r.n(n),o=r(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let u=["",{children:["fleet",{children:["hazards",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,96758)),"C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\fleet\\hazards\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,32029)),"C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\layout.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,11930)),"C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,12523)),"C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\not-found.tsx"]}],h=["C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\fleet\\hazards\\page.tsx"],c="/fleet/hazards/page",d={require:r,loadChunk:()=>Promise.resolve()},p=new i.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/fleet/hazards/page",pathname:"/fleet/hazards",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},14811:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,12994,23)),Promise.resolve().then(r.t.bind(r,96114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,79671,23)),Promise.resolve().then(r.t.bind(r,41868,23)),Promise.resolve().then(r.t.bind(r,84759,23))},22462:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,79404,23))},13027:(e,t,r)=>{Promise.resolve().then(r.bind(r,49494))},35303:()=>{},62881:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var i=r(17577);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=(...e)=>e.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ");var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,i.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:o="",children:l,iconNode:u,...h},c)=>(0,i.createElement)("svg",{ref:c,...s,width:t,height:t,stroke:e,strokeWidth:a?24*Number(r)/Number(t):r,className:n("lucide",o),...h},[...u.map(([e,t])=>(0,i.createElement)(e,t)),...Array.isArray(l)?l:[l]])),l=(e,t)=>{let r=(0,i.forwardRef)(({className:r,...s},l)=>(0,i.createElement)(o,{ref:l,iconNode:t,className:n(`lucide-${a(e)}`,r),...s}));return r.displayName=`${e}`,r}},50949:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});let i=(0,r(62881).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},3634:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});let i=(0,r(62881).Z)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},92989:(e,t,r)=>{"use strict";var i=r(15852),a=r(60962),n=r(76162),s=Symbol.for("react.element"),o=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),d=Symbol.for("react.consumer"),p=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),x=Symbol.for("react.scope"),v=Symbol.for("react.debug_trace_mode"),b=Symbol.for("react.offscreen"),w=Symbol.for("react.legacy_hidden"),S=Symbol.for("react.cache"),k=Symbol.iterator,T=Array.isArray;function I(e,t){var r=3&e.length,i=e.length-r,a=t;for(t=0;t<i;){var n=255&e.charCodeAt(t)|(255&e.charCodeAt(++t))<<8|(255&e.charCodeAt(++t))<<16|(255&e.charCodeAt(++t))<<24;++t,a^=n=461845907*(65535&(n=(n=3432918353*(65535&n)+((3432918353*(n>>>16)&65535)<<16)&4294967295)<<15|n>>>17))+((461845907*(n>>>16)&65535)<<16)&4294967295,a=(65535&(a=5*(65535&(a=a<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+27492+(((a>>>16)+58964&65535)<<16)}switch(n=0,r){case 3:n^=(255&e.charCodeAt(t+2))<<16;case 2:n^=(255&e.charCodeAt(t+1))<<8;case 1:n^=255&e.charCodeAt(t),a^=461845907*(65535&(n=(n=3432918353*(65535&n)+((3432918353*(n>>>16)&65535)<<16)&4294967295)<<15|n>>>17))+((461845907*(n>>>16)&65535)<<16)&4294967295}return a^=e.length,a^=a>>>16,a=2246822507*(65535&a)+((2246822507*(a>>>16)&65535)<<16)&4294967295,a^=a>>>13,((a=3266489909*(65535&a)+((3266489909*(a>>>16)&65535)<<16)&4294967295)^a>>>16)>>>0}var C=Object.assign,P=Object.prototype.hasOwnProperty,E=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),M={},A={};function z(e){return!!P.call(A,e)||!P.call(M,e)&&(E.test(e)?A[e]=!0:(M[e]=!0,!1))}var R=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" ")),D=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),L=/["'&<>]/;function F(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=L.exec(e);if(t){var r,i="",a=0;for(r=t.index;r<e.length;r++){switch(e.charCodeAt(r)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}a!==r&&(i+=e.slice(a,r)),a=r+1,i+=t}e=a!==r?i+e.slice(a,r):i}return e}var B=/([A-Z])/g,O=/^ms-/,N=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,V={pending:!1,data:null,method:null,action:null},$=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Dispatcher,j={prefetchDNS:function(e){var t=t$||null;if(t){var r,i,a=t.resumableState,n=t.renderState;"string"==typeof e&&e&&(a.dnsResources.hasOwnProperty(e)||(a.dnsResources[e]=null,(i=(a=n.headers)&&0<a.remainingCapacity)&&(r="<"+(""+e).replace(eB,eO)+">; rel=dns-prefetch",i=2<=(a.remainingCapacity-=r.length)),i?(n.resets.dns[e]=null,a.preconnects&&(a.preconnects+=", "),a.preconnects+=r):(eo(r=[],{href:e,rel:"dns-prefetch"}),n.preconnects.add(r))),rd(t))}},preconnect:function(e,t){var r=t$||null;if(r){var i=r.resumableState,a=r.renderState;if("string"==typeof e&&e){var n,s,o="use-credentials"===t?"credentials":"string"==typeof t?"anonymous":"default";i.connectResources[o].hasOwnProperty(e)||(i.connectResources[o][e]=null,(s=(i=a.headers)&&0<i.remainingCapacity)&&(s="<"+(""+e).replace(eB,eO)+">; rel=preconnect","string"==typeof t&&(s+='; crossorigin="'+(""+t).replace(eN,eV)+'"'),n=s,s=2<=(i.remainingCapacity-=n.length)),s?(a.resets.connect[o][e]=null,i.preconnects&&(i.preconnects+=", "),i.preconnects+=n):(eo(o=[],{rel:"preconnect",href:e,crossOrigin:t}),a.preconnects.add(o))),rd(r)}}},preload:function(e,t,r){var i=t$||null;if(i){var a=i.resumableState,n=i.renderState;if(t&&e){switch(t){case"image":if(r)var s,o=r.imageSrcSet,l=r.imageSizes,u=r.fetchPriority;var h=o?o+"\n"+(l||""):e;if(a.imageResources.hasOwnProperty(h))return;a.imageResources[h]=U,(a=n.headers)&&0<a.remainingCapacity&&"high"===u&&(s=eF(e,t,r),2<=(a.remainingCapacity-=s.length))?(n.resets.image[h]=U,a.highImagePreloads&&(a.highImagePreloads+=", "),a.highImagePreloads+=s):(eo(a=[],C({rel:"preload",href:o?void 0:e,as:t},r)),"high"===u?n.highImagePreloads.add(a):(n.bulkPreloads.add(a),n.preloads.images.set(h,a)));break;case"style":if(a.styleResources.hasOwnProperty(e))return;eo(o=[],C({rel:"preload",href:e,as:t},r)),a.styleResources[e]=r&&("string"==typeof r.crossOrigin||"string"==typeof r.integrity)?[r.crossOrigin,r.integrity]:U,n.preloads.stylesheets.set(e,o),n.bulkPreloads.add(o);break;case"script":if(a.scriptResources.hasOwnProperty(e))return;o=[],n.preloads.scripts.set(e,o),n.bulkPreloads.add(o),eo(o,C({rel:"preload",href:e,as:t},r)),a.scriptResources[e]=r&&("string"==typeof r.crossOrigin||"string"==typeof r.integrity)?[r.crossOrigin,r.integrity]:U;break;default:if(a.unknownResources.hasOwnProperty(t)){if((o=a.unknownResources[t]).hasOwnProperty(e))return}else o={},a.unknownResources[t]=o;(o[e]=U,(a=n.headers)&&0<a.remainingCapacity&&"font"===t&&(h=eF(e,t,r),2<=(a.remainingCapacity-=h.length)))?(n.resets.font[e]=U,a.fontPreloads&&(a.fontPreloads+=", "),a.fontPreloads+=h):(eo(a=[],e=C({rel:"preload",href:e,as:t},r)),"font"===t)?n.fontPreloads.add(a):n.bulkPreloads.add(a)}rd(i)}}},preloadModule:function(e,t){var r=t$||null;if(r){var i=r.resumableState,a=r.renderState;if(e){var n=t&&"string"==typeof t.as?t.as:"script";if("script"===n){if(i.moduleScriptResources.hasOwnProperty(e))return;n=[],i.moduleScriptResources[e]=t&&("string"==typeof t.crossOrigin||"string"==typeof t.integrity)?[t.crossOrigin,t.integrity]:U,a.preloads.moduleScripts.set(e,n)}else{if(i.moduleUnknownResources.hasOwnProperty(n)){var s=i.unknownResources[n];if(s.hasOwnProperty(e))return}else s={},i.moduleUnknownResources[n]=s;n=[],s[e]=U}eo(n,C({rel:"modulepreload",href:e},t)),a.bulkPreloads.add(n),rd(r)}}},preinitStyle:function(e,t,r){var i=t$||null;if(i){var a=i.resumableState,n=i.renderState;if(e){t=t||"default";var s=n.styles.get(t),o=a.styleResources.hasOwnProperty(e)?a.styleResources[e]:void 0;null!==o&&(a.styleResources[e]=null,s||(s={precedence:F(t),rules:[],hrefs:[],sheets:new Map},n.styles.set(t,s)),t={state:0,props:C({rel:"stylesheet",href:e,"data-precedence":t},r)},o&&(2===o.length&&eL(t.props,o),(n=n.preloads.stylesheets.get(e))&&0<n.length?n.length=0:t.state=1),s.sheets.set(e,t),rd(i))}}},preinitScript:function(e,t){var r=t$||null;if(r){var i=r.resumableState,a=r.renderState;if(e){var n=i.scriptResources.hasOwnProperty(e)?i.scriptResources[e]:void 0;null!==n&&(i.scriptResources[e]=null,t=C({src:e,async:!0},t),n&&(2===n.length&&eL(t,n),e=a.preloads.scripts.get(e))&&(e.length=0),e=[],a.scripts.add(e),eh(e,t),rd(r))}}},preinitModuleScript:function(e,t){var r=t$||null;if(r){var i=r.resumableState,a=r.renderState;if(e){var n=i.moduleScriptResources.hasOwnProperty(e)?i.moduleScriptResources[e]:void 0;null!==n&&(i.moduleScriptResources[e]=null,t=C({src:e,type:"module",async:!0},t),n&&(2===n.length&&eL(t,n),e=a.preloads.moduleScripts.get(e))&&(e.length=0),e=[],a.scripts.add(e),eh(e,t),rd(r))}}}},U=[],q=/(<\/|<)(s)(cript)/gi;function Z(e,t,r,i){return""+t+("s"===r?"\\u0073":"\\u0053")+i}function G(e,t,r,i,a){var n=0;return void 0!==t&&(n=1),{idPrefix:void 0===e?"":e,nextFormID:0,streamingFormat:n,bootstrapScriptContent:r,bootstrapScripts:i,bootstrapModules:a,instructions:0,hasBody:!1,hasHtml:!1,unknownResources:{},dnsResources:{},connectResources:{default:{},anonymous:{},credentials:{}},imageResources:{},styleResources:{},scriptResources:{},moduleUnknownResources:{},moduleScriptResources:{}}}function H(e,t,r){return{insertionMode:e,selectedValue:t,tagScope:r}}function W(e){return H("http://www.w3.org/2000/svg"===e?3:"http://www.w3.org/1998/Math/MathML"===e?4:0,null,0)}function X(e,t,r){switch(t){case"noscript":return H(2,null,1|e.tagScope);case"select":return H(2,null!=r.value?r.value:r.defaultValue,e.tagScope);case"svg":return H(3,null,e.tagScope);case"picture":return H(2,null,2|e.tagScope);case"math":return H(4,null,e.tagScope);case"foreignObject":return H(2,null,e.tagScope);case"table":return H(5,null,e.tagScope);case"thead":case"tbody":case"tfoot":return H(6,null,e.tagScope);case"colgroup":return H(8,null,e.tagScope);case"tr":return H(7,null,e.tagScope)}return 5<=e.insertionMode?H(2,null,e.tagScope):0===e.insertionMode?"html"===t?H(1,null,e.tagScope):H(2,null,e.tagScope):1===e.insertionMode?H(2,null,e.tagScope):e}var K=new Map;function J(e,t){if("object"!=typeof t)throw Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.");var r,i=!0;for(r in t)if(P.call(t,r)){var a=t[r];if(null!=a&&"boolean"!=typeof a&&""!==a){if(0===r.indexOf("--")){var n=F(r);a=F((""+a).trim())}else void 0===(n=K.get(r))&&(n=F(r.replace(B,"-$1").toLowerCase().replace(O,"-ms-")),K.set(r,n)),a="number"==typeof a?0===a||R.has(r)?""+a:a+"px":F((""+a).trim());i?(i=!1,e.push(' style="',n,":",a)):e.push(";",n,":",a)}}i||e.push('"')}function Y(e,t,r){r&&"function"!=typeof r&&"symbol"!=typeof r&&e.push(" ",t,'=""')}function Q(e,t,r){"function"!=typeof r&&"symbol"!=typeof r&&"boolean"!=typeof r&&e.push(" ",t,'="',F(r),'"')}function ee(e){var t=e.nextFormID++;return e.idPrefix+t}var et=F("javascript:throw new Error('React form unexpectedly submitted.')");function er(e,t){if(this.push('<input type="hidden"'),"string"!=typeof e)throw Error("File/Blob fields are not yet supported in progressive forms. It probably means you are closing over binary data or FormData in a Server Action.");Q(this,"name",t),Q(this,"value",e),this.push("/>")}function ei(e,t,r,i,a,n,s,o){var l=null;return"function"==typeof i&&("function"==typeof i.$$FORM_ACTION?(a=ee(t),o=(t=i.$$FORM_ACTION(a)).name,i=t.action||"",a=t.encType,n=t.method,s=t.target,l=t.data):(e.push(" ","formAction",'="',et,'"'),s=n=a=i=o=null,es(t,r))),null!=o&&ea(e,"name",o),null!=i&&ea(e,"formAction",i),null!=a&&ea(e,"formEncType",a),null!=n&&ea(e,"formMethod",n),null!=s&&ea(e,"formTarget",s),l}function ea(e,t,r){switch(t){case"className":Q(e,"class",r);break;case"tabIndex":Q(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":Q(e,t,r);break;case"style":J(e,r);break;case"src":case"href":case"action":case"formAction":if(null==r||"function"==typeof r||"symbol"==typeof r||"boolean"==typeof r)break;e.push(" ",t,'="',F(""+r),'"');break;case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":case"ref":break;case"autoFocus":case"multiple":case"muted":Y(e,t.toLowerCase(),r);break;case"xlinkHref":if("function"==typeof r||"symbol"==typeof r||"boolean"==typeof r)break;e.push(" ","xlink:href",'="',F(""+r),'"');break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":"function"!=typeof r&&"symbol"!=typeof r&&e.push(" ",t,'="',F(r),'"');break;case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!=typeof r&&"symbol"!=typeof r&&e.push(" ",t,'=""');break;case"capture":case"download":!0===r?e.push(" ",t,'=""'):!1!==r&&"function"!=typeof r&&"symbol"!=typeof r&&e.push(" ",t,'="',F(r),'"');break;case"cols":case"rows":case"size":case"span":"function"!=typeof r&&"symbol"!=typeof r&&!isNaN(r)&&1<=r&&e.push(" ",t,'="',F(r),'"');break;case"rowSpan":case"start":"function"==typeof r||"symbol"==typeof r||isNaN(r)||e.push(" ",t,'="',F(r),'"');break;case"xlinkActuate":Q(e,"xlink:actuate",r);break;case"xlinkArcrole":Q(e,"xlink:arcrole",r);break;case"xlinkRole":Q(e,"xlink:role",r);break;case"xlinkShow":Q(e,"xlink:show",r);break;case"xlinkTitle":Q(e,"xlink:title",r);break;case"xlinkType":Q(e,"xlink:type",r);break;case"xmlBase":Q(e,"xml:base",r);break;case"xmlLang":Q(e,"xml:lang",r);break;case"xmlSpace":Q(e,"xml:space",r);break;default:if((!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&z(t=D.get(t)||t)){switch(typeof r){case"function":case"symbol":return;case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return}e.push(" ",t,'="',F(r),'"')}}}function en(e,t,r){if(null!=t){if(null!=r)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if("object"!=typeof t||!("__html"in t))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.");null!=(t=t.__html)&&e.push(""+t)}}function es(e,t){0!=(16&e.instructions)||t.externalRuntimeScript||(e.instructions|=16,t.bootstrapChunks.unshift(t.startInlineScript,'addEventListener("submit",function(a){if(!a.defaultPrevented){var c=a.target,d=a.submitter,e=c.action,b=d;if(d){var f=d.getAttribute("formAction");null!=f&&(e=f,b=null)}"javascript:throw new Error(\'React form unexpectedly submitted.\')"===e&&(a.preventDefault(),b?(a=document.createElement("input"),a.name=b.name,a.value=b.value,b.parentNode.insertBefore(a,b),b=new FormData(c),a.parentNode.removeChild(a)):b=new FormData(c),a=c.ownerDocument||c,(a.$$reactFormReplay=a.$$reactFormReplay||[]).push(c,d,b))}});',"</script>"))}function eo(e,t){for(var r in e.push(ef("link")),t)if(P.call(t,r)){var i=t[r];if(null!=i)switch(r){case"children":case"dangerouslySetInnerHTML":throw Error("link is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:ea(e,r,i)}}return e.push("/>"),null}function el(e,t,r){for(var i in e.push(ef(r)),t)if(P.call(t,i)){var a=t[i];if(null!=a)switch(i){case"children":case"dangerouslySetInnerHTML":throw Error(r+" is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:ea(e,i,a)}}return e.push("/>"),null}function eu(e,t){e.push(ef("title"));var r,i=null,a=null;for(r in t)if(P.call(t,r)){var n=t[r];if(null!=n)switch(r){case"children":i=n;break;case"dangerouslySetInnerHTML":a=n;break;default:ea(e,r,n)}}return e.push(">"),"function"!=typeof(t=Array.isArray(i)?2>i.length?i[0]:null:i)&&"symbol"!=typeof t&&null!=t&&e.push(F(""+t)),en(e,a,i),e.push(eg("title")),null}function eh(e,t){e.push(ef("script"));var r,i=null,a=null;for(r in t)if(P.call(t,r)){var n=t[r];if(null!=n)switch(r){case"children":i=n;break;case"dangerouslySetInnerHTML":a=n;break;default:ea(e,r,n)}}return e.push(">"),en(e,a,i),"string"==typeof i&&e.push(F(i)),e.push(eg("script")),null}function ec(e,t,r){e.push(ef(r));var i,a=r=null;for(i in t)if(P.call(t,i)){var n=t[i];if(null!=n)switch(i){case"children":r=n;break;case"dangerouslySetInnerHTML":a=n;break;default:ea(e,i,n)}}return e.push(">"),en(e,a,r),"string"==typeof r?(e.push(F(r)),null):r}var ed=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,ep=new Map;function ef(e){var t=ep.get(e);if(void 0===t){if(!ed.test(e))throw Error("Invalid tag: "+e);t="<"+e,ep.set(e,t)}return t}var em=new Map;function eg(e){var t=em.get(e);return void 0===t&&(t="</"+e+">",em.set(e,t)),t}function ey(e,t){t=t.bootstrapChunks;for(var r=0;r<t.length-1;r++)e.push(t[r]);return!(r<t.length)||(r=t[r],t.length=0,e.push(r))}function e_(e,t,r){if(e.push('<!--$?--><template id="'),null===r)throw Error("An ID must have been assigned before we can complete the boundary.");return e.push(t.boundaryPrefix),t=r.toString(16),e.push(t),e.push('"></template>')}var ex=/[<\u2028\u2029]/g;function ev(e){return JSON.stringify(e).replace(ex,function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}var eb=/[&><\u2028\u2029]/g;function ew(e){return JSON.stringify(e).replace(eb,function(e){switch(e){case"&":return"\\u0026";case">":return"\\u003e";case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSObjectForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}var eS=!1,ek=!0;function eT(e){var t=e.rules,r=e.hrefs,i=0;if(r.length){for(this.push('<style media="not all" data-precedence="'),this.push(e.precedence),this.push('" data-href="');i<r.length-1;i++)this.push(r[i]),this.push(" ");for(this.push(r[i]),this.push('">'),i=0;i<t.length;i++)this.push(t[i]);ek=this.push("</style>"),eS=!0,t.length=0,r.length=0}}function eI(e){return 2!==e.state&&(eS=!0)}function eC(e,t,r){return eS=!1,ek=!0,t.styles.forEach(eT,e),t.stylesheets.forEach(eI),eS&&(r.stylesToHoist=!0),ek}function eP(e){for(var t=0;t<e.length;t++)this.push(e[t]);e.length=0}var eE=[];function eM(e){eo(eE,e.props);for(var t=0;t<eE.length;t++)this.push(eE[t]);eE.length=0,e.state=2}function eA(e){var t=0<e.sheets.size;e.sheets.forEach(eM,this),e.sheets.clear();var r=e.rules,i=e.hrefs;if(!t||i.length){if(this.push('<style data-precedence="'),this.push(e.precedence),e=0,i.length){for(this.push('" data-href="');e<i.length-1;e++)this.push(i[e]),this.push(" ");this.push(i[e])}for(this.push('">'),e=0;e<r.length;e++)this.push(r[e]);this.push("</style>"),r.length=0,i.length=0}}function ez(e){if(0===e.state){e.state=1;var t=e.props;for(eo(eE,{rel:"preload",as:"style",href:e.props.href,crossOrigin:t.crossOrigin,fetchPriority:t.fetchPriority,integrity:t.integrity,media:t.media,hrefLang:t.hrefLang,referrerPolicy:t.referrerPolicy}),e=0;e<eE.length;e++)this.push(eE[e]);eE.length=0}}function eR(e){e.sheets.forEach(ez,this),e.sheets.clear()}function eD(){return{styles:new Set,stylesheets:new Set}}function eL(e,t){null==e.crossOrigin&&(e.crossOrigin=t[0]),null==e.integrity&&(e.integrity=t[1])}function eF(e,t,r){for(var i in t="<"+(e=(""+e).replace(eB,eO))+'>; rel=preload; as="'+(t=(""+t).replace(eN,eV))+'"',r)P.call(r,i)&&"string"==typeof(e=r[i])&&(t+="; "+i.toLowerCase()+'="'+(""+e).replace(eN,eV)+'"');return t}var eB=/[<>\r\n]/g;function eO(e){switch(e){case"<":return"%3C";case">":return"%3E";case"\n":return"%0A";case"\r":return"%0D";default:throw Error("escapeLinkHrefForHeaderContextReplacer encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}}var eN=/["';,\r\n]/g;function eV(e){switch(e){case'"':return"%22";case"'":return"%27";case";":return"%3B";case",":return"%2C";case"\n":return"%0A";case"\r":return"%0D";default:throw Error("escapeStringForLinkHeaderQuotedParamValueContextReplacer encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}}function e$(e){this.styles.add(e)}function ej(e){this.stylesheets.add(e)}function eU(e,t){var r=e.idPrefix,i=[],a=e.bootstrapScriptContent,n=e.bootstrapScripts,s=e.bootstrapModules;void 0!==a&&i.push("<script>",(""+a).replace(q,Z),"</script>"),a=r+"P:";var o=r+"S:";r+="B:";var l=new Set,u=new Set,h=new Set,c=new Map,d=new Set,p=new Set,f=new Set,m={images:new Map,stylesheets:new Map,scripts:new Map,moduleScripts:new Map};if(void 0!==n)for(var g=0;g<n.length;g++){var y,_=n[g],x=void 0,v=void 0,b={rel:"preload",as:"script",fetchPriority:"low",nonce:void 0};"string"==typeof _?b.href=y=_:(b.href=y=_.src,b.integrity=v="string"==typeof _.integrity?_.integrity:void 0,b.crossOrigin=x="string"==typeof _||null==_.crossOrigin?void 0:"use-credentials"===_.crossOrigin?"use-credentials":"");var w=y;(_=e).scriptResources[w]=null,_.moduleScriptResources[w]=null,eo(_=[],b),d.add(_),i.push('<script src="',F(y)),"string"==typeof v&&i.push('" integrity="',F(v)),"string"==typeof x&&i.push('" crossorigin="',F(x)),i.push('" async=""></script>')}if(void 0!==s)for(n=0;n<s.length;n++)b=s[n],x=y=void 0,v={rel:"modulepreload",fetchPriority:"low",nonce:void 0},"string"==typeof b?v.href=g=b:(v.href=g=b.src,v.integrity=x="string"==typeof b.integrity?b.integrity:void 0,v.crossOrigin=y="string"==typeof b||null==b.crossOrigin?void 0:"use-credentials"===b.crossOrigin?"use-credentials":""),b=e,_=g,b.scriptResources[_]=null,b.moduleScriptResources[_]=null,eo(b=[],v),d.add(b),i.push('<script type="module" src="',F(g)),"string"==typeof x&&i.push('" integrity="',F(x)),"string"==typeof y&&i.push('" crossorigin="',F(y)),i.push('" async=""></script>');return{placeholderPrefix:a,segmentPrefix:o,boundaryPrefix:r,startInlineScript:"<script>",htmlChunks:null,headChunks:null,externalRuntimeScript:null,bootstrapChunks:i,importMapChunks:[],onHeaders:void 0,headers:null,resets:{font:{},dns:{},connect:{default:{},anonymous:{},credentials:{}},image:{},style:{}},charsetChunks:[],viewportChunks:[],hoistableChunks:[],preconnects:l,fontPreloads:u,highImagePreloads:h,styles:c,bootstrapScripts:d,scripts:p,bulkPreloads:f,preloads:m,stylesToHoist:!1,generateStaticMarkup:t}}function eq(e,t,r,i){return r.generateStaticMarkup?(e.push(F(t)),!1):(""===t?e=i:(i&&e.push("<!-- -->"),e.push(F(t)),e=!0),e)}var eZ=Symbol.for("react.client.reference");function eG(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===eZ?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case l:return"Fragment";case o:return"Portal";case h:return"Profiler";case u:return"StrictMode";case m:return"Suspense";case g:return"SuspenseList";case S:return"Cache"}if("object"==typeof e)switch(e.$$typeof){case c:return(e._context.displayName||"Context")+".Provider";case p:return(e.displayName||"Context")+".Consumer";case f:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:eG(e.type)||"Memo";case _:t=e._payload,e=e._init;try{return eG(e(t))}catch(e){}}return null}var eH={};function eW(e,t){if(!(e=e.contextTypes))return eH;var r,i={};for(r in e)i[r]=t[r];return i}var eX=null;function eK(e,t){if(e!==t){e.context._currentValue2=e.parentValue,e=e.parent;var r=t.parent;if(null===e){if(null!==r)throw Error("The stacks must reach the root at the same time. This is a bug in React.")}else{if(null===r)throw Error("The stacks must reach the root at the same time. This is a bug in React.");eK(e,r)}t.context._currentValue2=t.value}}function eJ(e){var t=eX;t!==e&&(null===t?function e(t){var r=t.parent;null!==r&&e(r),t.context._currentValue2=t.value}(e):null===e?function e(t){t.context._currentValue2=t.parentValue,null!==(t=t.parent)&&e(t)}(t):t.depth===e.depth?eK(t,e):t.depth>e.depth?function e(t,r){if(t.context._currentValue2=t.parentValue,null===(t=t.parent))throw Error("The depth must equal at least at zero before reaching the root. This is a bug in React.");t.depth===r.depth?eK(t,r):e(t,r)}(t,e):function e(t,r){var i=r.parent;if(null===i)throw Error("The depth must equal at least at zero before reaching the root. This is a bug in React.");t.depth===i.depth?eK(t,i):e(t,i),r.context._currentValue2=r.value}(t,e),eX=e)}var eY={isMounted:function(){return!1},enqueueSetState:function(e,t){null!==(e=e._reactInternals).queue&&e.queue.push(t)},enqueueReplaceState:function(e,t){(e=e._reactInternals).replace=!0,e.queue=[t]},enqueueForceUpdate:function(){}};function eQ(e,t,r,i){var a=void 0!==e.state?e.state:null;e.updater=eY,e.props=r,e.state=a;var n={queue:[],replace:!1};e._reactInternals=n;var s=t.contextType;if(e.context="object"==typeof s&&null!==s?s._currentValue2:i,"function"==typeof(s=t.getDerivedStateFromProps)&&(a=null==(s=s(r,a))?a:C({},a,s),e.state=a),"function"!=typeof t.getDerivedStateFromProps&&"function"!=typeof e.getSnapshotBeforeUpdate&&("function"==typeof e.UNSAFE_componentWillMount||"function"==typeof e.componentWillMount)){if(t=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),t!==e.state&&eY.enqueueReplaceState(e,e.state,null),null!==n.queue&&0<n.queue.length){if(t=n.queue,s=n.replace,n.queue=null,n.replace=!1,s&&1===t.length)e.state=t[0];else{for(n=s?t[0]:e.state,a=!0,s=s?1:0;s<t.length;s++){var o=t[s];null!=(o="function"==typeof o?o.call(e,n,r,i):o)&&(a?(a=!1,n=C({},n,o)):C(n,o))}e.state=n}}else n.queue=null}}var e0={id:1,overflow:""};function e1(e,t,r){var i=e.id;e=e.overflow;var a=32-e2(i)-1;i&=~(1<<a),r+=1;var n=32-e2(t)+a;if(30<n){var s=a-a%5;return n=(i&(1<<s)-1).toString(32),i>>=s,a-=s,{id:1<<32-e2(t)+a|r<<a|i,overflow:n+e}}return{id:1<<n|r<<a|i,overflow:e}}var e2=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(e3(e)/e5|0)|0},e3=Math.log,e5=Math.LN2,e4=Error("Suspense Exception: This is not a real error! It's an implementation detail of `use` to interrupt the current render. You must either rethrow it immediately, or move the `use` call outside of the `try/catch` block. Capturing without rethrowing will lead to unexpected behavior.\n\nTo handle async errors, wrap your component in an error boundary, or call the promise's `.catch` method and pass the result to `use`");function e6(){}var e8=null;function e9(){if(null===e8)throw Error("Expected a suspended thenable. This is a bug in React. Please file an issue.");var e=e8;return e8=null,e}var e7="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},te=null,tt=null,tr=null,ti=null,ta=null,tn=null,ts=!1,to=!1,tl=0,tu=0,th=-1,tc=0,td=null,tp=null,tf=0;function tm(){if(null===te)throw Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.");return te}function tg(){if(0<tf)throw Error("Rendered more hooks than during the previous render");return{memoizedState:null,queue:null,next:null}}function ty(){return null===tn?null===ta?(ts=!1,ta=tn=tg()):(ts=!0,tn=ta):null===tn.next?(ts=!1,tn=tn.next=tg()):(ts=!0,tn=tn.next),tn}function t_(){var e=td;return td=null,e}function tx(){ti=tr=tt=te=null,to=!1,ta=null,tf=0,tn=tp=null}function tv(e,t){return"function"==typeof t?t(e):t}function tb(e,t,r){if(te=tm(),tn=ty(),ts){var i=tn.queue;if(t=i.dispatch,null!==tp&&void 0!==(r=tp.get(i))){tp.delete(i),i=tn.memoizedState;do i=e(i,r.action),r=r.next;while(null!==r);return tn.memoizedState=i,[i,t]}return[tn.memoizedState,t]}return e=e===tv?"function"==typeof t?t():t:void 0!==r?r(t):t,tn.memoizedState=e,e=(e=tn.queue={last:null,dispatch:null}).dispatch=tS.bind(null,te,e),[tn.memoizedState,e]}function tw(e,t){if(te=tm(),tn=ty(),t=void 0===t?null:t,null!==tn){var r=tn.memoizedState;if(null!==r&&null!==t){var i=r[1];e:if(null===i)i=!1;else{for(var a=0;a<i.length&&a<t.length;a++)if(!e7(t[a],i[a])){i=!1;break e}i=!0}if(i)return r[0]}}return e=e(),tn.memoizedState=[e,t],e}function tS(e,t,r){if(25<=tf)throw Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");if(e===te){if(to=!0,e={action:r,next:null},null===tp&&(tp=new Map),void 0===(r=tp.get(t)))tp.set(t,e);else{for(t=r;null!==t.next;)t=t.next;t.next=e}}}function tk(){throw Error("startTransition cannot be called during server rendering.")}function tT(){throw Error("Cannot update optimistic state while rendering.")}function tI(e){var t=tc;return tc+=1,null===td&&(td=[]),function(e,t,r){switch(void 0===(r=e[r])?e.push(t):r!==t&&(t.then(e6,e6),t=r),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:if("string"!=typeof t.status)switch((e=t).status="pending",e.then(function(e){if("pending"===t.status){var r=t;r.status="fulfilled",r.value=e}},function(e){if("pending"===t.status){var r=t;r.status="rejected",r.reason=e}}),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}throw e8=t,e4}}(td,e,t)}function tC(){throw Error("Cache cannot be refreshed during server rendering.")}function tP(){}var tE,tM={readContext:function(e){return e._currentValue2},use:function(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return tI(e);if(e.$$typeof===p)return e._currentValue2}throw Error("An unsupported type was passed to use(): "+String(e))},useContext:function(e){return tm(),e._currentValue2},useMemo:tw,useReducer:tb,useRef:function(e){te=tm();var t=(tn=ty()).memoizedState;return null===t?(e={current:e},tn.memoizedState=e):t},useState:function(e){return tb(tv,e)},useInsertionEffect:tP,useLayoutEffect:tP,useCallback:function(e,t){return tw(function(){return e},t)},useImperativeHandle:tP,useEffect:tP,useDebugValue:tP,useDeferredValue:function(e){return tm(),e},useTransition:function(){return tm(),[!1,tk]},useId:function(){var e=tt.treeContext,t=e.overflow;e=((e=e.id)&~(1<<32-e2(e)-1)).toString(32)+t;var r=tA;if(null===r)throw Error("Invalid hook call. Hooks can only be called inside of the body of a function component.");return t=tl++,e=":"+r.idPrefix+"R"+e,0<t&&(e+="H"+t.toString(32)),e+":"},useSyncExternalStore:function(e,t,r){if(void 0===r)throw Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");return r()},useCacheRefresh:function(){return tC},useHostTransitionStatus:function(){return tm(),V},useOptimistic:function(e){return tm(),[e,tT]},useFormState:function(e,t,r){tm();var i=tu++,a=tr;if("function"==typeof e.$$FORM_ACTION){var n=null,s=ti;a=a.formState;var o=e.$$IS_SIGNATURE_EQUAL;if(null!==a&&"function"==typeof o){var l=a[1];o.call(e,a[2],a[3])&&l===(n=void 0!==r?"p"+r:"k"+I(JSON.stringify([s,null,i]),0))&&(th=i,t=a[0])}var u=e.bind(null,t);return e=function(e){u(e)},"function"==typeof u.$$FORM_ACTION&&(e.$$FORM_ACTION=function(e){e=u.$$FORM_ACTION(e),void 0!==r&&(r+="",e.action=r);var t=e.data;return t&&(null===n&&(n=void 0!==r?"p"+r:"k"+I(JSON.stringify([s,null,i]),0)),t.append("$ACTION_KEY",n)),e}),[t,e]}var h=e.bind(null,t);return[t,function(e){h(e)}]}},tA=null,tz={getCacheSignal:function(){throw Error("Not implemented.")},getCacheForType:function(){throw Error("Not implemented.")}};function tR(e){if(void 0===tE)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);tE=t&&t[1]||""}return"\n"+tE+e}var tD=!1;function tL(e,t){if(!e||tD)return"";tD=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var i={DetermineComponentFrameRoot:function(){try{if(t){var r=function(){throw Error()};if(Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(r,[])}catch(e){var i=e}Reflect.construct(e,[],r)}else{try{r.call()}catch(e){i=e}e.call(r.prototype)}}else{try{throw Error()}catch(e){i=e}(r=e())&&"function"==typeof r.catch&&r.catch(function(){})}}catch(e){if(e&&i&&"string"==typeof e.stack)return[e.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});try{var n=i.DetermineComponentFrameRoot(),s=n[0],o=n[1];if(s&&o){var l=s.split("\n"),u=o.split("\n");for(a=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;a<u.length&&!u[a].includes("DetermineComponentFrameRoot");)a++;if(i===l.length||a===u.length)for(i=l.length-1,a=u.length-1;1<=i&&0<=a&&l[i]!==u[a];)a--;for(;1<=i&&0<=a;i--,a--)if(l[i]!==u[a]){if(1!==i||1!==a)do if(i--,a--,0>a||l[i]!==u[a]){var h="\n"+l[i].replace(" at new "," at ");return e.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",e.displayName)),h}while(1<=i&&0<=a);break}}}finally{tD=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?tR(r):""}var tF=N.ReactCurrentDispatcher,tB=N.ReactCurrentCache;function tO(e){return console.error(e),null}function tN(){}function tV(e,t,r,i,a,n,s,o,l,u,h,c){$.current=j;var d=[],p=new Set;return(r=tG(t={destination:null,flushScheduled:!1,resumableState:t,renderState:r,rootFormatContext:i,progressiveChunkSize:void 0===a?12800:a,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:p,pingedTasks:d,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],trackedPostpones:null,onError:void 0===n?tO:n,onPostpone:void 0===h?tN:h,onAllReady:void 0===s?tN:s,onShellReady:void 0===o?tN:o,onShellError:void 0===l?tN:l,onFatalError:void 0===u?tN:u,formState:void 0===c?null:c},0,null,i,!1,!1)).parentFlushed=!0,e=tq(t,null,e,-1,null,r,null,p,null,i,eH,null,e0,null,!1),d.push(e),t}var t$=null;function tj(e,t){e.pingedTasks.push(t),1===e.pingedTasks.length&&(e.flushScheduled=null!==e.destination,ra(e))}function tU(e,t){return{status:0,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,completedSegments:[],byteSize:0,fallbackAbortableTasks:t,errorDigest:null,contentState:eD(),fallbackState:eD(),trackedContentKeyPath:null,trackedFallbackNode:null}}function tq(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f){e.allPendingTasks++,null===a?e.pendingRootTasks++:a.pendingTasks++;var m={replay:null,node:r,childIndex:i,ping:function(){return tj(e,m)},blockedBoundary:a,blockedSegment:n,hoistableState:s,abortSet:o,keyPath:l,formatContext:u,legacyContext:h,context:c,treeContext:d,componentStack:p,thenableState:t,isFallback:f};return o.add(m),m}function tZ(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f){e.allPendingTasks++,null===n?e.pendingRootTasks++:n.pendingTasks++,r.pendingTasks++;var m={replay:r,node:i,childIndex:a,ping:function(){return tj(e,m)},blockedBoundary:n,blockedSegment:null,hoistableState:s,abortSet:o,keyPath:l,formatContext:u,legacyContext:h,context:c,treeContext:d,componentStack:p,thenableState:t,isFallback:f};return o.add(m),m}function tG(e,t,r,i,a,n){return{status:0,id:-1,index:t,parentFlushed:!1,chunks:[],children:[],parentFormatContext:i,boundary:r,lastPushedText:a,textEmbedded:n}}function tH(e,t){return{tag:0,parent:e.componentStack,type:t}}function tW(e,t){if(t&&null!==e.trackedPostpones){try{e="";do{switch(t.tag){case 0:e+=tR(t.type,null);break;case 1:e+=tL(t.type,!1);break;case 2:e+=tL(t.type,!0)}t=t.parent}while(t);var r=e}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}r={componentStack:r}}else r={};return r}function tX(e,t,r){if(null==(e=e.onError(t,r))||"string"==typeof e)return e}function tK(e,t){var r=e.onShellError;r(t),(r=e.onFatalError)(t),null!==e.destination?(e.status=2,e.destination.destroy(t)):(e.status=1,e.fatalError=t)}function tJ(e,t,r,i,a,n){var s=t.thenableState;for(t.thenableState=null,te={},tt=t,tr=e,ti=r,tu=tl=0,th=-1,tc=0,td=s,e=i(a,n);to;)to=!1,tu=tl=0,th=-1,tc=0,tf+=1,tn=null,e=i(a,n);return tx(),e}function tY(e,t,r,i,a){var n=i.render(),s=a.childContextTypes;if(null!=s){if(r=t.legacyContext,"function"!=typeof i.getChildContext)a=r;else{for(var o in i=i.getChildContext())if(!(o in s))throw Error((eG(a)||"Unknown")+'.getChildContext(): key "'+o+'" is not defined in childContextTypes.');a=C({},r,i)}t.legacyContext=a,t3(e,t,n,-1),t.legacyContext=r}else a=t.keyPath,t.keyPath=r,t3(e,t,n,-1),t.keyPath=a}function tQ(e,t,r,i,a,n,s){var o=!1;if(0!==n&&null!==e.formState){var l=t.blockedSegment;if(null!==l){o=!0,l=l.chunks;for(var u=0;u<n;u++)u===s?l.push("<!--F!-->"):l.push("<!--F-->")}}n=t.keyPath,t.keyPath=r,a?(r=t.treeContext,t.treeContext=e1(r,1,0),t6(e,t,i,-1),t.treeContext=r):o?t6(e,t,i,-1):t3(e,t,i,-1),t.keyPath=n}function t0(e,t){if(e&&e.defaultProps)for(var r in t=C({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}function t1(e,t,r,a,n,s){if("function"==typeof a){if(a.prototype&&a.prototype.isReactComponent){s=t.componentStack,t.componentStack={tag:2,parent:t.componentStack,type:a};var o=eW(a,t.legacyContext),S=a.contextType;eQ(S=new a(n,"object"==typeof S&&null!==S?S._currentValue2:o),a,n,o),tY(e,t,r,S,a),t.componentStack=s}else{s=eW(a,t.legacyContext),o=t.componentStack,t.componentStack={tag:1,parent:t.componentStack,type:a},S=tJ(e,t,r,a,n,s);var k=0!==tl,I=tu,E=th;"object"==typeof S&&null!==S&&"function"==typeof S.render&&void 0===S.$$typeof?(eQ(S,a,n,s),tY(e,t,r,S,a)):tQ(e,t,r,S,k,I,E),t.componentStack=o}}else if("string"==typeof a){if(s=t.componentStack,t.componentStack=tH(t,a),null===(o=t.blockedSegment))o=n.children,S=t.formatContext,k=t.keyPath,t.formatContext=X(S,a,n),t.keyPath=r,t6(e,t,o,-1),t.formatContext=S,t.keyPath=k;else{k=function(e,t,r,a,n,s,o,l,u){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":break;case"select":e.push(ef("select"));var h,c=null,d=null;for(h in r)if(P.call(r,h)){var p=r[h];if(null!=p)switch(h){case"children":c=p;break;case"dangerouslySetInnerHTML":d=p;break;case"defaultValue":case"value":break;default:ea(e,h,p)}}return e.push(">"),en(e,d,c),c;case"option":var f=o.selectedValue;e.push(ef("option"));var m,g=null,y=null,_=null,x=null;for(m in r)if(P.call(r,m)){var v=r[m];if(null!=v)switch(m){case"children":g=v;break;case"selected":_=v;break;case"dangerouslySetInnerHTML":x=v;break;case"value":y=v;default:ea(e,m,v)}}if(null!=f){var b,w,S=null!==y?""+y:(b=g,w="",i.Children.forEach(b,function(e){null!=e&&(w+=e)}),w);if(T(f)){for(var k=0;k<f.length;k++)if(""+f[k]===S){e.push(' selected=""');break}}else""+f===S&&e.push(' selected=""')}else _&&e.push(' selected=""');return e.push(">"),en(e,x,g),g;case"textarea":e.push(ef("textarea"));var I,E=null,M=null,A=null;for(I in r)if(P.call(r,I)){var R=r[I];if(null!=R)switch(I){case"children":A=R;break;case"value":E=R;break;case"defaultValue":M=R;break;case"dangerouslySetInnerHTML":throw Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");default:ea(e,I,R)}}if(null===E&&null!==M&&(E=M),e.push(">"),null!=A){if(null!=E)throw Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(T(A)){if(1<A.length)throw Error("<textarea> can only have at most one child.");E=""+A[0]}E=""+A}return"string"==typeof E&&"\n"===E[0]&&e.push("\n"),null!==E&&e.push(F(""+E)),null;case"input":e.push(ef("input"));var D,L=null,B=null,O=null,N=null,V=null,$=null,j=null,q=null,Z=null;for(D in r)if(P.call(r,D)){var G=r[D];if(null!=G)switch(D){case"children":case"dangerouslySetInnerHTML":throw Error("input is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");case"name":L=G;break;case"formAction":B=G;break;case"formEncType":O=G;break;case"formMethod":N=G;break;case"formTarget":V=G;break;case"defaultChecked":Z=G;break;case"defaultValue":j=G;break;case"checked":q=G;break;case"value":$=G;break;default:ea(e,D,G)}}var H=ei(e,a,n,B,O,N,V,L);return null!==q?Y(e,"checked",q):null!==Z&&Y(e,"checked",Z),null!==$?ea(e,"value",$):null!==j&&ea(e,"value",j),e.push("/>"),null!==H&&H.forEach(er,e),null;case"button":e.push(ef("button"));var W,X=null,K=null,ed=null,ep=null,em=null,ey=null,e_=null;for(W in r)if(P.call(r,W)){var ex=r[W];if(null!=ex)switch(W){case"children":X=ex;break;case"dangerouslySetInnerHTML":K=ex;break;case"name":ed=ex;break;case"formAction":ep=ex;break;case"formEncType":em=ex;break;case"formMethod":ey=ex;break;case"formTarget":e_=ex;break;default:ea(e,W,ex)}}var ev=ei(e,a,n,ep,em,ey,e_,ed);if(e.push(">"),null!==ev&&ev.forEach(er,e),en(e,K,X),"string"==typeof X){e.push(F(X));var eb=null}else eb=X;return eb;case"form":e.push(ef("form"));var ew,eS=null,ek=null,eT=null,eI=null,eC=null,eP=null;for(ew in r)if(P.call(r,ew)){var eE=r[ew];if(null!=eE)switch(ew){case"children":eS=eE;break;case"dangerouslySetInnerHTML":ek=eE;break;case"action":eT=eE;break;case"encType":eI=eE;break;case"method":eC=eE;break;case"target":eP=eE;break;default:ea(e,ew,eE)}}var eM=null,eA=null;if("function"==typeof eT){if("function"==typeof eT.$$FORM_ACTION){var ez=ee(a),eR=eT.$$FORM_ACTION(ez);eT=eR.action||"",eI=eR.encType,eC=eR.method,eP=eR.target,eM=eR.data,eA=eR.name}else e.push(" ","action",'="',et,'"'),eP=eC=eI=eT=null,es(a,n)}if(null!=eT&&ea(e,"action",eT),null!=eI&&ea(e,"encType",eI),null!=eC&&ea(e,"method",eC),null!=eP&&ea(e,"target",eP),e.push(">"),null!==eA&&(e.push('<input type="hidden"'),Q(e,"name",eA),e.push("/>"),null!==eM&&eM.forEach(er,e)),en(e,ek,eS),"string"==typeof eS){e.push(F(eS));var eD=null}else eD=eS;return eD;case"menuitem":for(var eB in e.push(ef("menuitem")),r)if(P.call(r,eB)){var eO=r[eB];if(null!=eO)switch(eB){case"children":case"dangerouslySetInnerHTML":throw Error("menuitems cannot have `children` nor `dangerouslySetInnerHTML`.");default:ea(e,eB,eO)}}return e.push(">"),null;case"title":if(3===o.insertionMode||1&o.tagScope||null!=r.itemProp)var eN=eu(e,r);else u?eN=null:(eu(n.hoistableChunks,r),eN=void 0);return eN;case"link":var eV=r.rel,e$=r.href,ej=r.precedence;if(3===o.insertionMode||1&o.tagScope||null!=r.itemProp||"string"!=typeof eV||"string"!=typeof e$||""===e$){eo(e,r);var eU=null}else if("stylesheet"===r.rel){if("string"!=typeof ej||null!=r.disabled||r.onLoad||r.onError)eU=eo(e,r);else{var eq=n.styles.get(ej),eZ=a.styleResources.hasOwnProperty(e$)?a.styleResources[e$]:void 0;if(null!==eZ){a.styleResources[e$]=null,eq||(eq={precedence:F(ej),rules:[],hrefs:[],sheets:new Map},n.styles.set(ej,eq));var eG={state:0,props:C({},r,{"data-precedence":r.precedence,precedence:null})};if(eZ){2===eZ.length&&eL(eG.props,eZ);var eH=n.preloads.stylesheets.get(e$);eH&&0<eH.length?eH.length=0:eG.state=1}eq.sheets.set(e$,eG),s&&s.stylesheets.add(eG)}else if(eq){var eW=eq.sheets.get(e$);eW&&s&&s.stylesheets.add(eW)}l&&e.push("<!-- -->"),eU=null}}else r.onLoad||r.onError?eU=eo(e,r):(l&&e.push("<!-- -->"),eU=u?null:eo(n.hoistableChunks,r));return eU;case"script":var eX=r.async;if("string"!=typeof r.src||!r.src||!eX||"function"==typeof eX||"symbol"==typeof eX||r.onLoad||r.onError||3===o.insertionMode||1&o.tagScope||null!=r.itemProp)var eK=eh(e,r);else{var eJ=r.src;if("module"===r.type)var eY=a.moduleScriptResources,eQ=n.preloads.moduleScripts;else eY=a.scriptResources,eQ=n.preloads.scripts;var e0=eY.hasOwnProperty(eJ)?eY[eJ]:void 0;if(null!==e0){eY[eJ]=null;var e1=r;if(e0){2===e0.length&&eL(e1=C({},r),e0);var e2=eQ.get(eJ);e2&&(e2.length=0)}var e3=[];n.scripts.add(e3),eh(e3,e1)}l&&e.push("<!-- -->"),eK=null}return eK;case"style":var e5=r.precedence,e4=r.href;if(3===o.insertionMode||1&o.tagScope||null!=r.itemProp||"string"!=typeof e5||"string"!=typeof e4||""===e4){e.push(ef("style"));var e6,e8=null,e9=null;for(e6 in r)if(P.call(r,e6)){var e7=r[e6];if(null!=e7)switch(e6){case"children":e8=e7;break;case"dangerouslySetInnerHTML":e9=e7;break;default:ea(e,e6,e7)}}e.push(">");var te=Array.isArray(e8)?2>e8.length?e8[0]:null:e8;"function"!=typeof te&&"symbol"!=typeof te&&null!=te&&e.push(F(""+te)),en(e,e9,e8),e.push(eg("style"));var tt=null}else{var tr=n.styles.get(e5);if(null!==(a.styleResources.hasOwnProperty(e4)?a.styleResources[e4]:void 0)){a.styleResources[e4]=null,tr?tr.hrefs.push(F(e4)):(tr={precedence:F(e5),rules:[],hrefs:[F(e4)],sheets:new Map},n.styles.set(e5,tr));var ti,ta=tr.rules,tn=null,ts=null;for(ti in r)if(P.call(r,ti)){var to=r[ti];if(null!=to)switch(ti){case"children":tn=to;break;case"dangerouslySetInnerHTML":ts=to}}var tl=Array.isArray(tn)?2>tn.length?tn[0]:null:tn;"function"!=typeof tl&&"symbol"!=typeof tl&&null!=tl&&ta.push(F(""+tl)),en(ta,ts,tn)}tr&&s&&s.styles.add(tr),l&&e.push("<!-- -->"),tt=void 0}return tt;case"meta":if(3===o.insertionMode||1&o.tagScope||null!=r.itemProp)var tu=el(e,r,"meta");else l&&e.push("<!-- -->"),tu=u?null:"string"==typeof r.charSet?el(n.charsetChunks,r,"meta"):"viewport"===r.name?el(n.viewportChunks,r,"meta"):el(n.hoistableChunks,r,"meta");return tu;case"listing":case"pre":e.push(ef(t));var th,tc=null,td=null;for(th in r)if(P.call(r,th)){var tp=r[th];if(null!=tp)switch(th){case"children":tc=tp;break;case"dangerouslySetInnerHTML":td=tp;break;default:ea(e,th,tp)}}if(e.push(">"),null!=td){if(null!=tc)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if("object"!=typeof td||!("__html"in td))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.");var tf=td.__html;null!=tf&&("string"==typeof tf&&0<tf.length&&"\n"===tf[0]?e.push("\n",tf):e.push(""+tf))}return"string"==typeof tc&&"\n"===tc[0]&&e.push("\n"),tc;case"img":var tm=r.src,tg=r.srcSet;if(!("lazy"===r.loading||!tm&&!tg||"string"!=typeof tm&&null!=tm||"string"!=typeof tg&&null!=tg)&&"low"!==r.fetchPriority&&!1==!!(2&o.tagScope)&&("string"!=typeof tm||":"!==tm[4]||"d"!==tm[0]&&"D"!==tm[0]||"a"!==tm[1]&&"A"!==tm[1]||"t"!==tm[2]&&"T"!==tm[2]||"a"!==tm[3]&&"A"!==tm[3])&&("string"!=typeof tg||":"!==tg[4]||"d"!==tg[0]&&"D"!==tg[0]||"a"!==tg[1]&&"A"!==tg[1]||"t"!==tg[2]&&"T"!==tg[2]||"a"!==tg[3]&&"A"!==tg[3])){var ty="string"==typeof r.sizes?r.sizes:void 0,t_=tg?tg+"\n"+(ty||""):tm,tx=n.preloads.images,tv=tx.get(t_);if(tv)("high"===r.fetchPriority||10>n.highImagePreloads.size)&&(tx.delete(t_),n.highImagePreloads.add(tv));else if(!a.imageResources.hasOwnProperty(t_)){a.imageResources[t_]=U;var tb,tw=r.crossOrigin,tS="string"==typeof tw?"use-credentials"===tw?tw:"":void 0,tk=n.headers;tk&&0<tk.remainingCapacity&&("high"===r.fetchPriority||500>tk.highImagePreloads.length)&&(tb=eF(tm,"image",{imageSrcSet:r.srcSet,imageSizes:r.sizes,crossOrigin:tS,integrity:r.integrity,nonce:r.nonce,type:r.type,fetchPriority:r.fetchPriority,referrerPolicy:r.refererPolicy}),2<=(tk.remainingCapacity-=tb.length))?(n.resets.image[t_]=U,tk.highImagePreloads&&(tk.highImagePreloads+=", "),tk.highImagePreloads+=tb):(eo(tv=[],{rel:"preload",as:"image",href:tg?void 0:tm,imageSrcSet:tg,imageSizes:ty,crossOrigin:tS,integrity:r.integrity,type:r.type,fetchPriority:r.fetchPriority,referrerPolicy:r.referrerPolicy}),"high"===r.fetchPriority||10>n.highImagePreloads.size?n.highImagePreloads.add(tv):(n.bulkPreloads.add(tv),tx.set(t_,tv)))}}return el(e,r,"img");case"base":case"area":case"br":case"col":case"embed":case"hr":case"keygen":case"param":case"source":case"track":case"wbr":return el(e,r,t);case"head":if(2>o.insertionMode&&null===n.headChunks){n.headChunks=[];var tT=ec(n.headChunks,r,"head")}else tT=ec(e,r,"head");return tT;case"html":if(0===o.insertionMode&&null===n.htmlChunks){n.htmlChunks=[""];var tI=ec(n.htmlChunks,r,"html")}else tI=ec(e,r,"html");return tI;default:if(-1!==t.indexOf("-")){e.push(ef(t));var tC,tP=null,tE=null;for(tC in r)if(P.call(r,tC)){var tM=r[tC];if(null!=tM)switch(tC){case"children":tP=tM;break;case"dangerouslySetInnerHTML":tE=tM;break;case"style":J(e,tM);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"ref":break;default:z(tC)&&"function"!=typeof tM&&"symbol"!=typeof tM&&e.push(" ",tC,'="',F(tM),'"')}}return e.push(">"),en(e,tE,tP),tP}}return ec(e,r,t)}(o.chunks,a,n,e.resumableState,e.renderState,t.hoistableState,t.formatContext,o.lastPushedText,t.isFallback),o.lastPushedText=!1,S=t.formatContext,I=t.keyPath,t.formatContext=X(S,a,n),t.keyPath=r,t6(e,t,k,-1),t.formatContext=S,t.keyPath=I;e:{switch(r=o.chunks,e=e.resumableState,a){case"title":case"style":case"script":case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break e;case"body":if(1>=S.insertionMode){e.hasBody=!0;break e}break;case"html":if(0===S.insertionMode){e.hasHtml=!0;break e}}r.push(eg(a))}o.lastPushedText=!1}t.componentStack=s}else{switch(a){case w:case v:case u:case h:case l:a=t.keyPath,t.keyPath=r,t3(e,t,n.children,-1),t.keyPath=a;return;case b:"hidden"!==n.mode&&(a=t.keyPath,t.keyPath=r,t3(e,t,n.children,-1),t.keyPath=a);return;case g:a=t.componentStack,t.componentStack=tH(t,"SuspenseList"),s=t.keyPath,t.keyPath=r,t3(e,t,n.children,-1),t.keyPath=s,t.componentStack=a;return;case x:throw Error("ReactDOMServer does not yet support scope components.");case m:e:if(null!==t.replay){a=t.keyPath,t.keyPath=r,r=n.children;try{t6(e,t,r,-1)}finally{t.keyPath=a}}else{var M=t.componentStack;a=t.componentStack=tH(t,"Suspense");var A=t.keyPath;s=t.blockedBoundary;var R=t.hoistableState,D=t.blockedSegment;o=n.fallback;var L=n.children;S=tU(e,n=new Set),null!==e.trackedPostpones&&(S.trackedContentKeyPath=r),k=tG(e,D.chunks.length,S,t.formatContext,!1,!1),D.children.push(k),D.lastPushedText=!1;var B=tG(e,0,null,t.formatContext,!1,!1);B.parentFlushed=!0,t.blockedBoundary=S,t.hoistableState=S.contentState,t.blockedSegment=B,t.keyPath=r;try{if(t6(e,t,L,-1),e.renderState.generateStaticMarkup||B.lastPushedText&&B.textEmbedded&&B.chunks.push("<!-- -->"),B.status=1,rr(S,B),0===S.pendingTasks&&0===S.status){S.status=1,t.componentStack=M;break e}}catch(r){B.status=4,S.status=4,I=tW(e,t.componentStack),E=tX(e,r,I),S.errorDigest=E,t4(e,S)}finally{t.blockedBoundary=s,t.hoistableState=R,t.blockedSegment=D,t.keyPath=A,t.componentStack=M}I=[r[0],"Suspense Fallback",r[2]],null!==(E=e.trackedPostpones)&&(M=[I[1],I[2],[],null],E.workingMap.set(I,M),5===S.status?E.workingMap.get(r)[4]=M:S.trackedFallbackNode=M),t=tq(e,null,o,-1,s,k,S.fallbackState,n,I,t.formatContext,t.legacyContext,t.context,t.treeContext,a,!0),e.pingedTasks.push(t)}return}if("object"==typeof a&&null!==a)switch(a.$$typeof){case f:o=t.componentStack,t.componentStack={tag:1,parent:t.componentStack,type:a.render},n=tJ(e,t,r,a.render,n,s),tQ(e,t,r,n,0!==tl,tu,th),t.componentStack=o;return;case y:n=t0(a=a.type,n),t1(e,t,r,a,n,s);return;case c:if(o=n.children,s=t.keyPath,a=a._context,n=n.value,S=a._currentValue2,a._currentValue2=n,eX=n={parent:k=eX,depth:null===k?0:k.depth+1,context:a,parentValue:S,value:n},t.context=n,t.keyPath=r,t3(e,t,o,-1),null===(e=eX))throw Error("Tried to pop a Context at the root of the app. This is a bug in React.");e.context._currentValue2=e.parentValue,e=eX=e.parent,t.context=e,t.keyPath=s;return;case p:n=(n=n.children)(a._currentValue2),a=t.keyPath,t.keyPath=r,t3(e,t,n,-1),t.keyPath=a;return;case d:case _:s=t.componentStack,t.componentStack=tH(t,"Lazy"),n=t0(a=(o=a._init)(a._payload),n),t1(e,t,r,a,n,void 0),t.componentStack=s;return}throw Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: "+(null==a?a:typeof a)+".")}}function t2(e,t,r,i,a){var n=t.replay,s=t.blockedBoundary,o=tG(e,0,null,t.formatContext,!1,!1);o.id=r,o.parentFlushed=!0;try{t.replay=null,t.blockedSegment=o,t6(e,t,i,a),o.status=1,null===s?e.completedRootSegment=o:(rr(s,o),s.parentFlushed&&e.partialBoundaries.push(s))}finally{t.replay=n,t.blockedSegment=null}}function t3(e,t,r,i){if(null!==t.replay&&"number"==typeof t.replay.slots)t2(e,t,t.replay.slots,r,i);else if(t.node=r,t.childIndex=i,null!==r){if("object"==typeof r){switch(r.$$typeof){case s:var a=r.type,n=r.key,l=r.props,u=r.ref,h=eG(a),c=null==n?-1===i?0:i:n;if(n=[t.keyPath,h,c],null!==t.replay)e:{var d=t.replay;for(r=0,i=d.nodes;r<i.length;r++){var f=i[r];if(c===f[1]){if(4===f.length){if(null!==h&&h!==f[0])throw Error("Expected the resume to render <"+f[0]+"> in this slot but instead it rendered <"+h+">. The tree doesn't match so React will fallback to client rendering.");var g=f[2];h=f[3],c=t.node,t.replay={nodes:g,slots:h,pendingTasks:1};try{if(t1(e,t,n,a,l,u),1===t.replay.pendingTasks&&0<t.replay.nodes.length)throw Error("Couldn't find all resumable slots by key/index during replaying. The tree doesn't match so React will fallback to client rendering.");t.replay.pendingTasks--}catch(r){if("object"==typeof r&&null!==r&&(r===e4||"function"==typeof r.then))throw t.node===c&&(t.replay=d),r;t.replay.pendingTasks--,l=tW(e,t.componentStack),n=e,e=t.blockedBoundary,l=tX(n,a=r,l),t9(n,e,g,h,a,l)}t.replay=d}else{if(a!==m)throw Error("Expected the resume to render <Suspense> in this slot but instead it rendered <"+(eG(a)||"Unknown")+">. The tree doesn't match so React will fallback to client rendering.");t:{d=void 0,a=f[5],u=f[2],h=f[3],c=null===f[4]?[]:f[4][2],f=null===f[4]?null:f[4][3];var y=t.componentStack,x=t.componentStack=tH(t,"Suspense"),v=t.keyPath,b=t.replay,w=t.blockedBoundary,S=t.hoistableState,I=l.children;l=l.fallback;var C=new Set,P=tU(e,C);P.parentFlushed=!0,P.rootSegmentID=a,t.blockedBoundary=P,t.hoistableState=P.contentState,t.replay={nodes:u,slots:h,pendingTasks:1};try{if(t6(e,t,I,-1),1===t.replay.pendingTasks&&0<t.replay.nodes.length)throw Error("Couldn't find all resumable slots by key/index during replaying. The tree doesn't match so React will fallback to client rendering.");if(t.replay.pendingTasks--,0===P.pendingTasks&&0===P.status){P.status=1,e.completedBoundaries.push(P);break t}}catch(r){P.status=4,g=tW(e,t.componentStack),d=tX(e,r,g),P.errorDigest=d,t.replay.pendingTasks--,e.clientRenderedBoundaries.push(P)}finally{t.blockedBoundary=w,t.hoistableState=S,t.replay=b,t.keyPath=v,t.componentStack=y}t=tZ(e,null,{nodes:c,slots:f,pendingTasks:0},l,-1,w,P.fallbackState,C,[n[0],"Suspense Fallback",n[2]],t.formatContext,t.legacyContext,t.context,t.treeContext,x,!0),e.pingedTasks.push(t)}}i.splice(r,1);break e}}}else t1(e,t,n,a,l,u);return;case o:throw Error("Portals are not currently supported by the server renderer. Render them conditionally so that they only appear on the client render.");case _:l=t.componentStack,t.componentStack=tH(t,"Lazy"),r=(n=r._init)(r._payload),t.componentStack=l,t3(e,t,r,i);return}if(T(r)){t5(e,t,r,i);return}if((l=null===r||"object"!=typeof r?null:"function"==typeof(l=k&&r[k]||r["@@iterator"])?l:null)&&(l=l.call(r))){if(!(r=l.next()).done){n=[];do n.push(r.value),r=l.next();while(!r.done);t5(e,t,n,i)}return}if("function"==typeof r.then)return t.thenableState=null,t3(e,t,tI(r),i);if(r.$$typeof===p)return t3(e,t,r._currentValue2,i);throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(i=Object.prototype.toString.call(r))?"object with keys {"+Object.keys(r).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.")}"string"==typeof r?null!==(i=t.blockedSegment)&&(i.lastPushedText=eq(i.chunks,r,e.renderState,i.lastPushedText)):"number"==typeof r&&null!==(i=t.blockedSegment)&&(i.lastPushedText=eq(i.chunks,""+r,e.renderState,i.lastPushedText))}}function t5(e,t,r,i){var a=t.keyPath;if(-1!==i&&(t.keyPath=[t.keyPath,"Fragment",i],null!==t.replay)){for(var n=t.replay,s=n.nodes,o=0;o<s.length;o++){var l=s[o];if(l[1]===i){i=l[2],l=l[3],t.replay={nodes:i,slots:l,pendingTasks:1};try{if(t5(e,t,r,-1),1===t.replay.pendingTasks&&0<t.replay.nodes.length)throw Error("Couldn't find all resumable slots by key/index during replaying. The tree doesn't match so React will fallback to client rendering.");t.replay.pendingTasks--}catch(a){if("object"==typeof a&&null!==a&&(a===e4||"function"==typeof a.then))throw a;t.replay.pendingTasks--,r=tW(e,t.componentStack);var u=t.blockedBoundary;r=tX(e,a,r),t9(e,u,i,l,a,r)}t.replay=n,s.splice(o,1);break}}t.keyPath=a;return}if(n=t.treeContext,s=r.length,null!==t.replay&&null!==(o=t.replay.slots)&&"object"==typeof o){for(i=0;i<s;i++)l=r[i],t.treeContext=e1(n,s,i),"number"==typeof(u=o[i])?(t2(e,t,u,l,i),delete o[i]):t6(e,t,l,i);t.treeContext=n,t.keyPath=a;return}for(o=0;o<s;o++)i=r[o],t.treeContext=e1(n,s,o),t6(e,t,i,o);t.treeContext=n,t.keyPath=a}function t4(e,t){null!==(e=e.trackedPostpones)&&null!==(t=t.trackedContentKeyPath)&&void 0!==(t=e.workingMap.get(t))&&(t.length=4,t[2]=[],t[3]=null)}function t6(e,t,r,i){var a=t.formatContext,n=t.legacyContext,s=t.context,o=t.keyPath,l=t.treeContext,u=t.componentStack,h=t.blockedSegment;if(null===h)try{return t3(e,t,r,i)}catch(h){if(tx(),"object"==typeof(r=h===e4?e9():h)&&null!==r&&"function"==typeof r.then){e=tZ(e,i=t_(),t.replay,t.node,t.childIndex,t.blockedBoundary,t.hoistableState,t.abortSet,t.keyPath,t.formatContext,t.legacyContext,t.context,t.treeContext,null!==t.componentStack?t.componentStack.parent:null,t.isFallback).ping,r.then(e,e),t.formatContext=a,t.legacyContext=n,t.context=s,t.keyPath=o,t.treeContext=l,t.componentStack=u,eJ(s);return}}else{var c=h.children.length,d=h.chunks.length;try{return t3(e,t,r,i)}catch(p){if(tx(),h.children.length=c,h.chunks.length=d,"object"==typeof(r=p===e4?e9():p)&&null!==r&&"function"==typeof r.then){i=t_(),c=tG(e,(h=t.blockedSegment).chunks.length,null,t.formatContext,h.lastPushedText,!0),h.children.push(c),h.lastPushedText=!1,e=tq(e,i,t.node,t.childIndex,t.blockedBoundary,c,t.hoistableState,t.abortSet,t.keyPath,t.formatContext,t.legacyContext,t.context,t.treeContext,null!==t.componentStack?t.componentStack.parent:null,t.isFallback).ping,r.then(e,e),t.formatContext=a,t.legacyContext=n,t.context=s,t.keyPath=o,t.treeContext=l,t.componentStack=u,eJ(s);return}}}throw t.formatContext=a,t.legacyContext=n,t.context=s,t.keyPath=o,t.treeContext=l,eJ(s),r}function t8(e){var t=e.blockedBoundary;null!==(e=e.blockedSegment)&&(e.status=3,ri(this,t,e))}function t9(e,t,r,i,a,n){for(var s=0;s<r.length;s++){var o=r[s];if(4===o.length)t9(e,t,o[2],o[3],a,n);else{o=o[5];var l=tU(e,new Set);l.parentFlushed=!0,l.rootSegmentID=o,l.status=4,l.errorDigest=n,l.parentFlushed&&e.clientRenderedBoundaries.push(l)}}if(r.length=0,null!==i){if(null===t)throw Error("We should not have any resumable nodes in the shell. This is a bug in React.");if(4!==t.status&&(t.status=4,t.errorDigest=n,t.parentFlushed&&e.clientRenderedBoundaries.push(t)),"object"==typeof i)for(var u in i)delete i[u]}}function t7(e,t){try{var r=e.renderState,i=r.onHeaders;if(i){var a=r.headers;if(a){r.headers=null;var n=a.preconnects;if(a.fontPreloads&&(n&&(n+=", "),n+=a.fontPreloads),a.highImagePreloads&&(n&&(n+=", "),n+=a.highImagePreloads),!t){var s=r.styles.values(),o=s.next();t:for(;0<a.remainingCapacity&&!o.done;o=s.next())for(var l=o.value.sheets.values(),u=l.next();0<a.remainingCapacity&&!u.done;u=l.next()){var h=u.value,c=h.props,d=c.href,p=h.props,f=eF(p.href,"style",{crossOrigin:p.crossOrigin,integrity:p.integrity,nonce:p.nonce,type:p.type,fetchPriority:p.fetchPriority,referrerPolicy:p.referrerPolicy,media:p.media});if(2<=(a.remainingCapacity-=f.length))r.resets.style[d]=U,n&&(n+=", "),n+=f,r.resets.style[d]="string"==typeof c.crossOrigin||"string"==typeof c.integrity?[c.crossOrigin,c.integrity]:U;else break t}}i(n?{Link:n}:{})}}}catch(t){tX(e,t,{})}}function re(e){null===e.trackedPostpones&&t7(e,!0),e.onShellError=tN,(e=e.onShellReady)()}function rt(e){t7(e,null===e.trackedPostpones||null===e.completedRootSegment||5!==e.completedRootSegment.status),(e=e.onAllReady)()}function rr(e,t){if(0===t.chunks.length&&1===t.children.length&&null===t.children[0].boundary&&-1===t.children[0].id){var r=t.children[0];r.id=t.id,r.parentFlushed=!0,1===r.status&&rr(e,r)}else e.completedSegments.push(t)}function ri(e,t,r){if(null===t){if(null!==r&&r.parentFlushed){if(null!==e.completedRootSegment)throw Error("There can only be one root segment. This is a bug in React.");e.completedRootSegment=r}e.pendingRootTasks--,0===e.pendingRootTasks&&re(e)}else t.pendingTasks--,4!==t.status&&(0===t.pendingTasks?(0===t.status&&(t.status=1),null!==r&&r.parentFlushed&&1===r.status&&rr(t,r),t.parentFlushed&&e.completedBoundaries.push(t),1===t.status&&(t.fallbackAbortableTasks.forEach(t8,e),t.fallbackAbortableTasks.clear())):null!==r&&r.parentFlushed&&1===r.status&&(rr(t,r),1===t.completedSegments.length&&t.parentFlushed&&e.partialBoundaries.push(t)));e.allPendingTasks--,0===e.allPendingTasks&&rt(e)}function ra(e){if(2!==e.status){var t=eX,r=tF.current;tF.current=tM;var i=tB.current;tB.current=tz;var a=t$;t$=e;var n=tA;tA=e.resumableState;try{var s,o=e.pingedTasks;for(s=0;s<o.length;s++){var l=o[s],u=e,h=l.blockedSegment;if(null===h){var c=u;if(0!==l.replay.pendingTasks){eJ(l.context);try{if(t3(c,l,l.node,l.childIndex),1===l.replay.pendingTasks&&0<l.replay.nodes.length)throw Error("Couldn't find all resumable slots by key/index during replaying. The tree doesn't match so React will fallback to client rendering.");l.replay.pendingTasks--,l.abortSet.delete(l),ri(c,l.blockedBoundary,null)}catch(e){tx();var d=e===e4?e9():e;if("object"==typeof d&&null!==d&&"function"==typeof d.then){var p=l.ping;d.then(p,p),l.thenableState=t_()}else{l.replay.pendingTasks--,l.abortSet.delete(l);var f=tW(c,l.componentStack);u=void 0;var m=c,g=l.blockedBoundary,y=l.replay.nodes,_=l.replay.slots;u=tX(m,d,f),t9(m,g,y,_,d,u),c.pendingRootTasks--,0===c.pendingRootTasks&&re(c),c.allPendingTasks--,0===c.allPendingTasks&&rt(c)}}finally{}}}else if(c=void 0,m=h,0===m.status){eJ(l.context);var x=m.children.length,v=m.chunks.length;try{t3(u,l,l.node,l.childIndex),u.renderState.generateStaticMarkup||m.lastPushedText&&m.textEmbedded&&m.chunks.push("<!-- -->"),l.abortSet.delete(l),m.status=1,ri(u,l.blockedBoundary,m)}catch(e){tx(),m.children.length=x,m.chunks.length=v;var b=e===e4?e9():e;if("object"==typeof b&&null!==b&&"function"==typeof b.then){var w=l.ping;b.then(w,w),l.thenableState=t_()}else{var S=tW(u,l.componentStack);l.abortSet.delete(l),m.status=4;var k=l.blockedBoundary;c=tX(u,b,S),null===k?tK(u,b):(k.pendingTasks--,4!==k.status&&(k.status=4,k.errorDigest=c,t4(u,k),k.parentFlushed&&u.clientRenderedBoundaries.push(k))),u.allPendingTasks--,0===u.allPendingTasks&&rt(u)}}finally{}}}o.splice(0,s),null!==e.destination&&rh(e,e.destination)}catch(t){tX(e,t,{}),tK(e,t)}finally{tA=n,tF.current=r,tB.current=i,r===tM&&eJ(t),t$=a}}}function rn(e,t,r,i){switch(r.parentFlushed=!0,r.status){case 0:r.id=e.nextSegmentId++;case 5:return i=r.id,r.lastPushedText=!1,r.textEmbedded=!1,e=e.renderState,t.push('<template id="'),t.push(e.placeholderPrefix),e=i.toString(16),t.push(e),t.push('"></template>');case 1:r.status=2;var a=!0,n=r.chunks,s=0;r=r.children;for(var o=0;o<r.length;o++){for(a=r[o];s<a.index;s++)t.push(n[s]);a=rs(e,t,a,i)}for(;s<n.length-1;s++)t.push(n[s]);return s<n.length&&(a=t.push(n[s])),a;default:throw Error("Aborted, errored or already flushed boundaries should not be flushed again. This is a bug in React.")}}function rs(e,t,r,i){var a=r.boundary;if(null===a)return rn(e,t,r,i);if(a.parentFlushed=!0,4===a.status)return e.renderState.generateStaticMarkup||(a=a.errorDigest,t.push("<!--$!-->"),t.push("<template"),a&&(t.push(' data-dgst="'),a=F(a),t.push(a),t.push('"')),t.push("></template>")),rn(e,t,r,i),e=!!e.renderState.generateStaticMarkup||t.push("<!--/$-->");if(1!==a.status)return 0===a.status&&(a.rootSegmentID=e.nextSegmentId++),0<a.completedSegments.length&&e.partialBoundaries.push(a),e_(t,e.renderState,a.rootSegmentID),i&&((a=a.fallbackState).styles.forEach(e$,i),a.stylesheets.forEach(ej,i)),rn(e,t,r,i),t.push("<!--/$-->");if(a.byteSize>e.progressiveChunkSize)return a.rootSegmentID=e.nextSegmentId++,e.completedBoundaries.push(a),e_(t,e.renderState,a.rootSegmentID),rn(e,t,r,i),t.push("<!--/$-->");if(i&&((r=a.contentState).styles.forEach(e$,i),r.stylesheets.forEach(ej,i)),e.renderState.generateStaticMarkup||t.push("<!--$-->"),1!==(r=a.completedSegments).length)throw Error("A previously unvisited boundary must have exactly one root segment. This is a bug in React.");return rs(e,t,r[0],i),e=!!e.renderState.generateStaticMarkup||t.push("<!--/$-->")}function ro(e,t,r,i){return function(e,t,r,i){switch(r.insertionMode){case 0:case 1:case 2:return e.push('<div hidden id="'),e.push(t.segmentPrefix),t=i.toString(16),e.push(t),e.push('">');case 3:return e.push('<svg aria-hidden="true" style="display:none" id="'),e.push(t.segmentPrefix),t=i.toString(16),e.push(t),e.push('">');case 4:return e.push('<math aria-hidden="true" style="display:none" id="'),e.push(t.segmentPrefix),t=i.toString(16),e.push(t),e.push('">');case 5:return e.push('<table hidden id="'),e.push(t.segmentPrefix),t=i.toString(16),e.push(t),e.push('">');case 6:return e.push('<table hidden><tbody id="'),e.push(t.segmentPrefix),t=i.toString(16),e.push(t),e.push('">');case 7:return e.push('<table hidden><tr id="'),e.push(t.segmentPrefix),t=i.toString(16),e.push(t),e.push('">');case 8:return e.push('<table hidden><colgroup id="'),e.push(t.segmentPrefix),t=i.toString(16),e.push(t),e.push('">');default:throw Error("Unknown insertion mode. This is a bug in React.")}}(t,e.renderState,r.parentFormatContext,r.id),rs(e,t,r,i),function(e,t){switch(t.insertionMode){case 0:case 1:case 2:return e.push("</div>");case 3:return e.push("</svg>");case 4:return e.push("</math>");case 5:return e.push("</table>");case 6:return e.push("</tbody></table>");case 7:return e.push("</tr></table>");case 8:return e.push("</colgroup></table>");default:throw Error("Unknown insertion mode. This is a bug in React.")}}(t,r.parentFormatContext)}function rl(e,t,r){for(var i=r.completedSegments,a=0;a<i.length;a++)ru(e,t,r,i[a]);i.length=0,eC(t,r.contentState,e.renderState),i=e.resumableState,e=e.renderState,a=r.rootSegmentID,r=r.contentState;var n=e.stylesToHoist;e.stylesToHoist=!1;var s=0===i.streamingFormat;return s?(t.push(e.startInlineScript),n?0==(2&i.instructions)?(i.instructions|=10,t.push('$RC=function(b,c,e){c=document.getElementById(c);c.parentNode.removeChild(c);var a=document.getElementById(b);if(a){b=a.previousSibling;if(e)b.data="$!",a.setAttribute("data-dgst",e);else{e=b.parentNode;a=b.nextSibling;var f=0;do{if(a&&8===a.nodeType){var d=a.data;if("/$"===d)if(0===f)break;else f--;else"$"!==d&&"$?"!==d&&"$!"!==d||f++}d=a.nextSibling;e.removeChild(a);a=d}while(a);for(;c.firstChild;)e.insertBefore(c.firstChild,a);b.data="$"}b._reactRetry&&b._reactRetry()}};$RM=new Map;\n$RR=function(r,t,w){for(var u=$RC,n=$RM,p=new Map,q=document,g,b,h=q.querySelectorAll("link[data-precedence],style[data-precedence]"),v=[],k=0;b=h[k++];)"not all"===b.getAttribute("media")?v.push(b):("LINK"===b.tagName&&n.set(b.getAttribute("href"),b),p.set(b.dataset.precedence,g=b));b=0;h=[];var l,a;for(k=!0;;){if(k){var f=w[b++];if(!f){k=!1;b=0;continue}var c=!1,m=0;var d=f[m++];if(a=n.get(d)){var e=a._p;c=!0}else{a=q.createElement("link");a.href=d;a.rel="stylesheet";for(a.dataset.precedence=\nl=f[m++];e=f[m++];)a.setAttribute(e,f[m++]);e=a._p=new Promise(function(x,y){a.onload=x;a.onerror=y});n.set(d,a)}d=a.getAttribute("media");!e||"l"===e.s||d&&!matchMedia(d).matches||h.push(e);if(c)continue}else{a=v[b++];if(!a)break;l=a.getAttribute("data-precedence");a.removeAttribute("media")}c=p.get(l)||g;c===g&&(g=a);p.set(l,a);c?c.parentNode.insertBefore(a,c.nextSibling):(c=q.head,c.insertBefore(a,c.firstChild))}Promise.all(h).then(u.bind(null,r,t,""),u.bind(null,r,t,"Resource failed to load"))};$RR("')):0==(8&i.instructions)?(i.instructions|=8,t.push('$RM=new Map;\n$RR=function(r,t,w){for(var u=$RC,n=$RM,p=new Map,q=document,g,b,h=q.querySelectorAll("link[data-precedence],style[data-precedence]"),v=[],k=0;b=h[k++];)"not all"===b.getAttribute("media")?v.push(b):("LINK"===b.tagName&&n.set(b.getAttribute("href"),b),p.set(b.dataset.precedence,g=b));b=0;h=[];var l,a;for(k=!0;;){if(k){var f=w[b++];if(!f){k=!1;b=0;continue}var c=!1,m=0;var d=f[m++];if(a=n.get(d)){var e=a._p;c=!0}else{a=q.createElement("link");a.href=d;a.rel="stylesheet";for(a.dataset.precedence=\nl=f[m++];e=f[m++];)a.setAttribute(e,f[m++]);e=a._p=new Promise(function(x,y){a.onload=x;a.onerror=y});n.set(d,a)}d=a.getAttribute("media");!e||"l"===e.s||d&&!matchMedia(d).matches||h.push(e);if(c)continue}else{a=v[b++];if(!a)break;l=a.getAttribute("data-precedence");a.removeAttribute("media")}c=p.get(l)||g;c===g&&(g=a);p.set(l,a);c?c.parentNode.insertBefore(a,c.nextSibling):(c=q.head,c.insertBefore(a,c.firstChild))}Promise.all(h).then(u.bind(null,r,t,""),u.bind(null,r,t,"Resource failed to load"))};$RR("')):t.push('$RR("'):0==(2&i.instructions)?(i.instructions|=2,t.push('$RC=function(b,c,e){c=document.getElementById(c);c.parentNode.removeChild(c);var a=document.getElementById(b);if(a){b=a.previousSibling;if(e)b.data="$!",a.setAttribute("data-dgst",e);else{e=b.parentNode;a=b.nextSibling;var f=0;do{if(a&&8===a.nodeType){var d=a.data;if("/$"===d)if(0===f)break;else f--;else"$"!==d&&"$?"!==d&&"$!"!==d||f++}d=a.nextSibling;e.removeChild(a);a=d}while(a);for(;c.firstChild;)e.insertBefore(c.firstChild,a);b.data="$"}b._reactRetry&&b._reactRetry()}};$RC("')):t.push('$RC("')):n?t.push('<template data-rri="" data-bid="'):t.push('<template data-rci="" data-bid="'),i=a.toString(16),t.push(e.boundaryPrefix),t.push(i),s?t.push('","'):t.push('" data-sid="'),t.push(e.segmentPrefix),t.push(i),n?s?(t.push('",'),function(e,t){e.push("[");var r="[";t.stylesheets.forEach(function(t){if(2!==t.state){if(3===t.state)e.push(r),t=ew(""+t.props.href),e.push(t),e.push("]"),r=",[";else{e.push(r);var i=t.props["data-precedence"],a=t.props,n=ew(""+t.props.href);for(var s in e.push(n),i=""+i,e.push(","),i=ew(i),e.push(i),a)if(P.call(a,s)&&null!=(n=a[s]))switch(s){case"href":case"rel":case"precedence":case"data-precedence":break;case"children":case"dangerouslySetInnerHTML":throw Error("link is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:e:{i=e;var o=s.toLowerCase();switch(typeof n){case"function":case"symbol":break e}switch(s){case"innerHTML":case"dangerouslySetInnerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":case"style":case"ref":break e;case"className":o="class",n=""+n;break;case"hidden":if(!1===n)break e;n="";break;case"src":case"href":n=""+n;break;default:if(2<s.length&&("o"===s[0]||"O"===s[0])&&("n"===s[1]||"N"===s[1])||!z(s))break e;n=""+n}i.push(","),o=ew(o),i.push(o),i.push(","),n=ew(n),i.push(n)}}e.push("]"),r=",[",t.state=3}}}),e.push("]")}(t,r)):(t.push('" data-sty="'),function(e,t){e.push("[");var r="[";t.stylesheets.forEach(function(t){if(2!==t.state){if(3===t.state)e.push(r),t=F(JSON.stringify(""+t.props.href)),e.push(t),e.push("]"),r=",[";else{e.push(r);var i=t.props["data-precedence"],a=t.props,n=F(JSON.stringify(""+t.props.href));for(var s in e.push(n),i=""+i,e.push(","),i=F(JSON.stringify(i)),e.push(i),a)if(P.call(a,s)&&null!=(n=a[s]))switch(s){case"href":case"rel":case"precedence":case"data-precedence":break;case"children":case"dangerouslySetInnerHTML":throw Error("link is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:e:{i=e;var o=s.toLowerCase();switch(typeof n){case"function":case"symbol":break e}switch(s){case"innerHTML":case"dangerouslySetInnerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":case"style":case"ref":break e;case"className":o="class",n=""+n;break;case"hidden":if(!1===n)break e;n="";break;case"src":case"href":n=""+n;break;default:if(2<s.length&&("o"===s[0]||"O"===s[0])&&("n"===s[1]||"N"===s[1])||!z(s))break e;n=""+n}i.push(","),o=F(JSON.stringify(o)),i.push(o),i.push(","),n=F(JSON.stringify(n)),i.push(n)}}e.push("]"),r=",[",t.state=3}}}),e.push("]")}(t,r)):s&&t.push('"'),i=s?t.push(")</script>"):t.push('"></template>'),ey(t,e)&&i}function ru(e,t,r,i){if(2===i.status)return!0;var a=r.contentState,n=i.id;if(-1===n){if(-1===(i.id=r.rootSegmentID))throw Error("A root segment ID must have been assigned by now. This is a bug in React.");return ro(e,t,i,a)}return n===r.rootSegmentID?ro(e,t,i,a):(ro(e,t,i,a),r=e.resumableState,e=e.renderState,(i=0===r.streamingFormat)?(t.push(e.startInlineScript),0==(1&r.instructions)?(r.instructions|=1,t.push('$RS=function(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("')):t.push('$RS("')):t.push('<template data-rsi="" data-sid="'),t.push(e.segmentPrefix),n=n.toString(16),t.push(n),i?t.push('","'):t.push('" data-pid="'),t.push(e.placeholderPrefix),t.push(n),t=i?t.push('")</script>'):t.push('"></template>'))}function rh(e,t){try{var r,i=e.completedRootSegment;if(null!==i){if(5===i.status||0!==e.pendingRootTasks)return;var a=e.renderState;if((0!==e.allPendingTasks||null!==e.trackedPostpones)&&a.externalRuntimeScript){var n=a.externalRuntimeScript,s=e.resumableState,o=n.src,l=n.chunks;s.scriptResources.hasOwnProperty(o)||(s.scriptResources[o]=null,a.scripts.add(l))}var u,h=a.htmlChunks,c=a.headChunks;if(h){for(u=0;u<h.length;u++)t.push(h[u]);if(c)for(u=0;u<c.length;u++)t.push(c[u]);else{var d=ef("head");t.push(d),t.push(">")}}else if(c)for(u=0;u<c.length;u++)t.push(c[u]);var p=a.charsetChunks;for(u=0;u<p.length;u++)t.push(p[u]);p.length=0,a.preconnects.forEach(eP,t),a.preconnects.clear();var f=a.viewportChunks;for(u=0;u<f.length;u++)t.push(f[u]);f.length=0,a.fontPreloads.forEach(eP,t),a.fontPreloads.clear(),a.highImagePreloads.forEach(eP,t),a.highImagePreloads.clear(),a.styles.forEach(eA,t);var m=a.importMapChunks;for(u=0;u<m.length;u++)t.push(m[u]);m.length=0,a.bootstrapScripts.forEach(eP,t),a.scripts.forEach(eP,t),a.scripts.clear(),a.bulkPreloads.forEach(eP,t),a.bulkPreloads.clear();var g=a.hoistableChunks;for(u=0;u<g.length;u++)t.push(g[u]);if(g.length=0,h&&null===c){var y=eg("head");t.push(y)}rs(e,t,i,null),e.completedRootSegment=null,ey(t,e.renderState)}var _=e.renderState;i=0;var x=_.viewportChunks;for(i=0;i<x.length;i++)t.push(x[i]);x.length=0,_.preconnects.forEach(eP,t),_.preconnects.clear(),_.fontPreloads.forEach(eP,t),_.fontPreloads.clear(),_.highImagePreloads.forEach(eP,t),_.highImagePreloads.clear(),_.styles.forEach(eR,t),_.scripts.forEach(eP,t),_.scripts.clear(),_.bulkPreloads.forEach(eP,t),_.bulkPreloads.clear();var v=_.hoistableChunks;for(i=0;i<v.length;i++)t.push(v[i]);v.length=0;var b=e.clientRenderedBoundaries;for(r=0;r<b.length;r++){var w=b[r];_=t;var S=e.resumableState,k=e.renderState,T=w.rootSegmentID,I=w.errorDigest,C=w.errorMessage,P=w.errorComponentStack,E=0===S.streamingFormat;E?(_.push(k.startInlineScript),0==(4&S.instructions)?(S.instructions|=4,_.push('$RX=function(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};;$RX("')):_.push('$RX("')):_.push('<template data-rxi="" data-bid="'),_.push(k.boundaryPrefix);var M=T.toString(16);if(_.push(M),E&&_.push('"'),I||C||P){if(E){_.push(",");var A=ev(I||"");_.push(A)}else{_.push('" data-dgst="');var z=F(I||"");_.push(z)}}if(C||P){if(E){_.push(",");var R=ev(C||"");_.push(R)}else{_.push('" data-msg="');var D=F(C||"");_.push(D)}}if(P){if(E){_.push(",");var L=ev(P);_.push(L)}else{_.push('" data-stck="');var B=F(P);_.push(B)}}if(E?!_.push(")</script>"):!_.push('"></template>')){e.destination=null,r++,b.splice(0,r);return}}b.splice(0,r);var O=e.completedBoundaries;for(r=0;r<O.length;r++)if(!rl(e,t,O[r])){e.destination=null,r++,O.splice(0,r);return}O.splice(0,r);var N=e.partialBoundaries;for(r=0;r<N.length;r++){var V=N[r];e:{b=e,w=t;var $=V.completedSegments;for(S=0;S<$.length;S++)if(!ru(b,w,V,$[S])){S++,$.splice(0,S);var j=!1;break e}$.splice(0,S),j=eC(w,V.contentState,b.renderState)}if(!j){e.destination=null,r++,N.splice(0,r);return}}N.splice(0,r);var U=e.completedBoundaries;for(r=0;r<U.length;r++)if(!rl(e,t,U[r])){e.destination=null,r++,U.splice(0,r);return}U.splice(0,r)}finally{0===e.allPendingTasks&&0===e.pingedTasks.length&&0===e.clientRenderedBoundaries.length&&0===e.completedBoundaries.length&&(e.flushScheduled=!1,(r=e.resumableState).hasBody&&(N=eg("body"),t.push(N)),r.hasHtml&&(r=eg("html"),t.push(r)),t.push(null),e.destination=null)}}function rc(e){e.flushScheduled=null!==e.destination,ra(e),null===e.trackedPostpones&&t7(e,0===e.pendingRootTasks)}function rd(e){if(!1===e.flushScheduled&&0===e.pingedTasks.length&&null!==e.destination){e.flushScheduled=!0;var t=e.destination;t?rh(e,t):e.flushScheduled=!1}}function rp(e,t){if(1===e.status)e.status=2,t.destroy(e.fatalError);else if(2!==e.status&&null===e.destination){e.destination=t;try{rh(e,t)}catch(t){tX(e,t,{}),tK(e,t)}}}function rf(e,t){try{var r=e.abortableTasks;if(0<r.size){var i=void 0===t?Error("The render was aborted by the server without a reason."):t;r.forEach(function(t){return function e(t,r,i){var a=t.blockedBoundary,n=t.blockedSegment;if(null!==n&&(n.status=3),null===a){if(a={},1!==r.status&&2!==r.status){if(null===(t=t.replay)){tX(r,i,a),tK(r,i);return}t.pendingTasks--,0===t.pendingTasks&&0<t.nodes.length&&(a=tX(r,i,a),t9(r,null,t.nodes,t.slots,i,a)),r.pendingRootTasks--,0===r.pendingRootTasks&&re(r)}}else a.pendingTasks--,4!==a.status&&(a.status=4,t=tW(r,t.componentStack),t=tX(r,i,t),a.errorDigest=t,t4(r,a),a.parentFlushed&&r.clientRenderedBoundaries.push(a)),a.fallbackAbortableTasks.forEach(function(t){return e(t,r,i)}),a.fallbackAbortableTasks.clear();r.allPendingTasks--,0===r.allPendingTasks&&rt(r)}(t,e,i)}),r.clear()}null!==e.destination&&rh(e,e.destination)}catch(t){tX(e,t,{}),tK(e,t)}}function rm(){}function rg(e,t,r,i){var a=!1,n=null,s="",o=!1;if(rc(e=tV(e,t=G(t?t.identifierPrefix:void 0,void 0),eU(t,r),W(),1/0,rm,void 0,function(){o=!0},void 0,void 0,void 0)),rf(e,i),rp(e,{push:function(e){return null!==e&&(s+=e),!0},destroy:function(e){a=!0,n=e}}),a&&n!==i)throw n;if(!o)throw Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.");return s}var ry=function(e){function t(){var t=e.call(this,{})||this;return t.request=null,t.startedFlowing=!1,t}t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e;var r=t.prototype;return r._destroy=function(e,t){rf(this.request),t(e)},r._read=function(){this.startedFlowing&&rp(this.request,this)},t}(n.Readable);function r_(){}function rx(e,t){var r=new ry,i=tV(e,t=G(t?t.identifierPrefix:void 0,void 0),eU(t,!1),W(),1/0,r_,function(){r.startedFlowing=!0,rp(i,r)},void 0,void 0,void 0);return r.request=i,rc(i),r}t.renderToNodeStream=function(e,t){return rx(e,t)},t.renderToStaticMarkup=function(e,t){return rg(e,t,!0,'The server used "renderToStaticMarkup" which does not support Suspense. If you intended to have the server wait for the suspended component please switch to "renderToPipeableStream" which supports Suspense on the server')},t.renderToStaticNodeStream=function(e,t){return rx(e,t)},t.renderToString=function(e,t){return rg(e,t,!1,'The server used "renderToString" which does not support Suspense. If you intended for this Suspense boundary to render the fallback content on the server consider throwing an Error somewhere within the Suspense boundary. If you intended to have the server wait for the suspended component please switch to "renderToPipeableStream" which supports Suspense on the server')},t.version="18.3.0-canary-178c267a4e-20241218"},16594:(e,t,r)=>{"use strict";var i=r(21764),a=r(84770),n=r(61212),s=r(15852),o=r(60962),l=Symbol.for("react.element"),u=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.consumer"),m=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),b=Symbol.for("react.scope"),w=Symbol.for("react.debug_trace_mode"),S=Symbol.for("react.offscreen"),k=Symbol.for("react.legacy_hidden"),T=Symbol.for("react.cache"),I=Symbol.iterator,C=Array.isArray;function P(e){"function"==typeof e.flush&&e.flush()}var E=null,M=0,A=!0;function z(e,t){if("string"==typeof t){if(0!==t.length){if(2048<3*t.length)0<M&&(R(e,E.subarray(0,M)),E=new Uint8Array(2048),M=0),R(e,F.encode(t));else{var r=E;0<M&&(r=E.subarray(M));var i=(r=F.encodeInto(t,r)).read;M+=r.written,i<t.length&&(R(e,E.subarray(0,M)),E=new Uint8Array(2048),M=F.encodeInto(t.slice(i),E).written),2048===M&&(R(e,E),E=new Uint8Array(2048),M=0)}}}else 0!==t.byteLength&&(2048<t.byteLength?(0<M&&(R(e,E.subarray(0,M)),E=new Uint8Array(2048),M=0),R(e,t)):((r=E.length-M)<t.byteLength&&(0===r?R(e,E):(E.set(t.subarray(0,r),M),M+=r,R(e,E),t=t.subarray(r)),E=new Uint8Array(2048),M=0),E.set(t,M),2048===(M+=t.byteLength)&&(R(e,E),E=new Uint8Array(2048),M=0)))}function R(e,t){e=e.write(t),A=A&&e}function D(e,t){return z(e,t),A}function L(e){E&&0<M&&e.write(E.subarray(0,M)),E=null,M=0,A=!0}var F=new i.TextEncoder;function B(e){return F.encode(e)}var O=Object.assign,N=Object.prototype.hasOwnProperty,V=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$={},j={};function U(e){return!!N.call(j,e)||!N.call($,e)&&(V.test(e)?j[e]=!0:($[e]=!0,!1))}var q=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" ")),Z=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),G=/["'&<>]/;function H(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=G.exec(e);if(t){var r,i="",a=0;for(r=t.index;r<e.length;r++){switch(e.charCodeAt(r)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}a!==r&&(i+=e.slice(a,r)),a=r+1,i+=t}e=a!==r?i+e.slice(a,r):i}return e}var W=/([A-Z])/g,X=/^ms-/,K=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,J={pending:!1,data:null,method:null,action:null},Y=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Dispatcher,Q={prefetchDNS:function(e){var t=iI();if(t){var r,i,a=t.resumableState,n=t.renderState;"string"==typeof e&&e&&(a.dnsResources.hasOwnProperty(e)||(a.dnsResources[e]=null,(i=(a=n.headers)&&0<a.remainingCapacity)&&(r="<"+(""+e).replace(rv,rb)+">; rel=dns-prefetch",i=2<=(a.remainingCapacity-=r.length)),i?(n.resets.dns[e]=null,a.preconnects&&(a.preconnects+=", "),a.preconnects+=r):(eU(r=[],{href:e,rel:"dns-prefetch"}),n.preconnects.add(r))),i8(t))}},preconnect:function(e,t){var r=iI();if(r){var i=r.resumableState,a=r.renderState;if("string"==typeof e&&e){var n,s,o="use-credentials"===t?"credentials":"string"==typeof t?"anonymous":"default";i.connectResources[o].hasOwnProperty(e)||(i.connectResources[o][e]=null,(s=(i=a.headers)&&0<i.remainingCapacity)&&(s="<"+(""+e).replace(rv,rb)+">; rel=preconnect","string"==typeof t&&(s+='; crossorigin="'+(""+t).replace(rw,rS)+'"'),n=s,s=2<=(i.remainingCapacity-=n.length)),s?(a.resets.connect[o][e]=null,i.preconnects&&(i.preconnects+=", "),i.preconnects+=n):(eU(o=[],{rel:"preconnect",href:e,crossOrigin:t}),a.preconnects.add(o))),i8(r)}}},preload:function(e,t,r){var i=iI();if(i){var a=i.resumableState,n=i.renderState;if(t&&e){switch(t){case"image":if(r)var s,o=r.imageSrcSet,l=r.imageSizes,u=r.fetchPriority;var h=o?o+"\n"+(l||""):e;if(a.imageResources.hasOwnProperty(h))return;a.imageResources[h]=ee,(a=n.headers)&&0<a.remainingCapacity&&"high"===u&&(s=rx(e,t,r),2<=(a.remainingCapacity-=s.length))?(n.resets.image[h]=ee,a.highImagePreloads&&(a.highImagePreloads+=", "),a.highImagePreloads+=s):(eU(a=[],O({rel:"preload",href:o?void 0:e,as:t},r)),"high"===u?n.highImagePreloads.add(a):(n.bulkPreloads.add(a),n.preloads.images.set(h,a)));break;case"style":if(a.styleResources.hasOwnProperty(e))return;eU(o=[],O({rel:"preload",href:e,as:t},r)),a.styleResources[e]=r&&("string"==typeof r.crossOrigin||"string"==typeof r.integrity)?[r.crossOrigin,r.integrity]:ee,n.preloads.stylesheets.set(e,o),n.bulkPreloads.add(o);break;case"script":if(a.scriptResources.hasOwnProperty(e))return;o=[],n.preloads.scripts.set(e,o),n.bulkPreloads.add(o),eU(o,O({rel:"preload",href:e,as:t},r)),a.scriptResources[e]=r&&("string"==typeof r.crossOrigin||"string"==typeof r.integrity)?[r.crossOrigin,r.integrity]:ee;break;default:if(a.unknownResources.hasOwnProperty(t)){if((o=a.unknownResources[t]).hasOwnProperty(e))return}else o={},a.unknownResources[t]=o;(o[e]=ee,(a=n.headers)&&0<a.remainingCapacity&&"font"===t&&(h=rx(e,t,r),2<=(a.remainingCapacity-=h.length)))?(n.resets.font[e]=ee,a.fontPreloads&&(a.fontPreloads+=", "),a.fontPreloads+=h):(eU(a=[],e=O({rel:"preload",href:e,as:t},r)),"font"===t)?n.fontPreloads.add(a):n.bulkPreloads.add(a)}i8(i)}}},preloadModule:function(e,t){var r=iI();if(r){var i=r.resumableState,a=r.renderState;if(e){var n=t&&"string"==typeof t.as?t.as:"script";if("script"===n){if(i.moduleScriptResources.hasOwnProperty(e))return;n=[],i.moduleScriptResources[e]=t&&("string"==typeof t.crossOrigin||"string"==typeof t.integrity)?[t.crossOrigin,t.integrity]:ee,a.preloads.moduleScripts.set(e,n)}else{if(i.moduleUnknownResources.hasOwnProperty(n)){var s=i.unknownResources[n];if(s.hasOwnProperty(e))return}else s={},i.moduleUnknownResources[n]=s;n=[],s[e]=ee}eU(n,O({rel:"modulepreload",href:e},t)),a.bulkPreloads.add(n),i8(r)}}},preinitStyle:function(e,t,r){var i=iI();if(i){var a=i.resumableState,n=i.renderState;if(e){t=t||"default";var s=n.styles.get(t),o=a.styleResources.hasOwnProperty(e)?a.styleResources[e]:void 0;null!==o&&(a.styleResources[e]=null,s||(s={precedence:H(t),rules:[],hrefs:[],sheets:new Map},n.styles.set(t,s)),t={state:0,props:O({rel:"stylesheet",href:e,"data-precedence":t},r)},o&&(2===o.length&&r_(t.props,o),(n=n.preloads.stylesheets.get(e))&&0<n.length?n.length=0:t.state=1),s.sheets.set(e,t),i8(i))}}},preinitScript:function(e,t){var r=iI();if(r){var i=r.resumableState,a=r.renderState;if(e){var n=i.scriptResources.hasOwnProperty(e)?i.scriptResources[e]:void 0;null!==n&&(i.scriptResources[e]=null,t=O({src:e,async:!0},t),n&&(2===n.length&&r_(t,n),e=a.preloads.scripts.get(e))&&(e.length=0),e=[],a.scripts.add(e),eG(e,t),i8(r))}}},preinitModuleScript:function(e,t){var r=iI();if(r){var i=r.resumableState,a=r.renderState;if(e){var n=i.moduleScriptResources.hasOwnProperty(e)?i.moduleScriptResources[e]:void 0;null!==n&&(i.moduleScriptResources[e]=null,t=O({src:e,type:"module",async:!0},t),n&&(2===n.length&&r_(t,n),e=a.preloads.moduleScripts.get(e))&&(e.length=0),e=[],a.scripts.add(e),eG(e,t),i8(r))}}}},ee=[],et=B('"></template>'),er=B("<script>"),ei=B("</script>"),ea=B('<script src="'),en=B('<script type="module" src="'),es=B('" nonce="'),eo=B('" integrity="'),el=B('" crossorigin="'),eu=B('" async=""></script>'),eh=/(<\/|<)(s)(cript)/gi;function ec(e,t,r,i){return""+t+("s"===r?"\\u0073":"\\u0053")+i}var ed=B('<script type="importmap">'),ep=B("</script>");function ef(e,t,r){return{insertionMode:e,selectedValue:t,tagScope:r}}function em(e,t,r){switch(t){case"noscript":return ef(2,null,1|e.tagScope);case"select":return ef(2,null!=r.value?r.value:r.defaultValue,e.tagScope);case"svg":return ef(3,null,e.tagScope);case"picture":return ef(2,null,2|e.tagScope);case"math":return ef(4,null,e.tagScope);case"foreignObject":return ef(2,null,e.tagScope);case"table":return ef(5,null,e.tagScope);case"thead":case"tbody":case"tfoot":return ef(6,null,e.tagScope);case"colgroup":return ef(8,null,e.tagScope);case"tr":return ef(7,null,e.tagScope)}return 5<=e.insertionMode?ef(2,null,e.tagScope):0===e.insertionMode?"html"===t?ef(1,null,e.tagScope):ef(2,null,e.tagScope):1===e.insertionMode?ef(2,null,e.tagScope):e}var eg=B("<!-- -->");function ey(e,t,r,i){return""===t?i:(i&&e.push(eg),e.push(H(t)),!0)}var e_=new Map,ex=B(' style="'),ev=B(":"),eb=B(";");function ew(e,t){if("object"!=typeof t)throw Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.");var r,i=!0;for(r in t)if(N.call(t,r)){var a=t[r];if(null!=a&&"boolean"!=typeof a&&""!==a){if(0===r.indexOf("--")){var n=H(r);a=H((""+a).trim())}else void 0===(n=e_.get(r))&&(n=B(H(r.replace(W,"-$1").toLowerCase().replace(X,"-ms-"))),e_.set(r,n)),a="number"==typeof a?0===a||q.has(r)?""+a:a+"px":H((""+a).trim());i?(i=!1,e.push(ex,n,ev,a)):e.push(eb,n,ev,a)}}i||e.push(eT)}var eS=B(" "),ek=B('="'),eT=B('"'),eI=B('=""');function eC(e,t,r){r&&"function"!=typeof r&&"symbol"!=typeof r&&e.push(eS,t,eI)}function eP(e,t,r){"function"!=typeof r&&"symbol"!=typeof r&&"boolean"!=typeof r&&e.push(eS,t,ek,H(r),eT)}function eE(e){var t=e.nextFormID++;return e.idPrefix+t}var eM=B(H("javascript:throw new Error('React form unexpectedly submitted.')")),eA=B('<input type="hidden"');function ez(e,t){if(this.push(eA),"string"!=typeof e)throw Error("File/Blob fields are not yet supported in progressive forms. It probably means you are closing over binary data or FormData in a Server Action.");eP(this,"name",t),eP(this,"value",e),this.push(eF)}function eR(e,t,r,i,a,n,s,o){var l=null;return"function"==typeof i&&("function"==typeof i.$$FORM_ACTION?(a=eE(t),o=(t=i.$$FORM_ACTION(a)).name,i=t.action||"",a=t.encType,n=t.method,s=t.target,l=t.data):(e.push(eS,"formAction",ek,eM,eT),s=n=a=i=o=null,eV(t,r))),null!=o&&eD(e,"name",o),null!=i&&eD(e,"formAction",i),null!=a&&eD(e,"formEncType",a),null!=n&&eD(e,"formMethod",n),null!=s&&eD(e,"formTarget",s),l}function eD(e,t,r){switch(t){case"className":eP(e,"class",r);break;case"tabIndex":eP(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":eP(e,t,r);break;case"style":ew(e,r);break;case"src":case"href":case"action":case"formAction":if(null==r||"function"==typeof r||"symbol"==typeof r||"boolean"==typeof r)break;e.push(eS,t,ek,H(""+r),eT);break;case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":case"ref":break;case"autoFocus":case"multiple":case"muted":eC(e,t.toLowerCase(),r);break;case"xlinkHref":if("function"==typeof r||"symbol"==typeof r||"boolean"==typeof r)break;e.push(eS,"xlink:href",ek,H(""+r),eT);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":"function"!=typeof r&&"symbol"!=typeof r&&e.push(eS,t,ek,H(r),eT);break;case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!=typeof r&&"symbol"!=typeof r&&e.push(eS,t,eI);break;case"capture":case"download":!0===r?e.push(eS,t,eI):!1!==r&&"function"!=typeof r&&"symbol"!=typeof r&&e.push(eS,t,ek,H(r),eT);break;case"cols":case"rows":case"size":case"span":"function"!=typeof r&&"symbol"!=typeof r&&!isNaN(r)&&1<=r&&e.push(eS,t,ek,H(r),eT);break;case"rowSpan":case"start":"function"==typeof r||"symbol"==typeof r||isNaN(r)||e.push(eS,t,ek,H(r),eT);break;case"xlinkActuate":eP(e,"xlink:actuate",r);break;case"xlinkArcrole":eP(e,"xlink:arcrole",r);break;case"xlinkRole":eP(e,"xlink:role",r);break;case"xlinkShow":eP(e,"xlink:show",r);break;case"xlinkTitle":eP(e,"xlink:title",r);break;case"xlinkType":eP(e,"xlink:type",r);break;case"xmlBase":eP(e,"xml:base",r);break;case"xmlLang":eP(e,"xml:lang",r);break;case"xmlSpace":eP(e,"xml:space",r);break;default:if((!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&U(t=Z.get(t)||t)){switch(typeof r){case"function":case"symbol":return;case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return}e.push(eS,t,ek,H(r),eT)}}}var eL=B(">"),eF=B("/>");function eB(e,t,r){if(null!=t){if(null!=r)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if("object"!=typeof t||!("__html"in t))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.");null!=(t=t.__html)&&e.push(""+t)}}var eO=B(' selected=""'),eN=B('addEventListener("submit",function(a){if(!a.defaultPrevented){var c=a.target,d=a.submitter,e=c.action,b=d;if(d){var f=d.getAttribute("formAction");null!=f&&(e=f,b=null)}"javascript:throw new Error(\'React form unexpectedly submitted.\')"===e&&(a.preventDefault(),b?(a=document.createElement("input"),a.name=b.name,a.value=b.value,b.parentNode.insertBefore(a,b),b=new FormData(c),a.parentNode.removeChild(a)):b=new FormData(c),a=c.ownerDocument||c,(a.$$reactFormReplay=a.$$reactFormReplay||[]).push(c,d,b))}});');function eV(e,t){0!=(16&e.instructions)||t.externalRuntimeScript||(e.instructions|=16,t.bootstrapChunks.unshift(t.startInlineScript,eN,ei))}var e$=B("<!--F!-->"),ej=B("<!--F-->");function eU(e,t){for(var r in e.push(eJ("link")),t)if(N.call(t,r)){var i=t[r];if(null!=i)switch(r){case"children":case"dangerouslySetInnerHTML":throw Error("link is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:eD(e,r,i)}}return e.push(eF),null}function eq(e,t,r){for(var i in e.push(eJ(r)),t)if(N.call(t,i)){var a=t[i];if(null!=a)switch(i){case"children":case"dangerouslySetInnerHTML":throw Error(r+" is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:eD(e,i,a)}}return e.push(eF),null}function eZ(e,t){e.push(eJ("title"));var r,i=null,a=null;for(r in t)if(N.call(t,r)){var n=t[r];if(null!=n)switch(r){case"children":i=n;break;case"dangerouslySetInnerHTML":a=n;break;default:eD(e,r,n)}}return e.push(eL),"function"!=typeof(t=Array.isArray(i)?2>i.length?i[0]:null:i)&&"symbol"!=typeof t&&null!=t&&e.push(H(""+t)),eB(e,a,i),e.push(e0("title")),null}function eG(e,t){e.push(eJ("script"));var r,i=null,a=null;for(r in t)if(N.call(t,r)){var n=t[r];if(null!=n)switch(r){case"children":i=n;break;case"dangerouslySetInnerHTML":a=n;break;default:eD(e,r,n)}}return e.push(eL),eB(e,a,i),"string"==typeof i&&e.push(H(i)),e.push(e0("script")),null}function eH(e,t,r){e.push(eJ(r));var i,a=r=null;for(i in t)if(N.call(t,i)){var n=t[i];if(null!=n)switch(i){case"children":r=n;break;case"dangerouslySetInnerHTML":a=n;break;default:eD(e,i,n)}}return e.push(eL),eB(e,a,r),"string"==typeof r?(e.push(H(r)),null):r}var eW=B("\n"),eX=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,eK=new Map;function eJ(e){var t=eK.get(e);if(void 0===t){if(!eX.test(e))throw Error("Invalid tag: "+e);t=B("<"+e),eK.set(e,t)}return t}var eY=B("<!DOCTYPE html>"),eQ=new Map;function e0(e){var t=eQ.get(e);return void 0===t&&(t=B("</"+e+">"),eQ.set(e,t)),t}function e1(e,t){t=t.bootstrapChunks;for(var r=0;r<t.length-1;r++)z(e,t[r]);return!(r<t.length)||(r=t[r],t.length=0,D(e,r))}var e2=B('<template id="'),e3=B('"></template>'),e5=B("<!--$-->"),e4=B('<!--$?--><template id="'),e6=B('"></template>'),e8=B("<!--$!-->"),e9=B("<!--/$-->"),e7=B("<template"),te=B('"'),tt=B(' data-dgst="');B(' data-msg="'),B(' data-stck="');var tr=B("></template>");function ti(e,t,r){if(z(e,e4),null===r)throw Error("An ID must have been assigned before we can complete the boundary.");return z(e,t.boundaryPrefix),z(e,r.toString(16)),D(e,e6)}var ta=B('<div hidden id="'),tn=B('">'),ts=B("</div>"),to=B('<svg aria-hidden="true" style="display:none" id="'),tl=B('">'),tu=B("</svg>"),th=B('<math aria-hidden="true" style="display:none" id="'),tc=B('">'),td=B("</math>"),tp=B('<table hidden id="'),tf=B('">'),tm=B("</table>"),tg=B('<table hidden><tbody id="'),ty=B('">'),t_=B("</tbody></table>"),tx=B('<table hidden><tr id="'),tv=B('">'),tb=B("</tr></table>"),tw=B('<table hidden><colgroup id="'),tS=B('">'),tk=B("</colgroup></table>"),tT=B('$RS=function(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("'),tI=B('$RS("'),tC=B('","'),tP=B('")</script>'),tE=B('<template data-rsi="" data-sid="'),tM=B('" data-pid="'),tA=B('$RC=function(b,c,e){c=document.getElementById(c);c.parentNode.removeChild(c);var a=document.getElementById(b);if(a){b=a.previousSibling;if(e)b.data="$!",a.setAttribute("data-dgst",e);else{e=b.parentNode;a=b.nextSibling;var f=0;do{if(a&&8===a.nodeType){var d=a.data;if("/$"===d)if(0===f)break;else f--;else"$"!==d&&"$?"!==d&&"$!"!==d||f++}d=a.nextSibling;e.removeChild(a);a=d}while(a);for(;c.firstChild;)e.insertBefore(c.firstChild,a);b.data="$"}b._reactRetry&&b._reactRetry()}};$RC("'),tz=B('$RC("'),tR=B('$RC=function(b,c,e){c=document.getElementById(c);c.parentNode.removeChild(c);var a=document.getElementById(b);if(a){b=a.previousSibling;if(e)b.data="$!",a.setAttribute("data-dgst",e);else{e=b.parentNode;a=b.nextSibling;var f=0;do{if(a&&8===a.nodeType){var d=a.data;if("/$"===d)if(0===f)break;else f--;else"$"!==d&&"$?"!==d&&"$!"!==d||f++}d=a.nextSibling;e.removeChild(a);a=d}while(a);for(;c.firstChild;)e.insertBefore(c.firstChild,a);b.data="$"}b._reactRetry&&b._reactRetry()}};$RM=new Map;\n$RR=function(r,t,w){for(var u=$RC,n=$RM,p=new Map,q=document,g,b,h=q.querySelectorAll("link[data-precedence],style[data-precedence]"),v=[],k=0;b=h[k++];)"not all"===b.getAttribute("media")?v.push(b):("LINK"===b.tagName&&n.set(b.getAttribute("href"),b),p.set(b.dataset.precedence,g=b));b=0;h=[];var l,a;for(k=!0;;){if(k){var f=w[b++];if(!f){k=!1;b=0;continue}var c=!1,m=0;var d=f[m++];if(a=n.get(d)){var e=a._p;c=!0}else{a=q.createElement("link");a.href=d;a.rel="stylesheet";for(a.dataset.precedence=\nl=f[m++];e=f[m++];)a.setAttribute(e,f[m++]);e=a._p=new Promise(function(x,y){a.onload=x;a.onerror=y});n.set(d,a)}d=a.getAttribute("media");!e||"l"===e.s||d&&!matchMedia(d).matches||h.push(e);if(c)continue}else{a=v[b++];if(!a)break;l=a.getAttribute("data-precedence");a.removeAttribute("media")}c=p.get(l)||g;c===g&&(g=a);p.set(l,a);c?c.parentNode.insertBefore(a,c.nextSibling):(c=q.head,c.insertBefore(a,c.firstChild))}Promise.all(h).then(u.bind(null,r,t,""),u.bind(null,r,t,"Resource failed to load"))};$RR("'),tD=B('$RM=new Map;\n$RR=function(r,t,w){for(var u=$RC,n=$RM,p=new Map,q=document,g,b,h=q.querySelectorAll("link[data-precedence],style[data-precedence]"),v=[],k=0;b=h[k++];)"not all"===b.getAttribute("media")?v.push(b):("LINK"===b.tagName&&n.set(b.getAttribute("href"),b),p.set(b.dataset.precedence,g=b));b=0;h=[];var l,a;for(k=!0;;){if(k){var f=w[b++];if(!f){k=!1;b=0;continue}var c=!1,m=0;var d=f[m++];if(a=n.get(d)){var e=a._p;c=!0}else{a=q.createElement("link");a.href=d;a.rel="stylesheet";for(a.dataset.precedence=\nl=f[m++];e=f[m++];)a.setAttribute(e,f[m++]);e=a._p=new Promise(function(x,y){a.onload=x;a.onerror=y});n.set(d,a)}d=a.getAttribute("media");!e||"l"===e.s||d&&!matchMedia(d).matches||h.push(e);if(c)continue}else{a=v[b++];if(!a)break;l=a.getAttribute("data-precedence");a.removeAttribute("media")}c=p.get(l)||g;c===g&&(g=a);p.set(l,a);c?c.parentNode.insertBefore(a,c.nextSibling):(c=q.head,c.insertBefore(a,c.firstChild))}Promise.all(h).then(u.bind(null,r,t,""),u.bind(null,r,t,"Resource failed to load"))};$RR("'),tL=B('$RR("'),tF=B('","'),tB=B('",'),tO=B('"'),tN=B(")</script>"),tV=B('<template data-rci="" data-bid="'),t$=B('<template data-rri="" data-bid="'),tj=B('" data-sid="'),tU=B('" data-sty="'),tq=B('$RX=function(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};;$RX("'),tZ=B('$RX("'),tG=B('"'),tH=B(","),tW=B(")</script>"),tX=B('<template data-rxi="" data-bid="'),tK=B('" data-dgst="'),tJ=B('" data-msg="'),tY=B('" data-stck="'),tQ=/[<\u2028\u2029]/g;function t0(e){return JSON.stringify(e).replace(tQ,function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}var t1=/[&><\u2028\u2029]/g;function t2(e){return JSON.stringify(e).replace(t1,function(e){switch(e){case"&":return"\\u0026";case">":return"\\u003e";case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSObjectForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}var t3=B('<style media="not all" data-precedence="'),t5=B('" data-href="'),t4=B('">'),t6=B("</style>"),t8=!1,t9=!0;function t7(e){var t=e.rules,r=e.hrefs,i=0;if(r.length){for(z(this,t3),z(this,e.precedence),z(this,t5);i<r.length-1;i++)z(this,r[i]),z(this,ro);for(z(this,r[i]),z(this,t4),i=0;i<t.length;i++)z(this,t[i]);t9=D(this,t6),t8=!0,t.length=0,r.length=0}}function re(e){return 2!==e.state&&(t8=!0)}function rt(e,t,r){return t8=!1,t9=!0,t.styles.forEach(t7,e),t.stylesheets.forEach(re),t8&&(r.stylesToHoist=!0),t9}function rr(e){for(var t=0;t<e.length;t++)z(this,e[t]);e.length=0}var ri=[];function ra(e){eU(ri,e.props);for(var t=0;t<ri.length;t++)z(this,ri[t]);ri.length=0,e.state=2}var rn=B('<style data-precedence="'),rs=B('" data-href="'),ro=B(" "),rl=B('">'),ru=B("</style>");function rh(e){var t=0<e.sheets.size;e.sheets.forEach(ra,this),e.sheets.clear();var r=e.rules,i=e.hrefs;if(!t||i.length){if(z(this,rn),z(this,e.precedence),e=0,i.length){for(z(this,rs);e<i.length-1;e++)z(this,i[e]),z(this,ro);z(this,i[e])}for(z(this,rl),e=0;e<r.length;e++)z(this,r[e]);z(this,ru),r.length=0,i.length=0}}function rc(e){if(0===e.state){e.state=1;var t=e.props;for(eU(ri,{rel:"preload",as:"style",href:e.props.href,crossOrigin:t.crossOrigin,fetchPriority:t.fetchPriority,integrity:t.integrity,media:t.media,hrefLang:t.hrefLang,referrerPolicy:t.referrerPolicy}),e=0;e<ri.length;e++)z(this,ri[e]);ri.length=0}}function rd(e){e.sheets.forEach(rc,this),e.sheets.clear()}var rp=B("["),rf=B(",["),rm=B(","),rg=B("]");function ry(){return{styles:new Set,stylesheets:new Set}}function r_(e,t){null==e.crossOrigin&&(e.crossOrigin=t[0]),null==e.integrity&&(e.integrity=t[1])}function rx(e,t,r){for(var i in t="<"+(e=(""+e).replace(rv,rb))+'>; rel=preload; as="'+(t=(""+t).replace(rw,rS))+'"',r)N.call(r,i)&&"string"==typeof(e=r[i])&&(t+="; "+i.toLowerCase()+'="'+(""+e).replace(rw,rS)+'"');return t}var rv=/[<>\r\n]/g;function rb(e){switch(e){case"<":return"%3C";case">":return"%3E";case"\n":return"%0A";case"\r":return"%0D";default:throw Error("escapeLinkHrefForHeaderContextReplacer encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}}var rw=/["';,\r\n]/g;function rS(e){switch(e){case'"':return"%22";case"'":return"%27";case";":return"%3B";case",":return"%2C";case"\n":return"%0A";case"\r":return"%0D";default:throw Error("escapeStringForLinkHeaderQuotedParamValueContextReplacer encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}}function rk(e){this.styles.add(e)}function rT(e){this.stylesheets.add(e)}var rI=new n.AsyncLocalStorage,rC=Symbol.for("react.client.reference");function rP(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===rC?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case h:return"Fragment";case u:return"Portal";case d:return"Profiler";case c:return"StrictMode";case y:return"Suspense";case _:return"SuspenseList";case T:return"Cache"}if("object"==typeof e)switch(e.$$typeof){case p:return(e._context.displayName||"Context")+".Provider";case m:return(e.displayName||"Context")+".Consumer";case g:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case x:return null!==(t=e.displayName||null)?t:rP(e.type)||"Memo";case v:t=e._payload,e=e._init;try{return rP(e(t))}catch(e){}}return null}var rE={};function rM(e,t){if(!(e=e.contextTypes))return rE;var r,i={};for(r in e)i[r]=t[r];return i}var rA=null;function rz(e,t){if(e!==t){e.context._currentValue=e.parentValue,e=e.parent;var r=t.parent;if(null===e){if(null!==r)throw Error("The stacks must reach the root at the same time. This is a bug in React.")}else{if(null===r)throw Error("The stacks must reach the root at the same time. This is a bug in React.");rz(e,r)}t.context._currentValue=t.value}}function rR(e){var t=rA;t!==e&&(null===t?function e(t){var r=t.parent;null!==r&&e(r),t.context._currentValue=t.value}(e):null===e?function e(t){t.context._currentValue=t.parentValue,null!==(t=t.parent)&&e(t)}(t):t.depth===e.depth?rz(t,e):t.depth>e.depth?function e(t,r){if(t.context._currentValue=t.parentValue,null===(t=t.parent))throw Error("The depth must equal at least at zero before reaching the root. This is a bug in React.");t.depth===r.depth?rz(t,r):e(t,r)}(t,e):function e(t,r){var i=r.parent;if(null===i)throw Error("The depth must equal at least at zero before reaching the root. This is a bug in React.");t.depth===i.depth?rz(t,i):e(t,i),r.context._currentValue=r.value}(t,e),rA=e)}var rD={isMounted:function(){return!1},enqueueSetState:function(e,t){null!==(e=e._reactInternals).queue&&e.queue.push(t)},enqueueReplaceState:function(e,t){(e=e._reactInternals).replace=!0,e.queue=[t]},enqueueForceUpdate:function(){}};function rL(e,t,r,i){var a=void 0!==e.state?e.state:null;e.updater=rD,e.props=r,e.state=a;var n={queue:[],replace:!1};e._reactInternals=n;var s=t.contextType;if(e.context="object"==typeof s&&null!==s?s._currentValue:i,"function"==typeof(s=t.getDerivedStateFromProps)&&(a=null==(s=s(r,a))?a:O({},a,s),e.state=a),"function"!=typeof t.getDerivedStateFromProps&&"function"!=typeof e.getSnapshotBeforeUpdate&&("function"==typeof e.UNSAFE_componentWillMount||"function"==typeof e.componentWillMount)){if(t=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),t!==e.state&&rD.enqueueReplaceState(e,e.state,null),null!==n.queue&&0<n.queue.length){if(t=n.queue,s=n.replace,n.queue=null,n.replace=!1,s&&1===t.length)e.state=t[0];else{for(n=s?t[0]:e.state,a=!0,s=s?1:0;s<t.length;s++){var o=t[s];null!=(o="function"==typeof o?o.call(e,n,r,i):o)&&(a?(a=!1,n=O({},n,o)):O(n,o))}e.state=n}}else n.queue=null}}var rF={id:1,overflow:""};function rB(e,t,r){var i=e.id;e=e.overflow;var a=32-rO(i)-1;i&=~(1<<a),r+=1;var n=32-rO(t)+a;if(30<n){var s=a-a%5;return n=(i&(1<<s)-1).toString(32),i>>=s,a-=s,{id:1<<32-rO(t)+a|r<<a|i,overflow:n+e}}return{id:1<<n|r<<a|i,overflow:e}}var rO=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(rN(e)/rV|0)|0},rN=Math.log,rV=Math.LN2,r$=Error("Suspense Exception: This is not a real error! It's an implementation detail of `use` to interrupt the current render. You must either rethrow it immediately, or move the `use` call outside of the `try/catch` block. Capturing without rethrowing will lead to unexpected behavior.\n\nTo handle async errors, wrap your component in an error boundary, or call the promise's `.catch` method and pass the result to `use`");function rj(){}var rU=null;function rq(){if(null===rU)throw Error("Expected a suspended thenable. This is a bug in React. Please file an issue.");var e=rU;return rU=null,e}var rZ="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},rG=null,rH=null,rW=null,rX=null,rK=null,rJ=null,rY=!1,rQ=!1,r0=0,r1=0,r2=-1,r3=0,r5=null,r4=null,r6=0;function r8(){if(null===rG)throw Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.");return rG}function r9(){if(0<r6)throw Error("Rendered more hooks than during the previous render");return{memoizedState:null,queue:null,next:null}}function r7(){return null===rJ?null===rK?(rY=!1,rK=rJ=r9()):(rY=!0,rJ=rK):null===rJ.next?(rY=!1,rJ=rJ.next=r9()):(rY=!0,rJ=rJ.next),rJ}function ie(){var e=r5;return r5=null,e}function it(){rX=rW=rH=rG=null,rQ=!1,rK=null,r6=0,rJ=r4=null}function ir(e,t){return"function"==typeof t?t(e):t}function ii(e,t,r){if(rG=r8(),rJ=r7(),rY){var i=rJ.queue;if(t=i.dispatch,null!==r4&&void 0!==(r=r4.get(i))){r4.delete(i),i=rJ.memoizedState;do i=e(i,r.action),r=r.next;while(null!==r);return rJ.memoizedState=i,[i,t]}return[rJ.memoizedState,t]}return e=e===ir?"function"==typeof t?t():t:void 0!==r?r(t):t,rJ.memoizedState=e,e=(e=rJ.queue={last:null,dispatch:null}).dispatch=is.bind(null,rG,e),[rJ.memoizedState,e]}function ia(e,t){if(rG=r8(),rJ=r7(),t=void 0===t?null:t,null!==rJ){var r=rJ.memoizedState;if(null!==r&&null!==t){var i=r[1];e:if(null===i)i=!1;else{for(var a=0;a<i.length&&a<t.length;a++)if(!rZ(t[a],i[a])){i=!1;break e}i=!0}if(i)return r[0]}}return e=e(),rJ.memoizedState=[e,t],e}function is(e,t,r){if(25<=r6)throw Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");if(e===rG){if(rQ=!0,e={action:r,next:null},null===r4&&(r4=new Map),void 0===(r=r4.get(t)))r4.set(t,e);else{for(t=r;null!==t.next;)t=t.next;t.next=e}}}function io(){throw Error("startTransition cannot be called during server rendering.")}function il(){throw Error("Cannot update optimistic state while rendering.")}function iu(e,t,r){return void 0!==e?"p"+e:(e=JSON.stringify([t,null,r]),(t=a.createHash("md5")).update(e),"k"+t.digest("hex"))}function ih(e){var t=r3;return r3+=1,null===r5&&(r5=[]),function(e,t,r){switch(void 0===(r=e[r])?e.push(t):r!==t&&(t.then(rj,rj),t=r),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:if("string"!=typeof t.status)switch((e=t).status="pending",e.then(function(e){if("pending"===t.status){var r=t;r.status="fulfilled",r.value=e}},function(e){if("pending"===t.status){var r=t;r.status="rejected",r.reason=e}}),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}throw rU=t,r$}}(r5,e,t)}function ic(){throw Error("Cache cannot be refreshed during server rendering.")}function id(){}var ip,im={readContext:function(e){return e._currentValue},use:function(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return ih(e);if(e.$$typeof===m)return e._currentValue}throw Error("An unsupported type was passed to use(): "+String(e))},useContext:function(e){return r8(),e._currentValue},useMemo:ia,useReducer:ii,useRef:function(e){rG=r8();var t=(rJ=r7()).memoizedState;return null===t?(e={current:e},rJ.memoizedState=e):t},useState:function(e){return ii(ir,e)},useInsertionEffect:id,useLayoutEffect:id,useCallback:function(e,t){return ia(function(){return e},t)},useImperativeHandle:id,useEffect:id,useDebugValue:id,useDeferredValue:function(e){return r8(),e},useTransition:function(){return r8(),[!1,io]},useId:function(){var e=rH.treeContext,t=e.overflow;e=((e=e.id)&~(1<<32-rO(e)-1)).toString(32)+t;var r=ig;if(null===r)throw Error("Invalid hook call. Hooks can only be called inside of the body of a function component.");return t=r0++,e=":"+r.idPrefix+"R"+e,0<t&&(e+="H"+t.toString(32)),e+":"},useSyncExternalStore:function(e,t,r){if(void 0===r)throw Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");return r()},useCacheRefresh:function(){return ic},useHostTransitionStatus:function(){return r8(),J},useOptimistic:function(e){return r8(),[e,il]},useFormState:function(e,t,r){r8();var i=r1++,a=rW;if("function"==typeof e.$$FORM_ACTION){var n=null,s=rX;a=a.formState;var o=e.$$IS_SIGNATURE_EQUAL;if(null!==a&&"function"==typeof o){var l=a[1];o.call(e,a[2],a[3])&&l===(n=iu(r,s,i))&&(r2=i,t=a[0])}var u=e.bind(null,t);return e=function(e){u(e)},"function"==typeof u.$$FORM_ACTION&&(e.$$FORM_ACTION=function(e){e=u.$$FORM_ACTION(e),void 0!==r&&(r+="",e.action=r);var t=e.data;return t&&(null===n&&(n=iu(r,s,i)),t.append("$ACTION_KEY",n)),e}),[t,e]}var h=e.bind(null,t);return[t,function(e){h(e)}]}},ig=null,iy={getCacheSignal:function(){throw Error("Not implemented.")},getCacheForType:function(){throw Error("Not implemented.")}};function i_(e){if(void 0===ip)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);ip=t&&t[1]||""}return"\n"+ip+e}var ix=!1;function iv(e,t){if(!e||ix)return"";ix=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var i={DetermineComponentFrameRoot:function(){try{if(t){var r=function(){throw Error()};if(Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(r,[])}catch(e){var i=e}Reflect.construct(e,[],r)}else{try{r.call()}catch(e){i=e}e.call(r.prototype)}}else{try{throw Error()}catch(e){i=e}(r=e())&&"function"==typeof r.catch&&r.catch(function(){})}}catch(e){if(e&&i&&"string"==typeof e.stack)return[e.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});try{var n=i.DetermineComponentFrameRoot(),s=n[0],o=n[1];if(s&&o){var l=s.split("\n"),u=o.split("\n");for(a=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;a<u.length&&!u[a].includes("DetermineComponentFrameRoot");)a++;if(i===l.length||a===u.length)for(i=l.length-1,a=u.length-1;1<=i&&0<=a&&l[i]!==u[a];)a--;for(;1<=i&&0<=a;i--,a--)if(l[i]!==u[a]){if(1!==i||1!==a)do if(i--,a--,0>a||l[i]!==u[a]){var h="\n"+l[i].replace(" at new "," at ");return e.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",e.displayName)),h}while(1<=i&&0<=a);break}}}finally{ix=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?i_(r):""}var ib=K.ReactCurrentDispatcher,iw=K.ReactCurrentCache;function iS(e){return console.error(e),null}function ik(){}var iT=null;function iI(){return iT||rI.getStore()||null}function iC(e,t){e.pingedTasks.push(t),1===e.pingedTasks.length&&(e.flushScheduled=null!==e.destination,setImmediate(function(){return iQ(e)}))}function iP(e,t){return{status:0,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,completedSegments:[],byteSize:0,fallbackAbortableTasks:t,errorDigest:null,contentState:ry(),fallbackState:ry(),trackedContentKeyPath:null,trackedFallbackNode:null}}function iE(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f){e.allPendingTasks++,null===a?e.pendingRootTasks++:a.pendingTasks++;var m={replay:null,node:r,childIndex:i,ping:function(){return iC(e,m)},blockedBoundary:a,blockedSegment:n,hoistableState:s,abortSet:o,keyPath:l,formatContext:u,legacyContext:h,context:c,treeContext:d,componentStack:p,thenableState:t,isFallback:f};return o.add(m),m}function iM(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f){e.allPendingTasks++,null===n?e.pendingRootTasks++:n.pendingTasks++,r.pendingTasks++;var m={replay:r,node:i,childIndex:a,ping:function(){return iC(e,m)},blockedBoundary:n,blockedSegment:null,hoistableState:s,abortSet:o,keyPath:l,formatContext:u,legacyContext:h,context:c,treeContext:d,componentStack:p,thenableState:t,isFallback:f};return o.add(m),m}function iA(e,t,r,i,a,n){return{status:0,id:-1,index:t,parentFlushed:!1,chunks:[],children:[],parentFormatContext:i,boundary:r,lastPushedText:a,textEmbedded:n}}function iz(e,t){return{tag:0,parent:e.componentStack,type:t}}function iR(e,t){if(t&&null!==e.trackedPostpones){try{e="";do{switch(t.tag){case 0:e+=i_(t.type,null);break;case 1:e+=iv(t.type,!1);break;case 2:e+=iv(t.type,!0)}t=t.parent}while(t);var r=e}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}r={componentStack:r}}else r={};return r}function iD(e,t,r){if(null==(e=e.onError(t,r))||"string"==typeof e)return e}function iL(e,t){var r=e.onShellError;r(t),(r=e.onFatalError)(t),null!==e.destination?(e.status=2,e.destination.destroy(t)):(e.status=1,e.fatalError=t)}function iF(e,t,r,i,a,n){var s=t.thenableState;for(t.thenableState=null,rG={},rH=t,rW=e,rX=r,r1=r0=0,r2=-1,r3=0,r5=s,e=i(a,n);rQ;)rQ=!1,r1=r0=0,r2=-1,r3=0,r6+=1,rJ=null,e=i(a,n);return it(),e}function iB(e,t,r,i,a){var n=i.render(),s=a.childContextTypes;if(null!=s){if(r=t.legacyContext,"function"!=typeof i.getChildContext)a=r;else{for(var o in i=i.getChildContext())if(!(o in s))throw Error((rP(a)||"Unknown")+'.getChildContext(): key "'+o+'" is not defined in childContextTypes.');a=O({},r,i)}t.legacyContext=a,ij(e,t,n,-1),t.legacyContext=r}else a=t.keyPath,t.keyPath=r,ij(e,t,n,-1),t.keyPath=a}function iO(e,t,r,i,a,n,s){var o=!1;if(0!==n&&null!==e.formState){var l=t.blockedSegment;if(null!==l){o=!0,l=l.chunks;for(var u=0;u<n;u++)u===s?l.push(e$):l.push(ej)}}n=t.keyPath,t.keyPath=r,a?(r=t.treeContext,t.treeContext=rB(r,1,0),iZ(e,t,i,-1),t.treeContext=r):o?iZ(e,t,i,-1):ij(e,t,i,-1),t.keyPath=n}function iN(e,t){if(e&&e.defaultProps)for(var r in t=O({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}function iV(e,t,r,i,a,n){if("function"==typeof i){if(i.prototype&&i.prototype.isReactComponent){n=t.componentStack,t.componentStack={tag:2,parent:t.componentStack,type:i};var o=rM(i,t.legacyContext),l=i.contextType;rL(l=new i(a,"object"==typeof l&&null!==l?l._currentValue:o),i,a,o),iB(e,t,r,l,i),t.componentStack=n}else{n=rM(i,t.legacyContext),o=t.componentStack,t.componentStack={tag:1,parent:t.componentStack,type:i},l=iF(e,t,r,i,a,n);var u=0!==r0,T=r1,I=r2;"object"==typeof l&&null!==l&&"function"==typeof l.render&&void 0===l.$$typeof?(rL(l,i,a,n),iB(e,t,r,l,i)):iO(e,t,r,l,u,T,I),t.componentStack=o}}else if("string"==typeof i){if(n=t.componentStack,t.componentStack=iz(t,i),null===(o=t.blockedSegment))o=a.children,l=t.formatContext,u=t.keyPath,t.formatContext=em(l,i,a),t.keyPath=r,iZ(e,t,o,-1),t.formatContext=l,t.keyPath=u;else{u=function(e,t,r,i,a,n,o,l,u){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":break;case"select":e.push(eJ("select"));var h,c=null,d=null;for(h in r)if(N.call(r,h)){var p=r[h];if(null!=p)switch(h){case"children":c=p;break;case"dangerouslySetInnerHTML":d=p;break;case"defaultValue":case"value":break;default:eD(e,h,p)}}return e.push(eL),eB(e,d,c),c;case"option":var f=o.selectedValue;e.push(eJ("option"));var m,g=null,y=null,_=null,x=null;for(m in r)if(N.call(r,m)){var v=r[m];if(null!=v)switch(m){case"children":g=v;break;case"selected":_=v;break;case"dangerouslySetInnerHTML":x=v;break;case"value":y=v;default:eD(e,m,v)}}if(null!=f){var b,w,S=null!==y?""+y:(b=g,w="",s.Children.forEach(b,function(e){null!=e&&(w+=e)}),w);if(C(f)){for(var k=0;k<f.length;k++)if(""+f[k]===S){e.push(eO);break}}else""+f===S&&e.push(eO)}else _&&e.push(eO);return e.push(eL),eB(e,x,g),g;case"textarea":e.push(eJ("textarea"));var T,I=null,P=null,E=null;for(T in r)if(N.call(r,T)){var M=r[T];if(null!=M)switch(T){case"children":E=M;break;case"value":I=M;break;case"defaultValue":P=M;break;case"dangerouslySetInnerHTML":throw Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");default:eD(e,T,M)}}if(null===I&&null!==P&&(I=P),e.push(eL),null!=E){if(null!=I)throw Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(C(E)){if(1<E.length)throw Error("<textarea> can only have at most one child.");I=""+E[0]}I=""+E}return"string"==typeof I&&"\n"===I[0]&&e.push(eW),null!==I&&e.push(H(""+I)),null;case"input":e.push(eJ("input"));var A,z=null,R=null,D=null,L=null,F=null,B=null,V=null,$=null,j=null;for(A in r)if(N.call(r,A)){var q=r[A];if(null!=q)switch(A){case"children":case"dangerouslySetInnerHTML":throw Error("input is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");case"name":z=q;break;case"formAction":R=q;break;case"formEncType":D=q;break;case"formMethod":L=q;break;case"formTarget":F=q;break;case"defaultChecked":j=q;break;case"defaultValue":V=q;break;case"checked":$=q;break;case"value":B=q;break;default:eD(e,A,q)}}var Z=eR(e,i,a,R,D,L,F,z);return null!==$?eC(e,"checked",$):null!==j&&eC(e,"checked",j),null!==B?eD(e,"value",B):null!==V&&eD(e,"value",V),e.push(eF),null!==Z&&Z.forEach(ez,e),null;case"button":e.push(eJ("button"));var G,W=null,X=null,K=null,J=null,Y=null,Q=null,et=null;for(G in r)if(N.call(r,G)){var er=r[G];if(null!=er)switch(G){case"children":W=er;break;case"dangerouslySetInnerHTML":X=er;break;case"name":K=er;break;case"formAction":J=er;break;case"formEncType":Y=er;break;case"formMethod":Q=er;break;case"formTarget":et=er;break;default:eD(e,G,er)}}var ei=eR(e,i,a,J,Y,Q,et,K);if(e.push(eL),null!==ei&&ei.forEach(ez,e),eB(e,X,W),"string"==typeof W){e.push(H(W));var ea=null}else ea=W;return ea;case"form":e.push(eJ("form"));var en,es=null,eo=null,el=null,eu=null,eh=null,ec=null;for(en in r)if(N.call(r,en)){var ed=r[en];if(null!=ed)switch(en){case"children":es=ed;break;case"dangerouslySetInnerHTML":eo=ed;break;case"action":el=ed;break;case"encType":eu=ed;break;case"method":eh=ed;break;case"target":ec=ed;break;default:eD(e,en,ed)}}var ep=null,ef=null;if("function"==typeof el){if("function"==typeof el.$$FORM_ACTION){var em=eE(i),ey=el.$$FORM_ACTION(em);el=ey.action||"",eu=ey.encType,eh=ey.method,ec=ey.target,ep=ey.data,ef=ey.name}else e.push(eS,"action",ek,eM,eT),ec=eh=eu=el=null,eV(i,a)}if(null!=el&&eD(e,"action",el),null!=eu&&eD(e,"encType",eu),null!=eh&&eD(e,"method",eh),null!=ec&&eD(e,"target",ec),e.push(eL),null!==ef&&(e.push(eA),eP(e,"name",ef),e.push(eF),null!==ep&&ep.forEach(ez,e)),eB(e,eo,es),"string"==typeof es){e.push(H(es));var e_=null}else e_=es;return e_;case"menuitem":for(var ex in e.push(eJ("menuitem")),r)if(N.call(r,ex)){var ev=r[ex];if(null!=ev)switch(ex){case"children":case"dangerouslySetInnerHTML":throw Error("menuitems cannot have `children` nor `dangerouslySetInnerHTML`.");default:eD(e,ex,ev)}}return e.push(eL),null;case"title":if(3===o.insertionMode||1&o.tagScope||null!=r.itemProp)var eb=eZ(e,r);else u?eb=null:(eZ(a.hoistableChunks,r),eb=void 0);return eb;case"link":var eI=r.rel,eN=r.href,e$=r.precedence;if(3===o.insertionMode||1&o.tagScope||null!=r.itemProp||"string"!=typeof eI||"string"!=typeof eN||""===eN){eU(e,r);var ej=null}else if("stylesheet"===r.rel){if("string"!=typeof e$||null!=r.disabled||r.onLoad||r.onError)ej=eU(e,r);else{var eX=a.styles.get(e$),eK=i.styleResources.hasOwnProperty(eN)?i.styleResources[eN]:void 0;if(null!==eK){i.styleResources[eN]=null,eX||(eX={precedence:H(e$),rules:[],hrefs:[],sheets:new Map},a.styles.set(e$,eX));var eQ={state:0,props:O({},r,{"data-precedence":r.precedence,precedence:null})};if(eK){2===eK.length&&r_(eQ.props,eK);var e1=a.preloads.stylesheets.get(eN);e1&&0<e1.length?e1.length=0:eQ.state=1}eX.sheets.set(eN,eQ),n&&n.stylesheets.add(eQ)}else if(eX){var e2=eX.sheets.get(eN);e2&&n&&n.stylesheets.add(e2)}l&&e.push(eg),ej=null}}else r.onLoad||r.onError?ej=eU(e,r):(l&&e.push(eg),ej=u?null:eU(a.hoistableChunks,r));return ej;case"script":var e3=r.async;if("string"!=typeof r.src||!r.src||!e3||"function"==typeof e3||"symbol"==typeof e3||r.onLoad||r.onError||3===o.insertionMode||1&o.tagScope||null!=r.itemProp)var e5=eG(e,r);else{var e4=r.src;if("module"===r.type)var e6=i.moduleScriptResources,e8=a.preloads.moduleScripts;else e6=i.scriptResources,e8=a.preloads.scripts;var e9=e6.hasOwnProperty(e4)?e6[e4]:void 0;if(null!==e9){e6[e4]=null;var e7=r;if(e9){2===e9.length&&r_(e7=O({},r),e9);var te=e8.get(e4);te&&(te.length=0)}var tt=[];a.scripts.add(tt),eG(tt,e7)}l&&e.push(eg),e5=null}return e5;case"style":var tr=r.precedence,ti=r.href;if(3===o.insertionMode||1&o.tagScope||null!=r.itemProp||"string"!=typeof tr||"string"!=typeof ti||""===ti){e.push(eJ("style"));var ta,tn=null,ts=null;for(ta in r)if(N.call(r,ta)){var to=r[ta];if(null!=to)switch(ta){case"children":tn=to;break;case"dangerouslySetInnerHTML":ts=to;break;default:eD(e,ta,to)}}e.push(eL);var tl=Array.isArray(tn)?2>tn.length?tn[0]:null:tn;"function"!=typeof tl&&"symbol"!=typeof tl&&null!=tl&&e.push(H(""+tl)),eB(e,ts,tn),e.push(e0("style"));var tu=null}else{var th=a.styles.get(tr);if(null!==(i.styleResources.hasOwnProperty(ti)?i.styleResources[ti]:void 0)){i.styleResources[ti]=null,th?th.hrefs.push(H(ti)):(th={precedence:H(tr),rules:[],hrefs:[H(ti)],sheets:new Map},a.styles.set(tr,th));var tc,td=th.rules,tp=null,tf=null;for(tc in r)if(N.call(r,tc)){var tm=r[tc];if(null!=tm)switch(tc){case"children":tp=tm;break;case"dangerouslySetInnerHTML":tf=tm}}var tg=Array.isArray(tp)?2>tp.length?tp[0]:null:tp;"function"!=typeof tg&&"symbol"!=typeof tg&&null!=tg&&td.push(H(""+tg)),eB(td,tf,tp)}th&&n&&n.styles.add(th),l&&e.push(eg),tu=void 0}return tu;case"meta":if(3===o.insertionMode||1&o.tagScope||null!=r.itemProp)var ty=eq(e,r,"meta");else l&&e.push(eg),ty=u?null:"string"==typeof r.charSet?eq(a.charsetChunks,r,"meta"):"viewport"===r.name?eq(a.viewportChunks,r,"meta"):eq(a.hoistableChunks,r,"meta");return ty;case"listing":case"pre":e.push(eJ(t));var t_,tx=null,tv=null;for(t_ in r)if(N.call(r,t_)){var tb=r[t_];if(null!=tb)switch(t_){case"children":tx=tb;break;case"dangerouslySetInnerHTML":tv=tb;break;default:eD(e,t_,tb)}}if(e.push(eL),null!=tv){if(null!=tx)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if("object"!=typeof tv||!("__html"in tv))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.");var tw=tv.__html;null!=tw&&("string"==typeof tw&&0<tw.length&&"\n"===tw[0]?e.push(eW,tw):e.push(""+tw))}return"string"==typeof tx&&"\n"===tx[0]&&e.push(eW),tx;case"img":var tS=r.src,tk=r.srcSet;if(!("lazy"===r.loading||!tS&&!tk||"string"!=typeof tS&&null!=tS||"string"!=typeof tk&&null!=tk)&&"low"!==r.fetchPriority&&!1==!!(2&o.tagScope)&&("string"!=typeof tS||":"!==tS[4]||"d"!==tS[0]&&"D"!==tS[0]||"a"!==tS[1]&&"A"!==tS[1]||"t"!==tS[2]&&"T"!==tS[2]||"a"!==tS[3]&&"A"!==tS[3])&&("string"!=typeof tk||":"!==tk[4]||"d"!==tk[0]&&"D"!==tk[0]||"a"!==tk[1]&&"A"!==tk[1]||"t"!==tk[2]&&"T"!==tk[2]||"a"!==tk[3]&&"A"!==tk[3])){var tT="string"==typeof r.sizes?r.sizes:void 0,tI=tk?tk+"\n"+(tT||""):tS,tC=a.preloads.images,tP=tC.get(tI);if(tP)("high"===r.fetchPriority||10>a.highImagePreloads.size)&&(tC.delete(tI),a.highImagePreloads.add(tP));else if(!i.imageResources.hasOwnProperty(tI)){i.imageResources[tI]=ee;var tE,tM=r.crossOrigin,tA="string"==typeof tM?"use-credentials"===tM?tM:"":void 0,tz=a.headers;tz&&0<tz.remainingCapacity&&("high"===r.fetchPriority||500>tz.highImagePreloads.length)&&(tE=rx(tS,"image",{imageSrcSet:r.srcSet,imageSizes:r.sizes,crossOrigin:tA,integrity:r.integrity,nonce:r.nonce,type:r.type,fetchPriority:r.fetchPriority,referrerPolicy:r.refererPolicy}),2<=(tz.remainingCapacity-=tE.length))?(a.resets.image[tI]=ee,tz.highImagePreloads&&(tz.highImagePreloads+=", "),tz.highImagePreloads+=tE):(eU(tP=[],{rel:"preload",as:"image",href:tk?void 0:tS,imageSrcSet:tk,imageSizes:tT,crossOrigin:tA,integrity:r.integrity,type:r.type,fetchPriority:r.fetchPriority,referrerPolicy:r.referrerPolicy}),"high"===r.fetchPriority||10>a.highImagePreloads.size?a.highImagePreloads.add(tP):(a.bulkPreloads.add(tP),tC.set(tI,tP)))}}return eq(e,r,"img");case"base":case"area":case"br":case"col":case"embed":case"hr":case"keygen":case"param":case"source":case"track":case"wbr":return eq(e,r,t);case"head":if(2>o.insertionMode&&null===a.headChunks){a.headChunks=[];var tR=eH(a.headChunks,r,"head")}else tR=eH(e,r,"head");return tR;case"html":if(0===o.insertionMode&&null===a.htmlChunks){a.htmlChunks=[eY];var tD=eH(a.htmlChunks,r,"html")}else tD=eH(e,r,"html");return tD;default:if(-1!==t.indexOf("-")){e.push(eJ(t));var tL,tF=null,tB=null;for(tL in r)if(N.call(r,tL)){var tO=r[tL];if(null!=tO)switch(tL){case"children":tF=tO;break;case"dangerouslySetInnerHTML":tB=tO;break;case"style":ew(e,tO);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"ref":break;default:U(tL)&&"function"!=typeof tO&&"symbol"!=typeof tO&&e.push(eS,tL,ek,H(tO),eT)}}return e.push(eL),eB(e,tB,tF),tF}}return eH(e,r,t)}(o.chunks,i,a,e.resumableState,e.renderState,t.hoistableState,t.formatContext,o.lastPushedText,t.isFallback),o.lastPushedText=!1,l=t.formatContext,T=t.keyPath,t.formatContext=em(l,i,a),t.keyPath=r,iZ(e,t,u,-1),t.formatContext=l,t.keyPath=T;e:{switch(r=o.chunks,e=e.resumableState,i){case"title":case"style":case"script":case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break e;case"body":if(1>=l.insertionMode){e.hasBody=!0;break e}break;case"html":if(0===l.insertionMode){e.hasHtml=!0;break e}}r.push(e0(i))}o.lastPushedText=!1}t.componentStack=n}else{switch(i){case k:case w:case c:case d:case h:i=t.keyPath,t.keyPath=r,ij(e,t,a.children,-1),t.keyPath=i;return;case S:"hidden"!==a.mode&&(i=t.keyPath,t.keyPath=r,ij(e,t,a.children,-1),t.keyPath=i);return;case _:i=t.componentStack,t.componentStack=iz(t,"SuspenseList"),n=t.keyPath,t.keyPath=r,ij(e,t,a.children,-1),t.keyPath=n,t.componentStack=i;return;case b:throw Error("ReactDOMServer does not yet support scope components.");case y:e:if(null!==t.replay){i=t.keyPath,t.keyPath=r,r=a.children;try{iZ(e,t,r,-1)}finally{t.keyPath=i}}else{var P=t.componentStack;i=t.componentStack=iz(t,"Suspense");var E=t.keyPath;n=t.blockedBoundary;var M=t.hoistableState,A=t.blockedSegment;o=a.fallback;var z=a.children;l=iP(e,a=new Set),null!==e.trackedPostpones&&(l.trackedContentKeyPath=r),u=iA(e,A.chunks.length,l,t.formatContext,!1,!1),A.children.push(u),A.lastPushedText=!1;var R=iA(e,0,null,t.formatContext,!1,!1);R.parentFlushed=!0,t.blockedBoundary=l,t.hoistableState=l.contentState,t.blockedSegment=R,t.keyPath=r;try{if(iZ(e,t,z,-1),R.lastPushedText&&R.textEmbedded&&R.chunks.push(eg),R.status=1,iJ(l,R),0===l.pendingTasks&&0===l.status){l.status=1,t.componentStack=P;break e}}catch(r){R.status=4,l.status=4,T=iR(e,t.componentStack),I=iD(e,r,T),l.errorDigest=I,iq(e,l)}finally{t.blockedBoundary=n,t.hoistableState=M,t.blockedSegment=A,t.keyPath=E,t.componentStack=P}T=[r[0],"Suspense Fallback",r[2]],null!==(I=e.trackedPostpones)&&(P=[T[1],T[2],[],null],I.workingMap.set(T,P),5===l.status?I.workingMap.get(r)[4]=P:l.trackedFallbackNode=P),t=iE(e,null,o,-1,n,u,l.fallbackState,a,T,t.formatContext,t.legacyContext,t.context,t.treeContext,i,!0),e.pingedTasks.push(t)}return}if("object"==typeof i&&null!==i)switch(i.$$typeof){case g:o=t.componentStack,t.componentStack={tag:1,parent:t.componentStack,type:i.render},a=iF(e,t,r,i.render,a,n),iO(e,t,r,a,0!==r0,r1,r2),t.componentStack=o;return;case x:a=iN(i=i.type,a),iV(e,t,r,i,a,n);return;case p:if(o=a.children,n=t.keyPath,i=i._context,a=a.value,l=i._currentValue,i._currentValue=a,rA=a={parent:u=rA,depth:null===u?0:u.depth+1,context:i,parentValue:l,value:a},t.context=a,t.keyPath=r,ij(e,t,o,-1),null===(e=rA))throw Error("Tried to pop a Context at the root of the app. This is a bug in React.");e.context._currentValue=e.parentValue,e=rA=e.parent,t.context=e,t.keyPath=n;return;case m:a=(a=a.children)(i._currentValue),i=t.keyPath,t.keyPath=r,ij(e,t,a,-1),t.keyPath=i;return;case f:case v:n=t.componentStack,t.componentStack=iz(t,"Lazy"),a=iN(i=(o=i._init)(i._payload),a),iV(e,t,r,i,a,void 0),t.componentStack=n;return}throw Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: "+(null==i?i:typeof i)+".")}}function i$(e,t,r,i,a){var n=t.replay,s=t.blockedBoundary,o=iA(e,0,null,t.formatContext,!1,!1);o.id=r,o.parentFlushed=!0;try{t.replay=null,t.blockedSegment=o,iZ(e,t,i,a),o.status=1,null===s?e.completedRootSegment=o:(iJ(s,o),s.parentFlushed&&e.partialBoundaries.push(s))}finally{t.replay=n,t.blockedSegment=null}}function ij(e,t,r,i){if(null!==t.replay&&"number"==typeof t.replay.slots)i$(e,t,t.replay.slots,r,i);else if(t.node=r,t.childIndex=i,null!==r){if("object"==typeof r){switch(r.$$typeof){case l:var a=r.type,n=r.key,s=r.props,o=r.ref,h=rP(a),c=null==n?-1===i?0:i:n;if(n=[t.keyPath,h,c],null!==t.replay)e:{var d=t.replay;for(r=0,i=d.nodes;r<i.length;r++){var p=i[r];if(c===p[1]){if(4===p.length){if(null!==h&&h!==p[0])throw Error("Expected the resume to render <"+p[0]+"> in this slot but instead it rendered <"+h+">. The tree doesn't match so React will fallback to client rendering.");var f=p[2];h=p[3],c=t.node,t.replay={nodes:f,slots:h,pendingTasks:1};try{if(iV(e,t,n,a,s,o),1===t.replay.pendingTasks&&0<t.replay.nodes.length)throw Error("Couldn't find all resumable slots by key/index during replaying. The tree doesn't match so React will fallback to client rendering.");t.replay.pendingTasks--}catch(r){if("object"==typeof r&&null!==r&&(r===r$||"function"==typeof r.then))throw t.node===c&&(t.replay=d),r;t.replay.pendingTasks--,s=iR(e,t.componentStack),n=e,e=t.blockedBoundary,s=iD(n,a=r,s),iH(n,e,f,h,a,s)}t.replay=d}else{if(a!==y)throw Error("Expected the resume to render <Suspense> in this slot but instead it rendered <"+(rP(a)||"Unknown")+">. The tree doesn't match so React will fallback to client rendering.");t:{d=void 0,a=p[5],o=p[2],h=p[3],c=null===p[4]?[]:p[4][2],p=null===p[4]?null:p[4][3];var g=t.componentStack,_=t.componentStack=iz(t,"Suspense"),x=t.keyPath,b=t.replay,w=t.blockedBoundary,S=t.hoistableState,k=s.children;s=s.fallback;var T=new Set,P=iP(e,T);P.parentFlushed=!0,P.rootSegmentID=a,t.blockedBoundary=P,t.hoistableState=P.contentState,t.replay={nodes:o,slots:h,pendingTasks:1};try{if(iZ(e,t,k,-1),1===t.replay.pendingTasks&&0<t.replay.nodes.length)throw Error("Couldn't find all resumable slots by key/index during replaying. The tree doesn't match so React will fallback to client rendering.");if(t.replay.pendingTasks--,0===P.pendingTasks&&0===P.status){P.status=1,e.completedBoundaries.push(P);break t}}catch(r){P.status=4,f=iR(e,t.componentStack),d=iD(e,r,f),P.errorDigest=d,t.replay.pendingTasks--,e.clientRenderedBoundaries.push(P)}finally{t.blockedBoundary=w,t.hoistableState=S,t.replay=b,t.keyPath=x,t.componentStack=g}t=iM(e,null,{nodes:c,slots:p,pendingTasks:0},s,-1,w,P.fallbackState,T,[n[0],"Suspense Fallback",n[2]],t.formatContext,t.legacyContext,t.context,t.treeContext,_,!0),e.pingedTasks.push(t)}}i.splice(r,1);break e}}}else iV(e,t,n,a,s,o);return;case u:throw Error("Portals are not currently supported by the server renderer. Render them conditionally so that they only appear on the client render.");case v:s=t.componentStack,t.componentStack=iz(t,"Lazy"),r=(n=r._init)(r._payload),t.componentStack=s,ij(e,t,r,i);return}if(C(r)){iU(e,t,r,i);return}if((s=null===r||"object"!=typeof r?null:"function"==typeof(s=I&&r[I]||r["@@iterator"])?s:null)&&(s=s.call(r))){if(!(r=s.next()).done){n=[];do n.push(r.value),r=s.next();while(!r.done);iU(e,t,n,i)}return}if("function"==typeof r.then)return t.thenableState=null,ij(e,t,ih(r),i);if(r.$$typeof===m)return ij(e,t,r._currentValue,i);throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(i=Object.prototype.toString.call(r))?"object with keys {"+Object.keys(r).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.")}"string"==typeof r?null!==(i=t.blockedSegment)&&(i.lastPushedText=ey(i.chunks,r,e.renderState,i.lastPushedText)):"number"==typeof r&&null!==(i=t.blockedSegment)&&(i.lastPushedText=ey(i.chunks,""+r,e.renderState,i.lastPushedText))}}function iU(e,t,r,i){var a=t.keyPath;if(-1!==i&&(t.keyPath=[t.keyPath,"Fragment",i],null!==t.replay)){for(var n=t.replay,s=n.nodes,o=0;o<s.length;o++){var l=s[o];if(l[1]===i){i=l[2],l=l[3],t.replay={nodes:i,slots:l,pendingTasks:1};try{if(iU(e,t,r,-1),1===t.replay.pendingTasks&&0<t.replay.nodes.length)throw Error("Couldn't find all resumable slots by key/index during replaying. The tree doesn't match so React will fallback to client rendering.");t.replay.pendingTasks--}catch(a){if("object"==typeof a&&null!==a&&(a===r$||"function"==typeof a.then))throw a;t.replay.pendingTasks--,r=iR(e,t.componentStack);var u=t.blockedBoundary;r=iD(e,a,r),iH(e,u,i,l,a,r)}t.replay=n,s.splice(o,1);break}}t.keyPath=a;return}if(n=t.treeContext,s=r.length,null!==t.replay&&null!==(o=t.replay.slots)&&"object"==typeof o){for(i=0;i<s;i++)l=r[i],t.treeContext=rB(n,s,i),"number"==typeof(u=o[i])?(i$(e,t,u,l,i),delete o[i]):iZ(e,t,l,i);t.treeContext=n,t.keyPath=a;return}for(o=0;o<s;o++)i=r[o],t.treeContext=rB(n,s,o),iZ(e,t,i,o);t.treeContext=n,t.keyPath=a}function iq(e,t){null!==(e=e.trackedPostpones)&&null!==(t=t.trackedContentKeyPath)&&void 0!==(t=e.workingMap.get(t))&&(t.length=4,t[2]=[],t[3]=null)}function iZ(e,t,r,i){var a=t.formatContext,n=t.legacyContext,s=t.context,o=t.keyPath,l=t.treeContext,u=t.componentStack,h=t.blockedSegment;if(null===h)try{return ij(e,t,r,i)}catch(h){if(it(),"object"==typeof(r=h===r$?rq():h)&&null!==r&&"function"==typeof r.then){e=iM(e,i=ie(),t.replay,t.node,t.childIndex,t.blockedBoundary,t.hoistableState,t.abortSet,t.keyPath,t.formatContext,t.legacyContext,t.context,t.treeContext,null!==t.componentStack?t.componentStack.parent:null,t.isFallback).ping,r.then(e,e),t.formatContext=a,t.legacyContext=n,t.context=s,t.keyPath=o,t.treeContext=l,t.componentStack=u,rR(s);return}}else{var c=h.children.length,d=h.chunks.length;try{return ij(e,t,r,i)}catch(p){if(it(),h.children.length=c,h.chunks.length=d,"object"==typeof(r=p===r$?rq():p)&&null!==r&&"function"==typeof r.then){i=ie(),c=iA(e,(h=t.blockedSegment).chunks.length,null,t.formatContext,h.lastPushedText,!0),h.children.push(c),h.lastPushedText=!1,e=iE(e,i,t.node,t.childIndex,t.blockedBoundary,c,t.hoistableState,t.abortSet,t.keyPath,t.formatContext,t.legacyContext,t.context,t.treeContext,null!==t.componentStack?t.componentStack.parent:null,t.isFallback).ping,r.then(e,e),t.formatContext=a,t.legacyContext=n,t.context=s,t.keyPath=o,t.treeContext=l,t.componentStack=u,rR(s);return}}}throw t.formatContext=a,t.legacyContext=n,t.context=s,t.keyPath=o,t.treeContext=l,rR(s),r}function iG(e){var t=e.blockedBoundary;null!==(e=e.blockedSegment)&&(e.status=3,iY(this,t,e))}function iH(e,t,r,i,a,n){for(var s=0;s<r.length;s++){var o=r[s];if(4===o.length)iH(e,t,o[2],o[3],a,n);else{o=o[5];var l=iP(e,new Set);l.parentFlushed=!0,l.rootSegmentID=o,l.status=4,l.errorDigest=n,l.parentFlushed&&e.clientRenderedBoundaries.push(l)}}if(r.length=0,null!==i){if(null===t)throw Error("We should not have any resumable nodes in the shell. This is a bug in React.");if(4!==t.status&&(t.status=4,t.errorDigest=n,t.parentFlushed&&e.clientRenderedBoundaries.push(t)),"object"==typeof i)for(var u in i)delete i[u]}}function iW(e,t){try{var r=e.renderState,i=r.onHeaders;if(i){var a=r.headers;if(a){r.headers=null;var n=a.preconnects;if(a.fontPreloads&&(n&&(n+=", "),n+=a.fontPreloads),a.highImagePreloads&&(n&&(n+=", "),n+=a.highImagePreloads),!t){var s=r.styles.values(),o=s.next();t:for(;0<a.remainingCapacity&&!o.done;o=s.next())for(var l=o.value.sheets.values(),u=l.next();0<a.remainingCapacity&&!u.done;u=l.next()){var h=u.value,c=h.props,d=c.href,p=h.props,f=rx(p.href,"style",{crossOrigin:p.crossOrigin,integrity:p.integrity,nonce:p.nonce,type:p.type,fetchPriority:p.fetchPriority,referrerPolicy:p.referrerPolicy,media:p.media});if(2<=(a.remainingCapacity-=f.length))r.resets.style[d]=ee,n&&(n+=", "),n+=f,r.resets.style[d]="string"==typeof c.crossOrigin||"string"==typeof c.integrity?[c.crossOrigin,c.integrity]:ee;else break t}}i(n?{Link:n}:{})}}}catch(t){iD(e,t,{})}}function iX(e){null===e.trackedPostpones&&iW(e,!0),e.onShellError=ik,(e=e.onShellReady)()}function iK(e){iW(e,null===e.trackedPostpones||null===e.completedRootSegment||5!==e.completedRootSegment.status),(e=e.onAllReady)()}function iJ(e,t){if(0===t.chunks.length&&1===t.children.length&&null===t.children[0].boundary&&-1===t.children[0].id){var r=t.children[0];r.id=t.id,r.parentFlushed=!0,1===r.status&&iJ(e,r)}else e.completedSegments.push(t)}function iY(e,t,r){if(null===t){if(null!==r&&r.parentFlushed){if(null!==e.completedRootSegment)throw Error("There can only be one root segment. This is a bug in React.");e.completedRootSegment=r}e.pendingRootTasks--,0===e.pendingRootTasks&&iX(e)}else t.pendingTasks--,4!==t.status&&(0===t.pendingTasks?(0===t.status&&(t.status=1),null!==r&&r.parentFlushed&&1===r.status&&iJ(t,r),t.parentFlushed&&e.completedBoundaries.push(t),1===t.status&&(t.fallbackAbortableTasks.forEach(iG,e),t.fallbackAbortableTasks.clear())):null!==r&&r.parentFlushed&&1===r.status&&(iJ(t,r),1===t.completedSegments.length&&t.parentFlushed&&e.partialBoundaries.push(t)));e.allPendingTasks--,0===e.allPendingTasks&&iK(e)}function iQ(e){if(2!==e.status){var t=rA,r=ib.current;ib.current=im;var i=iw.current;iw.current=iy;var a=iT;iT=e;var n=ig;ig=e.resumableState;try{var s,o=e.pingedTasks;for(s=0;s<o.length;s++){var l=o[s],u=e,h=l.blockedSegment;if(null===h){var c=u;if(0!==l.replay.pendingTasks){rR(l.context);try{if(ij(c,l,l.node,l.childIndex),1===l.replay.pendingTasks&&0<l.replay.nodes.length)throw Error("Couldn't find all resumable slots by key/index during replaying. The tree doesn't match so React will fallback to client rendering.");l.replay.pendingTasks--,l.abortSet.delete(l),iY(c,l.blockedBoundary,null)}catch(e){it();var d=e===r$?rq():e;if("object"==typeof d&&null!==d&&"function"==typeof d.then){var p=l.ping;d.then(p,p),l.thenableState=ie()}else{l.replay.pendingTasks--,l.abortSet.delete(l);var f=iR(c,l.componentStack);u=void 0;var m=c,g=l.blockedBoundary,y=l.replay.nodes,_=l.replay.slots;u=iD(m,d,f),iH(m,g,y,_,d,u),c.pendingRootTasks--,0===c.pendingRootTasks&&iX(c),c.allPendingTasks--,0===c.allPendingTasks&&iK(c)}}finally{}}}else if(c=void 0,m=h,0===m.status){rR(l.context);var x=m.children.length,v=m.chunks.length;try{ij(u,l,l.node,l.childIndex),m.lastPushedText&&m.textEmbedded&&m.chunks.push(eg),l.abortSet.delete(l),m.status=1,iY(u,l.blockedBoundary,m)}catch(e){it(),m.children.length=x,m.chunks.length=v;var b=e===r$?rq():e;if("object"==typeof b&&null!==b&&"function"==typeof b.then){var w=l.ping;b.then(w,w),l.thenableState=ie()}else{var S=iR(u,l.componentStack);l.abortSet.delete(l),m.status=4;var k=l.blockedBoundary;c=iD(u,b,S),null===k?iL(u,b):(k.pendingTasks--,4!==k.status&&(k.status=4,k.errorDigest=c,iq(u,k),k.parentFlushed&&u.clientRenderedBoundaries.push(k))),u.allPendingTasks--,0===u.allPendingTasks&&iK(u)}}finally{}}}o.splice(0,s),null!==e.destination&&i4(e,e.destination)}catch(t){iD(e,t,{}),iL(e,t)}finally{ig=n,ib.current=r,iw.current=i,r===im&&rR(t),iT=a}}}function i0(e,t,r,i){switch(r.parentFlushed=!0,r.status){case 0:r.id=e.nextSegmentId++;case 5:return i=r.id,r.lastPushedText=!1,r.textEmbedded=!1,e=e.renderState,z(t,e2),z(t,e.placeholderPrefix),z(t,e=i.toString(16)),D(t,e3);case 1:r.status=2;var a=!0,n=r.chunks,s=0;r=r.children;for(var o=0;o<r.length;o++){for(a=r[o];s<a.index;s++)z(t,n[s]);a=i1(e,t,a,i)}for(;s<n.length-1;s++)z(t,n[s]);return s<n.length&&(a=D(t,n[s])),a;default:throw Error("Aborted, errored or already flushed boundaries should not be flushed again. This is a bug in React.")}}function i1(e,t,r,i){var a=r.boundary;if(null===a)return i0(e,t,r,i);if(a.parentFlushed=!0,4===a.status)a=a.errorDigest,D(t,e8),z(t,e7),a&&(z(t,tt),z(t,H(a)),z(t,te)),D(t,tr),i0(e,t,r,i);else if(1!==a.status)0===a.status&&(a.rootSegmentID=e.nextSegmentId++),0<a.completedSegments.length&&e.partialBoundaries.push(a),ti(t,e.renderState,a.rootSegmentID),i&&((a=a.fallbackState).styles.forEach(rk,i),a.stylesheets.forEach(rT,i)),i0(e,t,r,i);else if(a.byteSize>e.progressiveChunkSize)a.rootSegmentID=e.nextSegmentId++,e.completedBoundaries.push(a),ti(t,e.renderState,a.rootSegmentID),i0(e,t,r,i);else{if(i&&((r=a.contentState).styles.forEach(rk,i),r.stylesheets.forEach(rT,i)),D(t,e5),1!==(r=a.completedSegments).length)throw Error("A previously unvisited boundary must have exactly one root segment. This is a bug in React.");i1(e,t,r[0],i)}return D(t,e9)}function i2(e,t,r,i){return function(e,t,r,i){switch(r.insertionMode){case 0:case 1:case 2:return z(e,ta),z(e,t.segmentPrefix),z(e,i.toString(16)),D(e,tn);case 3:return z(e,to),z(e,t.segmentPrefix),z(e,i.toString(16)),D(e,tl);case 4:return z(e,th),z(e,t.segmentPrefix),z(e,i.toString(16)),D(e,tc);case 5:return z(e,tp),z(e,t.segmentPrefix),z(e,i.toString(16)),D(e,tf);case 6:return z(e,tg),z(e,t.segmentPrefix),z(e,i.toString(16)),D(e,ty);case 7:return z(e,tx),z(e,t.segmentPrefix),z(e,i.toString(16)),D(e,tv);case 8:return z(e,tw),z(e,t.segmentPrefix),z(e,i.toString(16)),D(e,tS);default:throw Error("Unknown insertion mode. This is a bug in React.")}}(t,e.renderState,r.parentFormatContext,r.id),i1(e,t,r,i),function(e,t){switch(t.insertionMode){case 0:case 1:case 2:return D(e,ts);case 3:return D(e,tu);case 4:return D(e,td);case 5:return D(e,tm);case 6:return D(e,t_);case 7:return D(e,tb);case 8:return D(e,tk);default:throw Error("Unknown insertion mode. This is a bug in React.")}}(t,r.parentFormatContext)}function i3(e,t,r){for(var i,a,n,s,o=r.completedSegments,l=0;l<o.length;l++)i5(e,t,r,o[l]);o.length=0,rt(t,r.contentState,e.renderState),o=e.resumableState,e=e.renderState,l=r.rootSegmentID,r=r.contentState;var u=e.stylesToHoist;e.stylesToHoist=!1;var h=0===o.streamingFormat;return h?(z(t,e.startInlineScript),u?0==(2&o.instructions)?(o.instructions|=10,z(t,tR)):0==(8&o.instructions)?(o.instructions|=8,z(t,tD)):z(t,tL):0==(2&o.instructions)?(o.instructions|=2,z(t,tA)):z(t,tz)):u?z(t,t$):z(t,tV),o=l.toString(16),z(t,e.boundaryPrefix),z(t,o),h?z(t,tF):z(t,tj),z(t,e.segmentPrefix),z(t,o),u?(h?(z(t,tB),i=r,z(t,rp),a=rp,i.stylesheets.forEach(function(e){if(2!==e.state){if(3===e.state)z(t,a),z(t,t2(""+e.props.href)),z(t,rg),a=rf;else{z(t,a);var r=e.props["data-precedence"],i=e.props;for(var n in z(t,t2(""+e.props.href)),r=""+r,z(t,rm),z(t,t2(r)),i)if(N.call(i,n)){var s=i[n];if(null!=s)switch(n){case"href":case"rel":case"precedence":case"data-precedence":break;case"children":case"dangerouslySetInnerHTML":throw Error("link is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:e:{r=t;var o=n.toLowerCase();switch(typeof s){case"function":case"symbol":break e}switch(n){case"innerHTML":case"dangerouslySetInnerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":case"style":case"ref":break e;case"className":o="class",s=""+s;break;case"hidden":if(!1===s)break e;s="";break;case"src":case"href":s=""+s;break;default:if(2<n.length&&("o"===n[0]||"O"===n[0])&&("n"===n[1]||"N"===n[1])||!U(n))break e;s=""+s}z(r,rm),z(r,t2(o)),z(r,rm),z(r,t2(s))}}}z(t,rg),a=rf,e.state=3}}})):(z(t,tU),n=r,z(t,rp),s=rp,n.stylesheets.forEach(function(e){if(2!==e.state){if(3===e.state)z(t,s),z(t,H(JSON.stringify(""+e.props.href))),z(t,rg),s=rf;else{z(t,s);var r=e.props["data-precedence"],i=e.props;for(var a in z(t,H(JSON.stringify(""+e.props.href))),r=""+r,z(t,rm),z(t,H(JSON.stringify(r))),i)if(N.call(i,a)){var n=i[a];if(null!=n)switch(a){case"href":case"rel":case"precedence":case"data-precedence":break;case"children":case"dangerouslySetInnerHTML":throw Error("link is a self-closing tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:e:{r=t;var o=a.toLowerCase();switch(typeof n){case"function":case"symbol":break e}switch(a){case"innerHTML":case"dangerouslySetInnerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":case"style":case"ref":break e;case"className":o="class",n=""+n;break;case"hidden":if(!1===n)break e;n="";break;case"src":case"href":n=""+n;break;default:if(2<a.length&&("o"===a[0]||"O"===a[0])&&("n"===a[1]||"N"===a[1])||!U(a))break e;n=""+n}z(r,rm),z(r,H(JSON.stringify(o))),z(r,rm),z(r,H(JSON.stringify(n)))}}}z(t,rg),s=rf,e.state=3}}})),z(t,rg)):h&&z(t,tO),o=h?D(t,tN):D(t,et),e1(t,e)&&o}function i5(e,t,r,i){if(2===i.status)return!0;var a=r.contentState,n=i.id;if(-1===n){if(-1===(i.id=r.rootSegmentID))throw Error("A root segment ID must have been assigned by now. This is a bug in React.");return i2(e,t,i,a)}return n===r.rootSegmentID?i2(e,t,i,a):(i2(e,t,i,a),r=e.resumableState,e=e.renderState,(i=0===r.streamingFormat)?(z(t,e.startInlineScript),0==(1&r.instructions)?(r.instructions|=1,z(t,tT)):z(t,tI)):z(t,tE),z(t,e.segmentPrefix),z(t,n=n.toString(16)),i?z(t,tC):z(t,tM),z(t,e.placeholderPrefix),z(t,n),t=i?D(t,tP):D(t,et))}function i4(e,t){E=new Uint8Array(2048),M=0,A=!0;try{var r,i=e.completedRootSegment;if(null!==i){if(5===i.status||0!==e.pendingRootTasks)return;var a=e.renderState;if((0!==e.allPendingTasks||null!==e.trackedPostpones)&&a.externalRuntimeScript){var n=a.externalRuntimeScript,s=e.resumableState,o=n.src,l=n.chunks;s.scriptResources.hasOwnProperty(o)||(s.scriptResources[o]=null,a.scripts.add(l))}var u,h=a.htmlChunks,c=a.headChunks;if(h){for(u=0;u<h.length;u++)z(t,h[u]);if(c)for(u=0;u<c.length;u++)z(t,c[u]);else z(t,eJ("head")),z(t,eL)}else if(c)for(u=0;u<c.length;u++)z(t,c[u]);var d=a.charsetChunks;for(u=0;u<d.length;u++)z(t,d[u]);d.length=0,a.preconnects.forEach(rr,t),a.preconnects.clear();var p=a.viewportChunks;for(u=0;u<p.length;u++)z(t,p[u]);p.length=0,a.fontPreloads.forEach(rr,t),a.fontPreloads.clear(),a.highImagePreloads.forEach(rr,t),a.highImagePreloads.clear(),a.styles.forEach(rh,t);var f=a.importMapChunks;for(u=0;u<f.length;u++)z(t,f[u]);f.length=0,a.bootstrapScripts.forEach(rr,t),a.scripts.forEach(rr,t),a.scripts.clear(),a.bulkPreloads.forEach(rr,t),a.bulkPreloads.clear();var m=a.hoistableChunks;for(u=0;u<m.length;u++)z(t,m[u]);m.length=0,h&&null===c&&z(t,e0("head")),i1(e,t,i,null),e.completedRootSegment=null,e1(t,e.renderState)}var g=e.renderState;i=0;var y=g.viewportChunks;for(i=0;i<y.length;i++)z(t,y[i]);y.length=0,g.preconnects.forEach(rr,t),g.preconnects.clear(),g.fontPreloads.forEach(rr,t),g.fontPreloads.clear(),g.highImagePreloads.forEach(rr,t),g.highImagePreloads.clear(),g.styles.forEach(rd,t),g.scripts.forEach(rr,t),g.scripts.clear(),g.bulkPreloads.forEach(rr,t),g.bulkPreloads.clear();var _=g.hoistableChunks;for(i=0;i<_.length;i++)z(t,_[i]);_.length=0;var x=e.clientRenderedBoundaries;for(r=0;r<x.length;r++){var v=x[r];g=t;var b=e.resumableState,w=e.renderState,S=v.rootSegmentID,k=v.errorDigest,T=v.errorMessage,I=v.errorComponentStack,C=0===b.streamingFormat;if(C?(z(g,w.startInlineScript),0==(4&b.instructions)?(b.instructions|=4,z(g,tq)):z(g,tZ)):z(g,tX),z(g,w.boundaryPrefix),z(g,S.toString(16)),C&&z(g,tG),(k||T||I)&&(C?(z(g,tH),z(g,t0(k||""))):(z(g,tK),z(g,H(k||"")))),(T||I)&&(C?(z(g,tH),z(g,t0(T||""))):(z(g,tJ),z(g,H(T||"")))),I&&(C?(z(g,tH),z(g,t0(I))):(z(g,tY),z(g,H(I)))),C?!D(g,tW):!D(g,et)){e.destination=null,r++,x.splice(0,r);return}}x.splice(0,r);var R=e.completedBoundaries;for(r=0;r<R.length;r++)if(!i3(e,t,R[r])){e.destination=null,r++,R.splice(0,r);return}R.splice(0,r),L(t),E=new Uint8Array(2048),M=0,A=!0;var F=e.partialBoundaries;for(r=0;r<F.length;r++){var B=F[r];e:{x=e,v=t;var O=B.completedSegments;for(b=0;b<O.length;b++)if(!i5(x,v,B,O[b])){b++,O.splice(0,b);var N=!1;break e}O.splice(0,b),N=rt(v,B.contentState,x.renderState)}if(!N){e.destination=null,r++,F.splice(0,r);return}}F.splice(0,r);var V=e.completedBoundaries;for(r=0;r<V.length;r++)if(!i3(e,t,V[r])){e.destination=null,r++,V.splice(0,r);return}V.splice(0,r)}finally{0===e.allPendingTasks&&0===e.pingedTasks.length&&0===e.clientRenderedBoundaries.length&&0===e.completedBoundaries.length?(e.flushScheduled=!1,(r=e.resumableState).hasBody&&z(t,e0("body")),r.hasHtml&&z(t,e0("html")),L(t),P(t),t.end(),e.destination=null):(L(t),P(t))}}function i6(e){iW(e,0===e.pendingRootTasks)}function i8(e){!1===e.flushScheduled&&0===e.pingedTasks.length&&null!==e.destination&&(e.flushScheduled=!0,setImmediate(function(){var t=e.destination;t?i4(e,t):e.flushScheduled=!1}))}function i9(e,t){if(1===e.status)e.status=2,t.destroy(e.fatalError);else if(2!==e.status&&null===e.destination){e.destination=t;try{i4(e,t)}catch(t){iD(e,t,{}),iL(e,t)}}}function i7(e,t){try{var r=e.abortableTasks;if(0<r.size){var i=void 0===t?Error("The render was aborted by the server without a reason."):t;r.forEach(function(t){return function e(t,r,i){var a=t.blockedBoundary,n=t.blockedSegment;if(null!==n&&(n.status=3),null===a){if(a={},1!==r.status&&2!==r.status){if(null===(t=t.replay)){iD(r,i,a),iL(r,i);return}t.pendingTasks--,0===t.pendingTasks&&0<t.nodes.length&&(a=iD(r,i,a),iH(r,null,t.nodes,t.slots,i,a)),r.pendingRootTasks--,0===r.pendingRootTasks&&iX(r)}}else a.pendingTasks--,4!==a.status&&(a.status=4,t=iR(r,t.componentStack),t=iD(r,i,t),a.errorDigest=t,iq(r,a),a.parentFlushed&&r.clientRenderedBoundaries.push(a)),a.fallbackAbortableTasks.forEach(function(t){return e(t,r,i)}),a.fallbackAbortableTasks.clear();r.allPendingTasks--,0===r.allPendingTasks&&iK(r)}(t,e,i)}),r.clear()}null!==e.destination&&i4(e,e.destination)}catch(t){iD(e,t,{}),iL(e,t)}}function ae(e,t){return function(){e.destination=null,i7(e,Error(t))}}t.renderToPipeableStream=function(e,t){var r=function(e,t){var r=t?t.identifierPrefix:void 0,i=0;void 0!==(t?t.unstable_externalRuntimeSrc:void 0)&&(i=1),r={idPrefix:void 0===r?"":r,nextFormID:0,streamingFormat:i,bootstrapScriptContent:t?t.bootstrapScriptContent:void 0,bootstrapScripts:t?t.bootstrapScripts:void 0,bootstrapModules:t?t.bootstrapModules:void 0,instructions:0,hasBody:!1,hasHtml:!1,unknownResources:{},dnsResources:{},connectResources:{default:{},anonymous:{},credentials:{}},imageResources:{},styleResources:{},scriptResources:{},moduleUnknownResources:{},moduleScriptResources:{}};var a=t?t.nonce:void 0,n=t?t.unstable_externalRuntimeSrc:void 0,s=t?t.importMap:void 0;i=t?t.onHeaders:void 0;var o=t?t.maxHeadersLength:void 0,l=void 0===a?er:B('<script nonce="'+H(a)+'">'),u=r.idPrefix,h=[],c=null,d=r.bootstrapScriptContent,p=r.bootstrapScripts,f=r.bootstrapModules;if(void 0!==d&&h.push(l,(""+d).replace(eh,ec),ei),void 0!==n&&("string"==typeof n?eG((c={src:n,chunks:[]}).chunks,{src:n,async:!0,integrity:void 0,nonce:a}):eG((c={src:n.src,chunks:[]}).chunks,{src:n.src,async:!0,integrity:n.integrity,nonce:a})),n=[],void 0!==s&&(n.push(ed),n.push((""+JSON.stringify(s)).replace(eh,ec)),n.push(ep)),s=i?{preconnects:"",fontPreloads:"",highImagePreloads:"",remainingCapacity:"number"==typeof o?o:2e3}:null,i={placeholderPrefix:B(u+"P:"),segmentPrefix:B(u+"S:"),boundaryPrefix:B(u+"B:"),startInlineScript:l,htmlChunks:null,headChunks:null,externalRuntimeScript:c,bootstrapChunks:h,importMapChunks:n,onHeaders:i,headers:s,resets:{font:{},dns:{},connect:{default:{},anonymous:{},credentials:{}},image:{},style:{}},charsetChunks:[],viewportChunks:[],hoistableChunks:[],preconnects:new Set,fontPreloads:new Set,highImagePreloads:new Set,styles:new Map,bootstrapScripts:new Set,scripts:new Set,bulkPreloads:new Set,preloads:{images:new Map,stylesheets:new Map,scripts:new Map,moduleScripts:new Map},nonce:a,hoistableState:null,stylesToHoist:!1},void 0!==p)for(l=0;l<p.length;l++)n=p[l],s=c=void 0,o={rel:"preload",as:"script",fetchPriority:"low",nonce:a},"string"==typeof n?o.href=u=n:(o.href=u=n.src,o.integrity=s="string"==typeof n.integrity?n.integrity:void 0,o.crossOrigin=c="string"==typeof n||null==n.crossOrigin?void 0:"use-credentials"===n.crossOrigin?"use-credentials":""),n=r,d=u,n.scriptResources[d]=null,n.moduleScriptResources[d]=null,eU(n=[],o),i.bootstrapScripts.add(n),h.push(ea,H(u)),a&&h.push(es,H(a)),"string"==typeof s&&h.push(eo,H(s)),"string"==typeof c&&h.push(el,H(c)),h.push(eu);if(void 0!==f)for(p=0;p<f.length;p++)o=f[p],c=u=void 0,s={rel:"modulepreload",fetchPriority:"low",nonce:a},"string"==typeof o?s.href=l=o:(s.href=l=o.src,s.integrity=c="string"==typeof o.integrity?o.integrity:void 0,s.crossOrigin=u="string"==typeof o||null==o.crossOrigin?void 0:"use-credentials"===o.crossOrigin?"use-credentials":""),o=r,n=l,o.scriptResources[n]=null,o.moduleScriptResources[n]=null,eU(o=[],s),i.bootstrapScripts.add(o),h.push(en,H(l)),a&&h.push(es,H(a)),"string"==typeof c&&h.push(eo,H(c)),"string"==typeof u&&h.push(el,H(u)),h.push(eu);return a=ef("http://www.w3.org/2000/svg"===(a=t?t.namespaceURI:void 0)?3:"http://www.w3.org/1998/Math/MathML"===a?4:0,null,0),f=t?t.progressiveChunkSize:void 0,p=t?t.onError:void 0,l=t?t.onAllReady:void 0,u=t?t.onShellReady:void 0,c=t?t.onShellError:void 0,s=t?t.onPostpone:void 0,o=t?t.formState:void 0,Y.current=Q,t=[],(i=iA(r={destination:null,flushScheduled:!1,resumableState:r,renderState:i,rootFormatContext:a,progressiveChunkSize:void 0===f?12800:f,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:h=new Set,pingedTasks:t,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],trackedPostpones:null,onError:void 0===p?iS:p,onPostpone:void 0===s?ik:s,onAllReady:void 0===l?ik:l,onShellReady:void 0===u?ik:u,onShellError:void 0===c?ik:c,onFatalError:ik,formState:void 0===o?null:o},0,null,a,!1,!1)).parentFlushed=!0,e=iE(r,null,e,-1,null,i,null,h,null,a,rE,null,rF,null,!1),t.push(e),r}(e,t),i=!1;return r.flushScheduled=null!==r.destination,setImmediate(function(){return rI.run(r,iQ,r)}),null===r.trackedPostpones&&setImmediate(function(){return rI.run(r,i6,r)}),{pipe:function(e){if(i)throw Error("React currently only supports piping to one writable stream.");return i=!0,iW(r,null===r.trackedPostpones?0===r.pendingRootTasks:null===r.completedRootSegment?0===r.pendingRootTasks:5!==r.completedRootSegment.status),i9(r,e),e.on("drain",function(){return i9(r,e)}),e.on("error",ae(r,"The destination stream errored while writing data.")),e.on("close",ae(r,"The destination stream closed early.")),e},abort:function(e){i7(r,e)}}},t.version="18.3.0-canary-178c267a4e-20241218"},46127:(e,t,r)=>{"use strict";e.exports=r(31719)},31719:(e,t,r)=>{"use strict";var i,a;i=r(92989),a=r(16594),t.version=i.version,t.renderToString=i.renderToString,t.renderToStaticMarkup=i.renderToStaticMarkup,t.renderToNodeStream=i.renderToNodeStream,t.renderToStaticNodeStream=i.renderToStaticNodeStream,t.renderToPipeableStream=a.renderToPipeableStream,a.resumeToPipeableStream&&(t.resumeToPipeableStream=a.resumeToPipeableStream)},63761:(e,t)=>{"use strict";var r=Symbol.for("react.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator,f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||f}function _(){}function x(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=y.prototype;var v=x.prototype=new _;v.constructor=x,m(v,y.prototype),v.isPureReactComponent=!0;var b=Array.isArray,w={current:null},S={current:null},k={transition:null},T={ReactCurrentDispatcher:w,ReactCurrentCache:S,ReactCurrentBatchConfig:k,ReactCurrentOwner:{current:null}},I=Object.prototype.hasOwnProperty,C=T.ReactCurrentOwner;function P(e,t,i){var a,n={},s=null,o=null;if(null!=t)for(a in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(s=""+t.key),t)I.call(t,a)&&"key"!==a&&"ref"!==a&&"__self"!==a&&"__source"!==a&&(n[a]=t[a]);var l=arguments.length-2;if(1===l)n.children=i;else if(1<l){for(var u=Array(l),h=0;h<l;h++)u[h]=arguments[h+2];n.children=u}if(e&&e.defaultProps)for(a in l=e.defaultProps)void 0===n[a]&&(n[a]=l[a]);return{$$typeof:r,type:e,key:s,ref:o,props:n,_owner:C.current}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var M=/\/+/g;function A(e,t){var r,i;return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,i={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return i[e]})):t.toString(36)}function z(){}function R(e,t,a){if(null==e)return e;var n=[],s=0;return function e(t,a,n,s,o){var l,u,h,c=typeof t;("undefined"===c||"boolean"===c)&&(t=null);var f=!1;if(null===t)f=!0;else switch(c){case"string":case"number":f=!0;break;case"object":switch(t.$$typeof){case r:case i:f=!0;break;case d:return e((f=t._init)(t._payload),a,n,s,o)}}if(f)return o=o(t),f=""===s?"."+A(t,0):s,b(o)?(n="",null!=f&&(n=f.replace(M,"$&/")+"/"),e(o,a,n,"",function(e){return e})):null!=o&&(E(o)&&(l=o,u=n+(!o.key||t&&t.key===o.key?"":(""+o.key).replace(M,"$&/")+"/")+f,o={$$typeof:r,type:l.type,key:u,ref:l.ref,props:l.props,_owner:l._owner}),a.push(o)),1;f=0;var m=""===s?".":s+":";if(b(t))for(var g=0;g<t.length;g++)c=m+A(s=t[g],g),f+=e(s,a,n,c,o);else if("function"==typeof(g=null===(h=t)||"object"!=typeof h?null:"function"==typeof(h=p&&h[p]||h["@@iterator"])?h:null))for(t=g.call(t),g=0;!(s=t.next()).done;)c=m+A(s=s.value,g++),f+=e(s,a,n,c,o);else if("object"===c){if("function"==typeof t.then)return e(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(z,z):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(t),a,n,s,o);throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(a=String(t))?"object with keys {"+Object.keys(t).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.")}return f}(e,n,"","",function(e){return t.call(a,e,s++)}),n}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}function L(){return new WeakMap}function F(){return{s:0,v:void 0,o:null,p:null}}function B(){}var O="function"==typeof reportError?reportError:function(e){console.error(e)};t.Children={map:R,forEach:function(e,t,r){R(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return R(e,function(){t++}),t},toArray:function(e){return R(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=a,t.Profiler=s,t.PureComponent=x,t.StrictMode=n,t.Suspense=h,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T,t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){var t=S.current;if(!t)return e.apply(null,arguments);var r=t.getCacheForType(L);void 0===(t=r.get(e))&&(t=F(),r.set(e,t)),r=0;for(var i=arguments.length;r<i;r++){var a=arguments[r];if("function"==typeof a||"object"==typeof a&&null!==a){var n=t.o;null===n&&(t.o=n=new WeakMap),void 0===(t=n.get(a))&&(t=F(),n.set(a,t))}else null===(n=t.p)&&(t.p=n=new Map),void 0===(t=n.get(a))&&(t=F(),n.set(a,t))}if(1===t.s)return t.v;if(2===t.s)throw t.v;try{var s=e.apply(null,arguments);return(r=t).s=1,r.v=s}catch(e){throw(s=t).s=2,s.v=e,e}}},t.cloneElement=function(e,t,i){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var a=m({},e.props),n=e.key,s=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,o=C.current),void 0!==t.key&&(n=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(u in t)I.call(t,u)&&"key"!==u&&"ref"!==u&&"__self"!==u&&"__source"!==u&&(a[u]=void 0===t[u]&&void 0!==l?l[u]:t[u])}var u=arguments.length-2;if(1===u)a.children=i;else if(1<u){l=Array(u);for(var h=0;h<u;h++)l[h]=arguments[h+2];a.children=l}return{$$typeof:r,type:e.type,key:n,ref:s,props:a,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=P,t.createFactory=function(e){var t=P.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition,r=new Set;k.transition={_callbacks:r};var i=k.transition;try{var a=e();"object"==typeof a&&null!==a&&"function"==typeof a.then&&(r.forEach(function(e){return e(i,a)}),a.then(B,O))}catch(e){O(e)}finally{k.transition=t}},t.unstable_useCacheRefresh=function(){return w.current.useCacheRefresh()},t.use=function(e){return w.current.use(e)},t.useCallback=function(e,t){return w.current.useCallback(e,t)},t.useContext=function(e){return w.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return w.current.useDeferredValue(e,t)},t.useEffect=function(e,t){return w.current.useEffect(e,t)},t.useId=function(){return w.current.useId()},t.useImperativeHandle=function(e,t,r){return w.current.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return w.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return w.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return w.current.useMemo(e,t)},t.useOptimistic=function(e,t){return w.current.useOptimistic(e,t)},t.useReducer=function(e,t,r){return w.current.useReducer(e,t,r)},t.useRef=function(e){return w.current.useRef(e)},t.useState=function(e){return w.current.useState(e)},t.useSyncExternalStore=function(e,t,r){return w.current.useSyncExternalStore(e,t,r)},t.useTransition=function(){return w.current.useTransition()},t.version="18.3.0-canary-178c267a4e-20241218"},15852:(e,t,r)=>{"use strict";e.exports=r(63761)},49494:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var i=r(10326),a=r(17577),n=r(57608);let s={low:"#eab308",medium:"#f97316",high:"#ef4444",critical:"#991b1b"},o={traffic_slowdown:"triangle-alert",collision:"car-crash",roadwork:"cone",debris:"ban",weather:"cloud-lightning",closure:"octagon-alert",police:"badge-check",lane_restriction:"layout-panel-top"};(0,n.eI)("https://dummy.supabase.co","dummy_key_here_for_build");var l=r(79004),u=r.n(l),h=r(50949),c=r(62881);let d=(0,c.Z)("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),p=(0,c.Z)("Cone",[["path",{d:"m20.9 18.55-8-15.98a1 1 0 0 0-1.8 0l-8 15.98",key:"53pte7"}],["ellipse",{cx:"12",cy:"19",rx:"9",ry:"3",key:"1ji25f"}]]);var f=r(3634);let m=(0,c.Z)("OctagonAlert",[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]]),g=(0,c.Z)("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),y=(0,c.Z)("LayoutPanelTop",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}]]),_=(0,c.Z)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);var x=r(46127);let v={"triangle-alert":h.Z,"car-crash":d,cone:p,"cloud-lightning":f.Z,"octagon-alert":m,"badge-check":g,"layout-panel-top":y,ban:_};function b({hazards:e,onSelect:t,onBoundsChange:r,initialCenter:n=[-98.5,39.8],initialZoom:l=4}){let c=(0,a.useRef)(null),d=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let r=d.current;r&&(r.__hazard_markers?.forEach(e=>e.remove()),r.__hazard_markers=[],e.forEach(e=>{let a=document.createElement("div");a.className="flex items-center justify-center rounded-full shadow-lg",a.style.width="28px",a.style.height="28px",a.style.background=s[e.severity];let n=v[o[e.type]]??h.Z,l=x.renderToStaticMarkup(i.jsx(n,{color:"white",size:18})),c=document.createElement("div");c.innerHTML=l,a.appendChild(c);let d=new(u()).Marker({element:a}).setLngLat([e.lng,e.lat]).addTo(r);d.getElement().addEventListener("click",()=>t?.(e)),r.__hazard_markers.push(d)}))},[JSON.stringify(e)]),i.jsx("div",{ref:c,className:"w-full h-[480px] rounded-2xl overflow-hidden ring-1 ring-black/10"})}let w=(0,c.Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),S=(0,c.Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),k=(0,c.Z)("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);function T(e){return({critical:0,high:1,medium:2,low:3})[e]??3}function I({hazards:e,coachingTips:t=[]}){let[r,n]=(0,a.useState)(null),o=(0,a.useMemo)(()=>[...e].sort((e,t)=>{let r=T(e.severity)-T(t.severity);return 0!==r?r:new Date(t.detected_at).getTime()-new Date(e.detected_at).getTime()}),[e]),l=(0,a.useMemo)(()=>{let e=new Map;return o.forEach(t=>{let r=function(e){let t=Math.round(10*e.lat)/10,r=Math.round(10*e.lng)/10;return`${e.type}|${t},${r}`}(t),i=e.get(r)??[];i.push(t),e.set(r,i)}),Array.from(e.values()).map(e=>({rep:[...e].sort((e,t)=>{let r=T(e.severity)-T(t.severity);return 0!==r?r:new Date(t.detected_at).getTime()-new Date(e.detected_at).getTime()})[0],all:e})).sort((e,t)=>{let r=T(e.rep.severity)-T(t.rep.severity);return 0!==r?r:new Date(t.rep.detected_at).getTime()-new Date(e.rep.detected_at).getTime()})},[o]),u=(0,a.useMemo)(()=>{let e=new Map;return t.forEach(t=>e.set(t.hazard_id,t)),e},[t]);async function h(e){try{await fetch("/api/hazards/ack",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hazard_id:e})})}catch{}}return(0,i.jsxs)("div",{className:"divide-y rounded-2xl border border-black/10 bg-white overflow-hidden",children:[l.map(({rep:e,all:t})=>{let a=s[e.severity],o=r===e.id,l=u.get(e.id)??u.get(t[0]?.id??""),c=Math.max(0,t.length-1);return i.jsx("div",{className:"p-3",children:(0,i.jsxs)("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"mt-1 h-3 w-3 rounded-full",style:{background:a}}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"font-medium",children:[e.title??e.type,(0,i.jsxs)("span",{className:"text-xs opacity-60",children:[" ","\xb7 ",new Date(e.detected_at).toLocaleTimeString(),c>0?` \xb7 +${c} nearby`:""]})]}),i.jsx("button",{className:"text-sm px-2 py-1 rounded hover:bg-black/5",onClick:()=>n(o?null:e.id),"aria-expanded":o,"aria-controls":`alert-panel-${e.id}`,children:o?i.jsx(w,{className:"w-4 h-4"}):i.jsx(S,{className:"w-4 h-4"})})]}),i.jsx("div",{className:"text-sm opacity-80",children:e.description}),o&&(0,i.jsxs)("div",{id:`alert-panel-${e.id}`,className:"mt-2 grid gap-2",children:[(0,i.jsxs)("div",{className:"text-xs",children:[i.jsx("span",{className:"opacity-70",children:"Location: "}),e.lat.toFixed(4),", ",e.lng.toFixed(4)]}),t.length>1&&(0,i.jsxs)("div",{className:"text-xs opacity-70",children:["Similar in vicinity:",(0,i.jsxs)("ul",{className:"list-disc ml-5 mt-1",children:[t.slice(0,5).map(e=>(0,i.jsxs)("li",{children:[e.type," \xb7 ",new Date(e.detected_at).toLocaleTimeString()]},e.id)),t.length>5&&(0,i.jsxs)("li",{children:["… ",t.length-5," more"]})]})]}),l&&(0,i.jsxs)("div",{className:"text-xs p-2 rounded flex gap-2 items-start bg-amber-50 border border-amber-200",children:[i.jsx(k,{className:"w-4 h-4 text-amber-600 mt-0.5"}),(0,i.jsxs)("div",{children:[i.jsx("div",{className:"font-semibold mb-0.5",children:"Coaching Tip"}),i.jsx("div",{children:l.tip}),(0,i.jsxs)("div",{className:"mt-1 opacity-60",children:["Status: ",l.status]})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx("button",{className:"text-xs px-2 py-1 rounded bg-neutral-100 hover:bg-neutral-200",onClick:()=>h(e.id),children:"Acknowledge"}),i.jsx("button",{className:"text-xs px-2 py-1 rounded bg-neutral-100 hover:bg-neutral-200",onClick:()=>{let t=`https://www.google.com/maps/dir/?api=1&destination=${e.lat},${e.lng}`;try{window.open(t,"_blank")}catch{}},children:"Navigate"})]})]})]})]})},e.id)}),0===l.length&&i.jsx("div",{className:"p-4 text-sm text-center opacity-60",children:"No active hazards."})]})}function C({k:e}){if(!e)return null;let t=e=>null==e?"—":`${Math.round(100*e)}%`;return(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[i.jsx(P,{label:"Alerts (today)",value:e.alerts_total??"—"}),i.jsx(P,{label:"Active Peak",value:e.alerts_active_max??"—"}),i.jsx(P,{label:"P95 Latency",value:e.p95_latency_ms?`${e.p95_latency_ms} ms`:"—"}),i.jsx(P,{label:"Ack Rate",value:t(e.driver_ack_rate)}),i.jsx(P,{label:"System Uptime",value:t(e.system_uptime)})]})}function P({label:e,value:t}){return(0,i.jsxs)("div",{className:"rounded-xl border border-black/10 p-3 bg-white",children:[i.jsx("div",{className:"text-xs opacity-60",children:e}),i.jsx("div",{className:"text-xl font-semibold",children:t})]})}function E(){let[e,t]=(0,a.useState)(void 0),{hazards:r,loading:n}=function(e={}){let[t,r]=(0,a.useState)([]),[i,n]=(0,a.useState)(!0);return{hazards:(0,a.useMemo)(()=>{var r,i;return r=e.fleetId??null,i=e.bbox,t.filter(e=>{let t=!e.fleet_id||!r||e.fleet_id===r,a=!i||function(e,t,r){let[i,a,n,s]=r;return e>=a&&e<=s&&t>=i&&t<=n}(e.lat,e.lng,i);return t&&a&&("active"===e.status||"clearing"===e.status)})},[t,e.fleetId,JSON.stringify(e.bbox)]),all:t,loading:i}}({fleetId:void 0,bbox:e}),s=function(e){let[t,r]=(0,a.useState)(null);return t}();return(0,i.jsxs)("div",{className:"p-4 grid gap-4",children:[i.jsx(C,{k:s}),(0,i.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[i.jsx(b,{hazards:r,onSelect:()=>{},onBoundsChange:t}),i.jsx("div",{className:"max-h-[480px] overflow-auto",children:i.jsx(I,{hazards:r})})]}),n&&i.jsx("div",{className:"text-sm opacity-60",children:"Loading realtime hazards…"})]})}},96758:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});let i=(0,r(68570).createProxy)(String.raw`C:\Users\moise\IdeaProjects\truckercore1\apps\web\src\app\fleet\hazards\page.tsx#default`)},32029:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,metadata:()=>a});var i=r(19510);let a={title:"TruckerCore",description:"Trucking Management System"};function n({children:e}){return i.jsx("html",{lang:"en",children:i.jsx("body",{children:e})})}},11930:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var i=r(19510);function a(){return(0,i.jsxs)("div",{style:n.container,children:[i.jsx("div",{style:n.spinner}),i.jsx("p",{style:n.text,children:"Loading..."})]})}let n={container:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#0F1216",color:"#ffffff"},spinner:{width:"48px",height:"48px",border:"4px solid #2A313A",borderTop:"4px solid #58A6FF",borderRadius:"50%",animation:"spin 1s linear infinite"},text:{marginTop:"16px",fontSize:"16px",color:"#8B949E"}}},12523:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var i=r(19510),a=r(57371);function n(){return(0,i.jsxs)("div",{style:s.container,children:[i.jsx("h1",{style:s.title,children:"404"}),i.jsx("h2",{style:s.subtitle,children:"Page Not Found"}),i.jsx("p",{style:s.description,children:"The page you're looking for doesn't exist or has been moved."}),(0,i.jsxs)("div",{style:s.links,children:[i.jsx(a.default,{href:"/",style:s.primaryLink,children:"Go Home"}),i.jsx(a.default,{href:"https://app.truckercore.com",style:s.secondaryLink,children:"Launch App"})]})]})}let s={container:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"24px",backgroundColor:"#0F1216",color:"#ffffff",textAlign:"center"},title:{fontSize:"96px",fontWeight:700,background:"linear-gradient(135deg, #58A6FF 0%, #79C0FF 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",marginBottom:"16px"},subtitle:{fontSize:"32px",fontWeight:600,marginBottom:"16px",color:"#ffffff"},description:{fontSize:"18px",color:"#8B949E",marginBottom:"32px",maxWidth:"500px"},links:{display:"flex",gap:"16px",flexWrap:"wrap",justifyContent:"center"},primaryLink:{padding:"14px 32px",backgroundColor:"#58A6FF",color:"#000",borderRadius:"8px",fontWeight:600,fontSize:"16px",transition:"all 0.2s"},secondaryLink:{padding:"14px 32px",border:"2px solid #58A6FF",color:"#58A6FF",borderRadius:"8px",fontWeight:600,fontSize:"16px",transition:"all 0.2s"}}},79004:function(e){var t;t=function(){"use strict";var e,t,r;function i(i,a){if(e){if(t){var n="var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk);",s={};e(s),r=a(s),"undefined"!=typeof window&&(r.workerUrl=window.URL.createObjectURL(new Blob([n],{type:"text/javascript"})))}else t=a}else e=a}return i(["exports"],function(e){let t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g,y,_,x,v;function b(e,t,r,i){return new(r||(r=Promise))(function(a,n){function s(e){try{l(i.next(e))}catch(e){n(e)}}function o(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,o)}l((i=i.apply(e,t||[])).next())})}function w(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function S(e,t){this.x=e,this.y=t}"function"==typeof SuppressedError&&SuppressedError,S.prototype={clone:function(){return new S(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),i=Math.sin(e),a=t.y+i*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-i*(this.y-t.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(e){return e instanceof S?e:Array.isArray(e)?new S(e[0],e[1]):e};var k,T,I,C,P=w(S);function E(e,t,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=i}E.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,i=0;i<8;i++){var a=this.sampleCurveX(r)-e;if(Math.abs(a)<t)return r;var n=this.sampleCurveDerivativeX(r);if(1e-6>Math.abs(n))break;r-=a/n}var s=0,o=1;for(r=e,i=0;i<20&&!(Math.abs((a=this.sampleCurveX(r))-e)<t);i++)e>a?s=r:o=r,r=.5*(o-s)+s;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var M=w(E);function A(){return null==t&&(t="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),t}function z(){if(null==r&&(r=!1,A())){let e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let t=0;t<25;t++){let r=4*t;e.fillStyle=`rgb(${r},${r+1},${r+2})`,e.fillRect(t%5,Math.floor(t/5),1,1)}let t=e.getImageData(0,0,5,5).data;for(let e=0;e<100;e++)if(e%4!=3&&t[e]!==e){r=!0;break}}}return r||!1}function R(e,t,r,i){let a=new M(e,t,r,i);return function(e){return a.solve(e)}}let D=R(.25,.1,.25,1);function L(e,t,r){return Math.min(r,Math.max(t,e))}function F(e,t,r){let i=r-t,a=((e-t)%i+i)%i+t;return a===t?r:a}function B(e,...t){for(let r of t)for(let t in r)e[t]=r[t];return e}let O=1;function N(e,t,r){let i={};for(let a in e)i[a]=t.call(r||this,e[a],a,e);return i}function V(e,t,r){let i={};for(let a in e)t.call(r||this,e[a],a,e)&&(i[a]=e[a]);return i}function $(e){return Array.isArray(e)?e.map($):"object"==typeof e&&e?N(e,$):e}let j={};function U(e){j[e]||("undefined"!=typeof console&&console.warn(e),j[e]=!0)}function q(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Z(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}let G=null;function H(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}let W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function X(e,t,r,i,a){return b(this,void 0,void 0,function*(){if("undefined"==typeof VideoFrame)throw Error("VideoFrame not supported");let n=new VideoFrame(e,{timestamp:0});try{let s=null==n?void 0:n.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw Error(`Unrecognized format ${s}`);let o=s.startsWith("BGR"),l=new Uint8ClampedArray(i*a*4);if(yield n.copyTo(l,function(e,t,r,i,a){let n=4*Math.max(-t,0),s=(Math.max(0,r)-r)*i*4+n,o=Math.max(0,t),l=Math.max(0,r);return{rect:{x:o,y:l,width:Math.min(e.width,t+i)-o,height:Math.min(e.height,r+a)-l},layout:[{offset:s,stride:4*i}]}}(e,t,r,i,a)),o)for(let e=0;e<l.length;e+=4){let t=l[e];l[e]=l[e+2],l[e+2]=t}return l}finally{n.close()}})}let K={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(e){let t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e,t=0){return this.getImageCanvasContext(e).getImageData(-t,-t,e.width+2*t,e.height+2*t)},getImageCanvasContext(e){let t=window.document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw Error("failed to create canvas 2d context");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height),r},resolveURL:e=>(n||(n=document.createElement("a")),n.href=e,n.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==s&&(s=matchMedia("(prefers-reduced-motion: reduce)")),s.matches)}},J={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Y extends Error{constructor(e,t,r,i){super(`AJAXError: ${t} (${e}): ${r}`),this.status=e,this.statusText=t,this.url=r,this.body=i}}let Q=Z()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href,ee=e=>J.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))];function et(e,t){let r=new AbortController,i=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,cache:e.cache,referrer:Q(),signal:r.signal}),a=!1,n=!1;return"json"===e.type&&i.headers.set("Accept","application/json"),n||fetch(i).then(r=>r.ok?(r=>{("arrayBuffer"===e.type||"image"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then(e=>{n||(a=!0,t(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires")))}).catch(e=>{n||t(Error(e.message))})})(r):r.blob().then(i=>t(new Y(r.status,r.statusText,e.url,i)))).catch(e=>{20!==e.code&&t(Error(e.message))}),{cancel:()=>{n=!0,a||r.abort()}}}let er=function(e,t){var r;if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){if(Z()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t);if(!Z())return(ee(e.url)||et)(e,t)}if(!(/^file:/.test(r=e.url)||/^file:/.test(Q())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return et(e,t);if(Z()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}return function(e,t){let r=new XMLHttpRequest;for(let t in r.open(e.method||"GET",e.url,!0),"arrayBuffer"!==e.type&&"image"!==e.type||(r.responseType="arraybuffer"),e.headers)r.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=()=>{t(Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let i=r.response;if("json"===e.type)try{i=JSON.parse(r.response)}catch(e){return t(e)}t(null,i,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else{let i=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});t(new Y(r.status,r.statusText,e.url,i))}},r.send(e.body),{cancel:()=>r.abort()}}(e,t)},ei=function(e,t){return er(B(e,{type:"arrayBuffer"}),t)};function ea(e){if(!e||0>=e.indexOf("://")||0===e.indexOf("data:image/")||0===e.indexOf("blob:"))return!0;let t=new URL(e),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function en(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function es(e,t,r){if(r&&r[e]){let i=r[e].indexOf(t);-1!==i&&r[e].splice(i,1)}}class eo{constructor(e,t={}){B(this,t),this.type=e}}class el extends eo{constructor(e,t={}){super("error",B({error:e},t))}}class eu{on(e,t){return this._listeners=this._listeners||{},en(e,t,this._listeners),this}off(e,t){return es(e,t,this._listeners),es(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},en(e,t,this._oneTimeListeners),this):new Promise(t=>this.once(e,t))}fire(e,t){"string"==typeof e&&(e=new eo(e,t||{}));let r=e.type;if(this.listens(r)){for(let t of(e.target=this,this._listeners&&this._listeners[r]?this._listeners[r].slice():[]))t.call(this,e);for(let t of this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[])es(r,t,this._oneTimeListeners),t.call(this,e);let t=this._eventedParent;t&&(B(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),t.fire(e))}else e instanceof el&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var eh={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let ec=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ed(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!ed(e[r],t[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t||Object.keys(e).length!==Object.keys(t).length)return!1;for(let r in e)if(!ed(e[r],t[r]))return!1;return!0}return e===t}let ep={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ef(e,t,r){r.push({command:ep.addSource,args:[e,t[e]]})}function em(e,t,r){t.push({command:ep.removeSource,args:[e]}),r[e]=!0}function eg(e,t,r,i,a,n){let s;for(s in t=t||{},e=e||{})Object.prototype.hasOwnProperty.call(e,s)&&(ed(e[s],t[s])||r.push({command:n,args:[i,s,t[s],a]}));for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&!Object.prototype.hasOwnProperty.call(e,s)&&(ed(e[s],t[s])||r.push({command:n,args:[i,s,t[s],a]}))}function ey(e){return e.id}function e_(e,t){return e[t.id]=t,e}class ex{constructor(e,t,r,i){this.message=(e?`${e}: `:"")+r,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function ev(e,...t){for(let r of t)for(let t in r)e[t]=r[t];return e}class eb extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class ew{constructor(e,t=[]){for(let[r,i]of(this.parent=e,this.bindings={},t))this.bindings[r]=i}concat(e){return new ew(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let eS={kind:"null"},ek={kind:"number"},eT={kind:"string"},eI={kind:"boolean"},eC={kind:"color"},eP={kind:"object"},eE={kind:"value"},eM={kind:"collator"},eA={kind:"formatted"},ez={kind:"padding"},eR={kind:"resolvedImage"},eD={kind:"variableAnchorOffsetCollection"};function eL(e,t){return{kind:"array",itemType:e,N:t}}function eF(e){if("array"===e.kind){let t=eF(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}let eB=[eS,ek,eT,eI,eC,eA,eP,eL(eE),ez,eR,eD];function eO(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!eO(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind){for(let e of eB)if(!eO(e,t))return null}}return`Expected ${eF(e)} but found ${eF(t)} instead.`}function eN(e,t){return t.some(t=>t.kind===e.kind)}function eV(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}function e$(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}let ej=4/29,eU=6/29,eq=6/29*3*(6/29),eZ=6/29*(6/29)*(6/29),eG=Math.PI/180,eH=180/Math.PI;function eW(e){return(e%=360)<0&&(e+=360),e}function eX([e,t,r,i]){let a,n;let s=eJ((.2225045*(e=eK(e))+.7168786*(t=eK(t))+.0606169*(r=eK(r)))/1);e===t&&t===r?a=n=s:(a=eJ((.4360747*e+.3850649*t+.1430804*r)/.96422),n=eJ((.0139322*e+.0971045*t+.7141733*r)/.82521));let o=116*s-16;return[o<0?0:o,500*(a-s),200*(s-n),i]}function eK(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function eJ(e){return e>eZ?Math.pow(e,1/3):e/eq+ej}function eY([e,t,r,i]){let a=(e+16)/116,n=isNaN(t)?a:a+t/500,s=isNaN(r)?a:a-r/200;return a=1*e0(a),[eQ(3.1338561*(n=.96422*e0(n))-1.6168667*a-.4906146*(s=.82521*e0(s))),eQ(-.9787684*n+1.9161415*a+.033454*s),eQ(.0719453*n-.2289914*a+1.4052427*s),i]}function eQ(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function e0(e){return e>eU?e*e*e:eq*(e-ej)}function e1(e){return parseInt(e.padEnd(2,e),16)/255}function e2(e,t){return e3(t?e/100:e,0,1)}function e3(e,t,r){return Math.min(Math.max(t,e),r)}function e5(e){return!e.some(Number.isNaN)}let e4={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class e6{constructor(e,t,r,i=1,a=!0){this.r=e,this.g=t,this.b=r,this.a=i,a||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,r,i]))}static parse(e){if(e instanceof e6)return e;if("string"!=typeof e)return;let t=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];let t=e4[e];if(t){let[e,r,i]=t;return[e/255,r/255,i/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){let t=e.length<6?1:2,r=1;return[e1(e.slice(r,r+=t)),e1(e.slice(r,r+=t)),e1(e.slice(r,r+=t)),e1(e.slice(r,r+t)||"ff")]}if(e.startsWith("rgb")){let t=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){let[e,r,i,a,n,s,o,l,u,h,c,d]=t,p=[a||" ",o||" ",h].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){let e=[i,s,u].join(""),t="%%%"===e?100:""===e?255:0;if(t){let e=[e3(+r/t,0,1),e3(+n/t,0,1),e3(+l/t,0,1),c?e2(+c,d):1];if(e5(e))return e}}return}}let r=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(r){let[e,t,i,a,n,s,o,l,u]=r,h=[i||" ",n||" ",o].join("");if("  "===h||"  /"===h||",,"===h||",,,"===h){let e=[+t,e3(+a,0,100),e3(+s,0,100),l?e2(+l,u):1];if(e5(e))return function([e,t,r,i]){function a(i){let a=(i+e/30)%12,n=t*Math.min(r,1-r);return r-n*Math.max(-1,Math.min(a-3,9-a,1))}return e=eW(e),t/=100,r/=100,[a(0),a(8),a(4),i]}(e)}}}(e);return t?new e6(...t,!1):void 0}get rgb(){let{r:e,g:t,b:r,a:i}=this,a=i||1/0;return this.overwriteGetter("rgb",[e/a,t/a,r/a,i])}get hcl(){return this.overwriteGetter("hcl",function(e){let[t,r,i,a]=eX(e),n=Math.sqrt(r*r+i*i);return[Math.round(1e4*n)?eW(Math.atan2(i,r)*eH):NaN,n,t,a]}(this.rgb))}get lab(){return this.overwriteGetter("lab",eX(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){let[e,t,r,i]=this.rgb;return`rgba(${[e,t,r].map(e=>Math.round(255*e)).join(",")},${i})`}}e6.black=new e6(0,0,0,1),e6.white=new e6(1,1,1,1),e6.transparent=new e6(0,0,0,0),e6.red=new e6(1,0,0,1);class e8{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class e9{constructor(e,t,r,i,a){this.text=e,this.image=t,this.scale=r,this.fontStack=i,this.textColor=a}}class e7{constructor(e){this.sections=e}static fromString(e){return new e7([new e9(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof e7?e:e7.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}}class te{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof te)return e;if("number"==typeof e)return new te([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(let t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new te(e)}}toString(){return JSON.stringify(this.values)}}let tt=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class tr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof tr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){let r=e[t],i=e[t+1];if("string"!=typeof r||!tt.has(r)||!Array.isArray(i)||2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])return}return new tr(e)}}toString(){return JSON.stringify(this.values)}}class ti{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ti({name:e,available:!1}):null}}function ta(e,t,r,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[e,t,r,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[e,t,r,i]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function tn(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof e6||e instanceof e8||e instanceof e7||e instanceof te||e instanceof tr||e instanceof ti)return!0;if(Array.isArray(e)){for(let t of e)if(!tn(t))return!1;return!0}if("object"==typeof e){for(let t in e)if(!tn(e[t]))return!1;return!0}return!1}function ts(e){if(null===e)return eS;if("string"==typeof e)return eT;if("boolean"==typeof e)return eI;if("number"==typeof e)return ek;if(e instanceof e6)return eC;if(e instanceof e8)return eM;if(e instanceof e7)return eA;if(e instanceof te)return ez;if(e instanceof tr)return eD;if(e instanceof ti)return eR;if(Array.isArray(e)){let t;let r=e.length;for(let r of e){let e=ts(r);if(t){if(t===e)continue;t=eE;break}t=e}return eL(t||eE,r)}return eP}function to(e){let t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof e6||e instanceof e7||e instanceof te||e instanceof tr||e instanceof ti?e.toString():JSON.stringify(e)}class tl{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!tn(e[1]))return t.error("invalid value");let r=e[1],i=ts(r),a=t.expectedType;return"array"===i.kind&&0===i.N&&a&&"array"===a.kind&&("number"!=typeof a.N||0===a.N)&&(i=a),new tl(i,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class tu{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let th={string:eT,number:ek,boolean:eI,object:eP};class tc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,i=1,a=e[0];if("array"===a){let a,n;if(e.length>2){let r=e[1];if("string"!=typeof r||!(r in th)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=th[r],i++}else a=eE;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);n=e[2],i++}r=eL(a,n)}else{if(!th[a])throw Error(`Types doesn't contain name = ${a}`);r=th[a]}let n=[];for(;i<e.length;i++){let r=t.parse(e[i],i,eE);if(!r)return null;n.push(r)}return new tc(r,n)}evaluate(e){for(let t=0;t<this.args.length;t++){let r=this.args[t].evaluate(e);if(!eO(this.type,ts(r)))return r;if(t===this.args.length-1)throw new tu(`Expected value to be of type ${eF(this.type)}, but found ${eF(ts(r))} instead.`)}throw Error()}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}let td={"to-boolean":eI,"to-color":eC,"to-number":ek,"to-string":eT};class tp{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r=e[0];if(!td[r])throw Error(`Can't parse ${r} as it is not part of the known types`);if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");let i=td[r],a=[];for(let r=1;r<e.length;r++){let i=t.parse(e[r],r,eE);if(!i)return null;a.push(i)}return new tp(i,a)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,r;for(let i of this.args){if(t=i.evaluate(e),r=null,t instanceof e6)return t;if("string"==typeof t){let r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:ta(t[0],t[1],t[2],t[3])))return new e6(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new tu(r||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"padding":{let t;for(let r of this.args){t=r.evaluate(e);let i=te.parse(t);if(i)return i}throw new tu(`Could not parse padding from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(let r of this.args){t=r.evaluate(e);let i=tr.parse(t);if(i)return i}throw new tu(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(let r of this.args){if(null===(t=r.evaluate(e)))return 0;let i=Number(t);if(!isNaN(i))return i}throw new tu(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return e7.fromString(to(this.args[0].evaluate(e)));case"resolvedImage":return ti.fromString(to(this.args[0].evaluate(e)));default:return to(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}let tf=["Unknown","Point","LineString","Polygon"];class tm{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?tf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=e6.parse(e)),t}}class tg{constructor(e,t,r=[],i,a=new ew,n=[]){this.registry=e,this.path=r,this.key=r.map(e=>`[${e}]`).join(""),this.scope=a,this.errors=n,this.expectedType=i,this._isConstant=t}parse(e,t,r,i,a={}){return t?this.concat(t,r,i)._parse(e,a):this._parse(e,a)}_parse(e,t){function r(e,t,r){return"assert"===r?new tc(t,[e]):"coerce"===r?new tp(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let i=e[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let a=this.registry[i];if(a){let i=a.parse(e,this);if(!i)return null;if(this.expectedType){let e=this.expectedType,a=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==a.kind){if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==a.kind&&"string"!==a.kind){if("padding"!==e.kind||"value"!==a.kind&&"number"!==a.kind&&"array"!==a.kind){if("variableAnchorOffsetCollection"!==e.kind||"value"!==a.kind&&"array"!==a.kind){if(this.checkSubtype(e,a))return null}else i=r(i,e,t.typeAnnotation||"coerce")}else i=r(i,e,t.typeAnnotation||"coerce")}else i=r(i,e,t.typeAnnotation||"coerce")}else i=r(i,e,t.typeAnnotation||"assert")}if(!(i instanceof tl)&&"resolvedImage"!==i.type.kind&&this._isConstant(i)){let e=new tm;try{i=new tl(i.type,i.evaluate(e))}catch(e){return this.error(e.message),null}}return i}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){let i="number"==typeof e?this.path.concat(e):this.path,a=r?this.scope.concat(r):this.scope;return new tg(this.registry,this._isConstant,i,t||null,a,this.errors)}error(e,...t){let r=`${this.key}${t.map(e=>`[${e}]`).join("")}`;this.errors.push(new eb(r,e))}checkSubtype(e,t){let r=eO(e,t);return r&&this.error(r),r}}class ty{constructor(e,t,r){this.type=eM,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");let r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");let i=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,eI);if(!i)return null;let a=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,eI);if(!a)return null;let n=null;return!r.locale||(n=t.parse(r.locale,1,eT))?new ty(i,a,n):null}evaluate(e){return new e8(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}function t_(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function tx(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function tv(e,t){var r,i;let a=!1;for(let n=0,s=t.length;n<s;n++){let s=t[n];for(let t=0,n=s.length;t<n-1;t++){if(function(e,t,r){let i=e[0]-t[0],a=e[1]-t[1],n=e[0]-r[0],s=e[1]-r[1];return i*s-n*a==0&&i*n<=0&&a*s<=0}(e,s[t],s[t+1]))return!1;(r=s[t])[1]>e[1]!=(i=s[t+1])[1]>e[1]&&e[0]<(i[0]-r[0])*(e[1]-r[1])/(i[1]-r[1])+r[0]&&(a=!a)}}return a}function tb(e,t,r,i){let a=i[0]-r[0],n=i[1]-r[1],s=(e[0]-r[0])*n-a*(e[1]-r[1]),o=(t[0]-r[0])*n-a*(t[1]-r[1]);return s>0&&o<0||s<0&&o>0}function tw(e,t){for(let r=0;r<e.length;++r)if(!tv(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(function(e,t,r){var i,a,n,s;for(let o of r)for(let r=0;r<o.length-1;++r)if(0!=(n=[(a=o[r+1])[0]-(i=o[r])[0],a[1]-i[1]])[0]*(s=[t[0]-e[0],t[1]-e[1]])[1]-n[1]*s[0]&&tb(e,t,i,a)&&tb(i,a,e,t))return!0;return!1}(e[r],e[r+1],t))return!1;return!0}function tS(e,t,r){let i=[];for(let a=0;a<e.length;a++){let n=[];for(let i=0;i<e[a].length;i++){let s=function(e,t){let r=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,a=Math.pow(2,t.z);return[Math.round(r*a*8192),Math.round(i*a*8192)]}(e[a][i],r);t_(t,s),n.push(s)}i.push(n)}return i}function tk(e,t,r){let i=[];for(let a=0;a<e.length;a++){let n=tS(e[a],t,r);i.push(n)}return i}function tT(e,t,r,i){if(e[0]<r[0]||e[0]>r[2]){let t=.5*i,a=e[0]-r[0]>t?-i:r[0]-e[0]>t?i:0;0===a&&(a=e[0]-r[2]>t?-i:r[2]-e[0]>t?i:0),e[0]+=a}t_(t,e)}function tI(e,t,r,i){let a=8192*Math.pow(2,i.z),n=[8192*i.x,8192*i.y],s=[];for(let i of e)for(let e of i){let i=[e.x+n[0],e.y+n[1]];tT(i,t,r,a),s.push(i)}return s}function tC(e,t,r,i){let a=8192*Math.pow(2,i.z),n=[8192*i.x,8192*i.y],s=[];for(let r of e){let e=[];for(let i of r){let r=[i.x+n[0],i.y+n[1]];t_(t,r),e.push(r)}s.push(e)}if(t[2]-t[0]<=a/2)for(let e of(t[0]=t[1]=1/0,t[2]=t[3]=-1/0,s))for(let i of e)tT(i,t,r,a);return s}class tP{constructor(e,t){this.type=eI,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(tn(e[1])){let t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){let r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new tP(t,t.features[e].geometry)}else if("Feature"===t.type){let e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new tP(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new tP(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){let r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],a=e.canonicalID();if("Polygon"===t.type){let n=tS(t.coordinates,i,a),s=tI(e.geometry(),r,i,a);if(!tx(r,i))return!1;for(let e of s)if(!tv(e,n))return!1}if("MultiPolygon"===t.type){let n=tk(t.coordinates,i,a),s=tI(e.geometry(),r,i,a);if(!tx(r,i))return!1;for(let e of s)if(!function(e,t){for(let r=0;r<t.length;r++)if(tv(e,t[r]))return!0;return!1}(e,n))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){let r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],a=e.canonicalID();if("Polygon"===t.type){let n=tS(t.coordinates,i,a),s=tC(e.geometry(),r,i,a);if(!tx(r,i))return!1;for(let e of s)if(!tw(e,n))return!1}if("MultiPolygon"===t.type){let n=tk(t.coordinates,i,a),s=tC(e.geometry(),r,i,a);if(!tx(r,i))return!1;for(let e of s)if(!function(e,t){for(let r=0;r<t.length;r++)if(tw(e,t[r]))return!0;return!1}(e,n))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class tE{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");let r=e[1];return t.scope.has(r)?new tE(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class tM{constructor(e,t,r,i){this.name=e,this.type=t,this._evaluate=r,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){let r=e[0],i=tM.definitions[r];if(!i)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);let a=Array.isArray(i)?i[0]:i.type,n=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=n.filter(([t])=>!Array.isArray(t)||t.length===e.length-1),o=null;for(let[i,n]of s){o=new tg(t.registry,tA,t.path,null,t.scope);let s=[],l=!1;for(let t=1;t<e.length;t++){let r=e[t],a=Array.isArray(i)?i[t-1]:i.type,n=o.parse(r,1+s.length,a);if(!n){l=!0;break}s.push(n)}if(!l){if(Array.isArray(i)&&i.length!==s.length)o.error(`Expected ${i.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){let t=Array.isArray(i)?i[e]:i.type,r=s[e];o.concat(e+1).checkSubtype(t,r.type)}if(0===o.errors.length)return new tM(r,a,n,s)}}}if(1===s.length)t.errors.push(...o.errors);else{let r=(s.length?s:n).map(([e])=>Array.isArray(e)?`(${e.map(eF).join(", ")})`:`(${eF(e.type)}...)`).join(" | "),i=[];for(let r=1;r<e.length;r++){let a=t.parse(e[r],1+i.length);if(!a)return null;i.push(eF(a.type))}t.error(`Expected arguments of type ${r}, but found (${i.join(", ")}) instead.`)}return null}static register(e,t){for(let r in tM.definitions=t,t)e[r]=tM}}function tA(e){if(e instanceof tE)return tA(e.boundExpression);if(e instanceof tM&&"error"===e.name||e instanceof ty||e instanceof tP)return!1;let t=e instanceof tp||e instanceof tc,r=!0;return e.eachChild(e=>{r=t?r&&tA(e):r&&e instanceof tl}),!!r&&tz(e)&&tD(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function tz(e){if(e instanceof tM&&("get"===e.name&&1===e.args.length||"feature-state"===e.name||"has"===e.name&&1===e.args.length||"properties"===e.name||"geometry-type"===e.name||"id"===e.name||/^filter-/.test(e.name))||e instanceof tP)return!1;let t=!0;return e.eachChild(e=>{t&&!tz(e)&&(t=!1)}),t}function tR(e){if(e instanceof tM&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!tR(e)&&(t=!1)}),t}function tD(e,t){if(e instanceof tM&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild(e=>{r&&!tD(e,t)&&(r=!1)}),r}function tL(e,t){let r=e.length-1,i,a,n=0,s=r,o=0;for(;n<=s;)if(i=e[o=Math.floor((n+s)/2)],a=e[o+1],i<=t){if(o===r||t<a)return o;n=o+1}else{if(!(i>t))throw new tu("Input is not a number.");s=o-1}return 0}class tF{constructor(e,t,r){for(let[i,a]of(this.type=e,this.input=t,this.labels=[],this.outputs=[],r))this.labels.push(i),this.outputs.push(a)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");let r=t.parse(e[1],1,ek);if(!r)return null;let i=[],a=null;t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let r=1;r<e.length;r+=2){let n=1===r?-1/0:e[r],s=e[r+1],o=r,l=r+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(i.length&&i[i.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);let u=t.parse(s,l,a);if(!u)return null;a=a||u.type,i.push([n,u])}return new tF(a,r,i)}evaluate(e){let t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);let i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);let a=t.length;return i>=t[a-1]?r[a-1].evaluate(e):r[tL(t,i)].evaluate(e)}eachChild(e){for(let t of(e(this.input),this.outputs))e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function tB(e,t,r){return e.map((e,i)=>e+r*(t[i]-e))}let tO={number:function(e,t,r){return e+r*(t-e)},color:function(e,t,r,i="rgb"){switch(i){case"rgb":{let[i,a,n,s]=tB(e.rgb,t.rgb,r);return new e6(i,a,n,s,!1)}case"hcl":{let i,a;let[n,s,o,l]=e.hcl,[u,h,c,d]=t.hcl;if(isNaN(n)||isNaN(u))isNaN(n)?isNaN(u)?i=NaN:(i=u,1!==o&&0!==o||(a=h)):(i=n,1!==c&&0!==c||(a=s));else{let e=u-n;u>n&&e>180?e-=360:u<n&&n-u>180&&(e+=360),i=n+r*e}let[p,f,m,g]=function([e,t,r,i]){return eY([r,Math.cos(e=isNaN(e)?0:e*eG)*t,Math.sin(e)*t,i])}([i,null!=a?a:s+r*(h-s),o+r*(c-o),l+r*(d-l)]);return new e6(p,f,m,g,!1)}case"lab":{let[i,a,n,s]=eY(tB(e.lab,t.lab,r));return new e6(i,a,n,s,!1)}}},array:tB,padding:function(e,t,r){return new te(tB(e.values,t.values,r))},variableAnchorOffsetCollection:function(e,t,r){let i=e.values,a=t.values;if(i.length!==a.length)throw new tu(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);let n=[];for(let e=0;e<i.length;e+=2){if(i[e]!==a[e])throw new tu(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${i[e]}, to[${e}]: ${a[e]}`);n.push(i[e]);let[t,s]=i[e+1],[o,l]=a[e+1];n.push([t+r*(o-t),s+r*(l-s)])}return new tr(n)}};class tN{constructor(e,t,r,i,a){for(let[n,s]of(this.type=e,this.operator=t,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[],a))this.labels.push(n),this.outputs.push(s)}static interpolationFactor(e,t,r,i){let a=0;if("exponential"===e.name)a=tV(t,e.base,r,i);else if("linear"===e.name)a=tV(t,1,r,i);else if("cubic-bezier"===e.name){let n=e.controlPoints;a=new M(n[0],n[1],n[2],n[3]).solve(tV(t,1,r,i))}return a}static parse(e,t){let[r,i,a,...n]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){let e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{let e=i.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(a=t.parse(a,2,ek)))return null;let s=[],o=null;"interpolate-hcl"===r||"interpolate-lab"===r?o=eC:t.expectedType&&"value"!==t.expectedType.kind&&(o=t.expectedType);for(let e=0;e<n.length;e+=2){let r=n[e],i=n[e+1],a=e+3,l=e+4;if("number"!=typeof r)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(s.length&&s[s.length-1][0]>=r)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',a);let u=t.parse(i,l,o);if(!u)return null;o=o||u.type,s.push([r,u])}return e$(o,ek)||e$(o,eC)||e$(o,ez)||e$(o,eD)||e$(o,eL(ek))?new tN(o,r,i,a,s):t.error(`Type ${eF(o)} is not interpolatable.`)}evaluate(e){let t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);let i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);let a=t.length;if(i>=t[a-1])return r[a-1].evaluate(e);let n=tL(t,i),s=tN.interpolationFactor(this.interpolation,i,t[n],t[n+1]),o=r[n].evaluate(e),l=r[n+1].evaluate(e);switch(this.operator){case"interpolate":return tO[this.type.kind](o,l,s);case"interpolate-hcl":return tO.color(o,l,s,"hcl");case"interpolate-lab":return tO.color(o,l,s,"lab")}}eachChild(e){for(let t of(e(this.input),this.outputs))e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function tV(e,t,r,i){let a=i-r,n=e-r;return 0===a?0:1===t?n/a:(Math.pow(t,n)-1)/(Math.pow(t,a)-1)}class t${constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null,i=t.expectedType;i&&"value"!==i.kind&&(r=i);let a=[];for(let i of e.slice(1)){let e=t.parse(i,1+a.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,a.push(e)}if(!r)throw Error("No output type");return new t$(i&&a.some(e=>eO(i,e.type))?eE:r,a)}evaluate(e){let t,r=null,i=0;for(let a of this.args)if(i++,(r=a.evaluate(e))&&r instanceof ti&&!r.available&&(t||(t=r.name),r=null,i===this.args.length&&(r=t)),null!==r)break;return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class tj{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let r=[];for(let i=1;i<e.length-1;i+=2){let a=e[i];if("string"!=typeof a)return t.error(`Expected string, but found ${typeof a} instead.`,i);if(/[^a-zA-Z0-9_]/.test(a))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);let n=t.parse(e[i+1],i+1);if(!n)return null;r.push([a,n])}let i=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return i?new tj(r,i):null}outputDefined(){return this.result.outputDefined()}}class tU{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let r=t.parse(e[1],1,ek),i=t.parse(e[2],2,eL(t.expectedType||eE));return r&&i?new tU(i.type.itemType,r,i):null}evaluate(e){let t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new tu(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new tu(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new tu(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class tq{constructor(e,t){this.type=eI,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let r=t.parse(e[1],1,eE),i=t.parse(e[2],2,eE);return r&&i?eN(r.type,[eI,eT,ek,eS,eE])?new tq(r,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${eF(r.type)} instead`):null}evaluate(e){let t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!eV(t,["boolean","string","number","null"]))throw new tu(`Expected first argument to be of type boolean, string, number or null, but found ${eF(ts(t))} instead.`);if(!eV(r,["string","array"]))throw new tu(`Expected second argument to be of type array or string, but found ${eF(ts(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class tZ{constructor(e,t,r){this.type=ek,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let r=t.parse(e[1],1,eE),i=t.parse(e[2],2,eE);if(!r||!i)return null;if(!eN(r.type,[eI,eT,ek,eS,eE]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${eF(r.type)} instead`);if(4===e.length){let a=t.parse(e[3],3,ek);return a?new tZ(r,i,a):null}return new tZ(r,i)}evaluate(e){let t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!eV(t,["boolean","string","number","null"]))throw new tu(`Expected first argument to be of type boolean, string, number or null, but found ${eF(ts(t))} instead.`);if(!eV(r,["string","array"]))throw new tu(`Expected second argument to be of type array or string, but found ${eF(ts(r))} instead.`);if(this.fromIndex){let i=this.fromIndex.evaluate(e);return r.indexOf(t,i)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class tG{constructor(e,t,r,i,a,n){this.inputType=e,this.type=t,this.input=r,this.cases=i,this.outputs=a,this.otherwise=n}static parse(e,t){let r,i;if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);let a={},n=[];for(let s=2;s<e.length-1;s+=2){let o=e[s],l=e[s+1];Array.isArray(o)||(o=[o]);let u=t.concat(s);if(0===o.length)return u.error("Expected at least one branch label.");for(let e of o){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,ts(e)))return null}else r=ts(e);if(void 0!==a[String(e)])return u.error("Branch labels must be unique.");a[String(e)]=n.length}let h=t.parse(l,s,i);if(!h)return null;i=i||h.type,n.push(h)}let s=t.parse(e[1],1,eE);if(!s)return null;let o=t.parse(e[e.length-1],e.length-1,i);return o?"value"!==s.type.kind&&t.concat(1).checkSubtype(r,s.type)?null:new tG(r,i,s,a,n,o):null}evaluate(e){let t=this.input.evaluate(e);return(ts(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class tH{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){let r;if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);let i=[];for(let a=1;a<e.length-1;a+=2){let n=t.parse(e[a],a,eI);if(!n)return null;let s=t.parse(e[a+1],a+1,r);if(!s)return null;i.push([n,s]),r=r||s.type}let a=t.parse(e[e.length-1],e.length-1,r);if(!a)return null;if(!r)throw Error("Can't infer output type");return new tH(r,i,a)}evaluate(e){for(let[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class tW{constructor(e,t,r,i){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let r=t.parse(e[1],1,eE),i=t.parse(e[2],2,ek);if(!r||!i)return null;if(!eN(r.type,[eL(eE),eT,eE]))return t.error(`Expected first argument to be of type array or string, but found ${eF(r.type)} instead`);if(4===e.length){let a=t.parse(e[3],3,ek);return a?new tW(r.type,r,i,a):null}return new tW(r.type,r,i)}evaluate(e){let t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!eV(t,["string","array"]))throw new tu(`Expected first argument to be of type array or string, but found ${eF(ts(t))} instead.`);if(this.endIndex){let i=this.endIndex.evaluate(e);return t.slice(r,i)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function tX(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function tK(e,t,r,i){return 0===i.compare(t,r)}function tJ(e,t,r){let i="=="!==e&&"!="!==e;return class a{constructor(e,t,r){this.type=eI,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");let r=e[0],n=t.parse(e[1],1,eE);if(!n)return null;if(!tX(r,n.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${eF(n.type)}'.`);let s=t.parse(e[2],2,eE);if(!s)return null;if(!tX(r,s.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${eF(s.type)}'.`);if(n.type.kind!==s.type.kind&&"value"!==n.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${eF(n.type)}' and '${eF(s.type)}'.`);i&&("value"===n.type.kind&&"value"!==s.type.kind?n=new tc(s.type,[n]):"value"!==n.type.kind&&"value"===s.type.kind&&(s=new tc(n.type,[s])));let o=null;if(4===e.length){if("string"!==n.type.kind&&"string"!==s.type.kind&&"value"!==n.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(o=t.parse(e[3],3,eM)))return null}return new a(n,s,o)}evaluate(a){let n=this.lhs.evaluate(a),s=this.rhs.evaluate(a);if(i&&this.hasUntypedArgument){let t=ts(n),r=ts(s);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new tu(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${r.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){let e=ts(n),r=ts(s);if("string"!==e.kind||"string"!==r.kind)return t(a,n,s)}return this.collator?r(a,n,s,this.collator.evaluate(a)):t(a,n,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}let tY=tJ("==",function(e,t,r){return t===r},tK),tQ=tJ("!=",function(e,t,r){return t!==r},function(e,t,r,i){return!tK(0,t,r,i)}),t0=tJ("<",function(e,t,r){return t<r},function(e,t,r,i){return 0>i.compare(t,r)}),t1=tJ(">",function(e,t,r){return t>r},function(e,t,r,i){return i.compare(t,r)>0}),t2=tJ("<=",function(e,t,r){return t<=r},function(e,t,r,i){return 0>=i.compare(t,r)}),t3=tJ(">=",function(e,t,r){return t>=r},function(e,t,r,i){return i.compare(t,r)>=0});class t5{constructor(e,t,r,i,a){this.type=eT,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=a}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");let r=t.parse(e[1],1,ek);if(!r)return null;let i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let a=null;if(i.locale&&!(a=t.parse(i.locale,1,eT)))return null;let n=null;if(i.currency&&!(n=t.parse(i.currency,1,eT)))return null;let s=null;if(i["min-fraction-digits"]&&!(s=t.parse(i["min-fraction-digits"],1,ek)))return null;let o=null;return!i["max-fraction-digits"]||(o=t.parse(i["max-fraction-digits"],1,ek))?new t5(r,a,n,s,o):null}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class t4{constructor(e){this.type=eA,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");let i=[],a=!1;for(let r=1;r<=e.length-1;++r){let n=e[r];if(a&&"object"==typeof n&&!Array.isArray(n)){a=!1;let e=null;if(n["font-scale"]&&!(e=t.parse(n["font-scale"],1,ek)))return null;let r=null;if(n["text-font"]&&!(r=t.parse(n["text-font"],1,eL(eT))))return null;let s=null;if(n["text-color"]&&!(s=t.parse(n["text-color"],1,eC)))return null;let o=i[i.length-1];o.scale=e,o.font=r,o.textColor=s}else{let n=t.parse(e[r],1,eE);if(!n)return null;let s=n.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new t4(i)}evaluate(e){return new e7(this.sections.map(t=>{let r=t.content.evaluate(e);return ts(r)===eR?new e9("",r,null,null,null):new e9(to(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(let t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}}class t6{constructor(e){this.type=eR,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");let r=t.parse(e[1],1,eT);return r?new t6(r):t.error("No image name provided.")}evaluate(e){let t=this.input.evaluate(e),r=ti.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}}class t8{constructor(e){this.type=ek,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);let r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error(`Expected argument of type string or array, but found ${eF(r.type)} instead.`):new t8(r):null}evaluate(e){let t=this.input.evaluate(e);if("string"==typeof t||Array.isArray(t))return t.length;throw new tu(`Expected value to be of type string or array, but found ${eF(ts(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}let t9={"==":tY,"!=":tQ,">":t1,"<":t0,">=":t3,"<=":t2,array:tc,at:tU,boolean:tc,case:tH,coalesce:t$,collator:ty,format:t4,image:t6,in:tq,"index-of":tZ,interpolate:tN,"interpolate-hcl":tN,"interpolate-lab":tN,length:t8,let:tj,literal:tl,match:tG,number:tc,"number-format":t5,object:tc,slice:tW,step:tF,string:tc,"to-boolean":tp,"to-color":tp,"to-number":tp,"to-string":tp,var:tE,within:tP};function t7(e,[t,r,i,a]){t=t.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);let n=a?a.evaluate(e):1,s=ta(t,r,i,n);if(s)throw new tu(s);return new e6(t/255,r/255,i/255,n,!1)}function re(e,t){let r=t[e];return void 0===r?null:r}function rt(e){return{type:e}}function rr(e){return{result:"success",value:e}}function ri(e){return{result:"error",value:e}}function ra(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function rn(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function rs(e){return!!e.expression&&e.expression.interpolated}function ro(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function rl(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function ru(e){return e}function rh(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function rc(e,t,r,i,a){return rh(typeof r===a?i[r]:void 0,e.default,t.default)}function rd(e,t,r){if("number"!==ro(r))return rh(e.default,t.default);let i=e.stops.length;if(1===i||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];let a=tL(e.stops.map(e=>e[0]),r);return e.stops[a][1]}function rp(e,t,r){let i=void 0!==e.base?e.base:1;if("number"!==ro(r))return rh(e.default,t.default);let a=e.stops.length;if(1===a||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[a-1][0])return e.stops[a-1][1];let n=tL(e.stops.map(e=>e[0]),r),s=function(e,t,r,i){let a=i-r,n=e-r;return 0===a?0:1===t?n/a:(Math.pow(t,n)-1)/(Math.pow(t,a)-1)}(r,i,e.stops[n][0],e.stops[n+1][0]),o=e.stops[n][1],l=e.stops[n+1][1],u=tO[t.type]||ru;return"function"==typeof o.evaluate?{evaluate(...t){let r=o.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==i)return u(r,i,s,e.colorSpace)}}:u(o,l,s,e.colorSpace)}function rf(e,t,r){switch(t.type){case"color":r=e6.parse(r);break;case"formatted":r=e7.fromString(r.toString());break;case"resolvedImage":r=ti.fromString(r.toString());break;case"padding":r=te.parse(r);break;default:ro(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0)}return rh(r,e.default,t.default)}tM.register(t9,{error:[{kind:"error"},[eT],(e,[t])=>{throw new tu(t.evaluate(e))}],typeof:[eT,[eE],(e,[t])=>eF(ts(t.evaluate(e)))],"to-rgba":[eL(ek,4),[eC],(e,[t])=>{let[r,i,a,n]=t.evaluate(e).rgb;return[255*r,255*i,255*a,n]}],rgb:[eC,[ek,ek,ek],t7],rgba:[eC,[ek,ek,ek,ek],t7],has:{type:eI,overloads:[[[eT],(e,[t])=>t.evaluate(e) in e.properties()],[[eT,eP],(e,[t,r])=>t.evaluate(e) in r.evaluate(e)]]},get:{type:eE,overloads:[[[eT],(e,[t])=>re(t.evaluate(e),e.properties())],[[eT,eP],(e,[t,r])=>re(t.evaluate(e),r.evaluate(e))]]},"feature-state":[eE,[eT],(e,[t])=>re(t.evaluate(e),e.featureState||{})],properties:[eP,[],e=>e.properties()],"geometry-type":[eT,[],e=>e.geometryType()],id:[eE,[],e=>e.id()],zoom:[ek,[],e=>e.globals.zoom],"heatmap-density":[ek,[],e=>e.globals.heatmapDensity||0],"line-progress":[ek,[],e=>e.globals.lineProgress||0],accumulated:[eE,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[ek,rt(ek),(e,t)=>{let r=0;for(let i of t)r+=i.evaluate(e);return r}],"*":[ek,rt(ek),(e,t)=>{let r=1;for(let i of t)r*=i.evaluate(e);return r}],"-":{type:ek,overloads:[[[ek,ek],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[ek],(e,[t])=>-t.evaluate(e)]]},"/":[ek,[ek,ek],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[ek,[ek,ek],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[ek,[],()=>Math.LN2],pi:[ek,[],()=>Math.PI],e:[ek,[],()=>Math.E],"^":[ek,[ek,ek],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[ek,[ek],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ek,[ek],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ek,[ek],(e,[t])=>Math.log(t.evaluate(e))],log2:[ek,[ek],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ek,[ek],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ek,[ek],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ek,[ek],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ek,[ek],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ek,[ek],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ek,[ek],(e,[t])=>Math.atan(t.evaluate(e))],min:[ek,rt(ek),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[ek,rt(ek),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[ek,[ek],(e,[t])=>Math.abs(t.evaluate(e))],round:[ek,[ek],(e,[t])=>{let r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[ek,[ek],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ek,[ek],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[eI,[eT,eE],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[eI,[eE],(e,[t])=>e.id()===t.value],"filter-type-==":[eI,[eT],(e,[t])=>e.geometryType()===t.value],"filter-<":[eI,[eT,eE],(e,[t,r])=>{let i=e.properties()[t.value],a=r.value;return typeof i==typeof a&&i<a}],"filter-id-<":[eI,[eE],(e,[t])=>{let r=e.id(),i=t.value;return typeof r==typeof i&&r<i}],"filter->":[eI,[eT,eE],(e,[t,r])=>{let i=e.properties()[t.value],a=r.value;return typeof i==typeof a&&i>a}],"filter-id->":[eI,[eE],(e,[t])=>{let r=e.id(),i=t.value;return typeof r==typeof i&&r>i}],"filter-<=":[eI,[eT,eE],(e,[t,r])=>{let i=e.properties()[t.value],a=r.value;return typeof i==typeof a&&i<=a}],"filter-id-<=":[eI,[eE],(e,[t])=>{let r=e.id(),i=t.value;return typeof r==typeof i&&r<=i}],"filter->=":[eI,[eT,eE],(e,[t,r])=>{let i=e.properties()[t.value],a=r.value;return typeof i==typeof a&&i>=a}],"filter-id->=":[eI,[eE],(e,[t])=>{let r=e.id(),i=t.value;return typeof r==typeof i&&r>=i}],"filter-has":[eI,[eE],(e,[t])=>t.value in e.properties()],"filter-has-id":[eI,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[eI,[eL(eT)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[eI,[eL(eE)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[eI,[eT,eL(eE)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[eI,[eT,eL(eE)],(e,[t,r])=>(function(e,t,r,i){for(;r<=i;){let a=r+i>>1;if(t[a]===e)return!0;t[a]>e?i=a-1:r=a+1}return!1})(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:eI,overloads:[[[eI,eI],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[rt(eI),(e,t)=>{for(let r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:eI,overloads:[[[eI,eI],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[rt(eI),(e,t)=>{for(let r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[eI,[eI],(e,[t])=>!t.evaluate(e)],"is-supported-script":[eI,[eT],(e,[t])=>{let r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[eT,[eT],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[eT,[eT],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[eT,rt(eE),(e,t)=>t.map(t=>to(t.evaluate(e))).join("")],"resolved-locale":[eT,[eM],(e,[t])=>t.evaluate(e).resolvedLocale()]});class rm{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new tm,this._defaultValue=t?"color"===t.type&&rl(t.default)?new e6(0,0,0,0):"color"===t.type?e6.parse(t.default)||null:"padding"===t.type?te.parse(t.default)||null:"variableAnchorOffsetCollection"===t.type?tr.parse(t.default)||null:void 0===t.default?null:t.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,i,a,n){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=i,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=n,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,i,a,n){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=n||null;try{let e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new tu(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function rg(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in t9}function ry(e,t){let r=new tg(t9,tA,[],t?function(e){let t={color:eC,string:eT,number:ek,enum:eT,boolean:eI,formatted:eA,padding:ez,resolvedImage:eR,variableAnchorOffsetCollection:eD};return"array"===e.type?eL(t[e.value]||eE,e.length):t[e.type]}(t):void 0),i=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?rr(new rm(i,t)):ri(r.errors)}class r_{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!tR(t.expression)}evaluateWithoutErrorHandling(e,t,r,i,a,n){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,a,n)}evaluate(e,t,r,i,a,n){return this._styleExpression.evaluate(e,t,r,i,a,n)}}class rx{constructor(e,t,r,i){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!tR(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,r,i,a,n){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,a,n)}evaluate(e,t,r,i,a,n){return this._styleExpression.evaluate(e,t,r,i,a,n)}interpolationFactor(e,t,r){return this.interpolationType?tN.interpolationFactor(this.interpolationType,e,t,r):0}}function rv(e,t){let r=ry(e,t);if("error"===r.result)return r;let i=r.value.expression,a=tz(i);if(!a&&!ra(t))return ri([new eb("","data expressions not supported")]);let n=tD(i,["zoom"]);if(!n&&!rn(t))return ri([new eb("","zoom expressions not supported")]);let s=function e(t){let r=null;if(t instanceof tj)r=e(t.result);else if(t instanceof t$){for(let i of t.args)if(r=e(i))break}else(t instanceof tF||t instanceof tN)&&t.input instanceof tM&&"zoom"===t.input.name&&(r=t);return r instanceof eb||t.eachChild(t=>{let i=e(t);i instanceof eb?r=i:!r&&i?r=new eb("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&i&&r!==i&&(r=new eb("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}(i);return s||n?s instanceof eb?ri([s]):s instanceof tN&&!rs(t)?ri([new eb("",'"interpolate" expressions cannot be used with this property')]):rr(s?new rx(a?"camera":"composite",r.value,s.labels,s instanceof tN?s.interpolation:void 0):new r_(a?"constant":"source",r.value)):ri([new eb("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rb{constructor(e,t){this._parameters=e,this._specification=t,ev(this,function e(t,r){var i;let a,n,s;let o="color"===r.type,l=t.stops&&"object"==typeof t.stops[0][0],u=l||!(l||void 0!==t.property),h=t.type||(rs(r)?"exponential":"interval");if(o||"padding"===r.type){let e=o?e6.parse:te.parse;(t=ev({},t)).stops&&(t.stops=t.stops.map(t=>[t[0],e(t[1])])),t.default=e(t.default?t.default:r.default)}if(t.colorSpace&&"rgb"!==(i=t.colorSpace)&&"hcl"!==i&&"lab"!==i)throw Error(`Unknown color space: "${t.colorSpace}"`);if("exponential"===h)a=rp;else if("interval"===h)a=rd;else if("categorical"===h){for(let e of(a=rc,n=Object.create(null),t.stops))n[e[0]]=e[1];s=typeof t.stops[0][0]}else{if("identity"!==h)throw Error(`Unknown function type "${h}"`);a=rf}if(l){let i={},a=[];for(let e=0;e<t.stops.length;e++){let r=t.stops[e],n=r[0].zoom;void 0===i[n]&&(i[n]={zoom:n,type:t.type,property:t.property,default:t.default,stops:[]},a.push(n)),i[n].stops.push([r[0].value,r[1]])}let n=[];for(let t of a)n.push([i[t].zoom,e(i[t],r)]);let s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:tN.interpolationFactor.bind(void 0,s),zoomStops:n.map(e=>e[0]),evaluate:({zoom:e},i)=>rp({stops:n,base:t.base},r,e).evaluate(e,i)}}if(u){let e="exponential"===h?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:e,interpolationFactor:tN.interpolationFactor.bind(void 0,e),zoomStops:t.stops.map(e=>e[0]),evaluate:({zoom:e})=>a(t,r,e,n,s)}}return{kind:"source",evaluate(e,i){let o=i&&i.properties?i.properties[t.property]:void 0;return void 0===o?rh(t.default,r.default):a(t,r,o,n,s)}}}(this._parameters,this._specification))}static deserialize(e){return new rb(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function rw(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(let t of e.slice(1))if(!rw(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}let rS={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function rk(e){if(null==e)return{filter:()=>!0,needGeometry:!1};rw(e)||(e=function e(t){if(!t)return!0;let r=t[0];return t.length<=1?"any"!==r:"=="===r?rI(t[1],t[2],"=="):"!="===r?rE(rI(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?rI(t[1],t[2],r):"any"===r?["any"].concat(t.slice(1).map(e)):"all"===r?["all"].concat(t.slice(1).map(e)):"none"===r?["all"].concat(t.slice(1).map(e).map(rE)):"in"===r?rC(t[1],t.slice(2)):"!in"===r?rE(rC(t[1],t.slice(2))):"has"===r?rP(t[1]):"!has"===r?rE(rP(t[1])):"within"!==r||t}(e));let t=ry(e,rS);if("error"===t.result)throw Error(t.value.map(e=>`${e.key}: ${e.message}`).join(", "));return{filter:(e,r,i)=>t.value.evaluate(e,r,{},i),needGeometry:function e(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let r=1;r<t.length;r++)if(e(t[r]))return!0;return!1}(e)}}function rT(e,t){return e<t?-1:e>t?1:0}function rI(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function rC(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(rT)]]:["filter-in-small",e,["literal",t]]}}function rP(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function rE(e){return["!",e]}function rM(e){let t=e.value;return t?[new ex(e.key,t,"constants have been deprecated as of v8")]:[]}function rA(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function rz(e){if(Array.isArray(e))return e.map(rz);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){let t={};for(let r in e)t[r]=rz(e[r]);return t}return rA(e)}function rR(e){let t=e.key,r=e.value,i=e.valueSpec||{},a=e.objectElementValidators||{},n=e.style,s=e.styleSpec,o=e.validateSpec,l=[],u=ro(r);if("object"!==u)return[new ex(t,r,`object expected, ${u} found`)];for(let e in r){let u;let h=e.split(".")[0],c=i[h]||i["*"];if(a[h])u=a[h];else if(i[h])u=o;else if(a["*"])u=a["*"];else{if(!i["*"]){l.push(new ex(t,r[e],`unknown property "${e}"`));continue}u=o}l=l.concat(u({key:(t?`${t}.`:t)+e,value:r[e],valueSpec:c,style:n,styleSpec:s,object:r,objectKey:e,validateSpec:o},r))}for(let e in i)a[e]||i[e].required&&void 0===i[e].default&&void 0===r[e]&&l.push(new ex(t,r,`missing required property "${e}"`));return l}function rD(e){let t=e.value,r=e.valueSpec,i=e.style,a=e.styleSpec,n=e.key,s=e.arrayElementValidator||e.validateSpec;if("array"!==ro(t))return[new ex(n,t,`array expected, ${ro(t)} found`)];if(r.length&&t.length!==r.length)return[new ex(n,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ex(n,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let o={type:r.value,values:r.values};a.$version<7&&(o.function=r.function),"object"===ro(r.value)&&(o=r.value);let l=[];for(let r=0;r<t.length;r++)l=l.concat(s({array:t,arrayIndex:r,value:t[r],valueSpec:o,validateSpec:e.validateSpec,style:i,styleSpec:a,key:`${n}[${r}]`}));return l}function rL(e){let t=e.key,r=e.value,i=e.valueSpec,a=ro(r);return"number"===a&&r!=r&&(a="NaN"),"number"!==a?[new ex(t,r,`number expected, ${a} found`)]:"minimum"in i&&r<i.minimum?[new ex(t,r,`${r} is less than the minimum value ${i.minimum}`)]:"maximum"in i&&r>i.maximum?[new ex(t,r,`${r} is greater than the maximum value ${i.maximum}`)]:[]}function rF(e){let t=e.valueSpec,r=rA(e.value.type),i,a,n,s={},o="categorical"!==r&&void 0===e.value.property,l="array"===ro(e.value.stops)&&"array"===ro(e.value.stops[0])&&"object"===ro(e.value.stops[0][0]),u=rR({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===r)return[new ex(e.key,e.value,'identity function may not have a "stops" property')];let t=[],i=e.value;return t=t.concat(rD({key:e.key,value:i,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===ro(i)&&0===i.length&&t.push(new ex(e.key,i,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===r&&o&&u.push(new ex(e.key,e.value,'missing required property "property"')),"identity"===r||e.value.stops||u.push(new ex(e.key,e.value,'missing required property "stops"')),"exponential"===r&&e.valueSpec.expression&&!rs(e.valueSpec)&&u.push(new ex(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(o||ra(e.valueSpec)?o&&!rn(e.valueSpec)&&u.push(new ex(e.key,e.value,"zoom functions not supported")):u.push(new ex(e.key,e.value,"property functions not supported"))),("categorical"===r||l)&&void 0===e.value.property&&u.push(new ex(e.key,e.value,'"property" property is required')),u;function h(e){let r=[],i=e.value,o=e.key;if("array"!==ro(i))return[new ex(o,i,`array expected, ${ro(i)} found`)];if(2!==i.length)return[new ex(o,i,`array length 2 expected, length ${i.length} found`)];if(l){if("object"!==ro(i[0]))return[new ex(o,i,`object expected, ${ro(i[0])} found`)];if(void 0===i[0].zoom)return[new ex(o,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new ex(o,i,"object stop key must have value")];if(n&&n>rA(i[0].zoom))return[new ex(o,i[0].zoom,"stop zoom values must appear in ascending order")];rA(i[0].zoom)!==n&&(n=rA(i[0].zoom),a=void 0,s={}),r=r.concat(rR({key:`${o}[0]`,value:i[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:rL,value:c}}))}else r=r.concat(c({key:`${o}[0]`,value:i[0],valueSpec:{},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},i));return rg(rz(i[1]))?r.concat([new ex(`${o}[1]`,i[1],"expressions are not allowed in function stops.")]):r.concat(e.validateSpec({key:`${o}[1]`,value:i[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function c(e,n){let o=ro(e.value),l=rA(e.value),u=null!==e.value?e.value:n;if(i){if(o!==i)return[new ex(e.key,u,`${o} stop domain type must match previous stop domain type ${i}`)]}else i=o;if("number"!==o&&"string"!==o&&"boolean"!==o)return[new ex(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==o&&"categorical"!==r){let i=`number expected, ${o} found`;return ra(t)&&void 0===r&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ex(e.key,u,i)]}return"categorical"!==r||"number"!==o||isFinite(l)&&Math.floor(l)===l?"categorical"!==r&&"number"===o&&void 0!==a&&l<a?[new ex(e.key,u,"stop domain values must appear in ascending order")]:(a=l,"categorical"===r&&l in s?[new ex(e.key,u,"stop domain values must be unique")]:(s[l]=!0,[])):[new ex(e.key,u,`integer expected, found ${l}`)]}}function rB(e){let t=("property"===e.expressionContext?rv:ry)(rz(e.value),e.valueSpec);if("error"===t.result)return t.value.map(t=>new ex(`${e.key}${t.key}`,e.value,t.message));let r=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new ex(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!tR(r))return[new ex(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!tR(r))return[new ex(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!tD(r,["zoom","feature-state"]))return[new ex(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!tz(r))return[new ex(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rO(e){let t=e.key,r=e.value,i=e.valueSpec,a=[];return Array.isArray(i.values)?-1===i.values.indexOf(rA(r))&&a.push(new ex(t,r,`expected one of [${i.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(i.values).indexOf(rA(r))&&a.push(new ex(t,r,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(r)} found`)),a}function rN(e){return rw(rz(e.value))?rB(ev({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function e(t){let r=t.value,i=t.key;if("array"!==ro(r))return[new ex(i,r,`array expected, ${ro(r)} found`)];let a=t.styleSpec,n,s=[];if(r.length<1)return[new ex(i,r,"filter array must have at least 1 element")];switch(s=s.concat(rO({key:`${i}[0]`,value:r[0],valueSpec:a.filter_operator,style:t.style,styleSpec:t.styleSpec})),rA(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===rA(r[1])&&s.push(new ex(i,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&s.push(new ex(i,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&"string"!==(n=ro(r[1]))&&s.push(new ex(`${i}[1]`,r[1],`string expected, ${n} found`));for(let e=2;e<r.length;e++)n=ro(r[e]),"$type"===rA(r[1])?s=s.concat(rO({key:`${i}[${e}]`,value:r[e],valueSpec:a.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&s.push(new ex(`${i}[${e}]`,r[e],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let a=1;a<r.length;a++)s=s.concat(e({key:`${i}[${a}]`,value:r[a],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=ro(r[1]),2!==r.length?s.push(new ex(i,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==n&&s.push(new ex(`${i}[1]`,r[1],`string expected, ${n} found`));break;case"within":n=ro(r[1]),2!==r.length?s.push(new ex(i,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==n&&s.push(new ex(`${i}[1]`,r[1],`object expected, ${n} found`))}return s}(e)}function rV(e,t){let r;let i=e.key,a=e.validateSpec,n=e.style,s=e.styleSpec,o=e.value,l=e.objectKey,u=s[`${t}_${e.layerType}`];if(!u)return[];let h=l.match(/^(.*)-transition$/);if("paint"===t&&h&&u[h[1]]&&u[h[1]].transition)return a({key:i,value:o,valueSpec:s.transition,style:n,styleSpec:s});let c=e.valueSpec||u[l];if(!c)return[new ex(i,o,`unknown property "${l}"`)];if("string"===ro(o)&&ra(c)&&!c.tokens&&(r=/^{([^}]+)}$/.exec(o)))return[new ex(i,o,`"${l}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(r[1])} }\`.`)];let d=[];return"symbol"===e.layerType&&("text-field"===l&&n&&!n.glyphs&&d.push(new ex(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&rl(rz(o))&&"identity"===rA(o.type)&&d.push(new ex(i,o,'"text-font" does not support identity functions'))),d.concat(a({key:e.key,value:o,valueSpec:c,style:n,styleSpec:s,expressionContext:"property",propertyType:t,propertyKey:l}))}function r$(e){return rV(e,"paint")}function rj(e){return rV(e,"layout")}function rU(e){let t=[],r=e.value,i=e.key,a=e.style,n=e.styleSpec;r.type||r.ref||t.push(new ex(i,r,'either "type" or "ref" is required'));let s=rA(r.type),o=rA(r.ref);if(r.id){let n=rA(r.id);for(let s=0;s<e.arrayIndex;s++){let e=a.layers[s];rA(e.id)===n&&t.push(new ex(i,r.id,`duplicate layer id "${r.id}", previously used at line ${e.id.__line__}`))}}if("ref"in r){let e;["type","source","source-layer","filter","layout"].forEach(e=>{e in r&&t.push(new ex(i,r[e],`"${e}" is prohibited for ref layers`))}),a.layers.forEach(t=>{rA(t.id)===o&&(e=t)}),e?e.ref?t.push(new ex(i,r.ref,"ref cannot reference another ref layer")):s=rA(e.type):t.push(new ex(i,r.ref,`ref layer "${o}" not found`))}else if("background"!==s){if(r.source){let e=a.sources&&a.sources[r.source],n=e&&rA(e.type);e?"vector"===n&&"raster"===s?t.push(new ex(i,r.source,`layer "${r.id}" requires a raster source`)):"raster-dem"!==n&&"hillshade"===s?t.push(new ex(i,r.source,`layer "${r.id}" requires a raster-dem source`)):"raster"===n&&"raster"!==s?t.push(new ex(i,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==n||r["source-layer"]?"raster-dem"===n&&"hillshade"!==s?t.push(new ex(i,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"===s&&r.paint&&r.paint["line-gradient"]&&("geojson"!==n||!e.lineMetrics)&&t.push(new ex(i,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ex(i,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ex(i,r.source,`source "${r.source}" not found`))}else t.push(new ex(i,r,'missing required property "source"'))}return t=t.concat(rR({key:i,value:r,valueSpec:n.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${i}.type`,value:r.type,valueSpec:n.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:r,objectKey:"type"}),filter:rN,layout:e=>rR({layer:r,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>rj(ev({layerType:s},e))}}),paint:e=>rR({layer:r,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>r$(ev({layerType:s},e))}})}}))}function rq(e){let t=e.value,r=e.key,i=ro(t);return"string"!==i?[new ex(r,t,`string expected, ${i} found`)]:[]}let rZ={promoteId:function({key:e,value:t}){if("string"===ro(t))return rq({key:e,value:t});{let r=[];for(let i in t)r.push(...rq({key:`${e}.${i}`,value:t[i]}));return r}}};function rG(e){let t;let r=e.value,i=e.key,a=e.styleSpec,n=e.style,s=e.validateSpec;if(!r.type)return[new ex(i,r,'"type" is required')];let o=rA(r.type);switch(o){case"vector":case"raster":return rR({key:i,value:r,valueSpec:a[`source_${o.replace("-","_")}`],style:e.style,styleSpec:a,objectElementValidators:rZ,validateSpec:s});case"raster-dem":return function(e){var t;let r=null!==(t=e.sourceName)&&void 0!==t?t:"",i=e.value,a=e.styleSpec,n=a.source_raster_dem,s=e.style,o=[],l=ro(i);if(void 0===i)return o;if("object"!==l)return o.push(new ex("source_raster_dem",i,`object expected, ${l} found`)),o;let u="custom"===rA(i.encoding),h=["redFactor","greenFactor","blueFactor","baseShift"],c=e.value.encoding?`"${e.value.encoding}"`:"Default";for(let t in i)!u&&h.includes(t)?o.push(new ex(t,i[t],`In "${r}": "${t}" is only valid when "encoding" is set to "custom". ${c} encoding found`)):n[t]?o=o.concat(e.validateSpec({key:t,value:i[t],valueSpec:n[t],validateSpec:e.validateSpec,style:s,styleSpec:a})):o.push(new ex(t,i[t],`unknown property "${t}"`));return o}({sourceName:i,value:r,style:e.style,styleSpec:a,validateSpec:s});case"geojson":if(t=rR({key:i,value:r,valueSpec:a.source_geojson,style:n,styleSpec:a,validateSpec:s,objectElementValidators:rZ}),r.cluster)for(let e in r.clusterProperties){let[a,n]=r.clusterProperties[e],o="string"==typeof a?[a,["accumulated"],["get",e]]:a;t.push(...rB({key:`${i}.${e}.map`,value:n,validateSpec:s,expressionContext:"cluster-map"})),t.push(...rB({key:`${i}.${e}.reduce`,value:o,validateSpec:s,expressionContext:"cluster-reduce"}))}return t;case"video":return rR({key:i,value:r,valueSpec:a.source_video,style:n,validateSpec:s,styleSpec:a});case"image":return rR({key:i,value:r,valueSpec:a.source_image,style:n,validateSpec:s,styleSpec:a});case"canvas":return[new ex(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rO({key:`${i}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,validateSpec:s,styleSpec:a})}}function rH(e){let t=e.value,r=e.styleSpec,i=r.light,a=e.style,n=[],s=ro(t);if(void 0===t)return n;if("object"!==s)return n.concat([new ex("light",t,`object expected, ${s} found`)]);for(let s in t){let o=s.match(/^(.*)-transition$/);n=n.concat(o&&i[o[1]]&&i[o[1]].transition?e.validateSpec({key:s,value:t[s],valueSpec:r.transition,validateSpec:e.validateSpec,style:a,styleSpec:r}):i[s]?e.validateSpec({key:s,value:t[s],valueSpec:i[s],validateSpec:e.validateSpec,style:a,styleSpec:r}):[new ex(s,t[s],`unknown property "${s}"`)])}return n}function rW(e){let t=e.value,r=e.styleSpec,i=r.terrain,a=e.style,n=[],s=ro(t);if(void 0===t)return n;if("object"!==s)return n.concat([new ex("terrain",t,`object expected, ${s} found`)]);for(let s in t)n=n.concat(i[s]?e.validateSpec({key:s,value:t[s],valueSpec:i[s],validateSpec:e.validateSpec,style:a,styleSpec:r}):[new ex(s,t[s],`unknown property "${s}"`)]);return n}function rX(e){let t=[],r=e.value,i=e.key;if(Array.isArray(r)){let a=[],n=[];for(let s in r)r[s].id&&a.includes(r[s].id)&&t.push(new ex(i,r,`all the sprites' ids must be unique, but ${r[s].id} is duplicated`)),a.push(r[s].id),r[s].url&&n.includes(r[s].url)&&t.push(new ex(i,r,`all the sprites' URLs must be unique, but ${r[s].url} is duplicated`)),n.push(r[s].url),t=t.concat(rR({key:`${i}[${s}]`,value:r[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return t}return rq({key:i,value:r})}let rK={"*":()=>[],array:rD,boolean:function(e){let t=e.value,r=e.key,i=ro(t);return"boolean"!==i?[new ex(r,t,`boolean expected, ${i} found`)]:[]},number:rL,color:function(e){let t=e.key,r=e.value,i=ro(r);return"string"!==i?[new ex(t,r,`color expected, ${i} found`)]:e6.parse(String(r))?[]:[new ex(t,r,`color expected, "${r}" found`)]},constants:rM,enum:rO,filter:rN,function:rF,layer:rU,object:rR,source:rG,light:rH,terrain:rW,string:rq,formatted:function(e){return 0===rq(e).length?[]:rB(e)},resolvedImage:function(e){return 0===rq(e).length?[]:rB(e)},padding:function(e){let t=e.key,r=e.value;if("array"===ro(r)){if(r.length<1||r.length>4)return[new ex(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];let i={type:"number"},a=[];for(let n=0;n<r.length;n++)a=a.concat(e.validateSpec({key:`${t}[${n}]`,value:r[n],validateSpec:e.validateSpec,valueSpec:i}));return a}return rL({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(e){let t=e.key,r=e.value,i=ro(r),a=e.styleSpec;if("array"!==i||r.length<1||r.length%2!=0)return[new ex(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let n=[];for(let i=0;i<r.length;i+=2)n=(n=n.concat(rO({key:`${t}[${i}]`,value:r[i],valueSpec:a.layout_symbol["text-anchor"]}))).concat(rD({key:`${t}[${i+1}]`,value:r[i+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:a}));return n},sprite:rX};function rJ(e){let t=e.value,r=e.valueSpec,i=e.styleSpec;return e.validateSpec=rJ,r.expression&&rl(rA(t))?rF(e):r.expression&&rg(rz(t))?rB(e):r.type&&rK[r.type]?rK[r.type](e):rR(ev({},e,{valueSpec:r.type?i[r.type]:r}))}function rY(e){let t=e.value,r=e.key,i=rq(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new ex(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new ex(r,t,'"glyphs" url must include a "{range}" token'))),i}function rQ(e,t=eh){let r=[];return r=r.concat(rJ({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:rJ,objectElementValidators:{glyphs:rY,"*":()=>[]}})),e.constants&&(r=r.concat(rM({key:"constants",value:e.constants,style:e,styleSpec:t,validateSpec:rJ}))),r1(r)}function r0(e){return function(t){return e({...t,validateSpec:rJ})}}function r1(e){return[].concat(e).sort((e,t)=>e.line-t.line)}function r2(e){return function(...t){return r1(e.apply(this,t))}}rQ.source=r2(r0(rG)),rQ.sprite=r2(r0(rX)),rQ.glyphs=r2(r0(rY)),rQ.light=r2(r0(rH)),rQ.terrain=r2(r0(rW)),rQ.layer=r2(r0(rU)),rQ.filter=r2(r0(rN)),rQ.paintProperty=r2(r0(r$)),rQ.layoutProperty=r2(r0(rj));let r3=rQ.light,r5=rQ.paintProperty,r4=rQ.layoutProperty;function r6(e,t){let r=!1;if(t&&t.length)for(let i of t)e.fire(new el(Error(i.message))),r=!0;return r}class r8{constructor(e,t,r){let i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;let a=new Int32Array(this.arrayBuffer);e=a[0],this.d=(t=a[1])+2*(r=a[2]);for(let e=0;e<this.d*this.d;e++){let t=a[3+e],r=a[3+e+1];i.push(t===r?null:a.subarray(t,r))}let n=a[3+i.length+1];this.keys=a.subarray(a[3+i.length],n),this.bboxes=a.subarray(n),this.insert=this._insertReadonly}else{this.d=t+2*r;for(let e=0;e<this.d*this.d;e++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;let a=r/t*e;this.min=-a,this.max=e+a}insert(e,t,r,i,a){this._forEachCell(t,r,i,a,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(a)}_insertReadonly(){throw Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,r,i,a,n){this.cells[a].push(n)}query(e,t,r,i,a){let n=this.min,s=this.max;if(e<=n&&t<=n&&s<=r&&s<=i&&!a)return Array.prototype.slice.call(this.keys);{let n=[];return this._forEachCell(e,t,r,i,this._queryCell,n,{},a),n}}_queryCell(e,t,r,i,a,n,s,o){let l=this.cells[a];if(null!==l){let a=this.keys,u=this.bboxes;for(let h=0;h<l.length;h++){let c=l[h];if(void 0===s[c]){let l=4*c;(o?o(u[l+0],u[l+1],u[l+2],u[l+3]):e<=u[l+2]&&t<=u[l+3]&&r>=u[l+0]&&i>=u[l+1])?(s[c]=!0,n.push(a[c])):s[c]=!1}}}}_forEachCell(e,t,r,i,a,n,s,o){let l=this._convertToCellCoord(e),u=this._convertToCellCoord(t),h=this._convertToCellCoord(r),c=this._convertToCellCoord(i);for(let d=l;d<=h;d++)for(let l=u;l<=c;l++){let u=this.d*l+d;if((!o||o(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&a.call(this,e,t,r,i,u,n,s,o))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let e=this.cells,t=3+this.cells.length+1+1,r=0;for(let e=0;e<this.cells.length;e++)r+=this.cells[e].length;let i=new Int32Array(t+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;let a=t;for(let t=0;t<e.length;t++){let r=e[t];i[3+t]=a,i.set(r,a),a+=r.length}return i[3+e.length]=a,i.set(this.keys,a),a+=this.keys.length,i[3+e.length+1]=a,i.set(this.bboxes,a),a+=this.bboxes.length,i.buffer}static serialize(e,t){let r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}}static deserialize(e){return new r8(e.buffer)}}let r9={};function r7(e,t,r={}){if(r9[e])throw Error(`${e} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),r9[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(let e in r7("Object",Object),r7("TransferableGridIndex",r8),r7("Color",e6),r7("Error",Error),r7("AJAXError",Y),r7("ResolvedImage",ti),r7("StylePropertyFunction",rb),r7("StyleExpression",rm,{omit:["_evaluator"]}),r7("ZoomDependentExpression",rx),r7("ZoomConstantExpression",r_),r7("CompoundExpression",tM,{omit:["_evaluate"]}),t9)t9[e]._classRegistryKey||r7(`Expression_${e}`,t9[e]);function ie(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function it(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob)return e;if(ie(e)||H(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e))return t&&t.push(e.buffer),e;if(e instanceof ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){let r=[];for(let i of e)r.push(it(i,t));return r}if("object"==typeof e){let r=e.constructor,i=r._classRegistryKey;if(!i)throw Error("can't serialize object of unregistered class");if(!r9[i])throw Error(`${i} is not registered.`);let a=r.serialize?r.serialize(e,t):{};if(r.serialize){if(t&&a===t[t.length-1])throw Error("statically serialized object won't survive transfer of $name property")}else{for(let r in e){if(!e.hasOwnProperty(r)||r9[i].omit.indexOf(r)>=0)continue;let n=e[r];a[r]=r9[i].shallow.indexOf(r)>=0?n:it(n,t)}e instanceof Error&&(a.message=e.message)}if(a.$name)throw Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(a.$name=i),a}throw Error("can't serialize object of type "+typeof e)}function ir(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||ie(e)||H(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(ir);if("object"==typeof e){let t=e.$name||"Object";if(!r9[t])throw Error(`can't deserialize unregistered class ${t}`);let{klass:r}=r9[t];if(!r)throw Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(e);let i=Object.create(r.prototype);for(let r of Object.keys(e)){if("$name"===r)continue;let a=e[r];i[r]=r9[t].shallow.indexOf(r)>=0?a:ir(a)}return i}throw Error("can't deserialize object of type "+typeof e)}class ii{constructor(){this.first=!0}update(e,t){let r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}let ia={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function is(e){for(let t of e)if(io(t.charCodeAt(0)))return!0;return!1}function io(e){return!(746!==e&&747!==e&&(e<4352||!(ia["Bopomofo Extended"](e)||ia.Bopomofo(e)||ia["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ia["CJK Compatibility Ideographs"](e)||ia["CJK Compatibility"](e)||ia["CJK Radicals Supplement"](e)||ia["CJK Strokes"](e)||!(!ia["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||ia["CJK Unified Ideographs Extension A"](e)||ia["CJK Unified Ideographs"](e)||ia["Enclosed CJK Letters and Months"](e)||ia["Hangul Compatibility Jamo"](e)||ia["Hangul Jamo Extended-A"](e)||ia["Hangul Jamo Extended-B"](e)||ia["Hangul Jamo"](e)||ia["Hangul Syllables"](e)||ia.Hiragana(e)||ia["Ideographic Description Characters"](e)||ia.Kanbun(e)||ia["Kangxi Radicals"](e)||ia["Katakana Phonetic Extensions"](e)||ia.Katakana(e)&&12540!==e||!(!ia["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ia["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||ia["Unified Canadian Aboriginal Syllabics"](e)||ia["Unified Canadian Aboriginal Syllabics Extended"](e)||ia["Vertical Forms"](e)||ia["Yijing Hexagram Symbols"](e)||ia["Yi Syllables"](e)||ia["Yi Radicals"](e))))}function il(e){return!(io(e)||ia["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||ia["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||ia["Letterlike Symbols"](e)||ia["Number Forms"](e)||ia["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||ia["Control Pictures"](e)&&9251!==e||ia["Optical Character Recognition"](e)||ia["Enclosed Alphanumerics"](e)||ia["Geometric Shapes"](e)||ia["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ia["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ia["CJK Symbols and Punctuation"](e)||ia.Katakana(e)||ia["Private Use Area"](e)||ia["CJK Compatibility Forms"](e)||ia["Small Form Variants"](e)||ia["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}function iu(e){return e>=1424&&e<=2303||ia["Arabic Presentation Forms-A"](e)||ia["Arabic Presentation Forms-B"](e)}let ih="deferred",ic="loading",id="loaded",ip=null,im="unavailable",ig=null,iy=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(im="error"),ip&&ip(e)};function i_(){ix.fire(new eo("pluginStateChange",{pluginStatus:im,pluginURL:ig}))}let ix=new eu,iv=function(){return im},ib=function(){if(im!==ih||!ig)throw Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");im=ic,i_(),ig&&ei({url:ig},e=>{e?iy(e):(im=id,i_())})},iw={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>im===id||null!=iw.applyArabicShaping,isLoading:()=>im===ic,setState(e){if(!Z())throw Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");im=e.pluginStatus,ig=e.pluginURL},isParsed(){if(!Z())throw Error("rtl-text-plugin is only parsed on the worker-threads");return null!=iw.applyArabicShaping&&null!=iw.processBidirectionalText&&null!=iw.processStyledBidirectionalText},getPluginURL(){if(!Z())throw Error("rtl-text-plugin url can only be queried from the worker threads");return ig}};class iS{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ii,this.transition={})}isSupportedScript(e){return function(e,t){for(let i of e){var r;if(r=i.charCodeAt(0),!t&&iu(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ia.Khmer(r))return!1}return!0}(e,iw.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}}}class ik{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(rl(e))return new rb(e,t);if(rg(e)){let r=rv(e,t);if("error"===r.result)throw Error(r.value.map(e=>`${e.key}: ${e.message}`).join(", "));return r.value}{let r=e;return"color"===t.type&&"string"==typeof e?r=e6.parse(e):"padding"===t.type&&("number"==typeof e||Array.isArray(e))?r=te.parse(e):"variableAnchorOffsetCollection"===t.type&&Array.isArray(e)&&(r=tr.parse(e)),{kind:"constant",evaluate:()=>r}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class iT{constructor(e){this.property=e,this.value=new ik(e,void 0)}transitioned(e,t){return new iC(this.property,this.value,t,B({},e.transition,this.transition),e.now)}untransitioned(){return new iC(this.property,this.value,null,{},0)}}class iI{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return $(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new iT(this._values[e].property)),this._values[e].value=new ik(this._values[e].property,null===t?void 0:$(t))}getTransition(e){return $(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new iT(this._values[e].property)),this._values[e].transition=$(t)||void 0}serialize(){let e={};for(let t of Object.keys(this._values)){let r=this.getValue(t);void 0!==r&&(e[t]=r);let i=this.getTransition(t);void 0!==i&&(e[`${t}-transition`]=i)}return e}transitioned(e,t){let r=new iP(this._properties);for(let i of Object.keys(this._values))r._values[i]=this._values[i].transitioned(e,t._values[i]);return r}untransitioned(){let e=new iP(this._properties);for(let t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class iC{constructor(e,t,r,i,a){this.property=e,this.value=t,this.begin=a+i.delay||0,this.end=this.begin+i.duration||0,e.specification.transition&&(i.delay||i.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){let i=e.now||0,a=this.value.possiblyEvaluate(e,t,r),n=this.prior;if(n){if(i>this.end||this.value.isDataDriven())return this.prior=null,a;if(i<this.begin)return n.possiblyEvaluate(e,t,r);{let s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(n.possiblyEvaluate(e,t,r),a,function(e){if(e<=0)return 0;if(e>=1)return 1;let t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}(s))}}return a}}class iP{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){let i=new iA(this._properties);for(let a of Object.keys(this._values))i._values[a]=this._values[a].possiblyEvaluate(e,t,r);return i}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class iE{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return void 0!==this._values[e].value}getValue(e){return $(this._values[e].value)}setValue(e,t){this._values[e]=new ik(this._values[e].property,null===t?void 0:$(t))}serialize(){let e={};for(let t of Object.keys(this._values)){let r=this.getValue(t);void 0!==r&&(e[t]=r)}return e}possiblyEvaluate(e,t,r){let i=new iA(this._properties);for(let a of Object.keys(this._values))i._values[a]=this._values[a].possiblyEvaluate(e,t,r);return i}}class iM{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,i){return this.property.evaluate(this.value,this.parameters,e,t,r,i)}}class iA{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class iz{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,r){let i=tO[this.specification.type];return i?i(e,t,r):e}}class iR{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,i){return new iM(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,i)}:e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new iM(this,{kind:"constant",value:void 0},e.parameters);let i=tO[this.specification.type];return i?new iM(this,{kind:"constant",value:i(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,i,a,n){return"constant"===e.kind?e.value:e.evaluate(t,r,i,a,n)}}class iD extends iR{possiblyEvaluate(e,t,r,i){if(void 0===e.value)return new iM(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){let a=e.expression.evaluate(t,null,{},r,i),n="resolvedImage"===e.property.specification.type&&"string"!=typeof a?a.name:a;return new iM(this,{kind:"constant",value:this._calculate(n,n,n,t)},t)}return"camera"===e.expression.kind?new iM(this,{kind:"constant",value:this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t)},t):new iM(this,e.expression,t)}evaluate(e,t,r,i,a,n){if("source"===e.kind){let s=e.evaluate(t,r,i,a,n);return this._calculate(s,s,s,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},r,i),e.evaluate({zoom:Math.floor(t.zoom)},r,i),e.evaluate({zoom:Math.floor(t.zoom)+1},r,i),t):e.value}_calculate(e,t,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class iL{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,i){if(void 0!==e.value){if("constant"===e.expression.kind){let a=e.expression.evaluate(t,null,{},r,i);return this._calculate(a,a,a,t)}return this._calculate(e.expression.evaluate(new iS(Math.floor(t.zoom-1),t)),e.expression.evaluate(new iS(Math.floor(t.zoom),t)),e.expression.evaluate(new iS(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class iF{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,i){return!!e.expression.evaluate(t,null,{},r,i)}interpolate(){return!1}}class iB{constructor(e){for(let t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){let r=e[t];r.specification.overridable&&this.overridableProperties.push(t);let i=this.defaultPropertyValues[t]=new ik(r,void 0),a=this.defaultTransitionablePropertyValues[t]=new iT(r);this.defaultTransitioningPropertyValues[t]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=i.possiblyEvaluate({})}}}r7("DataDrivenProperty",iR),r7("DataConstantProperty",iz),r7("CrossFadedDataDrivenProperty",iD),r7("CrossFadedProperty",iL),r7("ColorRampProperty",iF);let iO="-transition";class iN extends eu{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new iE(t.layout)),t.paint)){for(let r in this._transitionablePaint=new iI(t.paint),e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(let t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new iA(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r={}){null!=t&&this._validate(r4,`layers.${this.id}.layout.${e}`,e,t,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return e.endsWith(iO)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(null!=t&&this._validate(r5,`layers.${this.id}.paint.${e}`,e,t,r))return!1;if(e.endsWith(iO))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{let r=this._transitionablePaint._values[e],i="cross-faded-data-driven"===r.property.specification["property-type"],a=r.value.isDataDriven(),n=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);let s=this._transitionablePaint._values[e].value;return s.isDataDriven()||a||i||this._handleOverridablePaintPropertyUpdate(e,n,s)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){let e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),V(e,(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}_validate(e,t,r,i,a={}){return(!a||!1!==a.validate)&&r6(this,e.call(rQ,{key:t,layerType:this.type,objectKey:r,value:i,styleSpec:eh,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let e in this.paint._values){let t=this.paint.get(e);if(t instanceof iM&&ra(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}let iV={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class i${constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ij{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function iU(e,t=1){let r=0,i=0;return{members:e.map(e=>{let a=iV[e.type].BYTES_PER_ELEMENT,n=r=iq(r,Math.max(t,a)),s=e.components||1;return i=Math.max(i,a),r+=a*s,{name:e.name,type:e.type,components:s,offset:n}}),size:iq(r,Math.max(i,t)),alignment:t}}function iq(e,t){return Math.ceil(e/t)*t}class iZ extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){let r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){let i=2*e;return this.int16[i+0]=t,this.int16[i+1]=r,e}}iZ.prototype.bytesPerElement=4,r7("StructArrayLayout2i4",iZ);class iG extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){let i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){let a=3*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=i,e}}iG.prototype.bytesPerElement=6,r7("StructArrayLayout3i6",iG);class iH extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i){let a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,i)}emplace(e,t,r,i,a){let n=4*e;return this.int16[n+0]=t,this.int16[n+1]=r,this.int16[n+2]=i,this.int16[n+3]=a,e}}iH.prototype.bytesPerElement=8,r7("StructArrayLayout4i8",iH);class iW extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,a,n){let s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,i,a,n)}emplace(e,t,r,i,a,n,s){let o=6*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=i,this.int16[o+3]=a,this.int16[o+4]=n,this.int16[o+5]=s,e}}iW.prototype.bytesPerElement=12,r7("StructArrayLayout2i4i12",iW);class iX extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,a,n){let s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,i,a,n)}emplace(e,t,r,i,a,n,s){let o=4*e,l=8*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.uint8[l+4]=i,this.uint8[l+5]=a,this.uint8[l+6]=n,this.uint8[l+7]=s,e}}iX.prototype.bytesPerElement=8,r7("StructArrayLayout2i4ub8",iX);class iK extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){let r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){let i=2*e;return this.float32[i+0]=t,this.float32[i+1]=r,e}}iK.prototype.bytesPerElement=8,r7("StructArrayLayout2f8",iK);class iJ extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,a,n,s,o,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,t,r,i,a,n,s,o,l,u)}emplace(e,t,r,i,a,n,s,o,l,u,h){let c=10*e;return this.uint16[c+0]=t,this.uint16[c+1]=r,this.uint16[c+2]=i,this.uint16[c+3]=a,this.uint16[c+4]=n,this.uint16[c+5]=s,this.uint16[c+6]=o,this.uint16[c+7]=l,this.uint16[c+8]=u,this.uint16[c+9]=h,e}}iJ.prototype.bytesPerElement=20,r7("StructArrayLayout10ui20",iJ);class iY extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,a,n,s,o,l,u,h,c){let d=this.length;return this.resize(d+1),this.emplace(d,e,t,r,i,a,n,s,o,l,u,h,c)}emplace(e,t,r,i,a,n,s,o,l,u,h,c,d){let p=12*e;return this.int16[p+0]=t,this.int16[p+1]=r,this.int16[p+2]=i,this.int16[p+3]=a,this.uint16[p+4]=n,this.uint16[p+5]=s,this.uint16[p+6]=o,this.uint16[p+7]=l,this.int16[p+8]=u,this.int16[p+9]=h,this.int16[p+10]=c,this.int16[p+11]=d,e}}iY.prototype.bytesPerElement=24,r7("StructArrayLayout4i4ui4i24",iY);class iQ extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){let i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){let a=3*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=i,e}}iQ.prototype.bytesPerElement=12,r7("StructArrayLayout3f12",iQ);class i0 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}i0.prototype.bytesPerElement=4,r7("StructArrayLayout1ul4",i0);class i1 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,a,n,s,o,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,t,r,i,a,n,s,o,l)}emplace(e,t,r,i,a,n,s,o,l,u){let h=10*e;return this.int16[h+0]=t,this.int16[h+1]=r,this.int16[h+2]=i,this.int16[h+3]=a,this.int16[h+4]=n,this.int16[h+5]=s,this.uint32[5*e+3]=o,this.uint16[h+8]=l,this.uint16[h+9]=u,e}}i1.prototype.bytesPerElement=20,r7("StructArrayLayout6i1ul2ui20",i1);class i2 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,a,n){let s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,i,a,n)}emplace(e,t,r,i,a,n,s){let o=6*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=i,this.int16[o+3]=a,this.int16[o+4]=n,this.int16[o+5]=s,e}}i2.prototype.bytesPerElement=12,r7("StructArrayLayout2i2i2i12",i2);class i3 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,a){let n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i,a)}emplace(e,t,r,i,a,n){let s=4*e,o=8*e;return this.float32[s+0]=t,this.float32[s+1]=r,this.float32[s+2]=i,this.int16[o+6]=a,this.int16[o+7]=n,e}}i3.prototype.bytesPerElement=16,r7("StructArrayLayout2f1f2i16",i3);class i5 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i){let a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,i)}emplace(e,t,r,i,a){let n=12*e,s=3*e;return this.uint8[n+0]=t,this.uint8[n+1]=r,this.float32[s+1]=i,this.float32[s+2]=a,e}}i5.prototype.bytesPerElement=12,r7("StructArrayLayout2ub2f12",i5);class i4 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){let i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){let a=3*e;return this.uint16[a+0]=t,this.uint16[a+1]=r,this.uint16[a+2]=i,e}}i4.prototype.bytesPerElement=6,r7("StructArrayLayout3ui6",i4);class i6 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g)}emplace(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g,y){let _=24*e,x=12*e,v=48*e;return this.int16[_+0]=t,this.int16[_+1]=r,this.uint16[_+2]=i,this.uint16[_+3]=a,this.uint32[x+2]=n,this.uint32[x+3]=s,this.uint32[x+4]=o,this.uint16[_+10]=l,this.uint16[_+11]=u,this.uint16[_+12]=h,this.float32[x+7]=c,this.float32[x+8]=d,this.uint8[v+36]=p,this.uint8[v+37]=f,this.uint8[v+38]=m,this.uint32[x+10]=g,this.int16[_+22]=y,e}}i6.prototype.bytesPerElement=48,r7("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",i6);class i8 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g,y,_,x,v,b,w,S,k,T,I,C){let P=this.length;return this.resize(P+1),this.emplace(P,e,t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g,y,_,x,v,b,w,S,k,T,I,C)}emplace(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g,y,_,x,v,b,w,S,k,T,I,C,P){let E=32*e,M=16*e;return this.int16[E+0]=t,this.int16[E+1]=r,this.int16[E+2]=i,this.int16[E+3]=a,this.int16[E+4]=n,this.int16[E+5]=s,this.int16[E+6]=o,this.int16[E+7]=l,this.uint16[E+8]=u,this.uint16[E+9]=h,this.uint16[E+10]=c,this.uint16[E+11]=d,this.uint16[E+12]=p,this.uint16[E+13]=f,this.uint16[E+14]=m,this.uint16[E+15]=g,this.uint16[E+16]=y,this.uint16[E+17]=_,this.uint16[E+18]=x,this.uint16[E+19]=v,this.uint16[E+20]=b,this.uint16[E+21]=w,this.uint16[E+22]=S,this.uint32[M+12]=k,this.float32[M+13]=T,this.float32[M+14]=I,this.uint16[E+30]=C,this.uint16[E+31]=P,e}}i8.prototype.bytesPerElement=64,r7("StructArrayLayout8i15ui1ul2f2ui64",i8);class i9 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}i9.prototype.bytesPerElement=4,r7("StructArrayLayout1f4",i9);class i7 extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){let i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){let a=3*e;return this.uint16[6*e+0]=t,this.float32[a+1]=r,this.float32[a+2]=i,e}}i7.prototype.bytesPerElement=12,r7("StructArrayLayout1ui2f12",i7);class ae extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){let i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){let a=4*e;return this.uint32[2*e+0]=t,this.uint16[a+2]=r,this.uint16[a+3]=i,e}}ae.prototype.bytesPerElement=8,r7("StructArrayLayout1ul2ui8",ae);class at extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){let r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){let i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,e}}at.prototype.bytesPerElement=4,r7("StructArrayLayout2ui4",at);class ar extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ar.prototype.bytesPerElement=2,r7("StructArrayLayout1ui2",ar);class ai extends ij{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i){let a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,i)}emplace(e,t,r,i,a){let n=4*e;return this.float32[n+0]=t,this.float32[n+1]=r,this.float32[n+2]=i,this.float32[n+3]=a,e}}ai.prototype.bytesPerElement=16,r7("StructArrayLayout4f16",ai);class aa extends i${get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}aa.prototype.size=20;class an extends i1{get(e){return new aa(this,e)}}r7("CollisionBoxArray",an);class as extends i${get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}as.prototype.size=48;class ao extends i6{get(e){return new as(this,e)}}r7("PlacedSymbolArray",ao);class al extends i${get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}al.prototype.size=64;class au extends i8{get(e){return new al(this,e)}}r7("SymbolInstanceArray",au);class ah extends i9{getoffsetX(e){return this.float32[1*e+0]}}r7("GlyphOffsetArray",ah);class ac extends iG{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}r7("SymbolLineVertexArray",ac);class ad extends i${get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ad.prototype.size=12;class ap extends i7{get(e){return new ad(this,e)}}r7("TextAnchorOffsetArray",ap);class af extends i${get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}af.prototype.size=8;class am extends ae{get(e){return new af(this,e)}}r7("FeatureIndexArray",am);class ag extends iZ{}class ay extends iZ{}class a_ extends iZ{}class ax extends iW{}class av extends iX{}class ab extends iK{}class aw extends iJ{}class aS extends iY{}class ak extends iQ{}class aT extends i0{}class aI extends i2{}class aC extends i5{}class aP extends i4{}class aE extends at{}let{members:aM}=iU([{name:"a_pos",components:2,type:"Int16"}],4);class aA{constructor(e=[]){this.segments=e}prepareSegment(e,t,r,i){let a=this.segments[this.segments.length-1];return e>aA.MAX_VERTEX_ARRAY_LENGTH&&U(`Max vertices per segment is ${aA.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!a||a.vertexLength+e>aA.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==i)&&(a={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==i&&(a.sortKey=i),this.segments.push(a)),a}get(){return this.segments}destroy(){for(let e of this.segments)for(let t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,i){return new aA([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:i,vaos:{},sortKey:0}])}}function az(e,t){return 256*(e=L(Math.floor(e),0,255))+L(Math.floor(t),0,255)}aA.MAX_VERTEX_ARRAY_LENGTH=65535,r7("SegmentVector",aA);let aR=iU([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var aD={exports:{}},aL={exports:{}};aL.exports=function(e,t){var r,i,a,n,s,o;for(i=e.length-(r=3&e.length),a=t,o=0;o<i;)s=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24,++o,a=27492+(65535&(n=5*(65535&(a=(a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(n>>>16)&65535)<<16);switch(s=0,r){case 3:s^=(255&e.charCodeAt(o+2))<<16;case 2:s^=(255&e.charCodeAt(o+1))<<8;case 1:a^=s=(65535&(s=(s=(65535&(s^=255&e.charCodeAt(o)))*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295}return a^=e.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0};var aF=aL.exports,aB={exports:{}};aB.exports=function(e,t){for(var r,i=e.length,a=t^i,n=0;i>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))+((1540483477*(r>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),i-=4,++n;switch(i){case 3:a^=(255&e.charCodeAt(n+2))<<16;case 2:a^=(255&e.charCodeAt(n+1))<<8;case 1:a=1540483477*(65535&(a^=255&e.charCodeAt(n)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0};var aO=aB.exports;aD.exports=aF,aD.exports.murmur3=aF,aD.exports.murmur2=aO;var aN=w(aD.exports);class aV{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,r,i){this.ids.push(a$(e)),this.positions.push(t,r,i)}getPositions(e){if(!this.indexed)throw Error("Trying to get index, but feature positions are not indexed");let t=a$(e),r=0,i=this.ids.length-1;for(;r<i;){let e=r+i>>1;this.ids[e]>=t?i=e:r=e+1}let a=[];for(;this.ids[r]===t;)a.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return a}static serialize(e,t){let r=new Float64Array(e.ids),i=new Uint32Array(e.positions);return function e(t,r,i,a){for(;i<a;){let n=t[i+a>>1],s=i-1,o=a+1;for(;;){do s++;while(t[s]<n);do o--;while(t[o]>n);if(s>=o)break;aj(t,s,o),aj(r,3*s,3*o),aj(r,3*s+1,3*o+1),aj(r,3*s+2,3*o+2)}o-i<a-o?(e(t,r,i,o),i=o+1):(e(t,r,o+1,a),a=o)}}(r,i,0,r.length-1),t&&t.push(r.buffer,i.buffer),{ids:r,positions:i}}static deserialize(e){let t=new aV;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function a$(e){let t=+e;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:aN(String(e))}function aj(e,t,r){let i=e[t];e[t]=e[r],e[r]=i}r7("FeaturePositionMap",aV);class aU{constructor(e,t){this.gl=e.gl,this.location=t}}class aq extends aU{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class aZ extends aU{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class aG extends aU{constructor(e,t){super(e,t),this.current=e6.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}let aH=new Float32Array(16);function aW(e){return[az(255*e.r,255*e.g),az(255*e.b,255*e.a)]}class aX{constructor(e,t,r){this.value=e,this.uniformNames=t.map(e=>`u_${e}`),this.type=r}setUniform(e,t,r){e.set(r.constantOr(this.value))}getBinding(e,t,r){return"color"===this.type?new aG(e,t):new aq(e,t)}}class aK{constructor(e,t){this.uniformNames=t.map(e=>`u_${e}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,r,i){let a="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;a&&e.set(a)}getBinding(e,t,r){return"u_pattern"===r.substr(0,9)?new aZ(e,t):new aq(e,t)}}class aJ{constructor(e,t,r,i){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(e,t,r,i,a){let n=this.paintVertexArray.length,s=this.expression.evaluate(new iS(0),t,{},i,[],a);this.paintVertexArray.resize(e),this._setPaintValue(n,e,s)}updatePaintArray(e,t,r,i){let a=this.expression.evaluate({zoom:0},r,i);this._setPaintValue(e,t,a)}_setPaintValue(e,t,r){if("color"===this.type){let i=aW(r);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aY{constructor(e,t,r,i,a,n){this.expression=e,this.uniformNames=t.map(e=>`u_${e}_t`),this.type=r,this.useIntegerZoom=i,this.zoom=a,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new n}populatePaintArray(e,t,r,i,a){let n=this.expression.evaluate(new iS(this.zoom),t,{},i,[],a),s=this.expression.evaluate(new iS(this.zoom+1),t,{},i,[],a),o=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(o,e,n,s)}updatePaintArray(e,t,r,i){let a=this.expression.evaluate({zoom:this.zoom},r,i),n=this.expression.evaluate({zoom:this.zoom+1},r,i);this._setPaintValue(e,t,a,n)}_setPaintValue(e,t,r,i){if("color"===this.type){let a=aW(r),n=aW(i);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,a[0],a[1],n[0],n[1])}else{for(let a=e;a<t;a++)this.paintVertexArray.emplace(a,r,i);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){let r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,i=L(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(i)}getBinding(e,t,r){return new aq(e,t)}}class aQ{constructor(e,t,r,i,a,n){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=i,this.layerId=n,this.zoomInPaintVertexArray=new a,this.zoomOutPaintVertexArray=new a}populatePaintArray(e,t,r){let i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,i,a){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],a)}_setPaintValues(e,t,r,i){if(!i||!r)return;let{min:a,mid:n,max:s}=r,o=i[a],l=i[n],u=i[s];if(o&&l&&u)for(let r=e;r<t;r++)this.zoomInPaintVertexArray.emplace(r,l.tl[0],l.tl[1],l.br[0],l.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],l.pixelRatio,o.pixelRatio),this.zoomOutPaintVertexArray.emplace(r,l.tl[0],l.tl[1],l.br[0],l.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],l.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,aR.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,aR.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class a0{constructor(e,t,r){this.binders={},this._buffers=[];let i=[];for(let n in e.paint._values){var a;if(!r(n))continue;let s=e.paint.get(n);if(!(s instanceof iM&&ra(s.property.specification)))continue;let o=(a=e.type,({"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]})[n]||[n.replace(`${a}-`,"").replace(/-/g,"_")]),l=s.value,u=s.property.specification.type,h=s.property.useIntegerZoom,c=s.property.specification["property-type"],d="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===l.kind)this.binders[n]=d?new aK(l.value,o):new aX(l.value,o,u),i.push(`/u_${n}`);else if("source"===l.kind||d){let r=a2(n,u,"source");this.binders[n]=d?new aQ(l,u,h,t,r,e.id):new aJ(l,o,u,r),i.push(`/a_${n}`)}else{let e=a2(n,u,"composite");this.binders[n]=new aY(l,o,u,h,t,e),i.push(`/z_${n}`)}}this.cacheKey=i.sort().join("")}getMaxValue(e){let t=this.binders[e];return t instanceof aJ||t instanceof aY?t.maxValue:0}populatePaintArrays(e,t,r,i,a){for(let n in this.binders){let s=this.binders[n];(s instanceof aJ||s instanceof aY||s instanceof aQ)&&s.populatePaintArray(e,t,r,i,a)}}setConstantPatternPositions(e,t){for(let r in this.binders){let i=this.binders[r];i instanceof aK&&i.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,r,i,a){let n=!1;for(let s in e)for(let o of t.getPositions(s)){let t=r.feature(o.index);for(let r in this.binders){let l=this.binders[r];if((l instanceof aJ||l instanceof aY||l instanceof aQ)&&!0===l.expression.isStateDependent){let u=i.paint.get(r);l.expression=u.value,l.updatePaintArray(o.start,o.end,t,e[s],a),n=!0}}}return n}defines(){let e=[];for(let t in this.binders){let r=this.binders[t];(r instanceof aX||r instanceof aK)&&e.push(...r.uniformNames.map(e=>`#define HAS_UNIFORM_${e}`))}return e}getBinderAttributes(){let e=[];for(let t in this.binders){let r=this.binders[t];if(r instanceof aJ||r instanceof aY)for(let t=0;t<r.paintVertexAttributes.length;t++)e.push(r.paintVertexAttributes[t].name);else if(r instanceof aQ)for(let t=0;t<aR.members.length;t++)e.push(aR.members[t].name)}return e}getBinderUniforms(){let e=[];for(let t in this.binders){let r=this.binders[t];if(r instanceof aX||r instanceof aK||r instanceof aY)for(let t of r.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){let r=[];for(let i in this.binders){let a=this.binders[i];if(a instanceof aX||a instanceof aK||a instanceof aY){for(let n of a.uniformNames)if(t[n]){let s=a.getBinding(e,t[n],n);r.push({name:n,property:i,binding:s})}}}return r}setUniforms(e,t,r,i){for(let{name:e,property:a,binding:n}of t)this.binders[a].setUniform(n,i,r.get(a),e)}updatePaintBuffers(e){for(let t in this._buffers=[],this.binders){let r=this.binders[t];if(e&&r instanceof aQ){let t=2===e.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(r instanceof aJ||r instanceof aY)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(let t in this.binders){let r=this.binders[t];(r instanceof aJ||r instanceof aY||r instanceof aQ)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let t=this.binders[e];(t instanceof aJ||t instanceof aY||t instanceof aQ)&&t.destroy()}}}class a1{constructor(e,t,r=()=>!0){for(let i of(this.programConfigurations={},e))this.programConfigurations[i.id]=new a0(i,t,r);this.needsUpload=!1,this._featureMap=new aV,this._bufferOffset=0}populatePaintArrays(e,t,r,i,a,n){for(let r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(e,t,i,a,n);void 0!==t.id&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,i){for(let a of r)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(e,this._featureMap,t,a,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}function a2(e,t,r){let i={"line-pattern":{source:aw,composite:aw},"fill-pattern":{source:aw,composite:aw},"fill-extrusion-pattern":{source:aw,composite:aw}}[e];return i&&i[r]||({color:{source:iK,composite:ai},number:{source:i9,composite:iK}})[t][r]}r7("ConstantBinder",aX),r7("CrossFadedConstantBinder",aK),r7("SourceExpressionBinder",aJ),r7("CrossFadedCompositeBinder",aQ),r7("CompositeExpressionBinder",aY),r7("ProgramConfiguration",a0,{omit:["_buffers"]}),r7("ProgramConfigurationSet",a1);let a3=-16383-1;function a5(e){let t=8192/e.extent,r=e.loadGeometry();for(let e=0;e<r.length;e++){let i=r[e];for(let e=0;e<i.length;e++){let r=i[e],a=Math.round(r.x*t),n=Math.round(r.y*t);r.x=L(a,a3,16383),r.y=L(n,a3,16383),(a<r.x||a>r.x+1||n<r.y||n>r.y+1)&&U("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function a4(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?a5(e):[]}}function a6(e,t,r,i,a){e.emplaceBack(2*t+(i+1)/2,2*r+(a+1)/2)}class a8{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ay,this.indexArray=new aP,this.segments=new aA,this.programConfigurations=new a1(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){let i=this.layers[0],a=[],n=null,s=!1;for(let{feature:t,id:o,index:l,sourceLayerIndex:u}of("circle"===i.type&&(s=!(n=i.layout.get("circle-sort-key")).isConstant()),e)){let e=this.layers[0]._featureFilter.needGeometry,i=a4(t,e);if(!this.layers[0]._featureFilter.filter(new iS(this.zoom),i,r))continue;let h=s?n.evaluate(i,{},r):void 0,c={id:o,properties:t.properties,type:t.type,sourceLayerIndex:u,index:l,geometry:e?i.geometry:a5(t),patterns:{},sortKey:h};a.push(c)}for(let i of(s&&a.sort((e,t)=>e.sortKey-t.sortKey),a)){let{geometry:a,index:n,sourceLayerIndex:s}=i,o=e[n].feature;this.addFeature(i,a,n,r),t.featureIndex.insert(o,a,n,s,this.index)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,aM),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,i){for(let r of t)for(let t of r){let r=t.x,i=t.y;if(r<0||r>=8192||i<0||i>=8192)continue;let a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),n=a.vertexLength;a6(this.layoutVertexArray,r,i,-1,-1),a6(this.layoutVertexArray,r,i,1,-1),a6(this.layoutVertexArray,r,i,1,1),a6(this.layoutVertexArray,r,i,-1,1),this.indexArray.emplaceBack(n,n+1,n+2),this.indexArray.emplaceBack(n,n+3,n+2),a.vertexLength+=4,a.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},i)}}function a9(e,t){for(let r=0;r<e.length;r++)if(na(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(na(e,t[r]))return!0;return!!ne(e,t)}function a7(e,t){if(1===e.length)return ni(t,e[0]);for(let r=0;r<t.length;r++){let i=t[r];for(let t=0;t<i.length;t++)if(na(e,i[t]))return!0}for(let r=0;r<e.length;r++)if(ni(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(ne(e,t[r]))return!0;return!1}function ne(e,t){if(0===e.length||0===t.length)return!1;for(let a=0;a<e.length-1;a++){let n=e[a],s=e[a+1];for(let e=0;e<t.length-1;e++){var r,i;if(q(n,r=t[e],i=t[e+1])!==q(s,r,i)&&q(n,s,r)!==q(n,s,i))return!0}}return!1}function nt(e,t,r){let i=r*r;if(1===t.length)return e.distSqr(t[0])<i;for(let r=1;r<t.length;r++)if(nr(e,t[r-1],t[r])<i)return!0;return!1}function nr(e,t,r){let i=t.distSqr(r);if(0===i)return e.distSqr(t);let a=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/i;return e.distSqr(a<0?t:a>1?r:r.sub(t)._mult(a)._add(t))}function ni(e,t){let r,i,a,n=!1;for(let s=0;s<e.length;s++){r=e[s];for(let e=0,s=r.length-1;e<r.length;s=e++)i=r[e],a=r[s],i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(n=!n)}return n}function na(e,t){let r=!1;for(let i=0,a=e.length-1;i<e.length;a=i++){let n=e[i],s=e[a];n.y>t.y!=s.y>t.y&&t.x<(s.x-n.x)*(t.y-n.y)/(s.y-n.y)+n.x&&(r=!r)}return r}function nn(e,t,r){let i=t.paint.get(e).value;return"constant"===i.kind?i.value:r.programConfigurations.get(t.id).getMaxValue(e)}function ns(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function no(e,t,r,i,a){if(!t[0]&&!t[1])return e;let n=P.convert(t)._mult(a);"viewport"===r&&n._rotate(-i);let s=[];for(let t=0;t<e.length;t++)s.push(e[t].sub(n));return s}r7("CircleBucket",a8,{omit:["layers"]});var nl={get paint(){return l=l||new iB({"circle-radius":new iR(eh.paint_circle["circle-radius"]),"circle-color":new iR(eh.paint_circle["circle-color"]),"circle-blur":new iR(eh.paint_circle["circle-blur"]),"circle-opacity":new iR(eh.paint_circle["circle-opacity"]),"circle-translate":new iz(eh.paint_circle["circle-translate"]),"circle-translate-anchor":new iz(eh.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new iz(eh.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new iz(eh.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new iR(eh.paint_circle["circle-stroke-width"]),"circle-stroke-color":new iR(eh.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new iR(eh.paint_circle["circle-stroke-opacity"])})},get layout(){return o=o||new iB({"circle-sort-key":new iR(eh.layout_circle["circle-sort-key"])})}},nu="undefined"!=typeof Float32Array?Float32Array:Array;function nh(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function nc(e,t,r){var i=t[0],a=t[1],n=t[2],s=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15],x=r[0],v=r[1],b=r[2],w=r[3];return e[0]=x*i+v*o+b*c+w*m,e[1]=x*a+v*l+b*d+w*g,e[2]=x*n+v*u+b*p+w*y,e[3]=x*s+v*h+b*f+w*_,e[4]=(x=r[4])*i+(v=r[5])*o+(b=r[6])*c+(w=r[7])*m,e[5]=x*a+v*l+b*d+w*g,e[6]=x*n+v*u+b*p+w*y,e[7]=x*s+v*h+b*f+w*_,e[8]=(x=r[8])*i+(v=r[9])*o+(b=r[10])*c+(w=r[11])*m,e[9]=x*a+v*l+b*d+w*g,e[10]=x*n+v*u+b*p+w*y,e[11]=x*s+v*h+b*f+w*_,e[12]=(x=r[12])*i+(v=r[13])*o+(b=r[14])*c+(w=r[15])*m,e[13]=x*a+v*l+b*d+w*g,e[14]=x*n+v*u+b*p+w*y,e[15]=x*s+v*h+b*f+w*_,e}function nd(e,t,r){var i=t[0],a=t[1],n=t[2],s=t[3];return e[0]=r[0]*i+r[4]*a+r[8]*n+r[12]*s,e[1]=r[1]*i+r[5]*a+r[9]*n+r[13]*s,e[2]=r[2]*i+r[6]*a+r[10]*n+r[14]*s,e[3]=r[3]*i+r[7]*a+r[11]*n+r[15]*s,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),C=new nu(4),nu!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0,C[3]=0);class np extends iN{constructor(e){super(e,nl)}createBucket(e){return new a8(e)}queryRadius(e){return nn("circle-radius",this,e)+nn("circle-stroke-width",this,e)+ns(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,i,a,n,s,o){var l;let u=no(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),n.angle,s),h=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r),c="map"===this.paint.get("circle-pitch-alignment"),d=c?u:u.map(e=>nf(e,o)),p=c?h*s:h;for(let e of i)for(let t of e){let e=c?t:nf(t,o),r=p,i=nd([],[t.x,t.y,0,1],o);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?r*=i[3]/n.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(r*=n.cameraToCenterDistance/i[3]),l=r,na(d,e)||nt(e,d,l))return!0}return!1}}function nf(e,t){let r=nd([],[e.x,e.y,0,1],t);return new P(r[0]/r[3],r[1]/r[3])}class nm extends a8{}r7("HeatmapBucket",nm,{omit:["layers"]});var ng={get paint(){return u=u||new iB({"heatmap-radius":new iR(eh.paint_heatmap["heatmap-radius"]),"heatmap-weight":new iR(eh.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new iz(eh.paint_heatmap["heatmap-intensity"]),"heatmap-color":new iF(eh.paint_heatmap["heatmap-color"]),"heatmap-opacity":new iz(eh.paint_heatmap["heatmap-opacity"])})}};function ny(e,{width:t,height:r},i,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==t*r*i)throw RangeError(`mismatched image size. expected: ${a.length} but got: ${t*r*i}`)}else a=new Uint8Array(t*r*i);return e.width=t,e.height=r,e.data=a,e}function n_(e,{width:t,height:r},i){if(t===e.width&&r===e.height)return;let a=ny({},{width:t,height:r},i);nx(e,a,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,r)},i),e.width=t,e.height=r,e.data=a.data}function nx(e,t,r,i,a,n){if(0===a.width||0===a.height)return t;if(a.width>e.width||a.height>e.height||r.x>e.width-a.width||r.y>e.height-a.height)throw RangeError("out of range source coordinates for image copy");if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw RangeError("out of range destination coordinates for image copy");let s=e.data,o=t.data;if(s===o)throw Error("srcData equals dstData, so image is already copied");for(let l=0;l<a.height;l++){let u=((r.y+l)*e.width+r.x)*n,h=((i.y+l)*t.width+i.x)*n;for(let e=0;e<a.width*n;e++)o[h+e]=s[u+e]}return t}class nv{constructor(e,t){ny(this,e,1,t)}resize(e){n_(this,e,1)}clone(){return new nv({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,i,a){nx(e,t,r,i,a,1)}}class nb{constructor(e,t){ny(this,e,4,t)}resize(e){n_(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new nb({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,i,a){nx(e,t,r,i,a,4)}}function nw(e){let t={},r=e.resolution||256,i=e.clips?e.clips.length:1,a=e.image||new nb({width:r,height:i});if(Math.log(r)/Math.LN2%1!=0)throw Error(`width is not a power of 2 - ${r}`);let n=(r,i,n)=>{t[e.evaluationKey]=n;let s=e.expression.evaluate(t);a.data[r+i+0]=Math.floor(255*s.r/s.a),a.data[r+i+1]=Math.floor(255*s.g/s.a),a.data[r+i+2]=Math.floor(255*s.b/s.a),a.data[r+i+3]=Math.floor(255*s.a)};if(e.clips)for(let t=0,a=0;t<i;++t,a+=4*r)for(let i=0,s=0;i<r;i++,s+=4){let o=i/(r-1),{start:l,end:u}=e.clips[t];n(a,s,l*(1-o)+u*o)}else for(let e=0,t=0;e<r;e++,t+=4)n(0,t,e/(r-1));return a}r7("AlphaImage",nv),r7("RGBAImage",nb);class nS extends iN{createBucket(e){return new nm(e)}constructor(e){super(e,ng),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=nw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}var nk={get paint(){return h=h||new iB({"hillshade-illumination-direction":new iz(eh.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new iz(eh.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new iz(eh.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new iz(eh.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new iz(eh.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new iz(eh.paint_hillshade["hillshade-accent-color"])})}};class nT extends iN{constructor(e){super(e,nk)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}let{members:nI}=iU([{name:"a_pos",components:2,type:"Int16"}],4);var nC={exports:{}};function nP(e,t,r){r=r||2;var i,a,n,s,o,l,u,h=t&&t.length,c=h?t[0]*r:e.length,d=nE(e,0,c,r,!0),p=[];if(!d||d.next===d.prev)return p;if(h&&(d=function(e,t,r,i){var a,n,s,o=[];for(a=0,n=t.length;a<n;a++)(s=nE(e,t[a]*i,a<n-1?t[a+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),o.push(function(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}(s));for(o.sort(nA),a=0;a<o.length;a++)r=function(e,t){var r=function(e,t){var r,i,a,n=t,s=e.x,o=e.y,l=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var u=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=s&&u>l&&(l=u,a=n.x<n.next.x?n:n.next,u===s))return a}n=n.next}while(n!==t);if(!a)return null;var h,c=a,d=a.x,p=a.y,f=1/0;n=a;do s>=n.x&&n.x>=d&&s!==n.x&&nR(o<p?s:l,o,d,p,o<p?l:s,o,n.x,n.y)&&(h=Math.abs(o-n.y)/(s-n.x),nN(n,e)&&(h<f||h===f&&(n.x>a.x||n.x===a.x&&(r=a,i=n,0>nD(r.prev,r,i.prev)&&0>nD(i.next,r,r.next))))&&(a=n,f=h)),n=n.next;while(n!==c);return a}(e,t);if(!r)return t;var i=nV(r,e);return nM(i,i.next),nM(r,r.next)}(o[a],r);return r}(e,t,d,r)),e.length>80*r){i=n=e[0],a=s=e[1];for(var f=r;f<c;f+=r)(o=e[f])<i&&(i=o),(l=e[f+1])<a&&(a=l),o>n&&(n=o),l>s&&(s=l);u=0!==(u=Math.max(n-i,s-a))?32767/u:0}return function e(t,r,i,a,n,s,o){if(t){!o&&s&&function(e,t,r,i){var a=e;do 0===a.z&&(a.z=nz(a.x,a.y,t,r,i)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function(e){var t,r,i,a,n,s,o,l,u=1;do{for(r=e,e=null,n=null,s=0;r;){for(s++,i=r,o=0,t=0;t<u&&(o++,i=i.nextZ);t++);for(l=u;o>0||l>0&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(a=r,r=r.nextZ,o--):(a=i,i=i.nextZ,l--),n?n.nextZ=a:e=a,a.prevZ=n,n=a;r=i}n.nextZ=null,u*=2}while(s>1)}(a)}(t,a,n,s);for(var l,u,h=t;t.prev!==t.next;)if(l=t.prev,u=t.next,s?function(e,t,r,i){var a=e.prev,n=e.next;if(nD(a,e,n)>=0)return!1;for(var s=a.x,o=e.x,l=n.x,u=a.y,h=e.y,c=n.y,d=s<o?s<l?s:l:o<l?o:l,p=u<h?u<c?u:c:h<c?h:c,f=s>o?s>l?s:l:o>l?o:l,m=u>h?u>c?u:c:h>c?h:c,g=nz(d,p,t,r,i),y=nz(f,m,t,r,i),_=e.prevZ,x=e.nextZ;_&&_.z>=g&&x&&x.z<=y;){if(_.x>=d&&_.x<=f&&_.y>=p&&_.y<=m&&_!==a&&_!==n&&nR(s,u,o,h,l,c,_.x,_.y)&&nD(_.prev,_,_.next)>=0||(_=_.prevZ,x.x>=d&&x.x<=f&&x.y>=p&&x.y<=m&&x!==a&&x!==n&&nR(s,u,o,h,l,c,x.x,x.y)&&nD(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;_&&_.z>=g;){if(_.x>=d&&_.x<=f&&_.y>=p&&_.y<=m&&_!==a&&_!==n&&nR(s,u,o,h,l,c,_.x,_.y)&&nD(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=y;){if(x.x>=d&&x.x<=f&&x.y>=p&&x.y<=m&&x!==a&&x!==n&&nR(s,u,o,h,l,c,x.x,x.y)&&nD(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}(t,a,n,s):function(e){var t=e.prev,r=e.next;if(nD(t,e,r)>=0)return!1;for(var i=t.x,a=e.x,n=r.x,s=t.y,o=e.y,l=r.y,u=i<a?i<n?i:n:a<n?a:n,h=s<o?s<l?s:l:o<l?o:l,c=i>a?i>n?i:n:a>n?a:n,d=s>o?s>l?s:l:o>l?o:l,p=r.next;p!==t;){if(p.x>=u&&p.x<=c&&p.y>=h&&p.y<=d&&nR(i,s,a,o,n,l,p.x,p.y)&&nD(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}(t))r.push(l.i/i|0),r.push(t.i/i|0),r.push(u.i/i|0),nj(t),t=u.next,h=u.next;else if((t=u)===h){o?1===o?e(t=function(e,t,r){var i=e;do{var a=i.prev,n=i.next.next;!nL(a,n)&&nF(a,i,i.next,n)&&nN(a,n)&&nN(n,a)&&(t.push(a.i/r|0),t.push(i.i/r|0),t.push(n.i/r|0),nj(i),nj(i.next),i=e=n),i=i.next}while(i!==e);return nM(i)}(nM(t),r,i),r,i,a,n,s,2):2===o&&function(t,r,i,a,n,s){var o=t;do{for(var l,u,h=o.next.next;h!==o.prev;){if(o.i!==h.i&&(l=o,u=h,l.next.i!==u.i&&l.prev.i!==u.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&nF(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(l,u)&&(nN(l,u)&&nN(u,l)&&function(e,t){var r=e,i=!1,a=(e.x+t.x)/2,n=(e.y+t.y)/2;do r.y>n!=r.next.y>n&&r.next.y!==r.y&&a<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e);return i}(l,u)&&(nD(l.prev,l,u.prev)||nD(l,u.prev,u))||nL(l,u)&&nD(l.prev,l,l.next)>0&&nD(u.prev,u,u.next)>0))){var c=nV(o,h);return o=nM(o,o.next),c=nM(c,c.next),e(o,r,i,a,n,s,0),void e(c,r,i,a,n,s,0)}h=h.next}o=o.next}while(o!==t)}(t,r,i,a,n,s):e(nM(t),r,i,a,n,s,1);break}}}(d,p,r,i,a,u,0),p}function nE(e,t,r,i,a){var n,s;if(a===nq(e,t,r,i)>0)for(n=t;n<r;n+=i)s=n$(n,e[n],e[n+1],s);else for(n=r-i;n>=t;n-=i)s=n$(n,e[n],e[n+1],s);return s&&nL(s,s.next)&&(nj(s),s=s.next),s}function nM(e,t){if(!e)return e;t||(t=e);var r,i=e;do if(r=!1,i.steiner||!nL(i,i.next)&&0!==nD(i.prev,i,i.next))i=i.next;else{if(nj(i),(i=t=i.prev)===i.next)break;r=!0}while(r||i!==t);return t}function nA(e,t){return e.x-t.x}function nz(e,t,r,i,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function nR(e,t,r,i,a,n,s,o){return(a-s)*(t-o)>=(e-s)*(n-o)&&(e-s)*(i-o)>=(r-s)*(t-o)&&(r-s)*(n-o)>=(a-s)*(i-o)}function nD(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function nL(e,t){return e.x===t.x&&e.y===t.y}function nF(e,t,r,i){var a=nO(nD(e,t,r)),n=nO(nD(e,t,i)),s=nO(nD(r,i,e)),o=nO(nD(r,i,t));return a!==n&&s!==o||!(0!==a||!nB(e,r,t))||!(0!==n||!nB(e,i,t))||!(0!==s||!nB(r,e,i))||!(0!==o||!nB(r,t,i))}function nB(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function nO(e){return e>0?1:e<0?-1:0}function nN(e,t){return 0>nD(e.prev,e,e.next)?nD(e,t,e.next)>=0&&nD(e,e.prev,t)>=0:0>nD(e,t,e.prev)||0>nD(e,e.next,t)}function nV(e,t){var r=new nU(e.i,e.x,e.y),i=new nU(t.i,t.x,t.y),a=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function n$(e,t,r,i){var a=new nU(e,t,r);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}function nj(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function nU(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nq(e,t,r,i){for(var a=0,n=t,s=r-i;n<r;n+=i)a+=(e[s]-e[n])*(e[n+1]+e[s+1]),s=n;return a}nC.exports=nP,nC.exports.default=nP,nP.deviation=function(e,t,r,i){var a=t&&t.length,n=Math.abs(nq(e,0,a?t[0]*r:e.length,r));if(a)for(var s=0,o=t.length;s<o;s++)n-=Math.abs(nq(e,t[s]*r,s<o-1?t[s+1]*r:e.length,r));var l=0;for(s=0;s<i.length;s+=3){var u=i[s]*r,h=i[s+1]*r,c=i[s+2]*r;l+=Math.abs((e[u]-e[c])*(e[h+1]-e[u+1])-(e[u]-e[h])*(e[c+1]-e[u+1]))}return 0===n&&0===l?0:Math.abs((l-n)/n)},nP.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,a=0;a<e.length;a++){for(var n=0;n<e[a].length;n++)for(var s=0;s<t;s++)r.vertices.push(e[a][n][s]);a>0&&r.holes.push(i+=e[a-1].length)}return r};var nZ=w(nC.exports);function nG(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function nH(e,t){return e<t?-1:e>t?1:0}function nW(e,t){let r,i;let a=e.length;if(a<=1)return[e];let n=[];for(let t=0;t<a;t++){let a=function(e){let t=0;for(let r,i,a=0,n=e.length,s=n-1;a<n;s=a++)r=e[a],t+=((i=e[s]).x-r.x)*(r.y+i.y);return t}(e[t]);0!==a&&(e[t].area=Math.abs(a),void 0===i&&(i=a<0),i===a<0?(r&&n.push(r),r=[e[t]]):r.push(e[t]))}if(r&&n.push(r),t>1)for(let e=0;e<n.length;e++){var s;n[e].length<=t||(function e(t,r,i,a,n){for(;a>i;){if(a-i>600){var s=a-i+1,o=r-i+1,l=Math.log(s),u=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*u*(s-u)/s)*(o-s/2<0?-1:1);e(t,r,Math.max(i,Math.floor(r-o*u/s+h)),Math.min(a,Math.floor(r+(s-o)*u/s+h)),n)}var c=t[r],d=i,p=a;for(nG(t,i,r),n(t[a],c)>0&&nG(t,i,a);d<p;){for(nG(t,d,p),d++,p--;0>n(t[d],c);)d++;for(;n(t[p],c)>0;)p--}0===n(t[i],c)?nG(t,i,p):nG(t,++p,a),p<=r&&(i=p+1),r<=p&&(a=p-1)}}(s=n[e],t,1,n[e].length-1||s.length-1,nX||nH),n[e]=n[e].slice(0,t))}return n}function nX(e,t){return t.area-e.area}function nK(e,t,r){let i=r.patternDependencies,a=!1;for(let r of t){let t=r.paint.get(`${e}-pattern`);t.isConstant()||(a=!0);let n=t.constantOr(null);n&&(a=!0,i[n.to]=!0,i[n.from]=!0)}return a}function nJ(e,t,r,i,a){let n=a.patternDependencies;for(let s of t){let t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i-1},r,{},a.availableImages),o=t.evaluate({zoom:i},r,{},a.availableImages),l=t.evaluate({zoom:i+1},r,{},a.availableImages);e=e&&e.name?e.name:e,o=o&&o.name?o.name:o,l=l&&l.name?l.name:l,n[e]=!0,n[o]=!0,n[l]=!0,r.patterns[s.id]={min:e,mid:o,max:l}}}return r}class nY{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new a_,this.indexArray=new aP,this.indexArray2=new aE,this.programConfigurations=new a1(e.layers,e.zoom),this.segments=new aA,this.segments2=new aA,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){this.hasPattern=nK("fill",this.layers,t);let i=this.layers[0].layout.get("fill-sort-key"),a=!i.isConstant(),n=[];for(let{feature:s,id:o,index:l,sourceLayerIndex:u}of e){let e=this.layers[0]._featureFilter.needGeometry,h=a4(s,e);if(!this.layers[0]._featureFilter.filter(new iS(this.zoom),h,r))continue;let c=a?i.evaluate(h,{},r,t.availableImages):void 0,d={id:o,properties:s.properties,type:s.type,sourceLayerIndex:u,index:l,geometry:e?h.geometry:a5(s),patterns:{},sortKey:c};n.push(d)}for(let i of(a&&n.sort((e,t)=>e.sortKey-t.sortKey),n)){let{geometry:a,index:n,sourceLayerIndex:s}=i;if(this.hasPattern){let e=nJ("fill",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,a,n,r,{});t.featureIndex.insert(e[n].feature,a,n,s,this.index)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}addFeatures(e,t,r){for(let e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nI),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,r,i,a){for(let e of nW(t,500)){let t=0;for(let r of e)t+=r.length;let r=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),i=r.vertexLength,a=[],n=[];for(let t of e){if(0===t.length)continue;t!==e[0]&&n.push(a.length/2);let r=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),i=r.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(i+t.length-1,i),a.push(t[0].x),a.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(i+e-1,i+e),a.push(t[e].x),a.push(t[e].y);r.vertexLength+=t.length,r.primitiveLength+=t.length}let s=nZ(a,n);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(i+s[e],i+s[e+1],i+s[e+2]);r.vertexLength+=t,r.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,a,i)}}r7("FillBucket",nY,{omit:["layers","patternFeatures"]});var nQ={get paint(){return d=d||new iB({"fill-antialias":new iz(eh.paint_fill["fill-antialias"]),"fill-opacity":new iR(eh.paint_fill["fill-opacity"]),"fill-color":new iR(eh.paint_fill["fill-color"]),"fill-outline-color":new iR(eh.paint_fill["fill-outline-color"]),"fill-translate":new iz(eh.paint_fill["fill-translate"]),"fill-translate-anchor":new iz(eh.paint_fill["fill-translate-anchor"]),"fill-pattern":new iD(eh.paint_fill["fill-pattern"])})},get layout(){return c=c||new iB({"fill-sort-key":new iR(eh.layout_fill["fill-sort-key"])})}};class n0 extends iN{constructor(e){super(e,nQ)}recalculate(e,t){super.recalculate(e,t);let r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new nY(e)}queryRadius(){return ns(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,i,a,n,s){return a7(no(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),n.angle,s),i)}isTileClipped(){return!0}}let n1=iU([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),n2=iU([{name:"a_centroid",components:2,type:"Int16"}],4),{members:n3}=n1;var n5={};function n4(e,t,r,i,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=a,e.readFields(n6,this,t)}function n6(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var i=t._keys[e.readVarint()],a=t._values[e.readVarint()];t.properties[i]=a}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function n8(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(n9,this,t),this.length=this._features.length}function n9(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(r))}function n7(e,t,r){if(3===e){var i=new n8(r,r.readVarint()+r.pos);i.length&&(t[i.name]=i)}}n4.types=["Unknown","Point","LineString","Polygon"],n4.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,a=0,n=0,s=0,o=[];e.pos<r;){if(a<=0){var l=e.readVarint();i=7&l,a=l>>3}if(a--,1===i||2===i)n+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&o.push(t),t=[]),t.push(new S(n,s));else{if(7!==i)throw Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&o.push(t),o},n4.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,a=0,n=0,s=1/0,o=-1/0,l=1/0,u=-1/0;e.pos<t;){if(i<=0){var h=e.readVarint();r=7&h,i=h>>3}if(i--,1===r||2===r)(a+=e.readSVarint())<s&&(s=a),a>o&&(o=a),(n+=e.readSVarint())<l&&(l=n),n>u&&(u=n);else if(7!==r)throw Error("unknown command "+r)}return[s,l,o,u]},n4.prototype.toGeoJSON=function(e,t,r){var i,a,n=this.extent*Math.pow(2,r),s=this.extent*e,o=this.extent*t,l=this.loadGeometry(),u=n4.types[this.type];function h(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+s)/n-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+o)/n)*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(i=0;i<l.length;i++)c[i]=l[i][0];h(l=c);break;case 2:for(i=0;i<l.length;i++)h(l[i]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var r,i,a=[],n=0;n<t;n++){var s=function(e){for(var t,r,i=0,a=0,n=e.length,s=n-1;a<n;s=a++)i+=((r=e[s]).x-(t=e[a]).x)*(t.y+r.y);return i}(e[n]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(r&&a.push(r),r=[e[n]]):r.push(e[n]))}return r&&a.push(r),a}(l),i=0;i<l.length;i++)for(a=0;a<l[i].length;a++)h(l[i][a])}1===l.length?l=l[0]:u="Multi"+u;var d={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d},n8.prototype.feature=function(e){if(e<0||e>=this._features.length)throw Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new n4(this._pbf,t,this.extent,this._keys,this._values)},n5.VectorTile=function(e,t){this.layers=e.readFields(n7,{},t)},n5.VectorTileFeature=n4,n5.VectorTileLayer=n8;let se=n5.VectorTileFeature.types;function st(e,t,r,i,a,n,s,o){e.emplaceBack(t,r,2*Math.floor(8192*i)+s,16384*a,16384*n,Math.round(o))}class sr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ax,this.centroidVertexArray=new ag,this.indexArray=new aP,this.programConfigurations=new a1(e.layers,e.zoom),this.segments=new aA,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){for(let{feature:i,id:a,index:n,sourceLayerIndex:s}of(this.features=[],this.hasPattern=nK("fill-extrusion",this.layers,t),e)){let e=this.layers[0]._featureFilter.needGeometry,o=a4(i,e);if(!this.layers[0]._featureFilter.filter(new iS(this.zoom),o,r))continue;let l={id:a,sourceLayerIndex:s,index:n,geometry:e?o.geometry:a5(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(nJ("fill-extrusion",this.layers,l,this.zoom,t)):this.addFeature(l,l.geometry,n,r,{}),t.featureIndex.insert(i,l.geometry,n,s,this.index,!0)}}addFeatures(e,t,r){for(let e of this.features){let{geometry:i}=e;this.addFeature(e,i,e.index,t,r)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,n3),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,n2.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,t,r,i,a){let n={x:0,y:0,vertexCount:0};for(let r of nW(t,500)){let t=0;for(let e of r)t+=e.length;let i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let e of r){var s;if(0===e.length||(s=e).every(e=>e.x<0)||s.every(e=>e.x>8192)||s.every(e=>e.y<0)||s.every(e=>e.y>8192))continue;let t=0;for(let r=0;r<e.length;r++){let a=e[r];if(r>=1){let s=e[r-1];if((a.x!==s.x||!(a.x<0)&&!(a.x>8192))&&(a.y!==s.y||!(a.y<0)&&!(a.y>8192))){i.vertexLength+4>aA.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let e=a.sub(s)._perp()._unit(),r=s.dist(a);t+r>32768&&(t=0),st(this.layoutVertexArray,a.x,a.y,e.x,e.y,0,0,t),st(this.layoutVertexArray,a.x,a.y,e.x,e.y,0,1,t),n.x+=2*a.x,n.y+=2*a.y,n.vertexCount+=2,t+=r,st(this.layoutVertexArray,s.x,s.y,e.x,e.y,0,0,t),st(this.layoutVertexArray,s.x,s.y,e.x,e.y,0,1,t),n.x+=2*s.x,n.y+=2*s.y,n.vertexCount+=2;let o=i.vertexLength;this.indexArray.emplaceBack(o,o+2,o+1),this.indexArray.emplaceBack(o+1,o+2,o+3),i.vertexLength+=4,i.primitiveLength+=2}}}}if(i.vertexLength+t>aA.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),"Polygon"!==se[e.type])continue;let a=[],o=[],l=i.vertexLength;for(let e of r)if(0!==e.length){e!==r[0]&&o.push(a.length/2);for(let t=0;t<e.length;t++){let r=e[t];st(this.layoutVertexArray,r.x,r.y,0,0,1,1,0),n.x+=r.x,n.y+=r.y,n.vertexCount+=1,a.push(r.x),a.push(r.y)}}let u=nZ(a,o);for(let e=0;e<u.length;e+=3)this.indexArray.emplaceBack(l+u[e],l+u[e+2],l+u[e+1]);i.primitiveLength+=u.length/3,i.vertexLength+=t}for(let e=0;e<n.vertexCount;e++)this.centroidVertexArray.emplaceBack(Math.floor(n.x/n.vertexCount),Math.floor(n.y/n.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,a,i)}}r7("FillExtrusionBucket",sr,{omit:["layers","features"]});var si={get paint(){return p=p||new iB({"fill-extrusion-opacity":new iz(eh["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new iR(eh["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new iz(eh["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new iz(eh["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new iD(eh["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new iR(eh["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new iR(eh["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new iz(eh["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class sa extends iN{constructor(e){super(e,si)}createBucket(e){return new sr(e)}queryRadius(){return ns(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,t,r,i,a,n,s,o){let l=no(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),n.angle,s),u=this.paint.get("fill-extrusion-height").evaluate(t,r),h=this.paint.get("fill-extrusion-base").evaluate(t,r),c=function(e,t,r,i){let a=[];for(let r of e){let e=[r.x,r.y,0,1];nd(e,e,t),a.push(new P(e[0]/e[3],e[1]/e[3]))}return a}(l,o),d=function(e,t,r,i){let a=[],n=[],s=i[8]*t,o=i[9]*t,l=i[10]*t,u=i[11]*t,h=i[8]*r,c=i[9]*r,d=i[10]*r,p=i[11]*r;for(let t of e){let e=[],r=[];for(let a of t){let t=a.x,n=a.y,f=i[0]*t+i[4]*n+i[12],m=i[1]*t+i[5]*n+i[13],g=i[2]*t+i[6]*n+i[14],y=i[3]*t+i[7]*n+i[15],_=g+l,x=y+u,v=f+h,b=m+c,w=g+d,S=y+p,k=new P((f+s)/x,(m+o)/x);k.z=_/x,e.push(k);let T=new P(v/S,b/S);T.z=w/S,r.push(T)}a.push(e),n.push(r)}return[a,n]}(i,h,u,o);return function(e,t,r){let i=1/0;a7(r,t)&&(i=ss(r,t[0]));for(let a=0;a<t.length;a++){let n=t[a],s=e[a];for(let e=0;e<n.length-1;e++){let t=n[e],a=[t,n[e+1],s[e+1],s[e],t];a9(r,a)&&(i=Math.min(i,ss(r,a)))}}return i!==1/0&&i}(d[0],d[1],c)}}function sn(e,t){return e.x*t.x+e.y*t.y}function ss(e,t){if(1===e.length){let r,i=0,a=t[i++];for(;!r||a.equals(r);)if(!(r=t[i++]))return 1/0;for(;i<t.length;i++){let n=t[i],s=e[0],o=r.sub(a),l=n.sub(a),u=s.sub(a),h=sn(o,o),c=sn(o,l),d=sn(l,l),p=sn(u,o),f=sn(u,l),m=h*d-c*c,g=(d*p-c*f)/m,y=(h*f-c*p)/m,_=a.z*(1-g-y)+r.z*g+n.z*y;if(isFinite(_))return _}return 1/0}{let e=1/0;for(let r of t)e=Math.min(e,r.z);return e}}let{members:so}=iU([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:sl}=iU([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),su=n5.VectorTileFeature.types,sh=Math.cos(Math.PI/180*37.5);class sc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new av,this.layoutVertexArray2=new ab,this.indexArray=new aP,this.programConfigurations=new a1(e.layers,e.zoom),this.segments=new aA,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r){this.hasPattern=nK("line",this.layers,t);let i=this.layers[0].layout.get("line-sort-key"),a=!i.isConstant(),n=[];for(let{feature:t,id:s,index:o,sourceLayerIndex:l}of e){let e=this.layers[0]._featureFilter.needGeometry,u=a4(t,e);if(!this.layers[0]._featureFilter.filter(new iS(this.zoom),u,r))continue;let h=a?i.evaluate(u,{},r):void 0,c={id:s,properties:t.properties,type:t.type,sourceLayerIndex:l,index:o,geometry:e?u.geometry:a5(t),patterns:{},sortKey:h};n.push(c)}for(let i of(a&&n.sort((e,t)=>e.sortKey-t.sortKey),n)){let{geometry:a,index:n,sourceLayerIndex:s}=i;if(this.hasPattern){let e=nJ("line",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,a,n,r,{});t.featureIndex.insert(e[n].feature,a,n,s,this.index)}}update(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)}addFeatures(e,t,r){for(let e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,sl)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,so),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,i,a){let n=this.layers[0].layout,s=n.get("line-join").evaluate(e,{}),o=n.get("line-cap"),l=n.get("line-miter-limit"),u=n.get("line-round-limit");for(let r of(this.lineClips=this.lineFeatureClips(e),t))this.addLine(r,e,s,o,l,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,a,i)}addLine(e,t,r,i,a,n){let s,o,l,u,h;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let c="Polygon"===su[t.type],d=e.length;for(;d>=2&&e[d-1].equals(e[d-2]);)d--;let p=0;for(;p<d-1&&e[p].equals(e[p+1]);)p++;if(d<(c?3:2))return;"bevel"===r&&(a=1.05);let f=this.overscaling<=16?122880/(512*this.overscaling):0,m=this.segments.prepareSegment(10*d,this.layoutVertexArray,this.indexArray);this.e1=this.e2=-1,c&&(s=e[d-2],h=e[p].sub(s)._unit()._perp());for(let t=p;t<d;t++){if((l=t===d-1?c?e[p+1]:void 0:e[t+1])&&e[t].equals(l))continue;h&&(u=h),s&&(o=s),s=e[t],h=l?l.sub(s)._unit()._perp():u;let g=(u=u||h).add(h);0===g.x&&0===g.y||g._unit();let y=u.x*h.x+u.y*h.y,_=g.x*h.x+g.y*h.y,x=0!==_?1/_:1/0,v=2*Math.sqrt(2-2*_),b=_<sh&&o&&l,w=u.x*h.y-u.y*h.x>0;if(b&&t>p){let e=s.dist(o);if(e>2*f){let t=s.sub(s.sub(o)._mult(f/e)._round());this.updateDistance(o,t),this.addCurrentVertex(t,u,0,0,m),o=t}}let S=o&&l,k=S?r:c?"butt":i;if(S&&"round"===k&&(x<n?k="miter":x<=2&&(k="fakeround")),"miter"===k&&x>a&&(k="bevel"),"bevel"===k&&(x>2&&(k="flipbevel"),x<a&&(k="miter")),o&&this.updateDistance(o,s),"miter"===k)g._mult(x),this.addCurrentVertex(s,g,0,0,m);else if("flipbevel"===k){if(x>100)g=h.mult(-1);else{let e=x*u.add(h).mag()/u.sub(h).mag();g._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(s,g,0,0,m),this.addCurrentVertex(s,g.mult(-1),0,0,m)}else if("bevel"===k||"fakeround"===k){let e=-Math.sqrt(x*x-1),t=w?e:0,r=w?0:e;if(o&&this.addCurrentVertex(s,u,t,r,m),"fakeround"===k){let e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let r=t/e;if(.5!==r){let e=r-.5;r+=r*e*(r-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*e*e+(.848013+y*(.215638*y-1.06021)))}let i=h.sub(u)._mult(r)._add(u)._unit()._mult(w?-1:1);this.addHalfVertex(s,i.x,i.y,!1,w,0,m)}}l&&this.addCurrentVertex(s,h,-t,-r,m)}else if("butt"===k)this.addCurrentVertex(s,g,0,0,m);else if("square"===k){let e=o?1:-1;this.addCurrentVertex(s,g,e,e,m)}else"round"===k&&(o&&(this.addCurrentVertex(s,u,0,0,m),this.addCurrentVertex(s,u,1,1,m,!0)),l&&(this.addCurrentVertex(s,h,-1,-1,m,!0),this.addCurrentVertex(s,h,0,0,m)));if(b&&t<d-1){let e=s.dist(l);if(e>2*f){let t=s.add(l.sub(s)._mult(f/e)._round());this.updateDistance(s,t),this.addCurrentVertex(t,h,0,0,m),s=t}}}}addCurrentVertex(e,t,r,i,a,n=!1){let s=t.y*i-t.x,o=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,n,!1,r,a),this.addHalfVertex(e,s,o,n,!0,-i,a),this.distance>16384&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,r,i,a,n))}addHalfVertex({x:e,y:t},r,i,a,n,s,o){let l=.5*(this.lineClips?32767*this.scaledDistance:this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(a?1:0),(t<<1)+(n?1:0),Math.round(63*r)+128,Math.round(63*i)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),o.primitiveLength++),n?this.e2=u:this.e1=u}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}r7("LineBucket",sc,{omit:["layers","patternFeatures"]});var sd={get paint(){return m=m||new iB({"line-opacity":new iR(eh.paint_line["line-opacity"]),"line-color":new iR(eh.paint_line["line-color"]),"line-translate":new iz(eh.paint_line["line-translate"]),"line-translate-anchor":new iz(eh.paint_line["line-translate-anchor"]),"line-width":new iR(eh.paint_line["line-width"]),"line-gap-width":new iR(eh.paint_line["line-gap-width"]),"line-offset":new iR(eh.paint_line["line-offset"]),"line-blur":new iR(eh.paint_line["line-blur"]),"line-dasharray":new iL(eh.paint_line["line-dasharray"]),"line-pattern":new iD(eh.paint_line["line-pattern"]),"line-gradient":new iF(eh.paint_line["line-gradient"])})},get layout(){return f=f||new iB({"line-cap":new iz(eh.layout_line["line-cap"]),"line-join":new iR(eh.layout_line["line-join"]),"line-miter-limit":new iz(eh.layout_line["line-miter-limit"]),"line-round-limit":new iz(eh.layout_line["line-round-limit"]),"line-sort-key":new iR(eh.layout_line["line-sort-key"])})}};class sp extends iR{possiblyEvaluate(e,t){return t=new iS(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,i){return t=B({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,i)}}class sf extends iN{constructor(e){super(e,sd),this.gradientVersion=0,g||((g=new sp(sd.paint.properties["line-width"].specification)).useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){let e=this.gradientExpression();this.stepInterpolant=void 0!==e._styleExpression&&e._styleExpression.expression instanceof tF,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=g.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new sc(e)}queryRadius(e){var t,r;return t=nn("line-width",this,e),((r=nn("line-gap-width",this,e))>0?r+2*t:t)/2+Math.abs(nn("line-offset",this,e))+ns(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,i,a,n,s){var o,l;let u=no(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),n.angle,s),h=s/2*(o=this.paint.get("line-width").evaluate(t,r),(l=this.paint.get("line-gap-width").evaluate(t,r))>0?l+2*o:o),c=this.paint.get("line-offset").evaluate(t,r);return c&&(i=function(e,t){let r=[];for(let i=0;i<e.length;i++){let a=e[i],n=[];for(let e=0;e<a.length;e++){let r=a[e-1],i=a[e],s=a[e+1],o=0===e?new P(0,0):i.sub(r)._unit()._perp(),l=e===a.length-1?new P(0,0):s.sub(i)._unit()._perp(),u=o._add(l)._unit(),h=u.x*l.x+u.y*l.y;0!==h&&u._mult(1/h),n.push(u._mult(t)._add(i))}r.push(n)}return r}(i,c*s)),function(e,t,r){for(let i=0;i<t.length;i++){let a=t[i];if(e.length>=3){for(let t=0;t<a.length;t++)if(na(e,a[t]))return!0}if(function(e,t,r){if(e.length>1){if(ne(e,t))return!0;for(let i=0;i<t.length;i++)if(nt(t[i],e,r))return!0}for(let i=0;i<e.length;i++)if(nt(e[i],t,r))return!0;return!1}(e,a,r))return!0}return!1}(u,i,h)}isTileClipped(){return!0}}let sm=iU([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sg=iU([{name:"a_projected_pos",components:3,type:"Float32"}],4);iU([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let sy=iU([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);iU([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let s_=iU([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sx=iU([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);iU([{name:"triangle",components:3,type:"Uint16"}]),iU([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),iU([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),iU([{type:"Float32",name:"offsetX"}]),iU([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),iU([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let sv={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","\xa2":"￠","\xa3":"￡","\xa5":"￥","\xa6":"￤","\xac":"￢","\xaf":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var sb=function(e,t,r,i,a){var n,s,o=8*a-i-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?a-1:0,d=r?-1:1,p=e[t+c];for(c+=d,n=p&(1<<-h)-1,p>>=-h,h+=o;h>0;n=256*n+e[t+c],c+=d,h-=8);for(s=n&(1<<-h)-1,n>>=-h,h+=i;h>0;s=256*s+e[t+c],c+=d,h-=8);if(0===n)n=1-u;else{if(n===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),n-=u}return(p?-1:1)*s*Math.pow(2,n-i)},sw=function(e,t,r,i,a,n){var s,o,l,u=8*n-a-1,h=(1<<u)-1,c=h>>1,d=23===a?5960464477539062e-23:0,p=i?0:n-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(o=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+c>=1?d/l:d*Math.pow(2,1-c))*l>=2&&(s++,l/=2),s+c>=h?(o=0,s=h):s+c>=1?(o=(t*l-1)*Math.pow(2,a),s+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,a),s=0));a>=8;e[r+p]=255&o,p+=f,o/=256,a-=8);for(s=s<<a|o,u+=a;u>0;e[r+p]=255&s,p+=f,s/=256,u-=8);e[r+p-f]|=128*m};function sS(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}sS.Varint=0,sS.Fixed64=1,sS.Bytes=2,sS.Fixed32=5;var sk="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function sT(e){return e.type===sS.Bytes?e.readVarint()+e.pos:e.pos+1}function sI(e,t,r){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(i);for(var a=r.pos-1;a>=e;a--)r.buf[a+i]=r.buf[a]}function sC(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function sP(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function sE(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function sM(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function sA(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function sz(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function sR(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function sD(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function sL(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function sF(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function sB(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function sO(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}sS.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),a=i>>3,n=this.pos;this.type=7&i,e(a,t,this),this.pos===n&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=sF(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=sO(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=sF(this.buf,this.pos)+4294967296*sF(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=sF(this.buf,this.pos)+4294967296*sO(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=sb(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=sb(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,i=this.buf;return t=127&(r=i[this.pos++]),r<128?t:(t|=(127&(r=i[this.pos++]))<<7,r<128?t:(t|=(127&(r=i[this.pos++]))<<14,r<128?t:(t|=(127&(r=i[this.pos++]))<<21,r<128?t:function(e,t,r){var i,a,n,s=r.buf;if(a=(112&(n=s[r.pos++]))>>4,n<128||(a|=(127&(n=s[r.pos++]))<<3,n<128)||(a|=(127&(n=s[r.pos++]))<<10,n<128)||(a|=(127&(n=s[r.pos++]))<<17,n<128)||(a|=(127&(n=s[r.pos++]))<<24,n<128)||(a|=(1&(n=s[r.pos++]))<<31,n<128))return i=a,t?4294967296*i+(e>>>0):4294967296*(i>>>0)+(e>>>0);throw Error("Expected varint not more than 10 bytes")}(t|=(15&(r=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?-((e+1)/2):e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e,t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=12&&sk?(e=this.buf,sk.decode(e.subarray(r,t))):function(e,t,r){for(var i="",a=t;a<r;){var n,s,o,l=e[a],u=null,h=l>239?4:l>223?3:l>191?2:1;if(a+h>r)break;1===h?l<128&&(u=l):2===h?128==(192&(n=e[a+1]))&&(u=(31&l)<<6|63&n)<=127&&(u=null):3===h?(s=e[a+2],128==(192&(n=e[a+1]))&&128==(192&s)&&((u=(15&l)<<12|(63&n)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===h&&(s=e[a+2],o=e[a+3],128==(192&(n=e[a+1]))&&128==(192&s)&&128==(192&o)&&((u=(15&l)<<18|(63&n)<<12|(63&s)<<6|63&o)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,h=1):u>65535&&(u-=65536,i+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),i+=String.fromCharCode(u),a+=h}return i}(this.buf,r,t)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==sS.Bytes)return e.push(this.readVarint(t));var r=sT(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==sS.Bytes)return e.push(this.readSVarint());var t=sT(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==sS.Bytes)return e.push(this.readBoolean());var t=sT(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==sS.Bytes)return e.push(this.readFloat());var t=sT(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==sS.Bytes)return e.push(this.readDouble());var t=sT(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==sS.Bytes)return e.push(this.readFixed32());var t=sT(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==sS.Bytes)return e.push(this.readSFixed32());var t=sT(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==sS.Bytes)return e.push(this.readFixed64());var t=sT(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==sS.Bytes)return e.push(this.readSFixed64());var t=sT(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===sS.Varint)for(;this.buf[this.pos++]>127;);else if(t===sS.Bytes)this.pos=this.readVarint()+this.pos;else if(t===sS.Fixed32)this.pos+=4;else{if(t!==sS.Fixed64)throw Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),sB(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),sB(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),sB(this.buf,-1&e,this.pos),sB(this.buf,Math.floor(23283064365386963e-26*e),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),sB(this.buf,-1&e,this.pos),sB(this.buf,Math.floor(23283064365386963e-26*e),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,i,a,n,s;if(e>=0?(r=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,i=i+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw Error("Given varint doesn't fit into 10 bytes");t.realloc(10),a=r,t.buf[t.pos++]=127&a|128,a>>>=7,t.buf[t.pos++]=127&a|128,a>>>=7,t.buf[t.pos++]=127&a|128,a>>>=7,t.buf[t.pos++]=127&a|128,t.buf[t.pos]=127&(a>>>=7),s=(7&(n=i))<<4,t.buf[t.pos++]|=s|((n>>>=3)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n)))))}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?-(2*e)-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var i,a,n=0;n<t.length;n++){if((i=t.charCodeAt(n))>55295&&i<57344){if(!a){i>56319||n+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):a=i;continue}if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,a=i;continue}i=a-55296<<10|i-56320|65536,a=null}else a&&(e[r++]=239,e[r++]=191,e[r++]=189,a=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=63&i|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&sI(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),sw(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),sw(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var i=this.pos-r;i>=128&&sI(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,r){this.writeTag(e,sS.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,sC,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,sP,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,sA,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,sE,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,sM,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,sz,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,sR,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,sD,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,sL,t)},writeBytesField:function(e,t){this.writeTag(e,sS.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,sS.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,sS.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,sS.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,sS.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,sS.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,sS.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,sS.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,sS.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,sS.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var sN=w(sS);function sV(e,t,r){1===e&&r.readMessage(s$,t)}function s$(e,t,r){if(3===e){let{id:e,bitmap:i,width:a,height:n,left:s,top:o,advance:l}=r.readMessage(sj,{});t.push({id:e,bitmap:new nv({width:a+6,height:n+6},i),metrics:{width:a,height:n,left:s,top:o,advance:l}})}}function sj(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}function sU(e){let t=0,r=0;for(let i of e)t+=i.w*i.h,r=Math.max(r,i.w);e.sort((e,t)=>t.h-e.h);let i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],a=0,n=0;for(let t of e)for(let e=i.length-1;e>=0;e--){let r=i[e];if(!(t.w>r.w||t.h>r.h)){if(t.x=r.x,t.y=r.y,n=Math.max(n,t.y+t.h),a=Math.max(a,t.x+t.w),t.w===r.w&&t.h===r.h){let t=i.pop();e<i.length&&(i[e]=t)}else t.h===r.h?(r.x+=t.w,r.w-=t.w):(t.w===r.w||i.push({x:r.x+t.w,y:r.y,w:r.w-t.w,h:t.h}),r.y+=t.h,r.h-=t.h);break}}return{w:a,h:n,fill:t/(a*n)||0}}class sq{constructor(e,{pixelRatio:t,version:r,stretchX:i,stretchY:a,content:n}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=a,this.content=n,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class sZ{constructor(e,t){let r={},i={};this.haveRenderCallbacks=[];let a=[];this.addImages(e,r,a),this.addImages(t,i,a);let{w:n,h:s}=sU(a),o=new nb({width:n||1,height:s||1});for(let t in e){let i=e[t],a=r[t].paddedRect;nb.copy(i.data,o,{x:0,y:0},{x:a.x+1,y:a.y+1},i.data)}for(let e in t){let r=t[e],a=i[e].paddedRect,n=a.x+1,s=a.y+1,l=r.data.width,u=r.data.height;nb.copy(r.data,o,{x:0,y:0},{x:n,y:s},r.data),nb.copy(r.data,o,{x:0,y:u-1},{x:n,y:s-1},{width:l,height:1}),nb.copy(r.data,o,{x:0,y:0},{x:n,y:s+u},{width:l,height:1}),nb.copy(r.data,o,{x:l-1,y:0},{x:n-1,y:s},{width:1,height:u}),nb.copy(r.data,o,{x:0,y:0},{x:n+l,y:s},{width:1,height:u})}this.image=o,this.iconPositions=r,this.patternPositions=i}addImages(e,t,r){for(let i in e){let a=e[i],n={x:0,y:0,w:a.data.width+2,h:a.data.height+2};r.push(n),t[i]=new sq(n,a),a.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t){for(let r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)}patchUpdatedImage(e,t,r){if(!e||!t||e.version===t.version)return;e.version=t.version;let[i,a]=e.tl;r.update(t.data,void 0,{x:i,y:a})}}r7("ImagePosition",sq),r7("ImageAtlas",sZ),e.ai=void 0,(k=e.ai||(e.ai={}))[k.none=0]="none",k[k.horizontal=1]="horizontal",k[k.vertical=2]="vertical",k[k.horizontalOnly=3]="horizontalOnly";class sG{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){let r=new sG;return r.scale=e||1,r.fontStack=t,r}static forImage(e){let t=new sG;return t.imageName=e,t}}class sH{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){let r=new sH;for(let i=0;i<e.sections.length;i++){let a=e.sections[i];a.image?r.addImageSection(a):r.addTextSection(a,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let r=0;r<e.length;r++){let i=e.charCodeAt(r+1)||null,a=e.charCodeAt(r-1)||null;t+=i&&il(i)&&!sv[e[r+1]]||a&&il(a)&&!sv[e[r-1]]||!sv[e[r]]?e[r]:sv[e[r]]}return t}(this.text)}trim(){let e=0;for(let t=0;t<this.text.length&&sX[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&sX[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){let r=new sH;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(sG.forText(e.scale,e.fontStack||t));let r=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(r)}addImageSection(e){let t=e.image?e.image.name:"";if(0===t.length)return void U("Can't add FormattedSection with an empty image.");let r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(sG.forImage(t)),this.sectionIndex.push(this.sections.length-1)):U("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sW(t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g){let y;let _=sH.fromFeature(t,n);d===e.ai.vertical&&_.verticalizePunctuation();let{processBidirectionalText:x,processStyledBidirectionalText:v}=iw;if(x&&1===_.sections.length)for(let e of(y=[],x(_.toString(),s0(_,h,s,r,a,f,m)))){let t=new sH;t.text=e,t.sections=_.sections;for(let r=0;r<e.length;r++)t.sectionIndex.push(0);y.push(t)}else if(v)for(let e of(y=[],v(_.text,_.sectionIndex,s0(_,h,s,r,a,f,m)))){let t=new sH;t.text=e[0],t.sectionIndex=e[1],t.sections=_.sections,y.push(t)}else y=function(e,t){let r=[],i=e.text,a=0;for(let i of t)r.push(e.substring(a,i)),a=i;return a<i.length&&r.push(e.substring(a,i.length)),r}(_,s0(_,h,s,r,a,f,m));let b=[],w={positionedLines:b,text:_.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(t,r,i,a,n,s,o,l,u,h,c,d){let p=0,f=-17,m=0,g=0,y="right"===l?1:"left"===l?0:.5,_=0;for(let o of n){o.trim();let n=o.getMaxScale(),l=(n-1)*24,x={positionedGlyphs:[],lineOffset:0};t.positionedLines[_]=x;let v=x.positionedGlyphs,b=0;if(!o.length()){f+=s,++_;continue}for(let s=0;s<o.length();s++){let m=o.getSection(s),g=o.getSectionIndex(s),y=o.getCharCode(s),_=0,x=null,w=null,S=null,k=24,T=!(u===e.ai.horizontal||!c&&!io(y)||c&&(sX[y]||ia.Arabic(y)||ia["Arabic Supplement"](y)||ia["Arabic Extended-A"](y)||ia["Arabic Presentation Forms-A"](y)||ia["Arabic Presentation Forms-B"](y)));if(m.imageName){let e=a[m.imageName];if(!e)continue;S=m.imageName,t.iconsInText=t.iconsInText||!0,w=e.paddedRect;let r=e.displaySize;m.scale=24*m.scale/d,x={width:r[0],height:r[1],left:1,top:-3,advance:T?r[1]:r[0]},_=l+(24-r[1]*m.scale),k=x.advance;let i=T?r[0]*m.scale-24*n:r[1]*m.scale-24*n;i>0&&i>b&&(b=i)}else{let e=i[m.fontStack],t=e&&e[y];if(t&&t.rect)w=t.rect,x=t.metrics;else{let e=r[m.fontStack],t=e&&e[y];if(!t)continue;x=t.metrics}_=(n-m.scale)*24}T?(t.verticalizable=!0,v.push({glyph:y,imageName:S,x:p,y:f+_,vertical:T,scale:m.scale,fontStack:m.fontStack,sectionIndex:g,metrics:x,rect:w}),p+=k*m.scale+h):(v.push({glyph:y,imageName:S,x:p,y:f+_,vertical:T,scale:m.scale,fontStack:m.fontStack,sectionIndex:g,metrics:x,rect:w}),p+=x.advance*m.scale+h)}0!==v.length&&(m=Math.max(p-h,m),function(e,t,r,i,a){if(!i&&!a)return;let n=e[r],s=(e[r].x+n.metrics.advance*n.scale)*i;for(let t=0;t<=r;t++)e[t].x-=s,e[t].y+=a}(v,0,v.length-1,y,b)),p=0;let w=s*n+b;x.lineOffset=Math.max(b,l),f+=w,g=Math.max(w,g),++_}let x=f- -17,{horizontalAlign:v,verticalAlign:b}=s1(o);(function(e,t,r,i,a,n,s,o,l){let u=(t-r)*a,h=0;for(let t of(h=n!==s?-o*i- -17:(-i*l+.5)*s,e))for(let e of t.positionedGlyphs)e.x+=u,e.y+=h})(t.positionedLines,y,v,b,m,g,s,x,n.length),t.top+=-b*x,t.bottom=t.top+x,t.left+=-v*m,t.right=t.left+m}(w,r,i,a,y,o,l,u,d,h,p,g),!function(e){for(let t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b)&&w}let sX={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sK={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function sJ(e,t,r,i,a,n){if(t.imageName){let e=i[t.imageName];return e?e.displaySize[0]*t.scale*24/n+a:0}{let i=r[t.fontStack],n=i&&i[e];return n?n.metrics.advance*t.scale+a:0}}function sY(e,t,r,i){let a=Math.pow(e-t,2);return i?e<t?a/2:2*a:a+Math.abs(r)*r}function sQ(e,t,r,i,a,n){let s=null,o=sY(t,r,a,n);for(let e of i){let i=sY(t-e.x,r,a,n)+e.badness;i<=o&&(s=e,o=i)}return{index:e,x:t,priorBreak:s,badness:o}}function s0(e,t,r,i,a,n,s){if("point"!==n||!e)return[];let o=[],l=function(e,t,r,i,a,n){let s=0;for(let r=0;r<e.length();r++){let o=e.getSection(r);s+=sJ(e.getCharCode(r),o,i,a,t,n)}return s/Math.max(1,Math.ceil(s/r))}(e,t,r,i,a,s),u=e.text.indexOf("​")>=0,h=0;for(let r=0;r<e.length();r++){let n=e.getSection(r),c=e.getCharCode(r);if(sX[c]||(h+=sJ(c,n,i,a,t,s)),r<e.length()-1){let t=!(c<11904||!(ia["Bopomofo Extended"](c)||ia.Bopomofo(c)||ia["CJK Compatibility Forms"](c)||ia["CJK Compatibility Ideographs"](c)||ia["CJK Compatibility"](c)||ia["CJK Radicals Supplement"](c)||ia["CJK Strokes"](c)||ia["CJK Symbols and Punctuation"](c)||ia["CJK Unified Ideographs Extension A"](c)||ia["CJK Unified Ideographs"](c)||ia["Enclosed CJK Letters and Months"](c)||ia["Halfwidth and Fullwidth Forms"](c)||ia.Hiragana(c)||ia["Ideographic Description Characters"](c)||ia["Kangxi Radicals"](c)||ia["Katakana Phonetic Extensions"](c)||ia.Katakana(c)||ia["Vertical Forms"](c)||ia["Yi Radicals"](c)||ia["Yi Syllables"](c)));(sK[c]||t||n.imageName)&&o.push(sQ(r+1,h,l,o,function(e,t,r){let i=0;return 10===e&&(i-=1e4),r&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}(c,e.getCharCode(r+1),t&&u),!1))}}return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(sQ(e.length(),h,l,o,0,!0))}function s1(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function s2(e,t,r,i,a,n){let s,o,l,u,h;let c=e.image;if(c.content){let e=c.content,t=c.pixelRatio||1;s=[e[0]/t,e[1]/t,c.displaySize[0]-e[2]/t,c.displaySize[1]-e[3]/t]}let d=t.left*n,p=t.right*n;"width"===r||"both"===r?(h=a[0]+d-i[3],l=a[0]+p+i[1]):l=(h=a[0]+(d+p-c.displaySize[0])/2)+c.displaySize[0];let f=t.top*n,m=t.bottom*n;return"height"===r||"both"===r?(o=a[1]+f-i[0],u=a[1]+m+i[2]):u=(o=a[1]+(f+m-c.displaySize[1])/2)+c.displaySize[1],{image:c,top:o,right:l,bottom:u,left:h,collisionPadding:s}}function s3(e,t){let{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new iS(e+1))};if("source"===r.kind)return{kind:"source"};{let{zoomStops:t,interpolationType:i}=r,a=0;for(;a<t.length&&t[a]<=e;)a++;let n=a=Math.max(0,a-1);for(;n<t.length&&t[n]<e+1;)n++;n=Math.min(t.length-1,n);let s=t[a],o=t[n];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:o,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:o,minSize:r.evaluate(new iS(s)),maxSize:r.evaluate(new iS(o)),interpolationType:i}}}function s5(e,t,r){let i="never",a=e.get(t);return a?i=a:e.get(r)&&(i="always"),i}let s4=n5.VectorTileFeature.types,s6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function s8(e,t,r,i,a,n,s,o,l,u,h,c,d){let p=o?Math.min(32640,Math.round(o[0])):0,f=o?Math.min(32640,Math.round(o[1])):0;e.emplaceBack(t,r,Math.round(32*i),Math.round(32*a),n,s,(p<<1)+(l?1:0),f,16*u,16*h,256*c,256*d)}function s9(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}class s7{constructor(e){this.layoutVertexArray=new aS,this.indexArray=new aP,this.programConfigurations=e,this.segments=new aA,this.dynamicLayoutVertexArray=new ak,this.opacityVertexArray=new aT,this.hasVisibleVertices=!1,this.placedSymbolArray=new ao}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,r,i){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,sg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,s6,!0),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}r7("SymbolBuffers",s7);class oe{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new aA,this.collisionVertexArray=new aC}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,sy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}r7("CollisionBuffers",oe);class ot{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(e=>e.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=nh([]),this.placementViewportMatrix=nh([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=s3(this.zoom,r["text-size"]),this.iconSizeData=s3(this.zoom,r["icon-size"]);let i=this.layers[0].layout,a=i.get("symbol-sort-key"),n=i.get("symbol-z-order");this.canOverlap="never"!==s5(i,"text-overlap","text-allow-overlap")||"never"!==s5(i,"icon-overlap","icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&!a.isConstant(),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map(t=>e.ai[t])),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=t.sourceID}createArrays(){this.text=new s7(new a1(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new s7(new a1(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ah,this.lineVertexArray=new ac,this.symbolInstances=new au,this.textAnchorOffsets=new ap}calculateGlyphDependencies(e,t,r,i,a){for(let n=0;n<e.length;n++)if(t[e.charCodeAt(n)]=!0,(r||i)&&a){let r=sv[e.charAt(n)];r&&(t[r.charCodeAt(0)]=!0)}}populate(t,r,i){let a=this.layers[0],n=a.layout,s=n.get("text-font"),o=n.get("text-field"),l=n.get("icon-image"),u=("constant"!==o.value.kind||o.value.value instanceof e7&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),h="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,c=n.get("symbol-sort-key");if(this.features=[],!u&&!h)return;let d=r.iconDependencies,p=r.glyphDependencies,f=r.availableImages,m=new iS(this.zoom);for(let{feature:r,id:o,index:l,sourceLayerIndex:g}of t){let t,y;let _=a._featureFilter.needGeometry,x=a4(r,_);if(!a._featureFilter.filter(m,x,i))continue;if(_||(x.geometry=a5(r)),u){let e=a.getValueAndResolveTokens("text-field",x,i,f),r=e7.factory(e);(function(e){for(let t of e.sections)if(function(e){for(let t of e)if(iu(t.charCodeAt(0)))return!0;return!1}(t.text))return!0;return!1})(r)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===iv()||this.hasRTLText&&iw.isParsed())&&(t=function(e,t,r){return e.sections.forEach(e=>{e.text=function(e,t,r){let i=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),iw.applyArabicShaping&&(e=iw.applyArabicShaping(e)),e}(e.text,t,r)}),e}(r,a,x))}if(h){let e=a.getValueAndResolveTokens("icon-image",x,i,f);y=e instanceof ti?e:ti.fromString(e)}if(!t&&!y)continue;let v=this.sortFeaturesByKey?c.evaluate(x,{},i):void 0;if(this.features.push({id:o,text:t,icon:y,index:l,sourceLayerIndex:g,geometry:x.geometry,properties:r.properties,type:s4[r.type],sortKey:v}),y&&(d[y.name]=!0),t){let r=s.evaluate(x,{},i).join(","),a="viewport"!==n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement");for(let i of(this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(e.ai.vertical)>=0,t.sections))if(i.image)d[i.image.name]=!0;else{let e=is(t.toString()),n=i.fontStack||r,s=p[n]=p[n]||{};this.calculateGlyphDependencies(i.text,s,a,this.allowVerticalPlacement,e)}}}"line"===n.get("symbol-placement")&&(this.features=function(e){let t={},r={},i=[],a=0;function n(t){i.push(e[t]),a++}function s(e,t,a){let n=r[e];return delete r[e],r[t]=n,i[n].geometry[0].pop(),i[n].geometry[0]=i[n].geometry[0].concat(a[0]),n}function o(e,r,a){let n=t[r];return delete t[r],t[e]=n,i[n].geometry[0].shift(),i[n].geometry[0]=a[0].concat(i[n].geometry[0]),n}function l(e,t,r){let i=r?t[0][t[0].length-1]:t[0][0];return`${e}:${i.x}:${i.y}`}for(let u=0;u<e.length;u++){let h=e[u],c=h.geometry,d=h.text?h.text.toString():null;if(!d){n(u);continue}let p=l(d,c),f=l(d,c,!0);if(p in r&&f in t&&r[p]!==t[f]){let e=o(p,f,c),a=s(p,f,i[e].geometry);delete t[p],delete r[f],r[l(d,i[a].geometry,!0)]=a,i[e].geometry=null}else p in r?s(p,f,c):f in t?o(p,f,c):(n(u),t[p]=a-1,r[f]=a-1)}return i.filter(e=>e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}update(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){let r=this.lineVertexArray.length;if(void 0!==e.segment){let r=e.dist(t[e.segment+1]),i=e.dist(t[e.segment]),a={};for(let i=e.segment+1;i<t.length;i++)a[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:r},i<t.length-1&&(r+=t[i+1].dist(t[i]));for(let r=e.segment||0;r>=0;r--)a[r]={x:t[r].x,y:t[r].y,tileUnitDistanceFromAnchor:i},r>0&&(i+=t[r-1].dist(t[r]));for(let e=0;e<t.length;e++){let t=a[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(t,r,i,a,n,s,o,l,u,h,c,d){let p=t.indexArray,f=t.layoutVertexArray,m=t.segments.prepareSegment(4*r.length,f,p,this.canOverlap?s.sortKey:void 0),g=this.glyphOffsetArray.length,y=m.vertexLength,_=this.allowVerticalPlacement&&o===e.ai.vertical?Math.PI/2:0,x=s.text&&s.text.sections;for(let e=0;e<r.length;e++){let{tl:a,tr:n,bl:o,br:u,tex:h,pixelOffsetTL:c,pixelOffsetBR:g,minFontScaleX:y,minFontScaleY:v,glyphOffset:b,isSDF:w,sectionIndex:S}=r[e],k=m.vertexLength,T=b[1];s8(f,l.x,l.y,a.x,T+a.y,h.x,h.y,i,w,c.x,c.y,y,v),s8(f,l.x,l.y,n.x,T+n.y,h.x+h.w,h.y,i,w,g.x,c.y,y,v),s8(f,l.x,l.y,o.x,T+o.y,h.x,h.y+h.h,i,w,c.x,g.y,y,v),s8(f,l.x,l.y,u.x,T+u.y,h.x+h.w,h.y+h.h,i,w,g.x,g.y,y,v),s9(t.dynamicLayoutVertexArray,l,_),p.emplaceBack(k,k+1,k+2),p.emplaceBack(k+1,k+2,k+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),e!==r.length-1&&S===r[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,s,s.index,{},d,x&&x[S])}t.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,y,u,h,l.segment,i?i[0]:0,i?i[1]:0,a[0],a[1],o,0,!1,0,c)}_addCollisionDebugVertex(e,t,r,i,a,n){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,i,a,Math.round(n.x),Math.round(n.y))}addCollisionDebugVertices(e,t,r,i,a,n,s){let o=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),l=o.vertexLength,u=a.layoutVertexArray,h=a.collisionVertexArray,c=s.anchorX,d=s.anchorY;this._addCollisionDebugVertex(u,h,n,c,d,new P(e,t)),this._addCollisionDebugVertex(u,h,n,c,d,new P(r,t)),this._addCollisionDebugVertex(u,h,n,c,d,new P(r,i)),this._addCollisionDebugVertex(u,h,n,c,d,new P(e,i)),o.vertexLength+=4;let p=a.indexArray;p.emplaceBack(l,l+1),p.emplaceBack(l+1,l+2),p.emplaceBack(l+2,l+3),p.emplaceBack(l+3,l),o.primitiveLength+=4}addDebugCollisionBoxes(e,t,r,i){for(let a=e;a<t;a++){let e=this.collisionBoxArray.get(a);this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,i?this.textCollisionBox:this.iconCollisionBox,e.anchorPoint,r)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new oe(aI,s_.members,aE),this.iconCollisionBox=new oe(aI,s_.members,aE);for(let e=0;e<this.symbolInstances.length;e++){let t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(e,t,r,i,a,n,s,o,l){let u={};for(let i=t;i<r;i++){let t=e.get(i);u.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},u.textFeatureIndex=t.featureIndex;break}for(let t=i;t<a;t++){let r=e.get(t);u.verticalTextBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,anchorPointX:r.anchorPointX,anchorPointY:r.anchorPointY},u.verticalTextFeatureIndex=r.featureIndex;break}for(let t=n;t<s;t++){let r=e.get(t);u.iconBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,anchorPointX:r.anchorPointX,anchorPointY:r.anchorPointY},u.iconFeatureIndex=r.featureIndex;break}for(let t=o;t<l;t++){let r=e.get(t);u.verticalIconBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,anchorPointX:r.anchorPointX,anchorPointY:r.anchorPointY},u.verticalIconFeatureIndex=r.featureIndex;break}return u}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){let r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){let r=e.placedSymbolArray.get(t),i=r.vertexStartIndex+4*r.numGlyphs;for(let t=r.vertexStartIndex;t<i;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;let t=Math.sin(e),r=Math.cos(e),i=[],a=[],n=[];for(let e=0;e<this.symbolInstances.length;++e){n.push(e);let s=this.symbolInstances.get(e);i.push(0|Math.round(t*s.anchorX+r*s.anchorY)),a.push(s.featureIndex)}return n.sort((e,t)=>i[e]-i[t]||a[t]-a[e]),n}addToSortKeyRanges(e,t){let r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){for(let t of(this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[],this.symbolInstanceIndexes)){let e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach((e,t,r)=>{e>=0&&r.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)}),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}r7("SymbolBucket",ot,{omit:["layers","collisionBoxArray","features","compareText"]}),ot.MAX_GLYPHS=65535,ot.addDynamicAttributes=s9;var or={get paint(){return _=_||new iB({"icon-opacity":new iR(eh.paint_symbol["icon-opacity"]),"icon-color":new iR(eh.paint_symbol["icon-color"]),"icon-halo-color":new iR(eh.paint_symbol["icon-halo-color"]),"icon-halo-width":new iR(eh.paint_symbol["icon-halo-width"]),"icon-halo-blur":new iR(eh.paint_symbol["icon-halo-blur"]),"icon-translate":new iz(eh.paint_symbol["icon-translate"]),"icon-translate-anchor":new iz(eh.paint_symbol["icon-translate-anchor"]),"text-opacity":new iR(eh.paint_symbol["text-opacity"]),"text-color":new iR(eh.paint_symbol["text-color"],{runtimeType:eC,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new iR(eh.paint_symbol["text-halo-color"]),"text-halo-width":new iR(eh.paint_symbol["text-halo-width"]),"text-halo-blur":new iR(eh.paint_symbol["text-halo-blur"]),"text-translate":new iz(eh.paint_symbol["text-translate"]),"text-translate-anchor":new iz(eh.paint_symbol["text-translate-anchor"])})},get layout(){return y=y||new iB({"symbol-placement":new iz(eh.layout_symbol["symbol-placement"]),"symbol-spacing":new iz(eh.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new iz(eh.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new iR(eh.layout_symbol["symbol-sort-key"]),"symbol-z-order":new iz(eh.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new iz(eh.layout_symbol["icon-allow-overlap"]),"icon-overlap":new iz(eh.layout_symbol["icon-overlap"]),"icon-ignore-placement":new iz(eh.layout_symbol["icon-ignore-placement"]),"icon-optional":new iz(eh.layout_symbol["icon-optional"]),"icon-rotation-alignment":new iz(eh.layout_symbol["icon-rotation-alignment"]),"icon-size":new iR(eh.layout_symbol["icon-size"]),"icon-text-fit":new iz(eh.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new iz(eh.layout_symbol["icon-text-fit-padding"]),"icon-image":new iR(eh.layout_symbol["icon-image"]),"icon-rotate":new iR(eh.layout_symbol["icon-rotate"]),"icon-padding":new iR(eh.layout_symbol["icon-padding"]),"icon-keep-upright":new iz(eh.layout_symbol["icon-keep-upright"]),"icon-offset":new iR(eh.layout_symbol["icon-offset"]),"icon-anchor":new iR(eh.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new iz(eh.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new iz(eh.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new iz(eh.layout_symbol["text-rotation-alignment"]),"text-field":new iR(eh.layout_symbol["text-field"]),"text-font":new iR(eh.layout_symbol["text-font"]),"text-size":new iR(eh.layout_symbol["text-size"]),"text-max-width":new iR(eh.layout_symbol["text-max-width"]),"text-line-height":new iz(eh.layout_symbol["text-line-height"]),"text-letter-spacing":new iR(eh.layout_symbol["text-letter-spacing"]),"text-justify":new iR(eh.layout_symbol["text-justify"]),"text-radial-offset":new iR(eh.layout_symbol["text-radial-offset"]),"text-variable-anchor":new iz(eh.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new iR(eh.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new iR(eh.layout_symbol["text-anchor"]),"text-max-angle":new iz(eh.layout_symbol["text-max-angle"]),"text-writing-mode":new iz(eh.layout_symbol["text-writing-mode"]),"text-rotate":new iR(eh.layout_symbol["text-rotate"]),"text-padding":new iz(eh.layout_symbol["text-padding"]),"text-keep-upright":new iz(eh.layout_symbol["text-keep-upright"]),"text-transform":new iR(eh.layout_symbol["text-transform"]),"text-offset":new iR(eh.layout_symbol["text-offset"]),"text-allow-overlap":new iz(eh.layout_symbol["text-allow-overlap"]),"text-overlap":new iz(eh.layout_symbol["text-overlap"]),"text-ignore-placement":new iz(eh.layout_symbol["text-ignore-placement"]),"text-optional":new iz(eh.layout_symbol["text-optional"])})}};class oi{constructor(e){if(void 0===e.property.overrides)throw Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:eS,this.defaultValue=e}evaluate(e){if(e.formattedSection){let t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}r7("FormatSectionOverride",oi,{omit:["defaultValue"]});class oa extends iN{constructor(e){super(e,or)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){let e=this.layout.get("text-writing-mode");if(e){let t=[];for(let r of e)0>t.indexOf(r)&&t.push(r);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,i){var a;let n=this.layout.get(e).evaluate(t,{},r,i),s=this._unevaluatedLayout._values[e];return s.isDataDriven()||rg(s.value)||!n?n:(a=t.properties,n.replace(/{([^{}]+)}/g,(e,t)=>a&&t in a?String(a[t]):""))}createBucket(e){return new ot(e)}queryRadius(){return 0}queryIntersectsFeature(){throw Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let e of or.paint.overridableProperties){if(!oa.hasPaintOverride(this.layout,e))continue;let t=this.paint.get(e),r=new rm(new oi(t),t.property.specification),i=null;i="constant"===t.value.kind||"source"===t.value.kind?new r_("source",r):new rx("composite",r,t.value.zoomStops),this.paint._values[e]=new iM(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&oa.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){let r=e.get("text-field"),i=or.paint.properties[t],a=!1,n=e=>{for(let t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(a=!0)};if("constant"===r.value.kind&&r.value.value instanceof e7)n(r.value.value.sections);else if("source"===r.value.kind){let e=t=>{a||(t instanceof tl&&ts(t.value)===eA?n(t.value.sections):t instanceof t4?n(t.sections):t.eachChild(e))},t=r.value;t._styleExpression&&e(t._styleExpression.expression)}return a}}var on={get paint(){return x=x||new iB({"background-color":new iz(eh.paint_background["background-color"]),"background-pattern":new iL(eh.paint_background["background-pattern"]),"background-opacity":new iz(eh.paint_background["background-opacity"])})}};class os extends iN{constructor(e){super(e,on)}}var oo={get paint(){return v=v||new iB({"raster-opacity":new iz(eh.paint_raster["raster-opacity"]),"raster-hue-rotate":new iz(eh.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new iz(eh.paint_raster["raster-brightness-min"]),"raster-brightness-max":new iz(eh.paint_raster["raster-brightness-max"]),"raster-saturation":new iz(eh.paint_raster["raster-saturation"]),"raster-contrast":new iz(eh.paint_raster["raster-contrast"]),"raster-resampling":new iz(eh.paint_raster["raster-resampling"]),"raster-fade-duration":new iz(eh.paint_raster["raster-fade-duration"])})}};class ol extends iN{constructor(e){super(e,oo)}}class ou extends iN{constructor(e){super(e,{}),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw Error("Custom layers cannot be serialized")}}class oh{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}class oc{constructor(e,t){if(isNaN(e)||isNaN(t))throw Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oc(F(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let t=Math.PI/180,r=this.lat*t,i=e.lat*t;return 6371008.8*Math.acos(Math.min(Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos((e.lng-this.lng)*t),1))}static convert(e){if(e instanceof oc)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new oc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new oc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let od=2*Math.PI*6371008.8;function op(e){return od*Math.cos(e*Math.PI/180)}function of(e){return(180+e)/360}function om(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function og(e){return 360*e-180}function oy(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}class o_{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){let r=oc.convert(e);return new o_(of(r.lng),om(r.lat),t/op(r.lat))}toLngLat(){return new oc(og(this.x),oy(this.y))}toAltitude(){return this.z*op(oy(this.y))}meterInMercatorCoordinateUnits(){return 1/od*(1/Math.cos(oy(this.y)*Math.PI/180))}}function ox(e,t,r){var i=2*Math.PI*6378137/256/Math.pow(2,r);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}class ov{constructor(e,t,r){if(e<0||e>25||r<0||r>=Math.pow(2,e)||t<0||t>=Math.pow(2,e))throw Error(`x=${t}, y=${r}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=t,this.y=r,this.key=oS(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,r){var i,a,n,s,o;let l=(a=this.y,n=this.z,s=ox(256*(i=this.x),256*(a=Math.pow(2,n)-a-1),n),o=ox(256*(i+1),256*(a+1),n),s[0]+","+s[1]+","+o[0]+","+o[1]),u=function(e,t,r){let i,a="";for(let n=e;n>0;n--)a+=(t&(i=1<<n-1)?1:0)+(r&i?2:0);return a}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,t>1?"@2x":"").replace(/{quadkey}/g,u).replace(/{bbox-epsg-3857}/g,l)}isChildOf(e){let t=this.z-e.z;return t>0&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){let t=Math.pow(2,this.z);return new P((e.x*t-this.x)*8192,(e.y*t-this.y)*8192)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ob{constructor(e,t){this.wrap=e,this.canonical=t,this.key=oS(e,t.z,t.z,t.x,t.y)}}class ow{constructor(e,t,r,i,a){if(e<r)throw Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${r}`);this.overscaledZ=e,this.wrap=t,this.canonical=new ov(r,+i,+a),this.key=oS(t,e,r,i,a)}clone(){return new ow(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);let t=this.canonical.z-e;return e>this.canonical.z?new ow(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ow(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t){if(e>this.overscaledZ)throw Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);let r=this.canonical.z-e;return e>this.canonical.z?oS(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):oS(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}isChildOf(e){if(e.wrap!==this.wrap)return!1;let t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new ow(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let t=this.canonical.z+1,r=2*this.canonical.x,i=2*this.canonical.y;return[new ow(t,this.wrap,t,r,i),new ow(t,this.wrap,t,r+1,i),new ow(t,this.wrap,t,r,i+1),new ow(t,this.wrap,t,r+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ow(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ow(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ob(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new o_(e.x-this.wrap,e.y))}}function oS(e,t,r,i,a){(e*=2)<0&&(e=-1*e-1);let n=1<<r;return(n*n*e+n*a+i).toString(36)+r.toString(36)+t.toString(36)}r7("CanonicalTileID",ov),r7("OverscaledTileID",ow,{omit:["posMatrix"]});class ok{constructor(e,t,r,i=1,a=1,n=1,s=0){if(this.uid=e,t.height!==t.width)throw RangeError("DEM tiles must be square");if(r&&!["mapbox","terrarium","custom"].includes(r))return void U(`"${r}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=t.height;let o=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),r){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=i,this.greenFactor=a,this.blueFactor=n,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let e=0;e<o;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(o,e)]=this.data[this._idx(o-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,o)]=this.data[this._idx(e,o-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(o,-1)]=this.data[this._idx(o-1,0)],this.data[this._idx(-1,o)]=this.data[this._idx(0,o-1)],this.data[this._idx(o,o)]=this.data[this._idx(o-1,o-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let e=0;e<o;e++)for(let t=0;t<o;t++){let r=this.get(e,t);r>this.max&&(this.max=r),r<this.min&&(this.min=r)}}get(e,t){let r=new Uint8Array(this.data.buffer),i=4*this._idx(e,t);return this.unpack(r[i],r[i+1],r[i+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}unpack(e,t,r){return e*this.redFactor+t*this.greenFactor+r*this.blueFactor-this.baseShift}getPixels(){return new nb({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,r){if(this.dim!==e.dim)throw Error("dem dimension mismatch");let i=t*this.dim,a=t*this.dim+this.dim,n=r*this.dim,s=r*this.dim+this.dim;switch(t){case -1:i=a-1;break;case 1:a=i+1}switch(r){case -1:n=s-1;break;case 1:s=n+1}let o=-t*this.dim,l=-r*this.dim;for(let t=n;t<s;t++)for(let r=i;r<a;r++)this.data[this._idx(r,t)]=e.data[this._idx(r+o,t+l)]}}r7("DEMData",ok);class oT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){let r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class oI{constructor(e,t,r,i,a){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=i,this.properties=e.properties,this.id=a}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={geometry:this.geometry};for(let t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class oC{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new r8(8192,16,0),this.grid3D=new r8(8192,16,0),this.featureIndexArray=new am,this.promoteId=t}insert(e,t,r,i,a,n){let s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,i,a);let o=n?this.grid3D:this.grid;for(let e=0;e<t.length;e++){let r=t[e],i=[1/0,1/0,-1/0,-1/0];for(let e=0;e<r.length;e++){let t=r[e];i[0]=Math.min(i[0],t.x),i[1]=Math.min(i[1],t.y),i[2]=Math.max(i[2],t.x),i[3]=Math.max(i[3],t.y)}i[0]<8192&&i[1]<8192&&i[2]>=0&&i[3]>=0&&o.insert(s,i[0],i[1],i[2],i[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new n5.VectorTile(new sN(this.rawTileData)).layers,this.sourceLayerCoder=new oT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,r,i){let a;this.loadVTLayers();let n=e.params||{},s=8192/e.tileSize/e.scale,o=rk(n.filter),l=e.queryGeometry,u=e.queryPadding*s,h=oE(l),c=this.grid.query(h.minX-u,h.minY-u,h.maxX+u,h.maxY+u),d=oE(e.cameraQueryGeometry);for(let t of this.grid3D.query(d.minX-u,d.minY-u,d.maxX+u,d.maxY+u,(t,r,i,a)=>(function(e,t,r,i,a){for(let n of e)if(t<=n.x&&r<=n.y&&i>=n.x&&a>=n.y)return!0;let n=[new P(t,r),new P(t,a),new P(i,a),new P(i,r)];if(e.length>2){for(let t of n)if(na(e,t))return!0}for(let t=0;t<e.length-1;t++)if(function(e,t,r){let i=r[0],a=r[2];if(e.x<i.x&&t.x<i.x||e.x>a.x&&t.x>a.x||e.y<i.y&&t.y<i.y||e.y>a.y&&t.y>a.y)return!1;let n=q(e,t,r[0]);return n!==q(e,t,r[1])||n!==q(e,t,r[2])||n!==q(e,t,r[3])}(e[t],e[t+1],n))return!0;return!1})(e.cameraQueryGeometry,t-u,r-u,i+u,a+u)))c.push(t);c.sort(oM);let p={};for(let u=0;u<c.length;u++){let h=c[u];if(h===a)continue;a=h;let d=this.featureIndexArray.get(h),f=null;this.loadMatchingFeature(p,d.bucketIndex,d.sourceLayerIndex,d.featureIndex,o,n.layers,n.availableImages,t,r,i,(t,r,i)=>(f||(f=a5(t)),r.queryIntersectsFeature(l,t,i,f,this.z,e.transform,s,e.pixelPosMatrix)))}return p}loadMatchingFeature(e,t,r,i,a,n,s,o,l,u,h){let c=this.bucketLayerIDs[t];if(n&&!function(e,t){for(let r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}(n,c))return;let d=this.sourceLayerCoder.decode(r),p=this.vtLayers[d].feature(i);if(a.needGeometry){let e=a4(p,!0);if(!a.filter(new iS(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!a.filter(new iS(this.tileID.overscaledZ),p))return;let f=this.getId(p,d);for(let t=0;t<c.length;t++){let r=c[t];if(n&&0>n.indexOf(r))continue;let a=o[r];if(!a)continue;let d={};f&&u&&(d=u.getState(a.sourceLayer||"_geojsonTileLayer",f));let m=B({},l[r]);m.paint=oP(m.paint,a.paint,p,d,s),m.layout=oP(m.layout,a.layout,p,d,s);let g=!h||h(p,a,d);if(!g)continue;let y=new oI(p,this.z,this.x,this.y,f);y.layer=m;let _=e[r];void 0===_&&(_=e[r]=[]),_.push({featureIndex:i,feature:y,intersectionZ:g})}}lookupSymbolFeatures(e,t,r,i,a,n,s,o){let l={};this.loadVTLayers();let u=rk(a);for(let a of e)this.loadMatchingFeature(l,r,i,a,u,n,s,o,t);return l}hasLayer(e){for(let t of this.bucketLayerIDs)for(let r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;return this.promoteId&&"boolean"==typeof(r=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]])&&(r=Number(r)),r}}function oP(e,t,r,i,a){return N(e,(e,n)=>{let s=t instanceof iA?t.get(n):null;return s&&s.evaluate?s.evaluate(r,i,a):s})}function oE(e){let t=1/0,r=1/0,i=-1/0,a=-1/0;for(let n of e)t=Math.min(t,n.x),r=Math.min(r,n.y),i=Math.max(i,n.x),a=Math.max(a,n.y);return{minX:t,minY:r,maxX:i,maxY:a}}function oM(e,t){return t-e}function oA(e,t,r,i,a){let n=[];for(let s=0;s<e.length;s++){let o;let l=e[s];for(let e=0;e<l.length-1;e++){let s=l[e],u=l[e+1];s.x<t&&u.x<t||(s.x<t?s=new P(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<t&&(u=new P(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<r&&u.y<r||(s.y<r?s=new P(s.x+(r-s.y)/(u.y-s.y)*(u.x-s.x),r)._round():u.y<r&&(u=new P(s.x+(r-s.y)/(u.y-s.y)*(u.x-s.x),r)._round()),s.x>=i&&u.x>=i||(s.x>=i?s=new P(i,s.y+(i-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=i&&(u=new P(i,s.y+(i-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=a&&u.y>=a||(s.y>=a?s=new P(s.x+(a-s.y)/(u.y-s.y)*(u.x-s.x),a)._round():u.y>=a&&(u=new P(s.x+(a-s.y)/(u.y-s.y)*(u.x-s.x),a)._round()),o&&s.equals(o[o.length-1])||(o=[s],n.push(o)),o.push(u)))))}}return n}r7("FeatureIndex",oC,{omit:["rawTileData","sourceLayerCoder"]});class oz extends P{constructor(e,t,r,i){super(e,t),this.angle=r,void 0!==i&&(this.segment=i)}clone(){return new oz(this.x,this.y,this.angle,this.segment)}}function oR(e,t,r,i,a){if(void 0===t.segment||0===r)return!0;let n=t,s=t.segment+1,o=0;for(;o>-r/2;){if(--s<0)return!1;o-=e[s].dist(n),n=e[s]}o+=e[s].dist(e[s+1]),s++;let l=[],u=0;for(;o<r/2;){let t=e[s],r=e[s+1];if(!r)return!1;let n=e[s-1].angleTo(t)-t.angleTo(r);for(n=Math.abs((n+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:o,angleDelta:n}),u+=n;o-l[0].distance>i;)u-=l.shift().angleDelta;if(u>a)return!1;s++,o+=t.dist(r)}return!0}function oD(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function oL(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function oF(e,t,r,i){let a=[],n=e.image,s=n.pixelRatio,o=n.paddedRect.w-2,l=n.paddedRect.h-2,u=e.right-e.left,h=e.bottom-e.top,c=n.stretchX||[[0,o]],d=n.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=c.reduce(p,0),m=d.reduce(p,0),g=o-f,y=l-m,_=0,x=f,v=0,b=m,w=0,S=g,k=0,T=y;if(n.content&&i){let e=n.content;_=oB(c,0,e[0]),v=oB(d,0,e[1]),x=oB(c,e[0],e[2]),b=oB(d,e[1],e[3]),w=e[0]-_,k=e[1]-v,S=e[2]-e[0]-x,T=e[3]-e[1]-b}let I=(i,a,o,l)=>{var c,d,p,g;let y=(i.stretch-_)/x*u+e.left,I=(c=i.fixed-w,c-S*i.stretch/f),C=(a.stretch-v)/b*h+e.top,E=(d=a.fixed-k,d-T*a.stretch/m),M=(o.stretch-_)/x*u+e.left,A=(p=o.fixed-w,p-S*o.stretch/f),z=(l.stretch-v)/b*h+e.top,R=(g=l.fixed-k,g-T*l.stretch/m),D=new P(y,C),L=new P(M,C),F=new P(M,z),B=new P(y,z),O=new P(I/s,E/s),N=new P(A/s,R/s),V=t*Math.PI/180;if(V){let e=Math.sin(V),t=Math.cos(V),r=[t,-e,e,t];D._matMult(r),L._matMult(r),B._matMult(r),F._matMult(r)}let $=i.stretch+i.fixed,j=a.stretch+a.fixed;return{tl:D,tr:L,bl:B,br:F,tex:{x:n.paddedRect.x+1+$,y:n.paddedRect.y+1+j,w:o.stretch+o.fixed-$,h:l.stretch+l.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:N,minFontScaleX:S/s/u,minFontScaleY:T/s/h,isSDF:r}};if(i&&(n.stretchX||n.stretchY)){let e=oO(c,g,f),t=oO(d,y,m);for(let r=0;r<e.length-1;r++){let i=e[r],n=e[r+1];for(let e=0;e<t.length-1;e++)a.push(I(i,t[e],n,t[e+1]))}}else a.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:o+1},{fixed:0,stretch:l+1}));return a}function oB(e,t,r){let i=0;for(let a of e)i+=Math.max(t,Math.min(r,a[1]))-Math.max(t,Math.min(r,a[0]));return i}function oO(e,t,r){let i=[{fixed:-1,stretch:0}];for(let[t,r]of e){let e=i[i.length-1];i.push({fixed:t-e.stretch,stretch:e.stretch}),i.push({fixed:t-e.stretch,stretch:e.stretch+(r-t)})}return i.push({fixed:t+1,stretch:r}),i}r7("Anchor",oz);class oN{constructor(e,t,r,i,a,n,s,o,l,u){if(this.boxStartIndex=e.length,l){let e=n.top,t=n.bottom,r=n.collisionPadding;r&&(e-=r[1],t+=r[3]);let i=t-e;i>0&&(i=Math.max(10,i),this.circleDiameter=i)}else{let l=n.top*s-o[0],h=n.bottom*s+o[2],c=n.left*s-o[3],d=n.right*s+o[1],p=n.collisionPadding;if(p&&(c-=p[0]*s,l-=p[1]*s,d+=p[2]*s,h+=p[3]*s),u){let e=new P(c,l),t=new P(d,l),r=new P(c,h),i=new P(d,h),a=u*Math.PI/180;e._rotate(a),t._rotate(a),r._rotate(a),i._rotate(a),c=Math.min(e.x,t.x,r.x,i.x),d=Math.max(e.x,t.x,r.x,i.x),l=Math.min(e.y,t.y,r.y,i.y),h=Math.max(e.y,t.y,r.y,i.y)}e.emplaceBack(t.x,t.y,c,l,d,h,r,i,a)}this.boxEndIndex=e.length}}class oV{constructor(e=[],t=o$){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;let e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:r}=this,i=t[e];for(;e>0;){let a=e-1>>1,n=t[a];if(r(i,n)>=0)break;t[e]=n,e=a}t[e]=i}_down(e){let{data:t,compare:r}=this,i=this.length>>1,a=t[e];for(;e<i;){let i=1+(e<<1),n=t[i],s=i+1;if(s<this.length&&0>r(t[s],n)&&(i=s,n=t[s]),r(n,a)>=0)break;t[e]=n,e=i}t[e]=a}}function o$(e,t){return e<t?-1:e>t?1:0}function oj(e,t){return t.max-e.max}function oU(e,t,r,i){this.p=new P(e,t),this.h=r,this.d=function(e,t){let r=!1,i=1/0;for(let a=0;a<t.length;a++){let n=t[a];for(let t=0,a=n.length,s=a-1;t<a;s=t++){let a=n[t],o=n[s];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(r=!r),i=Math.min(i,nr(e,a,o))}}return(r?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}e.aq=void 0,(T=e.aq||(e.aq={}))[T.center=1]="center",T[T.left=2]="left",T[T.right=3]="right",T[T.top=4]="top",T[T.bottom=5]="bottom",T[T["top-left"]=6]="top-left",T[T["top-right"]=7]="top-right",T[T["bottom-left"]=8]="bottom-left",T[T["bottom-right"]=9]="bottom-right";let oq=Number.POSITIVE_INFINITY;function oZ(e,t){return t[1]!==oq?function(e,t,r){let i=0,a=0;switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":a=r-7;break;case"bottom-right":case"bottom-left":case"bottom":a=-r+7}switch(e){case"top-right":case"bottom-right":case"right":i=-t;break;case"top-left":case"bottom-left":case"left":i=t}return[i,a]}(e,t[0],t[1]):function(e,t){let r=0,i=0;t<0&&(t=0);let a=t/Math.SQRT2;switch(e){case"top-right":case"top-left":i=a-7;break;case"bottom-right":case"bottom-left":i=-a+7;break;case"bottom":i=-t+7;break;case"top":i=t-7}switch(e){case"top-right":case"bottom-right":r=-a;break;case"top-left":case"bottom-left":r=a;break;case"left":r=t;break;case"right":r=-t}return[r,i]}(e,t[0])}function oG(e,t,r){var i;let a=e.layout,n=null===(i=a.get("text-variable-anchor-offset"))||void 0===i?void 0:i.evaluate(t,{},r);if(n){let e=n.values,t=[];for(let r=0;r<e.length;r+=2){let i=t[r]=e[r],a=e[r+1].map(e=>24*e);i.startsWith("top")?a[1]-=7:i.startsWith("bottom")&&(a[1]+=7),t[r+1]=a}return new tr(t)}let s=a.get("text-variable-anchor");if(s){let i;i=void 0!==e._unevaluatedLayout.getValue("text-radial-offset")?[24*a.get("text-radial-offset").evaluate(t,{},r),oq]:a.get("text-offset").evaluate(t,{},r).map(e=>24*e);let n=[];for(let e of s)n.push(e,oZ(e,i));return new tr(n)}return null}function oH(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function oW(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f){let m=function(e,t,r,i,a,n,s,o){let l=i.layout.get("text-rotate").evaluate(n,{})*Math.PI/180,u=[];for(let e of t.positionedLines)for(let i of e.positionedGlyphs){if(!i.rect)continue;let n=i.rect||{},h=4,c=!0,d=1,p=0,f=(a||o)&&i.vertical,m=i.metrics.advance*i.scale/2;if(o&&t.verticalizable&&(p=e.lineOffset/2-(i.imageName?-(24-i.metrics.width*i.scale)/2:(i.scale-1)*24)),i.imageName){let e=s[i.imageName];c=e.sdf,h=1/(d=e.pixelRatio)}let g=a?[i.x+m,i.y]:[0,0],y=a?[0,0]:[i.x+m+r[0],i.y+r[1]-p],_=[0,0];f&&(_=y,y=[0,0]);let x=i.metrics.isDoubleResolution?2:1,v=(i.metrics.left-h)*i.scale-m+y[0],b=(-i.metrics.top-h)*i.scale+y[1],w=v+n.w/x*i.scale/d,S=b+n.h/x*i.scale/d,k=new P(v,b),T=new P(w,b),I=new P(v,S),C=new P(w,S);if(f){let e=new P(-m,m- -17),t=-Math.PI/2,r=12-m,a=new P(22-r,-(i.imageName?r:0)),n=new P(..._);k._rotateAround(t,e)._add(a)._add(n),T._rotateAround(t,e)._add(a)._add(n),I._rotateAround(t,e)._add(a)._add(n),C._rotateAround(t,e)._add(a)._add(n)}if(l){let e=Math.sin(l),t=Math.cos(l),r=[t,-e,e,t];k._matMult(r),T._matMult(r),I._matMult(r),C._matMult(r)}let E=new P(0,0),M=new P(0,0);u.push({tl:k,tr:T,bl:I,br:C,tex:n,writingMode:t.writingMode,glyphOffset:g,sectionIndex:i.sectionIndex,isSDF:c,pixelOffsetTL:E,pixelOffsetBR:M,minFontScaleX:0,minFontScaleY:0})}return u}(0,r,o,a,n,s,i,e.allowVerticalPlacement),g=e.textSizeData,y=null;for(let r of("source"===g.kind?(y=[128*a.layout.get("text-size").evaluate(s,{})])[0]>32640&&U(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`):"composite"===g.kind&&((y=[128*p.compositeTextSizes[0].evaluate(s,{},f),128*p.compositeTextSizes[1].evaluate(s,{},f)])[0]>32640||y[1]>32640)&&U(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`),e.addSymbols(e.text,m,y,o,n,s,u,t,l.lineStartIndex,l.lineLength,d,f),h))c[r]=e.text.placedSymbolArray.length-1;return 4*m.length}function oX(e){for(let t in e)return e[t];return null}let oK=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class oJ{static from(e){if(!(e instanceof ArrayBuffer))throw Error("Data must be an instance of ArrayBuffer.");let[t,r]=new Uint8Array(e,0,2);if(219!==t)throw Error("Data does not appear to be in a KDBush format.");let i=r>>4;if(1!==i)throw Error(`Got v${i} data when expected v1.`);let a=oK[15&r];if(!a)throw Error("Unrecognized array type.");let[n]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new oJ(s,n,a,e)}constructor(e,t=64,r=Float64Array,i){if(isNaN(e)||e<0)throw Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let a=oK.indexOf(this.ArrayType),n=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-s%8)%8;if(a<0)throw Error(`Unexpected typed array class: ${r}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+o,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+n+s+o),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+o,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+a]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){let r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){let e=this._pos>>1;if(e!==this.numItems)throw Error(`Added ${e} items when expected ${this.numItems}.`);return function e(t,r,i,a,n,s){if(n-a<=i)return;let o=a+n>>1;(function e(t,r,i,a,n,s){for(;n>a;){if(n-a>600){let o=n-a+1,l=i-a+1,u=Math.log(o),h=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*h*(o-h)/o)*(l-o/2<0?-1:1);e(t,r,i,Math.max(a,Math.floor(i-l*h/o+c)),Math.min(n,Math.floor(i+(o-l)*h/o+c)),s)}let o=r[2*i+s],l=a,u=n;for(oY(t,r,a,i),r[2*n+s]>o&&oY(t,r,a,n);l<u;){for(oY(t,r,l,u),l++,u--;r[2*l+s]<o;)l++;for(;r[2*u+s]>o;)u--}r[2*a+s]===o?oY(t,r,a,u):oY(t,r,++u,n),u<=i&&(a=u+1),i<=u&&(n=u-1)}})(t,r,o,a,n,s),e(t,r,i,a,o-1,1-s),e(t,r,i,o+1,n,1-s)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,i){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:a,coords:n,nodeSize:s}=this,o=[0,a.length-1,0],l=[];for(;o.length;){let u=o.pop()||0,h=o.pop()||0,c=o.pop()||0;if(h-c<=s){for(let s=c;s<=h;s++){let o=n[2*s],u=n[2*s+1];o>=e&&o<=r&&u>=t&&u<=i&&l.push(a[s])}continue}let d=c+h>>1,p=n[2*d],f=n[2*d+1];p>=e&&p<=r&&f>=t&&f<=i&&l.push(a[d]),(0===u?e<=p:t<=f)&&(o.push(c),o.push(d-1),o.push(1-u)),(0===u?r>=p:i>=f)&&(o.push(d+1),o.push(h),o.push(1-u))}return l}within(e,t,r){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:i,coords:a,nodeSize:n}=this,s=[0,i.length-1,0],o=[],l=r*r;for(;s.length;){let u=s.pop()||0,h=s.pop()||0,c=s.pop()||0;if(h-c<=n){for(let r=c;r<=h;r++)o0(a[2*r],a[2*r+1],e,t)<=l&&o.push(i[r]);continue}let d=c+h>>1,p=a[2*d],f=a[2*d+1];o0(p,f,e,t)<=l&&o.push(i[d]),(0===u?e-r<=p:t-r<=f)&&(s.push(c),s.push(d-1),s.push(1-u)),(0===u?e+r>=p:t+r>=f)&&(s.push(d+1),s.push(h),s.push(1-u))}return o}}function oY(e,t,r,i){oQ(e,r,i),oQ(t,2*r,2*i),oQ(t,2*r+1,2*i+1)}function oQ(e,t,r){let i=e[t];e[t]=e[r],e[r]=i}function o0(e,t,r,i){let a=e-r,n=t-i;return a*a+n*n}e.bh=void 0,(I=e.bh||(e.bh={})).create="create",I.load="load",I.fullLoad="fullLoad";let o1=null,o2=[],o3=1e3/60,o5="loadTime",o4="fullLoadTime";e.$=function(e,t,r){var i,a,n,s,o,l,u,h,c,d,p,f,m=r[0],g=r[1],y=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(a=t[1],n=t[2],s=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=t[9],p=t[10],f=t[11],e[0]=i=t[0],e[1]=a,e[2]=n,e[3]=s,e[4]=o,e[5]=l,e[6]=u,e[7]=h,e[8]=c,e[9]=d,e[10]=p,e[11]=f,e[12]=i*m+o*g+c*y+t[12],e[13]=a*m+l*g+d*y+t[13],e[14]=n*m+u*g+p*y+t[14],e[15]=s*m+h*g+f*y+t[15]),e},e.A=nu,e.B=tO,e.C=class{constructor(e,t,r){this.receive=e=>{let t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId)){if("<cancel>"===t.type){delete this.tasks[r];let e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e()}else Z()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)}},this.process=()=>{if(!this.taskQueue.length)return;let e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)},this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new oh(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Z()?e:window}send(e,t,r,i,a=!1){let n=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[n]=r);let s=[],o={id:n,type:e,hasCallback:!!r,targetMapId:i,mustQueue:a,sourceMapId:this.mapId,data:it(t,s)};return this.target.postMessage(o,{transfer:s}),{cancel:()=>{r&&delete this.callbacks[n],this.target.postMessage({id:n,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}processTask(e,t){if("<response>"===t.type){let r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(ir(t.error)):r(null,ir(t.data)))}else{let r=!1,i=[],a=t.hasCallback?(t,a)=>{r=!0,delete this.cancelCallbacks[e];let n={id:e,type:"<response>",sourceMapId:this.mapId,error:t?it(t):null,data:it(a,i)};this.target.postMessage(n,{transfer:i})}:e=>{r=!0},n=null,s=ir(t.data);if(this.parent[t.type])n=this.parent[t.type](t.sourceMapId,s,a);else if("getWorkerSource"in this.parent){let e=t.type.split(".");n=this.parent.getWorkerSource(t.sourceMapId,e[0],s.source)[e[1]](s,a)}else a(Error(`Could not find function ${t.type}`));!r&&n&&n.cancel&&(this.cancelCallbacks[e]=n.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},e.D=iz,e.E=eu,e.F=function(e,t){let r={};for(let i=0;i<t.length;i++){let a=t[i];a in e&&(r[a]=e[a])}return r},e.G=of,e.H=om,e.I=sq,e.J=A,e.K=z,e.L=oc,e.M=X,e.N=8192,e.O=ow,e.P=P,e.Q=iU,e.R=nb,e.S=aA,e.T=iI,e.U=o_,e.V=class extends iH{},e.W=ov,e.X=function(e,t){let r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let t=0;t<e.length;t++){let i=window.document.createElement("source");ea(e[t])||(r.crossOrigin="Anonymous"),i.src=e[t],r.appendChild(i)}return{cancel:()=>{}}},e.Y=ex,e.Z=function(){var e=new nu(16);return nu!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e._=b,e.a=H,e.a$=class extends ar{},e.a0=function(e,t,r){var i=r[0],a=r[1],n=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.a1=nc,e.a2=function(){return O++},e.a3=an,e.a4=ot,e.a5=function(){iw.isLoading()||iw.isLoaded()||"deferred"!==iv()||ib()},e.a6=rk,e.a7=a4,e.a8=iS,e.a9=oI,e.aA=iy,e.aB=function(e){e=e.slice();let t=Object.create(null);for(let r=0;r<e.length;r++)t[e[r].id]=e[r];for(let r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=function(e,t){let r={};for(let t in e)"ref"!==t&&(r[t]=e[t]);return ec.forEach(e=>{e in t&&(r[e]=t[e])}),r}(e[r],t[e[r].ref]));return e},e.aC=function(e){if("custom"===e.type)return new ou(e);switch(e.type){case"background":return new os(e);case"circle":return new np(e);case"fill":return new n0(e);case"fill-extrusion":return new sa(e);case"heatmap":return new nS(e);case"hillshade":return new nT(e);case"line":return new sf(e);case"raster":return new ol(e);case"symbol":return new oa(e)}},e.aD=$,e.aE=function(e,t){if(!e)return[{command:ep.setStyle,args:[t]}];let r=[];try{if(!ed(e.version,t.version))return[{command:ep.setStyle,args:[t]}];ed(e.center,t.center)||r.push({command:ep.setCenter,args:[t.center]}),ed(e.zoom,t.zoom)||r.push({command:ep.setZoom,args:[t.zoom]}),ed(e.bearing,t.bearing)||r.push({command:ep.setBearing,args:[t.bearing]}),ed(e.pitch,t.pitch)||r.push({command:ep.setPitch,args:[t.pitch]}),ed(e.sprite,t.sprite)||r.push({command:ep.setSprite,args:[t.sprite]}),ed(e.glyphs,t.glyphs)||r.push({command:ep.setGlyphs,args:[t.glyphs]}),ed(e.transition,t.transition)||r.push({command:ep.setTransition,args:[t.transition]}),ed(e.light,t.light)||r.push({command:ep.setLight,args:[t.light]});let i={},a=[];!function(e,t,r,i){let a;for(a in t=t||{},e=e||{})Object.prototype.hasOwnProperty.call(e,a)&&(Object.prototype.hasOwnProperty.call(t,a)||em(a,r,i));for(a in t){var n,s;Object.prototype.hasOwnProperty.call(t,a)&&(Object.prototype.hasOwnProperty.call(e,a)?ed(e[a],t[a])||("geojson"===e[a].type&&"geojson"===t[a].type&&function(e,t,r){let i;for(i in e[r])if(Object.prototype.hasOwnProperty.call(e[r],i)&&"data"!==i&&!ed(e[r][i],t[r][i]))return!1;for(i in t[r])if(Object.prototype.hasOwnProperty.call(t[r],i)&&"data"!==i&&!ed(e[r][i],t[r][i]))return!1;return!0}(e,t,a)?r.push({command:ep.setGeoJSONSourceData,args:[a,t[a].data]}):(n=a,s=t,em(n,r,i),ef(n,s,r))):ef(a,t,r))}}(e.sources,t.sources,a,i);let n=[];e.layers&&e.layers.forEach(e=>{i[e.source]?r.push({command:ep.removeLayer,args:[e.id]}):n.push(e)}),r=r.concat(a),function(e,t,r){let i,a,n,s,o,l,u;t=t||[];let h=(e=e||[]).map(ey),c=t.map(ey),d=e.reduce(e_,{}),p=t.reduce(e_,{}),f=h.slice(),m=Object.create(null);for(i=0,a=0;i<h.length;i++)n=h[i],Object.prototype.hasOwnProperty.call(p,n)?a++:(r.push({command:ep.removeLayer,args:[n]}),f.splice(f.indexOf(n,a),1));for(i=0,a=0;i<c.length;i++)n=c[c.length-1-i],f[f.length-1-i]!==n&&(Object.prototype.hasOwnProperty.call(d,n)?(r.push({command:ep.removeLayer,args:[n]}),f.splice(f.lastIndexOf(n,f.length-a),1)):a++,l=f[f.length-i],r.push({command:ep.addLayer,args:[p[n],l]}),f.splice(f.length-i,0,n),m[n]=!0);for(i=0;i<c.length;i++)if(s=d[n=c[i]],o=p[n],!m[n]&&!ed(s,o)){if(ed(s.source,o.source)&&ed(s["source-layer"],o["source-layer"])&&ed(s.type,o.type)){for(u in eg(s.layout,o.layout,r,n,null,ep.setLayoutProperty),eg(s.paint,o.paint,r,n,null,ep.setPaintProperty),ed(s.filter,o.filter)||r.push({command:ep.setFilter,args:[n,o.filter]}),ed(s.minzoom,o.minzoom)&&ed(s.maxzoom,o.maxzoom)||r.push({command:ep.setLayerZoomRange,args:[n,o.minzoom,o.maxzoom]}),s)Object.prototype.hasOwnProperty.call(s,u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?eg(s[u],o[u],r,n,u.slice(6),ep.setPaintProperty):ed(s[u],o[u])||r.push({command:ep.setLayerProperty,args:[n,u,o[u]]}));for(u in o)Object.prototype.hasOwnProperty.call(o,u)&&!Object.prototype.hasOwnProperty.call(s,u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?eg(s[u],o[u],r,n,u.slice(6),ep.setPaintProperty):ed(s[u],o[u])||r.push({command:ep.setLayerProperty,args:[n,u,o[u]]}))}else r.push({command:ep.removeLayer,args:[n]}),l=f[f.lastIndexOf(n)+1],r.push({command:ep.addLayer,args:[o,l]})}}(n,t.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:ep.setStyle,args:[t]}]}return r},e.aF=function(e){let t=[],r=e.id;return void 0===r&&t.push({message:`layers.${r}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${r}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},e.aG=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(!e(t[i],r[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==r){if("object"!=typeof r||Object.keys(t).length!==Object.keys(r).length)return!1;for(let i in t)if(!e(t[i],r[i]))return!1;return!0}return t===r},e.aH=N,e.aI=V,e.aJ=ix,e.aK=function(e){return e({pluginStatus:im,pluginURL:ig}),ix.on("pluginStateChange",e),e},e.aL=class extends aU{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.aM=aq,e.aN=class extends aU{constructor(e,t){super(e,t),this.current=aH}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.aO=aZ,e.aP=class extends aU{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.aQ=class extends aU{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.aR=aG,e.aS=function(e,t,r,i,a,n,s){var o=1/(t-r),l=1/(i-a),u=1/(n-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*o,e[13]=(a+i)*l,e[14]=(s+n)*u,e[15]=1,e},e.aT=e6,e.aU=nc,e.aV=class extends i3{},e.aW=sx,e.aX=class extends i4{},e.aY=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.aZ=nw,e.a_=ag,e.aa=function(e){let t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,r,i,a)=>{let n=i||a;return t[r]=!n||n.toLowerCase(),""}),t["max-age"]){let e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t},e.ab=function(e,t){let r=[];for(let i in e)i in t||r.push(i);return r},e.ac=function(e){if(null==G){let t=e.navigator?e.navigator.userAgent:null;G=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return G},e.ad=L,e.ae=function(e,t,r){var i=Math.sin(r),a=Math.cos(r),n=t[0],s=t[1],o=t[2],l=t[3],u=t[4],h=t[5],c=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*a+u*i,e[1]=s*a+h*i,e[2]=o*a+c*i,e[3]=l*a+d*i,e[4]=u*a-n*i,e[5]=h*a-s*i,e[6]=c*a-o*i,e[7]=d*a-l*i,e},e.af=function(e){var t=new nu(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.ag=nd,e.ah=function(e,t){let r=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){let{interpolationType:a,minZoom:n,maxZoom:s}=e,o=a?L(tN.interpolationFactor(a,t,n,s),0,1):0;"camera"===e.kind?i=tO.number(e.minSize,e.maxSize,o):r=o}return{uSizeT:r,uSize:i}},e.aj=function(e,{uSize:t,uSizeT:r},{lowerSize:i,upperSize:a}){return"source"===e.kind?i/128:"composite"===e.kind?tO.number(i/128,a/128,r):t},e.ak=s9,e.al=function(e,t,r,i){let a=t.y-e.y,n=t.x-e.x,s=i.y-r.y,o=i.x-r.x,l=s*n-o*a;if(0===l)return null;let u=(o*(e.y-r.y)-s*(e.x-r.x))/l;return new P(e.x+u*n,e.y+u*a)},e.am=oA,e.an=a9,e.ao=nh,e.ap=24,e.ar=s5,e.as=function(e,t){var r=t[0],i=t[1],a=t[2],n=t[3],s=t[4],o=t[5],l=t[6],u=t[7],h=t[8],c=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=r*o-i*s,x=r*l-a*s,v=r*u-n*s,b=i*l-a*o,w=i*u-n*o,S=a*u-n*l,k=h*m-c*f,T=h*g-d*f,I=h*y-p*f,C=c*g-d*m,P=c*y-p*m,E=d*y-p*g,M=_*E-x*P+v*C+b*I-w*T+S*k;return M?(e[0]=(o*E-l*P+u*C)*(M=1/M),e[1]=(a*P-i*E-n*C)*M,e[2]=(m*S-g*w+y*b)*M,e[3]=(d*w-c*S-p*b)*M,e[4]=(l*I-s*E-u*T)*M,e[5]=(r*E-a*I+n*T)*M,e[6]=(g*v-f*S-y*x)*M,e[7]=(h*S-d*v+p*x)*M,e[8]=(s*P-o*I+u*k)*M,e[9]=(i*I-r*P-n*k)*M,e[10]=(f*w-m*v+y*_)*M,e[11]=(c*v-h*w-p*_)*M,e[12]=(o*T-s*C-l*k)*M,e[13]=(r*C-i*T+a*k)*M,e[14]=(m*x-f*b-g*_)*M,e[15]=(h*b-c*x+d*_)*M,e):null},e.at=oH,e.au=s1,e.av=oJ,e.aw=function(){let e={},t=eh.$version;for(let r in eh.$root){let i=eh.$root[r];if(i.required){let a=null;null!=(a="version"===r?t:"array"===i.type?[]:{})&&(e[r]=a)}}return e},e.ax=ep,e.ay=ii,e.az=Q,e.b=function(e,t){createImageBitmap(new Blob([new Uint8Array(e)],{type:"image/png"})).then(e=>{t(null,e)}).catch(e=>{t(Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},e.b0=aP,e.b1=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],s=e[4],o=e[5],l=e[6],u=e[7],h=e[8],c=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=t[0],x=t[1],v=t[2],b=t[3],w=t[4],S=t[5],k=t[6],T=t[7],I=t[8],C=t[9],P=t[10],E=t[11],M=t[12],A=t[13],z=t[14],R=t[15];return Math.abs(r-_)<=1e-6*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=1e-6*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(a-v)<=1e-6*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(n-b)<=1e-6*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(s-w)<=1e-6*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(o-S)<=1e-6*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(l-k)<=1e-6*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(u-T)<=1e-6*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(h-I)<=1e-6*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(c-C)<=1e-6*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(d-P)<=1e-6*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(p-E)<=1e-6*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(f-M)<=1e-6*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(m-A)<=1e-6*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(g-z)<=1e-6*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(y-R)<=1e-6*Math.max(1,Math.abs(y),Math.abs(R))},e.b2=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.b3=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},e.b4=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.b5=F,e.b6=ob,e.b7=function(e,t){return e/op(t)},e.b8=function(e,t,r,i,a){var n,s=1/Math.tan(t/2);return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(e[10]=(a+i)*(n=1/(i-a)),e[14]=2*a*i*n):(e[10]=-1,e[14]=-2*i),e},e.b9=function(e,t,r){var i=Math.sin(r),a=Math.cos(r),n=t[4],s=t[5],o=t[6],l=t[7],u=t[8],h=t[9],c=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*a+u*i,e[5]=s*a+h*i,e[6]=o*a+c*i,e[7]=l*a+d*i,e[8]=u*a-n*i,e[9]=h*a-s*i,e[10]=c*a-o*i,e[11]=d*a-l*i,e},e.bA=S,e.bB=sS,e.bC=ry,e.bD=iw,e.ba=R,e.bb=D,e.bc=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.bd=class extends iG{},e.be=6371008.8,e.bf=og,e.bg={mark(e){performance.mark(e)},frame(e){null!=o1&&o2.push(e-o1),o1=e},clearMetrics(){for(let t in o1=null,o2=[],performance.clearMeasures(o5),performance.clearMeasures(o4),e.bh)performance.clearMarks(e.bh[t])},getPerformanceMetrics(){performance.measure(o5,e.bh.create,e.bh.load),performance.measure(o4,e.bh.create,e.bh.fullLoad);let t=performance.getEntriesByName(o5)[0].duration,r=performance.getEntriesByName(o4)[0].duration,i=o2.length,a=1/(o2.reduce((e,t)=>e+t,0)/i/1e3),n=o2.filter(e=>e>o3).reduce((e,t)=>e+(t-o3)/o3,0);return{loadTime:t,fullLoadTime:r,fps:a,percentDroppedFrames:n/(i+n)*100,totalFrames:i}}},e.bi=Y,e.bj=function(e,t,r=!1){if(im===ih||im===ic||im===id)throw Error("setRTLTextPlugin cannot be called multiple times.");ig=K.resolveURL(e),im=ih,ip=t,i_(),r||ib()},e.bk=iv,e.bl=function(e,t){let r={};for(let i=0;i<e.length;i++){let a=t&&t[e[i].id]||function(e){let t="";for(let r of ec)t+=`/${function e(t){let r=typeof t;if("number"===r||"boolean"===r||"string"===r||null==t)return JSON.stringify(t);if(Array.isArray(t)){let r="[";for(let i of t)r+=`${e(i)},`;return`${r}]`}let i=Object.keys(t).sort(),a="{";for(let r=0;r<i.length;r++)a+=`${JSON.stringify(i[r])}:${e(t[i[r]])},`;return`${a}}`}(e[r])}`;return t}(e[i]);t&&(t[e[i].id]=a);let n=r[a];n||(n=r[a]=[]),n.push(e[i])}let i=[];for(let e in r)i.push(r[e]);return i},e.bm=r7,e.bn=oT,e.bo=oC,e.bp=sZ,e.bq=function(t){t.bucket.createArrays(),t.bucket.tilePixelRatio=8192/(512*t.bucket.overscaling),t.bucket.compareText={},t.bucket.iconsNeedLinear=!1;let r=t.bucket.layers[0],i=r.layout,a=r._unevaluatedLayout._values,n={layoutIconSize:a["icon-size"].possiblyEvaluate(new iS(t.bucket.zoom+1),t.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new iS(t.bucket.zoom+1),t.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new iS(18))};if("composite"===t.bucket.textSizeData.kind){let{minZoom:e,maxZoom:r}=t.bucket.textSizeData;n.compositeTextSizes=[a["text-size"].possiblyEvaluate(new iS(e),t.canonical),a["text-size"].possiblyEvaluate(new iS(r),t.canonical)]}if("composite"===t.bucket.iconSizeData.kind){let{minZoom:e,maxZoom:r}=t.bucket.iconSizeData;n.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new iS(e),t.canonical),a["icon-size"].possiblyEvaluate(new iS(r),t.canonical)]}let s=24*i.get("text-line-height"),o="viewport"!==i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),l=i.get("text-keep-upright"),u=i.get("text-size");for(let a of t.bucket.features){let h=i.get("text-font").evaluate(a,{},t.canonical).join(","),c=u.evaluate(a,{},t.canonical),d=n.layoutTextSize.evaluate(a,{},t.canonical),p=n.layoutIconSize.evaluate(a,{},t.canonical),f={horizontal:{},vertical:void 0},m=a.text,g,y=[0,0];if(m){let n=m.toString(),u=24*i.get("text-letter-spacing").evaluate(a,{},t.canonical),p=!function(e){for(let r of e){var t;if(t=r.charCodeAt(0),ia.Arabic(t)||ia["Arabic Supplement"](t)||ia["Arabic Extended-A"](t)||ia["Arabic Presentation Forms-A"](t)||ia["Arabic Presentation Forms-B"](t))return!1}return!0}(n)?0:u,g=i.get("text-anchor").evaluate(a,{},t.canonical),_=oG(r,a,t.canonical);if(!_){let e=i.get("text-radial-offset").evaluate(a,{},t.canonical);y=e?oZ(g,[24*e,oq]):i.get("text-offset").evaluate(a,{},t.canonical).map(e=>24*e)}let x=o?"center":i.get("text-justify").evaluate(a,{},t.canonical),v=i.get("symbol-placement"),b="point"===v?24*i.get("text-max-width").evaluate(a,{},t.canonical):0,w=()=>{t.bucket.allowVerticalPlacement&&is(n)&&(f.vertical=sW(m,t.glyphMap,t.glyphPositions,t.imagePositions,h,b,s,g,"left",p,y,e.ai.vertical,!0,v,d,c))};if(!o&&_){let r=new Set;if("auto"===x)for(let e=0;e<_.values.length;e+=2)r.add(oH(_.values[e]));else r.add(x);let i=!1;for(let a of r)if(!f.horizontal[a]){if(i)f.horizontal[a]=f.horizontal[0];else{let r=sW(m,t.glyphMap,t.glyphPositions,t.imagePositions,h,b,s,"center",a,p,y,e.ai.horizontal,!1,v,d,c);r&&(f.horizontal[a]=r,i=1===r.positionedLines.length)}}w()}else{"auto"===x&&(x=oH(g));let r=sW(m,t.glyphMap,t.glyphPositions,t.imagePositions,h,b,s,g,x,p,y,e.ai.horizontal,!1,v,d,c);r&&(f.horizontal[x]=r),w(),is(n)&&o&&l&&(f.vertical=sW(m,t.glyphMap,t.glyphPositions,t.imagePositions,h,b,s,g,x,p,y,e.ai.vertical,!1,v,d,c))}}let _=!1;if(a.icon&&a.icon.name){let e=t.imageMap[a.icon.name];e&&(g=function(e,t,r){let{horizontalAlign:i,verticalAlign:a}=s1(r),n=t[0]-e.displaySize[0]*i,s=t[1]-e.displaySize[1]*a;return{image:e,top:s,bottom:s+e.displaySize[1],left:n,right:n+e.displaySize[0]}}(t.imagePositions[a.icon.name],i.get("icon-offset").evaluate(a,{},t.canonical),i.get("icon-anchor").evaluate(a,{},t.canonical)),_=!!e.sdf,void 0===t.bucket.sdfIcons?t.bucket.sdfIcons=_:t.bucket.sdfIcons!==_&&U("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.bucket.pixelRatio||0!==i.get("icon-rotate").constantOr(1))&&(t.bucket.iconsNeedLinear=!0))}let x=oX(f.horizontal)||f.vertical;t.bucket.iconsInText=!!x&&x.iconsInText,(x||g)&&function(t,r,i,a,n,s,o,l,u,h,c){let d,p=s.textMaxSize.evaluate(r,{});void 0===p&&(p=o);let f=t.layers[0].layout,m=f.get("icon-offset").evaluate(r,{},c),g=oX(i.horizontal),y=o/24,_=t.tilePixelRatio*y,x=t.tilePixelRatio*p/24,v=t.tilePixelRatio*l,b=t.tilePixelRatio*f.get("symbol-spacing"),w=f.get("text-padding")*t.tilePixelRatio,S=function(e,t,r,i=1){let a=e.get("icon-padding").evaluate(t,{},r),n=a&&a.values;return[n[0]*i,n[1]*i,n[2]*i,n[3]*i]}(f,r,c,t.tilePixelRatio),k=f.get("text-max-angle")/180*Math.PI,T="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),I="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),C=f.get("symbol-placement"),E=b/2,M=f.get("icon-text-fit");a&&"none"!==M&&(t.allowVerticalPlacement&&i.vertical&&(d=s2(a,i.vertical,M,f.get("icon-text-fit-padding"),m,y)),g&&(a=s2(a,g,M,f.get("icon-text-fit-padding"),m,y)));let A=(l,p)=>{p.x<0||p.x>=8192||p.y<0||p.y>=8192||function(t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g,y,_,x,v,b,w,S,k,T){let I=t.addToLineVertexArray(r,i),C,P,E,M,A=0,z=0,R=0,D=0,L=-1,F=-1,B={},O=aN("");if(t.allowVerticalPlacement&&a.vertical){let e=l.layout.get("text-rotate").evaluate(b,{},k)+90;E=new oN(u,r,h,c,d,a.vertical,p,f,m,e),o&&(M=new oN(u,r,h,c,d,o,y,_,m,e))}if(n){let i=l.layout.get("icon-rotate").evaluate(b,{}),a="none"!==l.layout.get("icon-text-fit"),s=oF(n,i,S,a),p=o?oF(o,i,S,a):void 0;P=new oN(u,r,h,c,d,n,y,_,!1,i),A=4*s.length;let f=t.iconSizeData,m=null;"source"===f.kind?(m=[128*l.layout.get("icon-size").evaluate(b,{})])[0]>32640&&U(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`):"composite"===f.kind&&((m=[128*w.compositeIconSizes[0].evaluate(b,{},k),128*w.compositeIconSizes[1].evaluate(b,{},k)])[0]>32640||m[1]>32640)&&U(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`),t.addSymbols(t.icon,s,m,v,x,b,e.ai.none,r,I.lineStartIndex,I.lineLength,-1,k),L=t.icon.placedSymbolArray.length-1,p&&(z=4*p.length,t.addSymbols(t.icon,p,m,v,x,b,e.ai.vertical,r,I.lineStartIndex,I.lineLength,-1,k),F=t.icon.placedSymbolArray.length-1)}let N=Object.keys(a.horizontal);for(let i of N){let n=a.horizontal[i];!C&&(O=aN(n.text),C=new oN(u,r,h,c,d,n,p,f,m,l.layout.get("text-rotate").evaluate(b,{},k)));let o=1===n.positionedLines.length;if(R+=oW(t,r,n,s,l,m,b,g,I,a.vertical?e.ai.horizontal:e.ai.horizontalOnly,o?N:[i],B,L,w,k),o)break}a.vertical&&(D+=oW(t,r,a.vertical,s,l,m,b,g,I,e.ai.vertical,["vertical"],B,F,w,k));let V=C?C.boxStartIndex:t.collisionBoxArray.length,$=C?C.boxEndIndex:t.collisionBoxArray.length,j=E?E.boxStartIndex:t.collisionBoxArray.length,q=E?E.boxEndIndex:t.collisionBoxArray.length,Z=P?P.boxStartIndex:t.collisionBoxArray.length,G=P?P.boxEndIndex:t.collisionBoxArray.length,H=M?M.boxStartIndex:t.collisionBoxArray.length,W=M?M.boxEndIndex:t.collisionBoxArray.length,X=-1,K=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t;X=K(C,-1),X=K(E,X),X=K(P,X);let J=(X=K(M,X))>-1?1:0;J&&(X*=T/24),t.glyphOffsetArray.length>=ot.MAX_GLYPHS&&U("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey);let Y=oG(l,b,k),[Q,ee]=function(t,r){let i=t.length,a=null==r?void 0:r.values;if((null==a?void 0:a.length)>0)for(let r=0;r<a.length;r+=2){let i=a[r+1];t.emplaceBack(e.aq[a[r]],i[0],i[1])}return[i,t.length]}(t.textAnchorOffsets,Y);t.symbolInstances.emplaceBack(r.x,r.y,B.right>=0?B.right:-1,B.center>=0?B.center:-1,B.left>=0?B.left:-1,B.vertical||-1,L,F,O,V,$,j,q,Z,G,H,W,h,R,D,A,z,J,0,p,X,Q,ee)}(t,p,l,i,a,n,d,t.layers[0],t.collisionBoxArray,r.index,r.sourceLayerIndex,t.index,_,[w,w,w,w],T,u,v,S,I,m,r,s,h,c,o)};if("line"===C)for(let e of oA(r.geometry,0,0,8192,8192))for(let r of function(e,t,r,i,a,n,s,o,l){let u=i?.6*24*s:0,h=oL(i,a),c=h*s,d=0===e[0].x||8192===e[0].x||0===e[0].y||8192===e[0].y;return t-c<t/4&&(t=c+t/4),function e(t,r,i,a,n,s,o,l,u){let h=s/2,c=oD(t),d=0,p=r-i,f=[];for(let e=0;e<t.length-1;e++){let r=t[e],o=t[e+1],l=r.dist(o),m=o.angleTo(r);for(;p+i<d+l;){let g=((p+=i)-d)/l,y=tO.number(r.x,o.x,g),_=tO.number(r.y,o.y,g);if(y>=0&&y<u&&_>=0&&_<u&&p-h>=0&&p+h<=c){let r=new oz(y,_,m,e);r._round(),a&&!oR(t,r,s,a,n)||f.push(r)}}d+=l}return l||f.length||o||(f=e(t,d/2,i,a,n,s,o,!0,u)),f}(e,d?t/2*o%t:(h/2+48)*s*o%t,t,u,r,c,d,!1,8192)}(e,b,k,i.vertical||g,a,0,x,t.overscaling,8192))g&&function(e,t,r,i){let a=e.compareText;if(t in a){let e=a[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<r)return!0}else a[t]=[];return a[t].push(i),!1}(t,g.text,E,r)||A(e,r);else if("line-center"===C){for(let e of r.geometry)if(e.length>1){let t=function(e,t,r,i,a,n){let s=r?.6*24*n:0,o=oL(r,i)*n,l=0,u=oD(e)/2;for(let r=0;r<e.length-1;r++){let i=e[r],a=e[r+1],n=i.dist(a);if(l+n>u){let h=(u-l)/n,c=new oz(tO.number(i.x,a.x,h),tO.number(i.y,a.y,h),a.angleTo(i),r);return c._round(),!s||oR(e,c,o,s,t)?c:void 0}l+=n}}(e,k,i.vertical||g,a,0,x);t&&A(e,t)}}else if("Polygon"===r.type)for(let e of nW(r.geometry,0)){let t=function(e,t=1,r=!1){let i=1/0,a=1/0,n=-1/0,s=-1/0,o=e[0];for(let e=0;e<o.length;e++){let t=o[e];(!e||t.x<i)&&(i=t.x),(!e||t.y<a)&&(a=t.y),(!e||t.x>n)&&(n=t.x),(!e||t.y>s)&&(s=t.y)}let l=Math.min(n-i,s-a),u=l/2,h=new oV([],oj);if(0===l)return new P(i,a);for(let t=i;t<n;t+=l)for(let r=a;r<s;r+=l)h.push(new oU(t+u,r+u,u,e));let c=function(e){let t=0,r=0,i=0,a=e[0];for(let e=0,n=a.length,s=n-1;e<n;s=e++){let n=a[e],o=a[s],l=n.x*o.y-o.x*n.y;r+=(n.x+o.x)*l,i+=(n.y+o.y)*l,t+=3*l}return new oU(r/t,i/t,0,e)}(e),d=h.length;for(;h.length;){let i=h.pop();(i.d>c.d||!c.d)&&(c=i,r&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-c.d<=t||(u=i.h/2,h.push(new oU(i.p.x-u,i.p.y-u,u,e)),h.push(new oU(i.p.x+u,i.p.y-u,u,e)),h.push(new oU(i.p.x-u,i.p.y+u,u,e)),h.push(new oU(i.p.x+u,i.p.y+u,u,e)),d+=4)}return r&&(console.log(`num probes: ${d}`),console.log(`best distance: ${c.d}`)),c.p}(e,16);A(e[0],new oz(t.x,t.y,0))}else if("LineString"===r.type)for(let e of r.geometry)A(e,new oz(e[0].x,e[0].y,0));else if("Point"===r.type)for(let e of r.geometry)for(let t of e)A([t],new oz(t.x,t.y,0))}(t.bucket,a,f,g,t.imageMap,n,d,p,y,_,t.canonical)}t.showCollisionBoxes&&t.bucket.generateCollisionDebugBuffers()},e.br=sc,e.bs=nY,e.bt=sr,e.bu=class{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}},e.bv=sN,e.bw=n5,e.bx=function(e,t,r,n,s){return b(this,void 0,void 0,function*(){if(z())try{return yield X(e,t,r,n,s)}catch(e){}return function(e,t,r,n,s){let o=e.width,l=e.height;i&&a||(a=(i=new OffscreenCanvas(o,l)).getContext("2d",{willReadFrequently:!0})),i.width=o,i.height=l,a.drawImage(e,0,0,o,l);let u=a.getImageData(t,r,n,s);return a.clearRect(0,0,o,l),u.data}(e,t,r,n,s)})},e.by=ok,e.bz=w,e.c=J,e.d=function(e,t){let r=new Image;r.onload=()=>{t(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=W})},r.onerror=()=>t(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let i=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(i):W},e.e=B,e.f=function(e,t){return er(B(e,{type:"json"}),t)},e.g=ee,e.h=K,e.i=Z,e.j=el,e.k=eo,e.l=ei,e.m=er,e.n=function(e){return new sN(e).readFields(sV,[])},e.o=function(e,t,r){if(!e.length)return r(null,[]);let i=e.length,a=Array(e.length),n=null;e.forEach((e,s)=>{t(e,(e,t)=>{e&&(n=e),a[s]=t,0==--i&&r(n,a)})})},e.p=sU,e.q=nv,e.r=iB,e.s=ea,e.t=r3,e.u=ia,e.v=eh,e.w=U,e.x=r6,e.y=rQ,e.z=function([e,t,r]){return t+=90,{x:e*Math.cos(t*=Math.PI/180)*Math.sin(r*=Math.PI/180),y:e*Math.sin(t)*Math.sin(r),z:e*Math.cos(r)}}}),i(["./shared"],function(e){class t{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,r){for(let r of t){this._layerConfigs[r.id]=r;let t=this._layers[r.id]=e.aC(r);t._featureFilter=e.a6(t.filter),this.keyCache[r.id]&&delete this.keyCache[r.id]}for(let e of r)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];for(let t of(this.familiesBySource={},e.bl(Object.values(this._layerConfigs),this.keyCache))){let e=t.map(e=>this._layers[e.id]),r=e[0];if("none"===r.visibility)continue;let i=r.source||"",a=this.familiesBySource[i];a||(a=this.familiesBySource[i]={});let n=r.sourceLayer||"_geojsonTileLayer",s=a[n];s||(s=a[n]=[]),s.push(e)}}}class r{constructor(t){let r={},i=[];for(let e in t){let a=t[e],n=r[e]={};for(let e in a){let t=a[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;let r={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};i.push(r),n[e]={rect:r,metrics:t.metrics}}}let{w:a,h:n}=e.p(i),s=new e.q({width:a||1,height:n||1});for(let i in t){let a=t[i];for(let t in a){let n=a[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;let o=r[i][t].rect;e.q.copy(n.bitmap,s,{x:0,y:0},{x:o.x+1,y:o.y+1},n.bitmap)}}this.image=s,this.positions=r}}e.bm("GlyphAtlas",r);class i{constructor(t){this.tileID=new e.O(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(t,i,n,s,o){let l,u,h,c;this.status="parsing",this.data=t,this.collisionBoxArray=new e.a3;let d=new e.bn(Object.keys(t.layers).sort()),p=new e.bo(this.tileID,this.promoteId);p.bucketLayerIDs=[];let f={},m={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:n},g=i.familiesBySource[this.source];for(let r in g){let i=t.layers[r];if(!i)continue;1===i.version&&e.w(`Vector tile source "${this.source}" layer "${r}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let s=d.encode(r),o=[];for(let e=0;e<i.length;e++){let t=i.feature(e),a=p.getId(t,r);o.push({feature:t,id:a,index:e,sourceLayerIndex:s})}for(let t of g[r]){let r=t[0];r.source!==this.source&&e.w(`layer.source = ${r.source} does not equal this.source = ${this.source}`),r.minzoom&&this.zoom<Math.floor(r.minzoom)||r.maxzoom&&this.zoom>=r.maxzoom||"none"!==r.visibility&&(a(t,this.zoom,n),(f[r.id]=r.createBucket({index:p.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(o,m,this.tileID.canonical),p.bucketLayerIDs.push(t.map(e=>e.id)))}}let y=e.aH(m.glyphDependencies,e=>Object.keys(e).map(Number));this.inFlightDependencies.forEach(e=>null==e?void 0:e.cancel()),this.inFlightDependencies=[];let _=++this.dependencySentinel;Object.keys(y).length?this.inFlightDependencies.push(s.send("getGlyphs",{uid:this.uid,stacks:y,source:this.source,tileID:this.tileID,type:"glyphs"},(e,t)=>{_===this.dependencySentinel&&(l||(l=e,u=t,b.call(this)))})):u={};let x=Object.keys(m.iconDependencies);x.length?this.inFlightDependencies.push(s.send("getImages",{icons:x,source:this.source,tileID:this.tileID,type:"icons"},(e,t)=>{_===this.dependencySentinel&&(l||(l=e,h=t,b.call(this)))})):h={};let v=Object.keys(m.patternDependencies);function b(){if(l)return o(l);if(u&&h&&c){let t=new r(u),i=new e.bp(h,c);for(let r in f){let s=f[r];s instanceof e.a4?(a(s.layers,this.zoom,n),e.bq({bucket:s,glyphMap:u,glyphPositions:t.positions,imageMap:h,imagePositions:i.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):s.hasPattern&&(s instanceof e.br||s instanceof e.bs||s instanceof e.bt)&&(a(s.layers,this.zoom,n),s.addFeatures(m,this.tileID.canonical,i.patternPositions))}this.status="done",o(null,{buckets:Object.values(f).filter(e=>!e.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,imageAtlas:i,glyphMap:this.returnDependencies?u:null,iconMap:this.returnDependencies?h:null,glyphPositions:this.returnDependencies?t.positions:null})}}v.length?this.inFlightDependencies.push(s.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},(e,t)=>{_===this.dependencySentinel&&(l||(l=e,c=t,b.call(this)))})):c={},b.call(this)}}function a(t,r,i){let a=new e.a8(r);for(let e of t)e.recalculate(a,i)}function n(t,r){let i=e.l(t.request,(i,a,n,s)=>{if(i)r(i);else if(a)try{let t=new e.bw.VectorTile(new e.bv(a));r(null,{vectorTile:t,rawData:a,cacheControl:n,expires:s})}catch(n){let e=new Uint8Array(a),i=`Unable to parse the tile at ${t.request.url}, `;r(Error(i+=31===e[0]&&139===e[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${n.messge}`))}});return()=>{i.cancel(),r()}}class s{constructor(e,t,r,i){this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=i||n,this.fetching={},this.loading={},this.loaded={}}loadTile(t,r){let a=t.uid;this.loading||(this.loading={});let n=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.bu(t.request),s=this.loading[a]=new i(t);s.abort=this.loadVectorData(t,(t,i)=>{if(delete this.loading[a],t||!i)return s.status="done",this.loaded[a]=s,r(t);let o=i.rawData,l={};i.expires&&(l.expires=i.expires),i.cacheControl&&(l.cacheControl=i.cacheControl);let u={};if(n){let e=n.finish();e&&(u.resourceTiming=JSON.parse(JSON.stringify(e)))}s.vectorTile=i.vectorTile,s.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,(t,i)=>{if(delete this.fetching[a],t||!i)return r(t);r(null,e.e({rawTileData:o.slice(0)},i,l,u))}),this.loaded=this.loaded||{},this.loaded[a]=s,this.fetching[a]={rawTileData:o,cacheControl:l,resourceTiming:u}})}reloadTile(t,r){let i=this.loaded,a=t.uid;if(i&&i[a]){let n=i[a];n.showCollisionBoxes=t.showCollisionBoxes,"parsing"===n.status?n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor,(t,i)=>{let n;if(t||!i)return r(t,i);if(this.fetching[a]){let{rawTileData:t,cacheControl:r,resourceTiming:s}=this.fetching[a];delete this.fetching[a],n=e.e({rawTileData:t.slice(0)},i,r,s)}else n=i;r(null,n)}):"done"===n.status&&(n.vectorTile?n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor,r):r())}}abortTile(e,t){let r=this.loading,i=e.uid;r&&r[i]&&r[i].abort&&(r[i].abort(),delete r[i]),t()}removeTile(e,t){let r=this.loaded,i=e.uid;r&&r[i]&&delete r[i],t()}}class o{constructor(){this.loaded={}}loadTile(t,r){return e._(this,void 0,void 0,function*(){let{uid:i,encoding:a,rawImageData:n,redFactor:s,greenFactor:o,blueFactor:l,baseShift:u}=t,h=n.width+2,c=n.height+2,d=e.a(n)?new e.R({width:h,height:c},(yield e.bx(n,-1,-1,h,c))):n,p=new e.by(i,d,a,s,o,l,u);this.loaded=this.loaded||{},this.loaded[i]=p,r(null,p)})}removeTile(e){let t=this.loaded,r=e.uid;t&&t[r]&&delete t[r]}}function l(e,t){if(0!==e.length){u(e[0],t);for(var r=1;r<e.length;r++)u(e[r],!t)}}function u(e,t){for(var r=0,i=0,a=0,n=e.length,s=n-1;a<n;s=a++){var o=(e[a][0]-e[s][0])*(e[s][1]+e[a][1]),l=r+o;i+=Math.abs(r)>=Math.abs(o)?r-l+o:o-l+r,r=l}r+i>=0!=!!t&&e.reverse()}var h,c=e.bz(function e(t,r){var i,a=t&&t.type;if("FeatureCollection"===a)for(i=0;i<t.features.length;i++)e(t.features[i],r);else if("GeometryCollection"===a)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],r);else if("Feature"===a)e(t.geometry,r);else if("Polygon"===a)l(t.coordinates,r);else if("MultiPolygon"===a)for(i=0;i<t.coordinates.length;i++)l(t.coordinates[i],r);return t});let d=e.bw.VectorTileFeature.prototype.toGeoJSON;var p={exports:{}},f=e.bA,m=e.bw.VectorTileFeature;function g(e,t){this.options=t||{},this.features=e,this.length=e.length}function y(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}g.prototype.feature=function(e){return new y(this.features[e],this.options.extent)},y.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],i=[],a=0;a<r.length;a++)i.push(new f(r[a][0],r[a][1]));this.geometry.push(i)}return this.geometry},y.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,i=1/0,a=-1/0,n=0;n<e.length;n++)for(var s=e[n],o=0;o<s.length;o++){var l=s[o];t=Math.min(t,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),a=Math.max(a,l.y)}return[t,i,r,a]},y.prototype.toGeoJSON=m.prototype.toGeoJSON;var _=e.bB;function x(e){var t=new _;return function(e,t){for(var r in e.layers)t.writeMessage(3,v,e.layers[r])}(e,t),t.finish()}function v(e,t){t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r,i={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)i.feature=e.feature(r),t.writeMessage(2,b,i);var a=i.keys;for(r=0;r<a.length;r++)t.writeStringField(3,a[r]);var n=i.values;for(r=0;r<n.length;r++)t.writeMessage(4,k,n[r])}function b(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,w,e),t.writeVarintField(3,r.type),t.writeMessage(4,S,r)}function w(e,t){var r=e.feature,i=e.keys,a=e.values,n=e.keycache,s=e.valuecache;for(var o in r.properties){var l=r.properties[o],u=n[o];if(null!==l){void 0===u&&(i.push(o),n[o]=u=i.length-1),t.writeVarint(u);var h=typeof l;"string"!==h&&"boolean"!==h&&"number"!==h&&(l=JSON.stringify(l));var c=h+":"+l,d=s[c];void 0===d&&(a.push(l),s[c]=d=a.length-1),t.writeVarint(d)}}}function S(e,t){for(var r=e.loadGeometry(),i=e.type,a=0,n=0,s=r.length,o=0;o<s;o++){var l=r[o],u=1;1===i&&(u=l.length),t.writeVarint((u<<3)+1);for(var h=3===i?l.length-1:l.length,c=0;c<h;c++){1===c&&1!==i&&t.writeVarint((h-1<<3)+2);var d=l[c].x-a,p=l[c].y-n;t.writeVarint(d<<1^d>>31),t.writeVarint(p<<1^p>>31),a+=d,n+=p}3===i&&t.writeVarint(15)}}function k(e,t){var r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}p.exports=x,p.exports.fromVectorTileJs=x,p.exports.fromGeojsonVt=function(e,t){t=t||{};var r={};for(var i in e)r[i]=new g(e[i].features,t),r[i].name=i,r[i].version=t.version,r[i].extent=t.extent;return x({layers:r})},p.exports.GeoJSONWrapper=g;var T=e.bz(p.exports);let I={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},C=Math.fround||(h=new Float32Array(1),e=>(h[0]=+e,h[0]));class P{constructor(e){this.options=Object.assign(Object.create(I),e),this.trees=Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){let{log:t,minZoom:r,maxZoom:i}=this.options;t&&console.time("total time");let a=`prepare ${e.length} points`;t&&console.time(a),this.points=e;let n=[];for(let t=0;t<e.length;t++){let r=e[t];if(!r.geometry)continue;let[i,a]=r.geometry.coordinates,s=C(A(i)),o=C(z(a));n.push(s,o,1/0,t,-1,1),this.options.reduce&&n.push(0)}let s=this.trees[i+1]=this._createTree(n);t&&console.timeEnd(a);for(let e=i;e>=r;e--){let r=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-r)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,e[1])),a=180===e[2]?180:((e[2]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,a=180;else if(r>a){let e=this.getClusters([r,i,180,n],t),s=this.getClusters([-180,i,a,n],t);return e.concat(s)}let s=this.trees[this._limitZoom(t)],o=s.range(A(r),z(n),A(a),z(i)),l=s.data,u=[];for(let e of o){let t=this.stride*e;u.push(l[t+5]>1?E(l,t,this.clusterProps):this.points[l[t+3]])}return u}getChildren(e){let t=this._getOriginId(e),r=this._getOriginZoom(e),i="No cluster with the specified id.",a=this.trees[r];if(!a)throw Error(i);let n=a.data;if(t*this.stride>=n.length)throw Error(i);let s=this.options.radius/(this.options.extent*Math.pow(2,r-1)),o=a.within(n[t*this.stride],n[t*this.stride+1],s),l=[];for(let t of o){let r=t*this.stride;n[r+4]===e&&l.push(n[r+5]>1?E(n,r,this.clusterProps):this.points[n[r+3]])}if(0===l.length)throw Error(i);return l}getLeaves(e,t,r){let i=[];return this._appendLeaves(i,e,t=t||10,r=r||0,0),i}getTile(e,t,r){let i=this.trees[this._limitZoom(e)],a=Math.pow(2,e),{extent:n,radius:s}=this.options,o=s/n,l=(r-o)/a,u=(r+1+o)/a,h={features:[]};return this._addTileFeatures(i.range((t-o)/a,l,(t+1+o)/a,u),i.data,t,r,a,h),0===t&&this._addTileFeatures(i.range(1-o/a,l,1,u),i.data,a,r,a,h),t===a-1&&this._addTileFeatures(i.range(0,l,o/a,u),i.data,-1,r,a,h),h.features.length?h:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){let r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,i,a){for(let n of this.getChildren(t)){let t=n.properties;if(t&&t.cluster?a+t.point_count<=i?a+=t.point_count:a=this._appendLeaves(e,t.cluster_id,r,i,a):a<i?a++:e.push(n),e.length===r)break}return a}_createTree(t){let r=new e.av(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)r.add(t[e],t[e+1]);return r.finish(),r.data=t,r}_addTileFeatures(e,t,r,i,a,n){for(let s of e){let e,o,l,u;let h=s*this.stride,c=t[h+5]>1;if(c)e=M(t,h,this.clusterProps),o=t[h],l=t[h+1];else{let r=this.points[t[h+3]];e=r.properties;let[i,a]=r.geometry.coordinates;o=A(i),l=z(a)}let d={type:1,geometry:[[Math.round(this.options.extent*(o*a-r)),Math.round(this.options.extent*(l*a-i))]],tags:e};void 0!==(u=c||this.options.generateId?t[h+3]:this.points[t[h+3]].id)&&(d.id=u),n.features.push(d)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){let{radius:r,extent:i,reduce:a,minPoints:n}=this.options,s=r/(i*Math.pow(2,t)),o=e.data,l=[],u=this.stride;for(let r=0;r<o.length;r+=u){if(o[r+2]<=t)continue;o[r+2]=t;let i=o[r],h=o[r+1],c=e.within(o[r],o[r+1],s),d=o[r+5],p=d;for(let e of c){let r=e*u;o[r+2]>t&&(p+=o[r+5])}if(p>d&&p>=n){let e,n=i*d,s=h*d,f=-1,m=((r/u|0)<<5)+(t+1)+this.points.length;for(let i of c){let l=i*u;if(o[l+2]<=t)continue;o[l+2]=t;let h=o[l+5];n+=o[l]*h,s+=o[l+1]*h,o[l+4]=m,a&&(e||(e=this._map(o,r,!0),f=this.clusterProps.length,this.clusterProps.push(e)),a(e,this._map(o,l)))}o[r+4]=m,l.push(n/p,s/p,1/0,m,-1,p),a&&l.push(f)}else{for(let e=0;e<u;e++)l.push(o[r+e]);if(p>1)for(let e of c){let r=e*u;if(!(o[r+2]<=t)){o[r+2]=t;for(let e=0;e<u;e++)l.push(o[r+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(e[t+5]>1){let i=this.clusterProps[e[t+6]];return r?Object.assign({},i):i}let i=this.points[e[t+3]].properties,a=this.options.map(i);return r&&a===i?Object.assign({},a):a}}function E(e,t,r){return{type:"Feature",id:e[t+3],properties:M(e,t,r),geometry:{type:"Point",coordinates:[360*(e[t]-.5),360*Math.atan(Math.exp((180-360*e[t+1])*Math.PI/180))/Math.PI-90]}}}function M(e,t,r){let i=e[t+5],a=i>=1e4?`${Math.round(i/1e3)}k`:i>=1e3?Math.round(i/100)/10+"k":i,n=e[t+6];return Object.assign(-1===n?{}:Object.assign({},r[n]),{cluster:!0,cluster_id:e[t+3],point_count:i,point_count_abbreviated:a})}function A(e){return e/360+.5}function z(e){let t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function R(e,t,r,i){var a={id:void 0===e?null:e,type:t,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)D(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<t.length;i++)D(e,t[i]);else if("MultiPolygon"===r)for(i=0;i<t.length;i++)for(var a=0;a<t[i].length;a++)D(e,t[i][a])}(a),a}function D(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function L(e,t,r,i){if(t.geometry){var a=t.geometry.coordinates,n=t.geometry.type,s=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),o=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=i||0),"Point"===n)F(a,o);else if("MultiPoint"===n)for(var u=0;u<a.length;u++)F(a[u],o);else if("LineString"===n)B(a,o,s,!1);else if("MultiLineString"===n){if(r.lineMetrics){for(u=0;u<a.length;u++)B(a[u],o=[],s,!1),e.push(R(l,"LineString",o,t.properties));return}O(a,o,s,!1)}else if("Polygon"===n)O(a,o,s,!0);else{if("MultiPolygon"!==n){if("GeometryCollection"===n){for(u=0;u<t.geometry.geometries.length;u++)L(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},r,i);return}throw Error("Input data is not a valid GeoJSON object.")}for(u=0;u<a.length;u++){var h=[];O(a[u],h,s,!0),o.push(h)}}e.push(R(l,n,o,t.properties))}}function F(e,t){t.push(e[0]/360+.5),t.push(N(e[1])),t.push(0)}function B(e,t,r,i){for(var a,n,s=0,o=0;o<e.length;o++){var l=e[o][0]/360+.5,u=N(e[o][1]);t.push(l),t.push(u),t.push(0),o>0&&(s+=i?(a*u-l*n)/2:Math.sqrt(Math.pow(l-a,2)+Math.pow(u-n,2))),a=l,n=u}var h=t.length-3;t[2]=1,function e(t,r,i,a){for(var n,s=a,o=i-r>>1,l=i-r,u=t[r],h=t[r+1],c=t[i],d=t[i+1],p=r+3;p<i;p+=3){var f=function(e,t,r,i,a,n){var s=a-r,o=n-i;if(0!==s||0!==o){var l=((e-r)*s+(t-i)*o)/(s*s+o*o);l>1?(r=a,i=n):l>0&&(r+=s*l,i+=o*l)}return(s=e-r)*s+(o=t-i)*o}(t[p],t[p+1],u,h,c,d);if(f>s)n=p,s=f;else if(f===s){var m=Math.abs(p-o);m<l&&(n=p,l=m)}}s>a&&(n-r>3&&e(t,r,n,a),t[n+2]=s,i-n>3&&e(t,n,i,a))}(t,0,h,r),t[h+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function O(e,t,r,i){for(var a=0;a<e.length;a++){var n=[];B(e[a],n,r,i),t.push(n)}}function N(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function V(e,t,r,i,a,n,s,o){if(i/=t,n>=(r/=t)&&s<i)return e;if(s<r||n>=i)return null;for(var l=[],u=0;u<e.length;u++){var h=e[u],c=h.geometry,d=h.type,p=0===a?h.minX:h.minY,f=0===a?h.maxX:h.maxY;if(p>=r&&f<i)l.push(h);else if(!(f<r||p>=i)){var m=[];if("Point"===d||"MultiPoint"===d)(function(e,t,r,i,a){for(var n=0;n<e.length;n+=3){var s=e[n+a];s>=r&&s<=i&&(t.push(e[n]),t.push(e[n+1]),t.push(e[n+2]))}})(c,m,r,i,a);else if("LineString"===d)$(c,m,r,i,a,!1,o.lineMetrics);else if("MultiLineString"===d)U(c,m,r,i,a,!1);else if("Polygon"===d)U(c,m,r,i,a,!0);else if("MultiPolygon"===d)for(var g=0;g<c.length;g++){var y=[];U(c[g],y,r,i,a,!0),y.length&&m.push(y)}if(m.length){if(o.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(R(h.id,d,m[g],h.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(R(h.id,d,m,h.tags))}}}return l.length?l:null}function $(e,t,r,i,a,n,s){for(var o,l,u=j(e),h=0===a?Z:G,c=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],y=e[d+4],_=0===a?p:f,x=0===a?g:y,v=!1;s&&(o=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),_<r?x>r&&(l=h(u,p,f,g,y,r),s&&(u.start=c+o*l)):_>i?x<i&&(l=h(u,p,f,g,y,i),s&&(u.start=c+o*l)):q(u,p,f,m),x<r&&_>=r&&(l=h(u,p,f,g,y,r),v=!0),x>i&&_<=i&&(l=h(u,p,f,g,y,i),v=!0),!n&&v&&(s&&(u.end=c+o*l),t.push(u),u=j(e)),s&&(c+=o)}var b=e.length-3;p=e[b],f=e[b+1],m=e[b+2],(_=0===a?p:f)>=r&&_<=i&&q(u,p,f,m),b=u.length-3,n&&b>=3&&(u[b]!==u[0]||u[b+1]!==u[1])&&q(u,u[0],u[1],u[2]),u.length&&t.push(u)}function j(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function U(e,t,r,i,a,n){for(var s=0;s<e.length;s++)$(e[s],t,r,i,a,n,!1)}function q(e,t,r,i){e.push(t),e.push(r),e.push(i)}function Z(e,t,r,i,a,n){var s=(n-t)/(i-t);return e.push(n),e.push(r+(a-r)*s),e.push(1),s}function G(e,t,r,i,a,n){var s=(n-r)/(a-r);return e.push(t+(i-t)*s),e.push(n),e.push(1),s}function H(e,t){for(var r=[],i=0;i<e.length;i++){var a,n=e[i],s=n.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)a=W(n.geometry,t);else if("MultiLineString"===s||"Polygon"===s){a=[];for(var o=0;o<n.geometry.length;o++)a.push(W(n.geometry[o],t))}else if("MultiPolygon"===s)for(a=[],o=0;o<n.geometry.length;o++){for(var l=[],u=0;u<n.geometry[o].length;u++)l.push(W(n.geometry[o][u],t));a.push(l)}r.push(R(n.id,s,a,n.tags))}return r}function W(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var i=0;i<e.length;i+=3)r.push(e[i]+t,e[i+1],e[i+2]);return r}function X(e,t){if(e.transformed)return e;var r,i,a,n=1<<e.z,s=e.x,o=e.y;for(r=0;r<e.features.length;r++){var l=e.features[r],u=l.geometry,h=l.type;if(l.geometry=[],1===h)for(i=0;i<u.length;i+=2)l.geometry.push(K(u[i],u[i+1],t,n,s,o));else for(i=0;i<u.length;i++){var c=[];for(a=0;a<u[i].length;a+=2)c.push(K(u[i][a],u[i][a+1],t,n,s,o));l.geometry.push(c)}}return e.transformed=!0,e}function K(e,t,r,i,a,n){return[Math.round(r*(e*i-a)),Math.round(r*(t*i-n))]}function J(e,t,r,i,a,n){var s=i*i;if(i>0&&t.size<(a?s:i))r.numPoints+=t.length/3;else{for(var o=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>s)&&(r.numSimplified++,o.push(t[l]),o.push(t[l+1])),r.numPoints++;a&&function(e,t){for(var r=0,i=0,a=e.length,n=a-2;i<a;n=i,i+=2)r+=(e[i]-e[n])*(e[i+1]+e[n+1]);if(r>0===t)for(i=0,a=e.length;i<a/2;i+=2){var s=e[i],o=e[i+1];e[i]=e[a-2-i],e[i+1]=e[a-1-i],e[a-2-i]=s,e[a-1-i]=o}}(o,n),e.push(o)}}function Y(e,t){var r,i,a,n,s,o,l=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(l&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw Error("promoteId and generateId cannot be used together.");var u=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)L(r,e.features[i],t,i);else L(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],l&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=u,a=(i=t).buffer/i.extent,n=r,s=V(r,1,-1-a,a,0,-1,2,i),o=V(r,1,1-a,2+a,0,-1,2,i),(s||o)&&(n=V(r,1,-a,1+a,0,-1,2,i)||[],s&&(n=H(s,1).concat(n)),o&&(n=n.concat(H(o,-1)))),(u=n).length&&this.splitTile(u,0,0,0),l&&(u.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Q(e,t,r){return 32*((1<<e)*r+t)+e}function ee(e,t){return t?e.properties[t]:e.id}function et(e,t){if(null==e)return!0;if("Feature"===e.type)return null!=ee(e,t);if("FeatureCollection"===e.type){let r=new Set;for(let i of e.features){let e=ee(i,t);if(null==e||r.has(e))return!1;r.add(e)}return!0}return!1}function er(e,t){let r=new Map;if(null==e);else if("Feature"===e.type)r.set(ee(e,t),e);else for(let i of e.features)r.set(ee(i,t),i);return r}Y.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Y.prototype.splitTile=function(e,t,r,i,a,n,s){for(var o=[e,t,r,i],l=this.options,u=l.debug;o.length;){i=o.pop(),r=o.pop(),t=o.pop(),e=o.pop();var h=1<<t,c=Q(t,r,i),d=this.tiles[c];if(!d&&(u>1&&console.time("creation"),d=this.tiles[c]=function(e,t,r,i,a){for(var n=t===a.maxZoom?0:a.tolerance/((1<<t)*a.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},o=0;o<e.length;o++){s.numFeatures++,function(e,t,r,i){var a=t.geometry,n=t.type,s=[];if("Point"===n||"MultiPoint"===n)for(var o=0;o<a.length;o+=3)s.push(a[o]),s.push(a[o+1]),e.numPoints++,e.numSimplified++;else if("LineString"===n)J(s,a,e,r,!1,!1);else if("MultiLineString"===n||"Polygon"===n)for(o=0;o<a.length;o++)J(s,a[o],e,r,"Polygon"===n,0===o);else if("MultiPolygon"===n)for(var l=0;l<a.length;l++){var u=a[l];for(o=0;o<u.length;o++)J(s,u[o],e,r,!0,0===o)}if(s.length){var h=t.tags||null;if("LineString"===n&&i.lineMetrics){for(var c in h={},t.tags)h[c]=t.tags[c];h.mapbox_clip_start=a.start/a.size,h.mapbox_clip_end=a.end/a.size}var d={geometry:s,type:"Polygon"===n||"MultiPolygon"===n?3:"LineString"===n||"MultiLineString"===n?2:1,tags:h};null!==t.id&&(d.id=t.id),e.features.push(d)}}(s,e[o],n,a);var l=e[o].minX,u=e[o].minY,h=e[o].maxX,c=e[o].maxY;l<s.minX&&(s.minX=l),u<s.minY&&(s.minY=u),h>s.maxX&&(s.maxX=h),c>s.maxY&&(s.maxY=c)}return s}(e,t,r,i,l),this.tileCoords.push({z:t,x:r,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,a){if(t===l.maxZoom||t===a)continue;var f=1<<a-t;if(r!==Math.floor(n/f)||i!==Math.floor(s/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){u>1&&console.time("clipping");var m,g,y,_,x,v,b=.5*l.buffer/l.extent,w=.5-b,S=.5+b,k=1+b;m=g=y=_=null,x=V(e,h,r-b,r+S,0,d.minX,d.maxX,l),v=V(e,h,r+w,r+k,0,d.minX,d.maxX,l),e=null,x&&(m=V(x,h,i-b,i+S,1,d.minY,d.maxY,l),g=V(x,h,i+w,i+k,1,d.minY,d.maxY,l),x=null),v&&(y=V(v,h,i-b,i+S,1,d.minY,d.maxY,l),_=V(v,h,i+w,i+k,1,d.minY,d.maxY,l),v=null),u>1&&console.timeEnd("clipping"),o.push(m||[],t+1,2*r,2*i),o.push(g||[],t+1,2*r,2*i+1),o.push(y||[],t+1,2*r+1,2*i),o.push(_||[],t+1,2*r+1,2*i+1)}}},Y.prototype.getTile=function(e,t,r){var i=this.options,a=i.extent,n=i.debug;if(e<0||e>24)return null;var s=1<<e,o=Q(e,t=(t%s+s)%s,r);if(this.tiles[o])return X(this.tiles[o],a);n>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var l,u=e,h=t,c=r;!l&&u>0;)u--,h=Math.floor(h/2),c=Math.floor(c/2),l=this.tiles[Q(u,h,c)];return l&&l.source?(n>1&&console.log("found parent tile z%d-%d-%d",u,h,c),n>1&&console.time("drilling down"),this.splitTile(l.source,u,h,c,e,t,r),n>1&&console.timeEnd("drilling down"),this.tiles[o]?X(this.tiles[o],a):null):null};class ei extends s{constructor(t,r,i,a){super(t,r,i),this._dataUpdateable=new Map,this.loadGeoJSON=(t,r)=>{let{promoteId:i}=t;if(t.request)return e.f(t.request,(e,t,a,n)=>{this._dataUpdateable=et(t,i)?er(t,i):void 0,r(e,t,a,n)});if("string"==typeof t.data)try{let e=JSON.parse(t.data);this._dataUpdateable=et(e,i)?er(e,i):void 0,r(null,e)}catch(e){r(Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}else t.dataDiff?this._dataUpdateable?(function(e,t,r){var i,a,n,s;if(t.removeAll&&e.clear(),t.remove)for(let r of t.remove)e.delete(r);if(t.add)for(let i of t.add){let t=ee(i,r);null!=t&&e.set(t,i)}if(t.update)for(let r of t.update){let t=e.get(r.id);if(null==t)continue;let o=!r.removeAllProperties&&((null===(i=r.removeProperties)||void 0===i?void 0:i.length)>0||(null===(a=r.addOrUpdateProperties)||void 0===a?void 0:a.length)>0);if((r.newGeometry||r.removeAllProperties||o)&&(t=Object.assign({},t),e.set(r.id,t),o&&(t.properties=Object.assign({},t.properties))),r.newGeometry&&(t.geometry=r.newGeometry),r.removeAllProperties)t.properties={};else if((null===(n=r.removeProperties)||void 0===n?void 0:n.length)>0)for(let e of r.removeProperties)Object.prototype.hasOwnProperty.call(t.properties,e)&&delete t.properties[e];if((null===(s=r.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(let{key:e,value:i}of r.addOrUpdateProperties)t.properties[e]=i}}(this._dataUpdateable,t.dataDiff,i),r(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):r(Error(`Cannot update existing geojson data in ${t.source}`)):r(Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,a&&(this.loadGeoJSON=a)}loadGeoJSONTile(t,r){let i=t.tileID.canonical;if(!this._geoJSONIndex)return r(null,null);let a=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!a)return r(null,null);let n=new class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.N,this.length=t.length,this._features=t}feature(t){return new class{constructor(t){this._feature=t,this.extent=e.N,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){let t=[];for(let r of this._feature.geometry)t.push([new e.P(r[0],r[1])]);return t}{let t=[];for(let r of this._feature.geometry){let i=[];for(let t of r)i.push(new e.P(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,r){return d.call(this,e,t,r)}}(this._features[t])}}(a.features),s=T(n);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),r(null,{vectorTile:n,rawData:s.buffer})}loadData(t,r){var i;null===(i=this._pendingRequest)||void 0===i||i.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});let a=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.bu(t.request);this._pendingCallback=r,this._pendingRequest=this.loadGeoJSON(t,(i,n)=>{if(delete this._pendingCallback,delete this._pendingRequest,i||!n)return r(i);if("object"!=typeof n)return r(Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{c(n,!0);try{var s,o;if(t.filter){let r=e.bC(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===r.result)throw Error(r.value.map(e=>`${e.key}: ${e.message}`).join(", "));let i=n.features.filter(e=>r.value.evaluate({zoom:0},e));n={type:"FeatureCollection",features:i}}this._geoJSONIndex=t.cluster?new P(function({superclusterOptions:t,clusterProperties:r}){if(!r||!t)return t;let i={},a={},n={accumulated:null,zoom:0},s={properties:null},o=Object.keys(r);for(let t of o){let[n,s]=r[t],o=e.bC(s),l=e.bC("string"==typeof n?[n,["accumulated"],["get",t]]:n);i[t]=o.value,a[t]=l.value}return t.map=e=>{s.properties=e;let t={};for(let e of o)t[e]=i[e].evaluate(n,s);return t},t.reduce=(e,t)=>{for(let r of(s.properties=t,o))n.accumulated=e[r],e[r]=a[r].evaluate(n,s)},t}(t)).load(n.features):(s=n,o=t.geojsonVtOptions,new Y(s,o))}catch(e){return r(e)}this.loaded={};let i={};if(a){let e=a.finish();e&&(i.resourceTiming={},i.resourceTiming[t.source]=JSON.parse(JSON.stringify(e)))}r(null,i)}})}reloadTile(e,t){let r=this.loaded;return r&&r[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}removeSource(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t()}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class ea{constructor(t){this.self=t,this.actor=new e.C(t,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:s,geojson:ei},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.bD.isParsed())throw Error("RTL text plugin already registered.");e.bD.applyArabicShaping=t.applyArabicShaping,e.bD.processBidirectionalText=t.processBidirectionalText,e.bD.processStyledBidirectionalText=t.processStyledBidirectionalText}}setReferrer(e,t){this.referrer=t}setImages(e,t,r){for(let r in this.availableImages[e]=t,this.workerSources[e]){let i=this.workerSources[e][r];for(let e in i)i[e].availableImages=t}r()}setLayers(e,t,r){this.getLayerIndex(e).replace(t),r()}updateLayers(e,t,r){this.getLayerIndex(e).update(t.layers,t.removedIds),r()}loadTile(e,t,r){this.getWorkerSource(e,t.type,t.source).loadTile(t,r)}loadDEMTile(e,t,r){this.getDEMWorkerSource(e,t.source).loadTile(t,r)}reloadTile(e,t,r){this.getWorkerSource(e,t.type,t.source).reloadTile(t,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source).removeTile(t,r)}removeDEMTile(e,t){this.getDEMWorkerSource(e,t.source).removeTile(t)}removeSource(e,t,r){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;let i=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,r):r()}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}syncRTLPluginState(t,r,i){try{e.bD.setState(r);let t=e.bD.getPluginURL();if(e.bD.isLoaded()&&!e.bD.isParsed()&&null!=t){this.self.importScripts(t);let r=e.bD.isParsed();i(r?void 0:Error(`RTL Text Plugin failed to import scripts from ${t}`),r)}}catch(e){i(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let r=this.layerIndexes[e];return r||(r=this.layerIndexes[e]=new t),r}getWorkerSource(e,t,r){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][r]||(this.workerSources[e][t][r]=new this.workerSourceTypes[t]({send:(t,r,i)=>{this.actor.send(t,r,i,e)}},this.getLayerIndex(e),this.getAvailableImages(e))),this.workerSources[e][t][r]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new o),this.demWorkerSources[e][t]}}return e.i()&&(self.worker=new ea(self)),ea}),i(["./shared"],function(e){let t,r,i,a;var n,s="3.6.2";class o{static testProp(e){if(!o.docStyle)return e[0];for(let t=0;t<e.length;t++)if(e[t]in o.docStyle)return e[t];return e[0]}static create(e,t,r){let i=window.document.createElement(e);return void 0!==t&&(i.className=t),r&&r.appendChild(i),i}static createNS(e,t){return window.document.createElementNS(e,t)}static disableDrag(){o.docStyle&&o.selectProp&&(o.userSelect=o.docStyle[o.selectProp],o.docStyle[o.selectProp]="none")}static enableDrag(){o.docStyle&&o.selectProp&&(o.docStyle[o.selectProp]=o.userSelect)}static setTransform(e,t){e.style[o.transformProp]=t}static addEventListener(e,t,r,i={}){e.addEventListener(t,r,"passive"in i?i:i.capture)}static removeEventListener(e,t,r,i={}){e.removeEventListener(t,r,"passive"in i?i:i.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",o.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",o.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",o.suppressClickInternal,!0)},0)}static mousePos(t,r){let i=t.getBoundingClientRect();return new e.P(r.clientX-i.left-t.clientLeft,r.clientY-i.top-t.clientTop)}static touchPos(t,r){let i=t.getBoundingClientRect(),a=[];for(let n=0;n<r.length;n++)a.push(new e.P(r[n].clientX-i.left-t.clientLeft,r[n].clientY-i.top-t.clientTop));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}o.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,o.selectProp=o.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),o.transformProp=o.testProp(["transform","WebkitTransform"]);let l={supported:!1,testSupport:function(e){!c&&h&&(d?p(e):u=e)}},u,h,c=!1,d=!1;function p(e){let t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h),e.isContextLost())return;l.supported=!0}catch(e){}e.deleteTexture(t),c=!0}"undefined"!=typeof document&&((h=document.createElement("img")).onload=function(){u&&p(u),u=null,d=!0},h.onerror=function(){c=!0,u=null},h.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(t){let r,i,a,n;t.resetRequestQueue=()=>{r=[],i=0,a=0,n={}},t.addThrottleControl=e=>{let t=a++;return n[t]=e,t},t.removeThrottleControl=e=>{delete n[e],u()},t.getImage=(e,t,a=!0)=>{l.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*");let n={requestParameters:e,supportImageRefresh:a,callback:t,cancelled:!1,completed:!1,cancel:()=>{n.completed||n.cancelled||(n.cancelled=!0,n.innerRequest&&(n.innerRequest.cancel(),i--),u())}};return r.push(n),u(),n};let s=t=>{let{requestParameters:r,supportImageRefresh:i,callback:a}=t;return e.e(r,{type:"image"}),(!1!==i||e.i()||e.g(r.url)||r.headers&&!Object.keys(r.headers).reduce((e,t)=>e&&"accept"===t,!0)?e.m:h)(r,(e,r,i,n)=>{o(t,a,e,r,i,n)})},o=(t,r,a,n,s,o)=>{var l;a?r(a):n instanceof HTMLImageElement||e.a(n)?r(null,n):n&&(l=(e,t)=>{null!=e?r(e):null!=t&&r(null,t,{cacheControl:s,expires:o})},"function"==typeof createImageBitmap?e.b(n,l):e.d(n,l)),t.cancelled||(t.completed=!0,i--,u())},u=()=>{let t=(()=>{let e=Object.keys(n),t=!1;if(e.length>0){for(let r of e)if(t=n[r]())break}return t})()?e.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:e.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let e=i;e<t&&r.length>0;e++){let t=r.shift();if(t.cancelled){e--;continue}let a=s(t);i++,t.innerRequest=a}},h=(t,r)=>{let i=new Image,a=t.url,n=!1,s=t.credentials;return s&&"include"===s?i.crossOrigin="use-credentials":(s&&"same-origin"===s||!e.s(a))&&(i.crossOrigin="anonymous"),i.fetchPriority="high",i.onload=()=>{r(null,i),i.onerror=i.onload=null},i.onerror=()=>{n||r(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),i.onerror=i.onload=null},i.src=a,{cancel:()=>{n=!0,i.src=""}}}}(_||(_={})),_.resetRequestQueue(),(y=x||(x={})).Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown";class f{constructor(e){this._transformRequestFn=e}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeSpriteURL(e,t,r){let i=function(e){let t=e.match(m);if(!t)throw Error(`Unable to parse URL "${e}"`);return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}(e);return i.path+=`${t}${r}`,function(e){let t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}(i)}setTransformRequest(e){this._transformRequestFn=e}}let m=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function g(t){var r=new e.A(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}var y,_,x,v,b=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e};v=new e.A(3),e.A!=Float32Array&&(v[0]=0,v[1]=0,v[2]=0);var w=function(e){var t=e[0],r=e[1];return t*t+r*r};function S(e){let t=[];if("string"==typeof e)t.push({id:"default",url:e});else if(e&&e.length>0){let r=[];for(let{id:i,url:a}of e){let e=`${i}${a}`;-1===r.indexOf(e)&&(r.push(e),t.push({id:i,url:a}))}}return t}function k(t,r,i,a,n){if(a)return void t(a);if(n!==Object.values(r).length||n!==Object.values(i).length)return;let s={};for(let t in r){s[t]={};let a=e.h.getImageCanvasContext(i[t]),n=r[t];for(let e in n){let{width:r,height:i,x:o,y:l,sdf:u,pixelRatio:h,stretchX:c,stretchY:d,content:p}=n[e];s[t][e]={data:null,pixelRatio:h,sdf:u,stretchX:c,stretchY:d,content:p,spriteData:{width:r,height:i,x:o,y:l,context:a}}}}t(null,s)}n=new e.A(2),e.A!=Float32Array&&(n[0]=0,n[1]=0);class T{constructor(e,t,r,i){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,i)}update(t,r,i){let{width:a,height:n}=t,s=!(this.size&&this.size[0]===a&&this.size[1]===n||i),{context:o}=this,{gl:l}=o;if(this.useMipmap=!!(r&&r.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!r||!1!==r.premultiply)),s)this.size=[a,n],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.a(t)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,t):l.texImage2D(l.TEXTURE_2D,0,this.format,a,n,0,this.format,l.UNSIGNED_BYTE,t.data);else{let{x:r,y:s}=i||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.a(t)?l.texSubImage2D(l.TEXTURE_2D,0,r,s,l.RGBA,l.UNSIGNED_BYTE,t):l.texSubImage2D(l.TEXTURE_2D,0,r,s,a,n,l.RGBA,l.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D)}bind(e,t,r){let{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_2D,this.texture),r!==a.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=a.LINEAR),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class I extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}getImage(t){let r=this.images[t];if(r&&!r.data&&r.spriteData){let t=r.spriteData;r.data=new e.R({width:t.width,height:t.height},t.context.getImageData(t.x,t.y,t.width,t.height).data),r.spriteData=null}return r}addImage(e,t){if(this.images[e])throw Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,t)&&(this.images[e]=t)}_validate(t,r){let i=!0,a=r.data||r.spriteData;return this._validateStretch(r.stretchX,a&&a.width)||(this.fire(new e.j(Error(`Image "${t}" has invalid "stretchX" value`))),i=!1),this._validateStretch(r.stretchY,a&&a.height)||(this.fire(new e.j(Error(`Image "${t}" has invalid "stretchY" value`))),i=!1),this._validateContent(r.content,r)||(this.fire(new e.j(Error(`Image "${t}" has invalid "content" value`))),i=!1),i}_validateStretch(e,t){if(!e)return!0;let r=0;for(let i of e){if(i[0]<r||i[1]<i[0]||t<i[1])return!1;r=i[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;let r=t.spriteData,i=r&&r.width||t.data.width,a=r&&r.height||t.data.height;return!(e[0]<0||i<e[0]||e[1]<0||a<e[1]||e[2]<0||i<e[2]||e[3]<0||a<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,t,r=!0){let i=this.getImage(e);if(r&&(i.data.width!==t.data.width||i.data.height!==t.data.height))throw Error(`size mismatch between old image (${i.data.width}x${i.data.height}) and new image (${t.data.width}x${t.data.height}).`);t.version=i.version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){let t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let r=!0;if(!this.isLoaded())for(let t of e)this.images[t]||(r=!1);this.isLoaded()||r?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,r){let i={};for(let r of t){let t=this.getImage(r);t||(this.fire(new e.k("styleimagemissing",{id:r})),t=this.getImage(r)),t?i[r]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:!!(t.userImage&&t.userImage.render)}:e.w(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,i)}getPixelSize(){let{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){let r=this.patterns[t],i=this.getImage(t);if(!i)return null;if(r&&r.position.version===i.version)return r.position;if(r)r.position.version=i.version;else{let r={w:i.data.width+2,h:i.data.height+2,x:0,y:0},a=new e.I(r,i);this.patterns[t]={bin:r,position:a}}return this._updatePatternAtlas(),this.patterns[t].position}bind(e){let t=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new T(e,this.atlasImage,t.RGBA),this.atlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE)}_updatePatternAtlas(){let t=[];for(let e in this.patterns)t.push(this.patterns[e].bin);let{w:r,h:i}=e.p(t),a=this.atlasImage;for(let t in a.resize({width:r||1,height:i||1}),this.patterns){let{bin:r}=this.patterns[t],i=r.x+1,n=r.y+1,s=this.getImage(t).data,o=s.width,l=s.height;e.R.copy(s,a,{x:0,y:0},{x:i,y:n},{width:o,height:l}),e.R.copy(s,a,{x:0,y:l-1},{x:i,y:n-1},{width:o,height:1}),e.R.copy(s,a,{x:0,y:0},{x:i,y:n+l},{width:o,height:1}),e.R.copy(s,a,{x:o-1,y:0},{x:i-1,y:n},{width:1,height:l}),e.R.copy(s,a,{x:0,y:0},{x:i+o,y:n},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(let r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;let t=this.getImage(r);t||e.w(`Image with ID: "${r}" was not found`),function(e){let{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}(t)&&this.updateImage(r,t)}}}function C(e,t,r,i,a,n,s,o,l){for(let u=t;u<t+i;u++)P(e,r*n+u,n,a,s,o,l);for(let u=r;u<r+a;u++)P(e,u*n+t,1,i,s,o,l)}function P(e,t,r,i,a,n,s){n[0]=0,s[0]=-1e20,s[1]=1e20,a[0]=e[t];for(let o=1,l=0,u=0;o<i;o++){a[o]=e[t+o*r];let i=o*o;do{let e=n[l];u=(a[o]-a[e]+i-e*e)/(o-e)/2}while(u<=s[l]&&--l>-1);n[++l]=o,s[l]=u,s[l+1]=1e20}for(let o=0,l=0;o<i;o++){for(;s[l+1]<o;)l++;let i=n[l],u=o-i;e[t+o*r]=a[i]+u*u}}class E{constructor(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}}setURL(e){this.url=e}getGlyphs(t,r){let i=[];for(let e in t)for(let r of t[e])i.push({stack:e,id:r});e.o(i,({stack:e,id:t},r)=>{let i=this.entries[e];i||(i=this.entries[e]={glyphs:{},requests:{},ranges:{}});let a=i.glyphs[t];if(void 0!==a)return void r(null,{stack:e,id:t,glyph:a});if(a=this._tinySDF(i,e,t))return i.glyphs[t]=a,void r(null,{stack:e,id:t,glyph:a});let n=Math.floor(t/256);if(256*n>65535)return void r(Error("glyphs > 65535 not supported"));if(i.ranges[n])return void r(null,{stack:e,id:t,glyph:a});if(!this.url)return void r(Error("glyphsUrl is not set"));let s=i.requests[n];s||(s=i.requests[n]=[],E.loadGlyphRange(e,n,this.url,this.requestManager,(e,t)=>{if(t){for(let e in t)this._doesCharSupportLocalGlyph(+e)||(i.glyphs[+e]=t[+e]);i.ranges[n]=!0}for(let r of s)r(e,t);delete i.requests[n]})),s.push((i,a)=>{i?r(i):a&&r(null,{stack:e,id:t,glyph:a[t]||null})})},(e,t)=>{if(e)r(e);else if(t){let e={};for(let{stack:r,id:i,glyph:a}of t)(e[r]||(e[r]={}))[i]=a&&{id:a.id,bitmap:a.bitmap.clone(),metrics:a.metrics};r(null,e)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(e.u["CJK Unified Ideographs"](t)||e.u["Hangul Syllables"](t)||e.u.Hiragana(t)||e.u.Katakana(t))}_tinySDF(t,r,i){let a=this.localIdeographFontFamily;if(!a||!this._doesCharSupportLocalGlyph(i))return;let n=t.tinySDF;if(!n){let e="400";/bold/i.test(r)?e="900":/medium/i.test(r)?e="500":/light/i.test(r)&&(e="200"),n=t.tinySDF=new E.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:a,fontWeight:e})}let s=n.draw(String.fromCharCode(i));return{id:i,bitmap:new e.q({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}E.loadGlyphRange=function(t,r,i,a,n){let s=256*r,o=a.transformRequest(i.replace("{fontstack}",t).replace("{range}",`${s}-${s+255}`),x.Glyphs);e.l(o,(t,r)=>{if(t)n(t);else if(r){let t={};for(let i of e.n(r))t[i.id]=i;n(null,t)}})},E.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:a="sans-serif",fontWeight:n="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=r;let o=this.size=e+4*t,l=this._createCanvas(o),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${s} ${n} ${e}px ${a}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Uint16Array(o)}_createCanvas(e){let t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:a,actualBoundingBoxRight:n}=this.ctx.measureText(e),s=Math.ceil(r),o=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(n-a))),l=Math.min(this.size-this.buffer,s+Math.ceil(i)),u=o+2*this.buffer,h=l+2*this.buffer,c=Math.max(u*h,0),d=new Uint8ClampedArray(c),p={data:d,width:u,height:h,glyphWidth:o,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===o||0===l)return p;let{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;f.clearRect(m,m,o,l),f.fillText(e,m,m+s);let _=f.getImageData(m,m,o,l);y.fill(1e20,0,c),g.fill(0,0,c);for(let e=0;e<l;e++)for(let t=0;t<o;t++){let r=_.data[4*(e*o+t)+3]/255;if(0===r)continue;let i=(e+m)*u+t+m;if(1===r)y[i]=0,g[i]=1e20;else{let e=.5-r;y[i]=e>0?e*e:0,g[i]=e<0?e*e:0}}C(y,0,0,u,h,u,this.f,this.v,this.z),C(g,m,m,o,l,u,this.f,this.v,this.z);for(let e=0;e<c;e++){let t=Math.sqrt(y[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class M{constructor(){this.specification=e.v.light.position}possiblyEvaluate(t,r){return e.z(t.expression.evaluate(r))}interpolate(t,r,i){return{x:e.B.number(t.x,r.x,i),y:e.B.number(t.y,r.y,i),z:e.B.number(t.z,r.z,i)}}}class A extends e.E{constructor(r){super(),t=t||new e.r({anchor:new e.D(e.v.light.anchor),position:new M,color:new e.D(e.v.light.color),intensity:new e.D(e.v.light.intensity)}),this._transitionable=new e.T(t),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(e.t,t,r))for(let e in t){let r=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),r):this._transitionable.setValue(e,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,i){return(!i||!1!==i.validate)&&e.x(this,t.call(e.y,e.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.v})))}}class z{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,t){let r=e.join(",")+String(t);return this.dashEntry[r]||(this.dashEntry[r]=this.addDash(e,t)),this.dashEntry[r]}getDashRanges(e,t,r){let i=[],a=e.length%2==1?-e[e.length-1]*r:0,n=e[0]*r,s=!0;i.push({left:a,right:n,isDash:s,zeroLength:0===e[0]});let o=e[0];for(let t=1;t<e.length;t++){s=!s;let l=e[t];a=o*r,o+=l,n=o*r,i.push({left:a,right:n,isDash:s,zeroLength:0===l})}return i}addRoundDash(e,t,r){let i=t/2;for(let t=-r;t<=r;t++){let a=this.width*(this.nextRow+r+t),n=0,s=e[0];for(let o=0;o<this.width;o++){let l;o/s.right>1&&(s=e[++n]);let u=Math.min(Math.abs(o-s.left),Math.abs(o-s.right)),h=t/r*(i+1);if(s.isDash){let e=i-Math.abs(h);l=Math.sqrt(u*u+e*e)}else l=i-Math.sqrt(u*u+h*h);this.data[a+o]=Math.max(0,Math.min(255,l+128))}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){let r=e[t],i=e[t+1];r.zeroLength?e.splice(t,1):i&&i.isDash===r.isDash&&(i.left=r.left,e.splice(t,1))}let t=e[0],r=e[e.length-1];t.isDash===r.isDash&&(t.left=r.left-this.width,r.right=t.right+this.width);let i=this.width*this.nextRow,a=0,n=e[0];for(let t=0;t<this.width;t++){t/n.right>1&&(n=e[++a]);let r=Math.min(Math.abs(t-n.left),Math.abs(t-n.right));this.data[i+t]=Math.max(0,Math.min(255,(n.isDash?r:-r)+128))}}addDash(t,r){let i=r?7:0,a=2*i+1;if(this.nextRow+a>this.height)return e.w("LineAtlas out of space"),null;let n=0;for(let e=0;e<t.length;e++)n+=t[e];if(0!==n){let e=this.width/n,a=this.getDashRanges(t,this.width,e);r?this.addRoundDash(a,e,i):this.addRegularDash(a)}let s={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:n};return this.nextRow+=a,this.dirty=!0,s}bind(e){let t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}class R{constructor(t,r,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=i;let a=this.workerPool.acquire(i);for(let t=0;t<a.length;t++){let n=new e.C(a[t],r,i);n.name=`Worker ${t}`,this.actors.push(n)}if(!this.actors.length)throw Error("No actors found")}broadcast(t,r,i){e.o(this.actors,(e,i)=>{e.send(t,r,i)},i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(e=>{e.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}}function D(t,r,i){let a=function(r,a){if(r)return i(r);if(a){let r=e.F(e.e(a,t),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(r.vectorLayers=a.vector_layers,r.vectorLayerIds=r.vectorLayers.map(e=>e.id)),i(null,r)}};return t.url?e.f(r.transformRequest(t.url,x.Source),a):e.h.frame(()=>a(null,t))}class L{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&(4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(t){return this._ne=t instanceof e.L?new e.L(t.lng,t.lat):e.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof e.L?new e.L(t.lng,t.lat):e.L.convert(t),this}extend(t){let r,i;let a=this._sw,n=this._ne;if(t instanceof e.L)r=t,i=t;else{if(!(t instanceof L))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(L.convert(t)):this.extend(e.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(e.L.convert(t)):this;if(r=t._sw,i=t._ne,!r||!i)return this}return a||n?(a.lng=Math.min(r.lng,a.lng),a.lat=Math.min(r.lat,a.lat),n.lng=Math.max(i.lng,n.lng),n.lat=Math.max(i.lat,n.lat)):(this._sw=new e.L(r.lng,r.lat),this._ne=new e.L(i.lng,i.lat)),this}getCenter(){return new e.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new e.L(this.getWest(),this.getNorth())}getSouthEast(){return new e.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:r,lat:i}=e.L.convert(t),a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&a}static convert(e){return e instanceof L?e:e?new L(e):e}static fromLngLat(t,r=0){let i=360*r/40075017,a=i/Math.cos(Math.PI/180*t.lat);return new L(new e.L(t.lng-a,t.lat-i),new e.L(t.lng+a,t.lat+i))}}class F{constructor(e,t,r){this.bounds=L.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){let r=Math.pow(2,t.z),i=Math.floor(e.G(this.bounds.getWest())*r),a=Math.floor(e.H(this.bounds.getNorth())*r),n=Math.ceil(e.G(this.bounds.getEast())*r),s=Math.ceil(e.H(this.bounds.getSouth())*r);return t.x>=i&&t.x<n&&t.y>=a&&t.y<s}}class B extends e.E{constructor(t,r,i,a){if(super(),this.load=()=>{this._loaded=!1,this.fire(new e.k("dataloading",{dataType:"source"})),this._tileJSONRequest=D(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new e.j(t)):r&&(e.e(this,r),r.bounds&&(this.tileBounds=new F(r.bounds,this.minzoom,this.maxzoom)),this.fire(new e.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>e.e({},this._options),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.F(r,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a)}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(e,t){let r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i={request:this.map._requestManager.transformRequest(r,x.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function a(r,i){return delete e.request,e.aborted?t(null):r&&404!==r.status?t(r):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=t:e.request=e.actor.send("reloadTile",i,a.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,a.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class O extends e.E{constructor(t,r,i,a){super(),this.id=t,this.dispatcher=i,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},r),e.e(this,e.F(r,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new e.k("dataloading",{dataType:"source"})),this._tileJSONRequest=D(this._options,this.map._requestManager,(t,r)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.j(t)):r&&(e.e(this,r),r.bounds&&(this.tileBounds=new F(r.bounds,this.minzoom,this.maxzoom)),this.fire(new e.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}serialize(){return e.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){let r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=_.getImage(this.map._requestManager.transformRequest(r,x.Tile),(r,i,a)=>{if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(r)e.state="errored",t(r);else if(i){this.map._refreshExpiredTiles&&a&&e.setExpiryData(a);let r=this.map.painter.context,n=r.gl;e.texture=this.map.painter.getTileTexture(i.width),e.texture?e.texture.update(i,{useMipmap:!0}):(e.texture=new T(r,i,n.RGBA,{useMipmap:!0}),e.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE,n.LINEAR_MIPMAP_NEAREST),r.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax)),e.state="loaded",t(null)}},this.map._refreshExpiredTiles)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}}class N extends O{constructor(t,r,i,a){super(t,r,i,a),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(t,r){let i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(i,x.Tile);function n(e,i){e&&(t.state="errored",r(e)),i&&(t.dem=i,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",r(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=_.getImage(a,(i,a,s)=>e._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(i)t.state="errored",r(i);else if(a){this.map._refreshExpiredTiles&&t.setExpiryData(s);let r=e.a(a)&&e.J()?a:yield function(t){return e._(this,void 0,void 0,function*(){if("undefined"!=typeof VideoFrame&&e.K()){let r=t.width+2,i=t.height+2;try{return new e.R({width:r,height:i},(yield e.M(t,-1,-1,r,i)))}catch(e){}}return e.h.getImageData(t,1)})}(a),i={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:r,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",i,n))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){let r=t.canonical,i=Math.pow(2,r.z),a=(r.x-1+i)%i,n=0===r.x?t.wrap-1:t.wrap,s=(r.x+1+i)%i,o=r.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.O(t.overscaledZ,n,r.z,a,r.y).key]={backfilled:!1},l[new e.O(t.overscaledZ,o,r.z,s,r.y).key]={backfilled:!1},r.y>0&&(l[new e.O(t.overscaledZ,n,r.z,a,r.y-1).key]={backfilled:!1},l[new e.O(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new e.O(t.overscaledZ,o,r.z,s,r.y-1).key]={backfilled:!1}),r.y+1<i&&(l[new e.O(t.overscaledZ,n,r.z,a,r.y+1).key]={backfilled:!1},l[new e.O(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new e.O(t.overscaledZ,o,r.z,s,r.y+1).key]={backfilled:!1}),l}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})}}class V extends e.E{constructor(t,r,i,a){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>e.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=i.getActor(),this.setEventedParent(a),this._data=r.data,this._options=e.e({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;let n=e.N/this.tileSize;this.workerOptions=e.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*n,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*n,extent:e.N,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.N,radius:(r.clusterRadius||50)*n,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(void 0!==e.clusterRadius&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),void 0!==e.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,r,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:r},i),this}_updateWorkerData(t){let r=e.e({},this.workerOptions);t?r.dataDiff=t:"string"==typeof this._data?(r.request=this.map._requestManager.transformRequest(e.h.resolveURL(this._data),x.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new e.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,r,(t,r)=>{if(this._pendingLoads--,this._removed||r&&r.abandoned)return void this.fire(new e.k("dataabort",{dataType:"source"}));let i=null;if(r&&r.resourceTiming&&r.resourceTiming[this.id]&&(i=r.resourceTiming[this.id].slice(0)),t)return void this.fire(new e.j(t));let a={dataType:"source"};this._collectResourceTiming&&i&&i.length>0&&e.e(a,{resourceTiming:i}),this.fire(new e.k("data",Object.assign(Object.assign({},a),{sourceDataType:"metadata"}))),this.fire(new e.k("data",Object.assign(Object.assign({},a),{sourceDataType:"content"})))})}loaded(){return 0===this._pendingLoads}loadTile(e,t){let r=e.actor?"reloadTile":"loadTile";e.actor=this.actor;let i={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(r,i,(i,a)=>(delete e.request,e.unloadVectorData(),e.aborted?t(null):i?t(i):(e.loadVectorData(a,this.map.painter,"reloadTile"===r),t(null))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var $=e.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class j extends e.E{constructor(t,r,i,a){super(),this.load=(t,r)=>{this._loaded=!1,this.fire(new e.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=_.getImage(this.map._requestManager.transformRequest(this.url,x.Image),(i,a)=>{this._request=null,this._loaded=!0,i?this.fire(new e.j(i)):a&&(this.image=a,t&&(this.coordinates=t),r&&r(),this._finishLoading())})},this.prepare=()=>{if(0===Object.keys(this.tiles).length||!this.image)return;let t=this.map.painter.context,r=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,$.members)),this.boundsSegments||(this.boundsSegments=e.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new T(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let i=!1;for(let e in this.tiles){let t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new e.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=i,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(a),this.options=r}loaded(){return this._loaded}updateImage(e){return e.url&&(this._request&&(this._request.cancel(),this._request=null),this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null})),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;let r=t.map(e.U.fromLngLat);this.tileID=function(t){let r=1/0,i=1/0,a=-1/0,n=-1/0;for(let e of t)r=Math.min(r,e.x),i=Math.min(i,e.y),a=Math.max(a,e.x),n=Math.max(n,e.y);let s=Math.max(0,Math.floor(-Math.log(Math.max(a-r,n-i))/Math.LN2)),o=Math.pow(2,s);return new e.W(s,Math.floor((r+a)/2*o),Math.floor((i+n)/2*o))}(r),this.minzoom=this.maxzoom=this.tileID.z;let i=r.map(e=>this.tileID.getTilePoint(e)._round());return this._boundsArray=new e.V,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,e.N,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,e.N),this._boundsArray.emplaceBack(i[2].x,i[2].y,e.N,e.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored",t(null)}hasTransition(){return!1}}class U extends j{constructor(t,r,i,a){super(t,r,i,a),this.load=()=>{this._loaded=!1;let t=this.options;for(let e of(this.urls=[],t.urls))this.urls.push(this.map._requestManager.transformRequest(e,x.Source).url);e.X(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new e.j(t)):r&&(this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;let t=this.map.painter.context,r=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,$.members)),this.boundsSegments||(this.boundsSegments=e.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new T(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let i=!1;for(let e in this.tiles){let t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new e.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=r}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){let r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new e.j(new e.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class q extends j{constructor(t,r,i,a){super(t,r,i,a),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.j(Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;let r=this.map.painter.context,i=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,$.members)),this.boundsSegments||(this.boundsSegments=e.S.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new T(r,this.canvas,i.RGBA,{premultiply:!0});let a=!1;for(let e in this.tiles){let t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,a=!0)}a&&this.fire(new e.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new e.j(new e.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.j(new e.Y(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new e.j(new e.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof HTMLCanvasElement||this.fire(new e.j(new e.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.j(new e.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let Z={},G=e=>{switch(e){case"geojson":return V;case"image":return j;case"raster":return O;case"raster-dem":return N;case"vector":return B;case"video":return U;case"canvas":return q}return Z[e]};function H(e,t){let r=e.tileID,i=t.tileID;return r.overscaledZ-i.overscaledZ||r.canonical.y-i.canonical.y||r.wrap-i.wrap||r.canonical.x-i.canonical.x}class W{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=e.a2(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let t=e+this.timeAdded;t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(let a in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(e,t){let r={};if(!t)return r;for(let i of e){let e=i.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length)for(let t of(i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0])),e))r[t.id]=i}return r}(t.buckets,r.style),this.hasSymbolBuckets=!1,this.buckets){let t=this.buckets[a];if(t instanceof e.a4){if(this.hasSymbolBuckets=!0,!i)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let t in this.buckets){let r=this.buckets[t];if(r instanceof e.a4&&r.hasRTLText){this.hasRTLText=!0,e.a5();break}}for(let e in this.queryPadding=0,this.buckets){let t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(e).queryRadius(t))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new e.a3}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let t in this.buckets){let r=this.buckets[t];r.uploadPending()&&r.upload(e)}let t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new T(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new T(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,r,i,a,n,s,o,l,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:a,scale:n,tileSize:this.tileSize,pixelPosMatrix:u,transform:o,params:s,queryPadding:this.queryPadding*l},e,t,r):{}}querySourceFeatures(t,r){let i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;let a=i.loadVTLayers(),n=r&&r.sourceLayer?r.sourceLayer:"",s=a._geojsonTileLayer||a[n];if(!s)return;let o=e.a6(r&&r.filter),{z:l,x:u,y:h}=this.tileID.canonical,c={z:l,x:u,y:h};for(let r=0;r<s.length;r++){let a=s.feature(r);if(o.needGeometry){let t=e.a7(a,!0);if(!o.filter(new e.a8(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!o.filter(new e.a8(this.tileID.overscaledZ),a))continue;let d=i.getId(a,n),p=new e.a9(a,l,u,h,d);p.tile=c,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let r=this.expirationTime;if(t.cacheControl){let r=e.aa(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let e=Date.now(),t=!1;if(this.expirationTime>e)t=!1;else if(r){if(this.expirationTime<r)t=!0;else{let i=this.expirationTime-r;i?this.expirationTime=e+Math.max(i,3e4):t=!0}}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),2147483647)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;let r=this.latestFeatureIndex.loadVTLayers();for(let i in this.buckets){if(!t.style.hasLayer(i))continue;let a=this.buckets[i],n=a.layers[0].sourceLayer||"_geojsonTileLayer",s=r[n],o=e[n];if(!s||!o||0===Object.keys(o).length)continue;a.update(o,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});let l=t&&t.style&&t.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.h.now()+t}setDependencies(e,t){let r={};for(let e of t)r[e]=!0;this.dependencies[e]=r}hasDependency(e,t){for(let r of e){let e=this.dependencies[r];if(e){for(let r of t)if(e[r])return!0}}return!1}}class X{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(let e in this.data)for(let t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){let i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);let a={value:t,timeout:void 0};if(void 0!==r&&(a.timeout=setTimeout(()=>{this.remove(e,a)},r)),this.data[i].push(a),this.order.push(i),this.order.length>this.max){let e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){let t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;let r=e.wrapped().key,i=void 0===t?0:this.data[r].indexOf(t),a=this.data[r][i];return this.data[r].splice(i,1),a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(a.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){let t=[];for(let r in this.data)for(let i of this.data[r])e(i.value)||t.push(i);for(let e of t)this.remove(e.value.tileID,e)}}class K{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,i){let a=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][a]=this.stateChanges[t][a]||{},e.e(this.stateChanges[t][a],i),null===this.deletedStates[t])for(let e in this.deletedStates[t]={},this.state[t])e!==a&&(this.deletedStates[t][e]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][a])for(let e in this.deletedStates[t][a]={},this.state[t][a])i[e]||(this.deletedStates[t][a][e]=null);else for(let e in i)this.deletedStates[t]&&this.deletedStates[t][a]&&null===this.deletedStates[t][a][e]&&delete this.deletedStates[t][a][e]}removeFeatureState(e,t,r){if(null===this.deletedStates[e])return;let i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][r]=null);else if(void 0!==t){if(this.stateChanges[e]&&this.stateChanges[e][i])for(r in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][r]=null;else this.deletedStates[e][i]=null}else this.deletedStates[e]=null}getState(t,r){let i=String(r),a=e.e({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){let e=this.deletedStates[t][r];if(null===e)return{};for(let t in e)delete a[t]}return a}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(t,r){let i={};for(let t in this.stateChanges){this.state[t]=this.state[t]||{};let r={};for(let i in this.stateChanges[t])this.state[t][i]||(this.state[t][i]={}),e.e(this.state[t][i],this.stateChanges[t][i]),r[i]=this.state[t][i];i[t]=r}for(let t in this.deletedStates){this.state[t]=this.state[t]||{};let r={};if(null===this.deletedStates[t])for(let e in this.state[t])r[e]={},this.state[t][e]={};else for(let e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else for(let r of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][r];r[e]=this.state[t][e]}i[t]=i[t]||{},e.e(i[t],r)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(let e in t)t[e].setFeatureState(i,r)}}class J extends e.E{constructor(e,t,r){super(),this.id=e,this.dispatcher=r,this.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((e,t,r,i)=>{let a=new(G(t.type))(e,t,r,i);if(a.id!==e)throw Error(`Expected Source id to be ${e} instead of ${a.id}`);return a})(e,t,r,this),this._tiles={},this._cache=new X(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new K,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,t){return this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new e.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){for(let t in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){let r=this._tiles[t];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Y).map(e=>e.key)}getRenderableIds(t){let r=[];for(let e in this._tiles)this._isIdRenderable(e,t)&&r.push(this._tiles[e]);return t?r.sort((t,r)=>{let i=t.tileID,a=r.tileID,n=new e.P(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),s=new e.P(a.canonical.x,a.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-a.overscaledZ||s.y-n.y||s.x-n.x}).map(e=>e.tileID.key):r.map(e=>e.tileID).sort(Y).map(e=>e.key)}hasRenderableParent(e){let t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else for(let e in this._cache.reset(),this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading")}_reloadTile(e,t){let r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(t,r,i,a){if(a)return t.state="errored",void(404!==a.status?this._source.fire(new e.j(a,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=e.h.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new e.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(e){let t=this.getRenderableIds();for(let i=0;i<t.length;i++){let a=t[i];if(e.neighboringTiles&&e.neighboringTiles[a]){let t=this.getTileByID(a);r(e,t),r(t,e)}}function r(e,t){e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0;let r=t.tileID.canonical.x-e.tileID.canonical.x,i=t.tileID.canonical.y-e.tileID.canonical.y,a=Math.pow(2,e.tileID.canonical.z),n=t.tileID.key;0===r&&0===i||Math.abs(i)>1||(Math.abs(r)>1&&(1===Math.abs(r+a)?r+=a:1===Math.abs(r-a)&&(r-=a)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,i),e.neighboringTiles&&e.neighboringTiles[n]&&(e.neighboringTiles[n].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,r,i){for(let a in this._tiles){let n=this._tiles[a];if(i[a]||!n.hasData()||n.tileID.overscaledZ<=t||n.tileID.overscaledZ>r)continue;let s=n.tileID;for(;n&&n.tileID.overscaledZ>t+1;){let e=n.tileID.scaledTo(n.tileID.overscaledZ-1);(n=this._tiles[e.key])&&n.hasData()&&(s=e)}let o=s;for(;o.overscaledZ>t;)if(e[(o=o.scaledTo(o.overscaledZ-1)).key]){i[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){let r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(let r=e.overscaledZ-1;r>=t;r--){let t=e.scaledTo(r),i=this._getLoadedTile(t);if(i)return i}}_getLoadedTile(e){let t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(e.wrapped().key)}updateCacheSize(t){let r=Math.floor((Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1)*(null===this._maxTileCacheZoomLevels?e.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(i)}handleWrapJump(e){let t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){let e={};for(let r in this._tiles){let i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}for(let t in this._tiles=e,this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(let e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}}update(t,r){let i;if(this.transform=t,this.terrain=r,!this._sourceLoaded||this._paused)return;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new e.O(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(i=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r}),this._source.hasTile&&(i=i.filter(e=>this._source.hasTile(e)))):i=[];let a=t.coveringZoomLevel(this._source),n=Math.max(a-J.maxOverzooming,this._source.minzoom),s=Math.max(a+J.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let e={};for(let t of i)if(t.canonical.z>this._source.minzoom){let r=t.scaledTo(t.canonical.z-1);e[r.key]=r;let i=t.scaledTo(Math.max(this._source.minzoom,Math.min(t.canonical.z,5)));e[i.key]=i}i=i.concat(Object.values(e))}let o=0===i.length&&!this._updated&&this._didEmitContent;this._updated=!0,o&&this.fire(new e.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let l=this._updateRetainedTiles(i,a);if(Q(this._source.type)){let t={},o={},u=Object.keys(l),h=e.h.now();for(let e of u){let r=l[e],i=this._tiles[e];if(!i||0!==i.fadeEndTime&&i.fadeEndTime<=h)continue;let a=this.findLoadedParent(r,n);a&&(this._addTile(a.tileID),t[a.tileID.key]=a.tileID),o[e]=r}for(let e in this._retainLoadedChildren(o,a,s,l),t)l[e]||(this._coveredTiles[e]=!0,l[e]=t[e]);if(r){let e={},t={};for(let r of i)this._tiles[r.key].hasData()?e[r.key]=r:t[r.key]=r;for(let r in t){let i=t[r].children(this._source.maxzoom);this._tiles[i[0].key]&&this._tiles[i[1].key]&&this._tiles[i[2].key]&&this._tiles[i[3].key]&&(e[i[0].key]=l[i[0].key]=i[0],e[i[1].key]=l[i[1].key]=i[1],e[i[2].key]=l[i[2].key]=i[2],e[i[3].key]=l[i[3].key]=i[3],delete t[r])}for(let r in t){let i=this.findLoadedParent(t[r],this._source.minzoom);if(i)for(let t in e[i.tileID.key]=l[i.tileID.key]=i.tileID,e)e[t].isChildOf(i.tileID)&&delete e[t]}for(let t in this._tiles)e[t]||(this._coveredTiles[t]=!0)}}for(let e in l)this._tiles[e].clearFadeHold();for(let t of e.ab(this._tiles,l)){let e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(t)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,t){let r={},i={},a=Math.max(t-J.maxOverzooming,this._source.minzoom),n=Math.max(t+J.maxUnderzooming,this._source.minzoom),s={};for(let i of e){let e=this._addTile(i);r[i.key]=i,e.hasData()||t<this._source.maxzoom&&(s[i.key]=i)}for(let o of(this._retainLoadedChildren(s,t,n,r),e)){let e=this._tiles[o.key];if(e.hasData())continue;if(t+1>this._source.maxzoom){let e=o.children(this._source.maxzoom)[0],t=this.getTile(e);if(t&&t.hasData()){r[e.key]=e;continue}}else{let e=o.children(this._source.maxzoom);if(r[e[0].key]&&r[e[1].key]&&r[e[2].key]&&r[e[3].key])continue}let n=e.wasRequested();for(let t=o.overscaledZ-1;t>=a;--t){let a=o.scaledTo(t);if(i[a.key])break;if(i[a.key]=!0,(e=this.getTile(a))||!n||(e=this._addTile(a)),e){let t=e.hasData();if((n||t)&&(r[a.key]=a),n=e.wasRequested(),t)break}}}return r}_updateLoadedParentTileCache(){for(let e in this._loadedParentTiles={},this._tiles){let t=[],r,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){r=this._loadedParentTiles[i.key];break}t.push(i.key);let e=i.scaledTo(i.overscaledZ-1);if(r=this._getLoadedTile(e))break;i=e}for(let e of t)this._loadedParentTiles[e]=r}}_addTile(t){let r=this._tiles[t.key];if(r)return r;(r=this._cache.getAndRemove(t))&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));let i=r;return r||(r=new W(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))),r.uses++,this._tiles[t.key]=r,i||this._source.fire(new e.k("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){let t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){for(let e in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(t,r,i){let a=[],n=this.transform;if(!n)return a;let s=i?n.getCameraQueryGeometry(t):t,o=t.map(e=>n.pointCoordinate(e,this.terrain)),l=s.map(e=>n.pointCoordinate(e,this.terrain)),u=this.getIds(),h=1/0,c=1/0,d=-1/0,p=-1/0;for(let e of l)h=Math.min(h,e.x),c=Math.min(c,e.y),d=Math.max(d,e.x),p=Math.max(p,e.y);for(let t=0;t<u.length;t++){let i=this._tiles[u[t]];if(i.holdingForFade())continue;let s=i.tileID,f=Math.pow(2,n.zoom-i.tileID.overscaledZ),m=r*i.queryPadding*e.N/i.tileSize/f,g=[s.getTilePoint(new e.U(h,c)),s.getTilePoint(new e.U(d,p))];if(g[0].x-m<e.N&&g[0].y-m<e.N&&g[1].x+m>=0&&g[1].y+m>=0){let e=o.map(e=>s.getTilePoint(e)),t=l.map(e=>s.getTilePoint(e));a.push({tile:i,tileID:s,queryGeometry:e,cameraQueryGeometry:t,scale:f})}}return a}getVisibleCoordinates(e){let t=this.getRenderableIds(e).map(e=>this._tiles[e].tileID);for(let e of t)e.posMatrix=this.transform.calculatePosMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Q(this._source.type)){let t=e.h.now();for(let e in this._tiles)if(this._tiles[e].fadeEndTime>=t)return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){let i=this._tiles[e];i&&i.setDependencies(t,r)}reloadTilesForDependencies(e,t){for(let r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(r,"reloading");this._cache.filter(r=>!r.hasDependency(e,t))}}function Y(e,t){let r=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Q(e){return"raster"===e||"image"===e||"video"===e}J.maxOverzooming=10,J.maxUnderzooming=3;let ee="mapboxgl_preloaded_worker_pool";class et{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<et.workerCount;)this.workers.push(new Worker(e.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ee]}numActive(){return Object.keys(this.active).length}}let er=Math.floor(e.h.hardwareConcurrency/2);function ei(){return r||(r=new et),r}et.workerCount=e.ac(globalThis)?Math.max(Math.min(er,3),1):1;class ea{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ad(t,0,1);let r=1,i=this._distances[r],a=t*this.paddedLength+this.padding;for(;i<a&&r<this._distances.length;)i=this._distances[++r];let n=r-1,s=this._distances[n],o=i-s,l=o>0?(a-s)/o:0;return this.points[n].mult(1-l).add(this.points[r].mult(l))}}function en(e,t){let r=!0;return"always"===e||"never"!==e&&"never"!==t||(r=!1),r}class es{constructor(e,t,r){let i=this.boxCells=[],a=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(t/r);for(let e=0;e<this.xCellCount*this.yCellCount;e++)i.push([]),a.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,r,i,a){this._forEachCell(t,r,i,a,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(a)}insertCircle(e,t,r,i){this._forEachCell(t-i,r-i,t+i,r+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(r),this.circles.push(i)}_insertBoxCell(e,t,r,i,a,n){this.boxCells[a].push(n)}_insertCircleCell(e,t,r,i,a,n){this.circleCells[a].push(n)}_query(e,t,r,i,a,n,s){if(r<0||e>this.width||i<0||t>this.height)return[];let o=[];if(e<=0&&t<=0&&this.width<=r&&this.height<=i){if(a)return[{key:null,x1:e,y1:t,x2:r,y2:i}];for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){let t=this.circles[3*e],r=this.circles[3*e+1],i=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-i,y1:r-i,x2:t+i,y2:r+i})}}else this._forEachCell(e,t,r,i,this._queryCell,o,{hitTest:a,overlapMode:n,seenUids:{box:{},circle:{}}},s);return o}query(e,t,r,i){return this._query(e,t,r,i,!1,null)}hitTest(e,t,r,i,a,n){return this._query(e,t,r,i,!0,a,n).length>0}hitTestCircle(e,t,r,i,a){let n=e-r,s=e+r,o=t-r,l=t+r;if(s<0||n>this.width||l<0||o>this.height)return!1;let u=[];return this._forEachCell(n,o,s,l,this._queryCellCircle,u,{hitTest:!0,overlapMode:i,circle:{x:e,y:t,radius:r},seenUids:{box:{},circle:{}}},a),u.length>0}_queryCell(e,t,r,i,a,n,s,o){let{seenUids:l,hitTest:u,overlapMode:h}=s,c=this.boxCells[a];if(null!==c){let a=this.bboxes;for(let s of c)if(!l.box[s]){l.box[s]=!0;let c=4*s,d=this.boxKeys[s];if(e<=a[c+2]&&t<=a[c+3]&&r>=a[c+0]&&i>=a[c+1]&&(!o||o(d))&&(!u||!en(h,d.overlapMode))&&(n.push({key:d,x1:a[c],y1:a[c+1],x2:a[c+2],y2:a[c+3]}),u))return!0}}let d=this.circleCells[a];if(null!==d){let a=this.circles;for(let s of d)if(!l.circle[s]){l.circle[s]=!0;let c=3*s,d=this.circleKeys[s];if(this._circleAndRectCollide(a[c],a[c+1],a[c+2],e,t,r,i)&&(!o||o(d))&&(!u||!en(h,d.overlapMode))){let e=a[c],t=a[c+1],r=a[c+2];if(n.push({key:d,x1:e-r,y1:t-r,x2:e+r,y2:t+r}),u)return!0}}}return!1}_queryCellCircle(e,t,r,i,a,n,s,o){let{circle:l,seenUids:u,overlapMode:h}=s,c=this.boxCells[a];if(null!==c){let e=this.bboxes;for(let t of c)if(!u.box[t]){u.box[t]=!0;let r=4*t,i=this.boxKeys[t];if(this._circleAndRectCollide(l.x,l.y,l.radius,e[r+0],e[r+1],e[r+2],e[r+3])&&(!o||o(i))&&!en(h,i.overlapMode))return n.push(!0),!0}}let d=this.circleCells[a];if(null!==d){let e=this.circles;for(let t of d)if(!u.circle[t]){u.circle[t]=!0;let r=3*t,i=this.circleKeys[t];if(this._circlesCollide(e[r],e[r+1],e[r+2],l.x,l.y,l.radius)&&(!o||o(i))&&!en(h,i.overlapMode))return n.push(!0),!0}}}_forEachCell(e,t,r,i,a,n,s,o){let l=this._convertToXCellCoord(e),u=this._convertToYCellCoord(t),h=this._convertToXCellCoord(r),c=this._convertToYCellCoord(i);for(let d=l;d<=h;d++)for(let l=u;l<=c;l++)if(a.call(this,e,t,r,i,this.xCellCount*l+d,n,s,o))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,r,i,a,n){let s=i-e,o=a-t,l=r+n;return l*l>s*s+o*o}_circleAndRectCollide(e,t,r,i,a,n,s){let o=(n-i)/2,l=Math.abs(e-(i+o));if(l>o+r)return!1;let u=(s-a)/2,h=Math.abs(t-(a+u));if(h>u+r)return!1;if(l<=o||h<=u)return!0;let c=l-o,d=h-u;return c*c+d*d<=r*r}}function eo(t,r,i,a,n){let s=e.Z();return r?(e.a0(s,s,[1/n,1/n,1]),i||e.ae(s,s,a.angle)):e.a1(s,a.labelPlaneMatrix,t),s}function el(t,r,i,a,n){if(r){let r=e.af(t);return e.a0(r,r,[n,n,1]),i||e.ae(r,r,-a.angle),r}return a.glCoordMatrix}function eu(t,r,i){let a;i?(a=[t.x,t.y,i(t.x,t.y),1],e.ag(a,a,r)):ev(a=[t.x,t.y,0,1],a,r);let n=a[3];return{point:new e.P(a[0]/n,a[1]/n),signedDistanceFromCamera:n}}function eh(e,t){return .5+e/t*.5}function ec(e,t,r,i,a,n,s,o,l,u,h,c,d){let p=o.glyphStartIndex+o.numGlyphs,f=o.lineStartIndex,m=o.lineStartIndex+o.lineLength,g=t.getoffsetX(o.glyphStartIndex),y=t.getoffsetX(p-1),_=ey(e*g,r,i,a,n,s,o.segment,f,m,l,u,h,c,d);if(!_)return null;let x=ey(e*y,r,i,a,n,s,o.segment,f,m,l,u,h,c,d);return x?{first:_,last:x}:null}function ed(t,r,i,a){return t===e.ai.horizontal&&Math.abs(i.y-r.y)>Math.abs(i.x-r.x)*a?{useVertical:!0}:(t===e.ai.vertical?r.y<i.y:r.x>i.x)?{needsFlipping:!0}:null}function ep(t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g){let y;let _=r/24,x=t.lineOffsetX*_,v=t.lineOffsetY*_;if(t.numGlyphs>1){let e=t.glyphStartIndex+t.numGlyphs,r=t.lineStartIndex,n=t.lineStartIndex+t.lineLength,h=ec(_,l,x,v,i,c,d,t,u,s,p,m,g);if(!h)return{notEnoughRoom:!0};let b=eu(h.first.point,o,g).point,w=eu(h.last.point,o,g).point;if(a&&!i){let e=ed(t.writingMode,b,w,f);if(e)return e}y=[h.first];for(let a=t.glyphStartIndex+1;a<e-1;a++)y.push(ey(_*l.getoffsetX(a),x,v,i,c,d,t.segment,r,n,u,s,p,m,g));y.push(h.last)}else{if(a&&!i){let r=eu(d,n,g).point,i=t.lineStartIndex+t.segment+1,a=new e.P(u.getx(i),u.gety(i)),s=eu(a,n,g),o=s.signedDistanceFromCamera>0?s.point:ef(d,a,r,1,n,g),l=ed(t.writingMode,r,o,f);if(l)return l}let r=ey(_*l.getoffsetX(t.glyphStartIndex),x,v,i,c,d,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,u,s,p,m,g);if(!r)return{notEnoughRoom:!0};y=[r]}for(let t of y)e.ak(h,t.point,t.angle);return{}}function ef(e,t,r,i,a,n){let s=eu(e.add(e.sub(t)._unit()),a,n).point,o=r.sub(s);return r.add(o._mult(i/o.mag()))}function em(t,r){let{projectionCache:i,lineVertexArray:a,labelPlaneMatrix:n,tileAnchorPoint:s,distanceFromAnchor:o,getElevation:l,previousVertex:u,direction:h,absOffsetX:c}=r;if(i.projections[t])return i.projections[t];let d=new e.P(a.getx(t),a.gety(t)),p=eu(d,n,l);if(p.signedDistanceFromCamera>0)return i.projections[t]=p.point,p.point;let f=t-h;return ef(0===o?s:new e.P(a.getx(f),a.gety(f)),d,u,c-o+1,n,l)}function eg(e,t,r){return e._unit()._perp()._mult(t*r)}function ey(t,r,i,a,n,s,o,l,u,h,c,d,p,f){let m;let g=a?t-r:t+r,y=g>0?1:-1,_=0;a&&(y*=-1,_=Math.PI),y<0&&(_+=Math.PI);let x,v,b=y>0?l+o:l+o+1,w=n,S=n,k=0,T=0,I=Math.abs(g),C=[];for(;k+T<=I;){if((b+=y)<l||b>=u)return null;k+=T,S=w,v=x;let t={projectionCache:d,lineVertexArray:h,labelPlaneMatrix:c,tileAnchorPoint:s,distanceFromAnchor:k,getElevation:f,previousVertex:S,direction:y,absOffsetX:I};if(w=em(b,t),0===i)C.push(S),m=w.sub(S);else{let r;let a=w.sub(S);r=0===a.mag()?eg(em(b+y,t).sub(w),i,y):eg(a,i,y),v||(v=S.add(r)),x=function(t,r,i,a,n,s,o,l){let{projectionCache:u,direction:h}=l;if(u.offsets[t])return u.offsets[t];let c=i.add(r);if(t+h<a||t+h>=n)return u.offsets[t]=c,c;let d=em(t+h,l),p=eg(d.sub(i),o,h),f=i.add(p),m=d.add(p);return u.offsets[t]=e.al(s,c,f,m)||c,u.offsets[t]}(b,r,w,l,u,v,i,t),C.push(v),m=x.sub(v)}T=m.mag()}let P=m._mult((I-k)/T)._add(v||S),E=_+Math.atan2(w.y-S.y,w.x-S.x);return C.push(P),{point:P,angle:p?E:0,path:C}}let e_=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ex(e,t){for(let r=0;r<e;r++){let e=t.length;t.resize(e+4),t.float32.set(e_,3*e)}}function ev(e,t,r){let i=t[0],a=t[1];return e[0]=r[0]*i+r[4]*a+r[12],e[1]=r[1]*i+r[5]*a+r[13],e[3]=r[3]*i+r[7]*a+r[15],e}class eb{constructor(e,t=new es(e.width+200,e.height+200,25),r=new es(e.width+200,e.height+200,25)){this.transform=e,this.grid=t,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,t,r,i,a,n){let s=this.projectAndGetPerspectiveRatio(i,e.anchorPointX,e.anchorPointY,n),o=r*s.perspectiveRatio,l=e.x1*o+s.point.x,u=e.y1*o+s.point.y,h=e.x2*o+s.point.x,c=e.y2*o+s.point.y;return!this.isInsideGrid(l,u,h,c)||"always"!==t&&this.grid.hitTest(l,u,h,c,t,a)||s.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[l,u,h,c],offscreen:this.isOffscreen(l,u,h,c)}}placeCollisionCircles(t,r,i,a,n,s,o,l,u,h,c,d,p,f){let m=[],g=new e.P(r.anchorX,r.anchorY),y=eu(g,s,f),_=eh(this.transform.cameraToCenterDistance,y.signedDistanceFromCamera),x=(h?n/_:n*_)/e.ap,v=eu(g,o,f).point,b=ec(x,a,r.lineOffsetX*x,r.lineOffsetY*x,!1,v,g,r,i,o,{projections:{},offsets:{}},!1,f),w=!1,S=!1,k=!0;if(b){let r=.5*d*_+p,i=new e.P(-100,-100),a=new e.P(this.screenRightBoundary,this.screenBottomBoundary),n=new ea,s=b.first,o=b.last,h=[];for(let e=s.path.length-1;e>=1;e--)h.push(s.path[e]);for(let e=1;e<o.path.length;e++)h.push(o.path[e]);let g=2.5*r;if(l){let e=h.map(e=>eu(e,l,f));h=e.some(e=>e.signedDistanceFromCamera<=0)?[]:e.map(e=>e.point)}let y=[];if(h.length>0){let t=h[0].clone(),r=h[0].clone();for(let e=1;e<h.length;e++)t.x=Math.min(t.x,h[e].x),t.y=Math.min(t.y,h[e].y),r.x=Math.max(r.x,h[e].x),r.y=Math.max(r.y,h[e].y);y=t.x>=i.x&&r.x<=a.x&&t.y>=i.y&&r.y<=a.y?[h]:r.x<i.x||t.x>a.x||r.y<i.y||t.y>a.y?[]:e.am([h],i.x,i.y,a.x,a.y)}for(let e of y){n.reset(e,.25*r);let i=0;i=n.length<=.5*r?1:Math.ceil(n.paddedLength/g)+1;for(let e=0;e<i;e++){let a=e/Math.max(i-1,1),s=n.lerp(a),o=s.x+100,l=s.y+100;m.push(o,l,r,0);let h=o-r,d=l-r,p=o+r,f=l+r;if(k=k&&this.isOffscreen(h,d,p,f),S=S||this.isInsideGrid(h,d,p,f),"always"!==t&&this.grid.hitTestCircle(o,l,r,t,c)&&(w=!0,!u))return{circles:[],offscreen:!1,collisionDetected:w}}}}return{circles:!u&&w||!S||_<this.perspectiveRatioCutoff?[]:m,offscreen:k,collisionDetected:w}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};let r=[],i=1/0,a=1/0,n=-1/0,s=-1/0;for(let o of t){let t=new e.P(o.x+100,o.y+100);i=Math.min(i,t.x),a=Math.min(a,t.y),n=Math.max(n,t.x),s=Math.max(s,t.y),r.push(t)}let o=this.grid.query(i,a,n,s).concat(this.ignoredGrid.query(i,a,n,s)),l={},u={};for(let t of o){let i=t.key;if(void 0===l[i.bucketInstanceId]&&(l[i.bucketInstanceId]={}),l[i.bucketInstanceId][i.featureIndex])continue;let a=[new e.P(t.x1,t.y1),new e.P(t.x2,t.y1),new e.P(t.x2,t.y2),new e.P(t.x1,t.y2)];e.an(r,a)&&(l[i.bucketInstanceId][i.featureIndex]=!0,void 0===u[i.bucketInstanceId]&&(u[i.bucketInstanceId]=[]),u[i.bucketInstanceId].push(i.featureIndex))}return u}insertCollisionBox(e,t,r,i,a,n){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:a,collisionGroupID:n,overlapMode:t},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,r,i,a,n){let s=r?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:a,collisionGroupID:n,overlapMode:t};for(let t=0;t<e.length;t+=4)s.insertCircle(o,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,r,i,a){let n;return a?(n=[r,i,a(r,i),1],e.ag(n,n,t)):ev(n=[r,i,0,1],n,t),{point:new e.P((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5}}isOffscreen(e,t,r,i){return r<100||e>=this.screenRightBoundary||i<100||t>this.screenBottomBoundary}isInsideGrid(e,t,r,i){return r>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){let t=e.ao([]);return e.$(t,t,[-100,-100,0]),t}}function ew(t,r,i){return e.N/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ))*r}class eS{constructor(e,t,r,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class ek{constructor(e,t,r,i,a){this.text=new eS(e?e.text:null,t,r,a),this.icon=new eS(e?e.icon:null,t,i,a)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class eT{constructor(e,t,r){this.text=e,this.icon=t,this.skipFade=r}}class eI{constructor(){this.invProjMatrix=e.Z(),this.viewportMatrix=e.Z(),this.circles=[]}}class eC{constructor(e,t,r,i,a){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=r,this.bucketIndex=i,this.tileID=a}}class eP{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function eE(t,r,i,a,n){let{horizontalAlign:s,verticalAlign:o}=e.au(t);return new e.P(-(s-.5)*r+a[0]*n,-(o-.5)*i+a[1]*n)}function eM(t,r,i,a,n,s){let{x1:o,x2:l,y1:u,y2:h,anchorPointX:c,anchorPointY:d}=t,p=new e.P(r,i);return a&&p._rotate(n?s:-s),{x1:o+p.x,y1:u+p.y,x2:l+p.x,y2:h+p.y,anchorPointX:c,anchorPointY:d}}class eA{constructor(e,t,r,i,a){this.transform=e.clone(),this.terrain=t,this.collisionIndex=new eb(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new eP(i),this.collisionCircleArrays={},this.prevPlacement=a,a&&(a.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,i,a){let n=i.getBucket(r),s=i.latestFeatureIndex;if(!n||!s||r.id!==n.layerIds[0])return;let o=i.collisionBoxArray,l=n.layers[0].layout,u=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),h=i.tileSize/e.N,c=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),d="map"===l.get("text-pitch-alignment"),p="map"===l.get("text-rotation-alignment"),f=ew(i,1,this.transform.zoom),m=eo(c,d,p,this.transform,f),g=null;if(d){let t=el(c,d,p,this.transform,f);g=e.a1([],this.transform.labelPlaneMatrix,t)}this.retainedQueryData[n.bucketInstanceId]=new eC(n.bucketInstanceId,s,n.sourceLayerIndex,n.index,i.tileID);let y={bucket:n,layout:l,posMatrix:c,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:u,textPixelRatio:h,holdingForFade:i.holdingForFade(),collisionBoxArray:o,partiallyEvaluatedTextSize:e.ah(n.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(n.sourceID)};if(a)for(let e of n.sortKeyRanges){let{sortKey:r,symbolInstanceStart:i,symbolInstanceEnd:a}=e;t.push({sortKey:r,symbolInstanceStart:i,symbolInstanceEnd:a,parameters:y})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:n.symbolInstances.length,parameters:y})}attemptAnchorPlacement(t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g){let y=e.aq[t.textAnchor],_=[t.textOffset0,t.textOffset1],x=eE(y,i,a,_,n),v=this.collisionIndex.placeCollisionBox(eM(r,x.x,x.y,s,o,this.transform.angle),c,l,u,h.predicate,g);if((!m||0!==this.collisionIndex.placeCollisionBox(eM(m,x.x,x.y,s,o,this.transform.angle),c,l,u,h.predicate,g).box.length)&&v.box.length>0){let e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID].text&&(e=this.prevPlacement.variableOffsets[d.crossTileID].anchor),0===d.crossTileID)throw Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[d.crossTileID]={textOffset:_,width:i,height:a,anchor:y,textBoxScale:n,prevAnchor:e},this.markUsedJustification(p,y,d,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,d),this.placedOrientations[d.crossTileID]=f),{shift:x,placedGlyphBoxes:v}}}placeLayerBucketPart(t,r,i){let{bucket:a,layout:n,posMatrix:s,textLabelPlaneMatrix:o,labelToScreenMatrix:l,textPixelRatio:u,holdingForFade:h,collisionBoxArray:c,partiallyEvaluatedTextSize:d,collisionGroup:p}=t.parameters,f=n.get("text-optional"),m=n.get("icon-optional"),g=e.ar(n,"text-overlap","text-allow-overlap"),y="always"===g,_=e.ar(n,"icon-overlap","icon-allow-overlap"),x="always"===_,v="map"===n.get("text-rotation-alignment"),b="map"===n.get("text-pitch-alignment"),w="none"!==n.get("icon-text-fit"),S="viewport-y"===n.get("symbol-z-order"),k=y&&(x||!a.hasIconData()||m),T=x&&(y||!a.hasTextData()||f);!a.collisionArrays&&c&&a.deserializeCollisionBoxes(c);let I=this.retainedQueryData[a.bucketInstanceId].tileID,C=this.terrain?(e,t)=>this.terrain.getElevation(I,e,t):null,P=(t,c)=>{var x,S;if(r[t.crossTileID])return;if(h)return void(this.placements[t.crossTileID]=new eT(!1,!1,!1));let I=!1,P=!1,E=!0,M=null,A={box:null,offscreen:null},z={box:null,offscreen:null},R=null,D=null,L=null,F=0,B=0,O=0;c.textFeatureIndex?F=c.textFeatureIndex:t.useRuntimeCollisionCircles&&(F=t.featureIndex),c.verticalTextFeatureIndex&&(B=c.verticalTextFeatureIndex);let N=c.textBox;if(N){let r=r=>{let i=e.ai.horizontal;if(a.allowVerticalPlacement&&!r&&this.prevPlacement){let e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,i=e,this.markUsedOrientation(a,i,t))}return i},i=(r,i)=>{if(a.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&c.verticalTextBox){for(let t of a.writingModes)if(t===e.ai.vertical?z=A=i():A=r(),A&&A.box&&A.box.length)break}else A=r()},n=t.textAnchorOffsetStartIndex,o=t.textAnchorOffsetEndIndex;if(o===n){let n=(e,r)=>{let i=this.collisionIndex.placeCollisionBox(e,g,u,s,p.predicate,C);return i&&i.box&&i.box.length&&(this.markUsedOrientation(a,r,t),this.placedOrientations[t.crossTileID]=r),i};i(()=>n(N,e.ai.horizontal),()=>{let r=c.verticalTextBox;return a.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&r?n(r,e.ai.vertical):{box:null,offscreen:null}}),r(A&&A.box&&A.box.length)}else{let l=e.aq[null===(S=null===(x=this.prevPlacement)||void 0===x?void 0:x.variableOffsets[t.crossTileID])||void 0===S?void 0:S.anchor],h=(e,r,i)=>{let h=e.x2-e.x1,c=e.y2-e.y1,d=t.textBoxScale,f=w&&"never"===_?r:null,m={box:[],offscreen:!1},y="never"===g?1:2,x="never";l&&y++;for(let r=0;r<y;r++){for(let r=n;r<o;r++){let n=a.textAnchorOffsets.get(r);if(l&&n.textAnchor!==l)continue;let o=this.attemptAnchorPlacement(n,e,h,c,d,v,b,u,s,p,x,t,a,i,f,C);if(o&&(m=o.placedGlyphBoxes)&&m.box&&m.box.length)return I=!0,M=o.shift,m}l?l=null:x=g}return m};i(()=>h(N,c.iconBox,e.ai.horizontal),()=>{let r=c.verticalTextBox;return a.allowVerticalPlacement&&!(A&&A.box&&A.box.length)&&t.numVerticalGlyphVertices>0&&r?h(r,c.verticalIconBox,e.ai.vertical):{box:null,offscreen:null}}),A&&(I=A.box,E=A.offscreen);let d=r(A&&A.box);if(!I&&this.prevPlacement){let e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(a,e.anchor,t,d))}}}if(I=(R=A)&&R.box&&R.box.length>0,E=R&&R.offscreen,t.useRuntimeCollisionCircles){let r=a.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),u=e.aj(a.textSizeData,d,r),h=n.get("text-padding");(D=this.collisionIndex.placeCollisionCircles(g,r,a.lineVertexArray,a.glyphOffsetArray,u,s,o,l,i,b,p.predicate,t.collisionCircleDiameter,h,C)).circles.length&&D.collisionDetected&&!i&&e.w("Collisions detected, but collision boxes are not shown"),I=y||D.circles.length>0&&!D.collisionDetected,E=E&&D.offscreen}if(c.iconFeatureIndex&&(O=c.iconFeatureIndex),c.iconBox){let e=e=>{let t=w&&M?eM(e,M.x,M.y,v,b,this.transform.angle):e;return this.collisionIndex.placeCollisionBox(t,_,u,s,p.predicate,C)};P=z&&z.box&&z.box.length&&c.verticalIconBox?(L=e(c.verticalIconBox)).box.length>0:(L=e(c.iconBox)).box.length>0,E=E&&L.offscreen}let V=f||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,$=m||0===t.numIconVertices;if(V||$?$?V||(P=P&&I):I=P&&I:P=I=P&&I,I&&R&&R.box&&this.collisionIndex.insertCollisionBox(R.box,g,n.get("text-ignore-placement"),a.bucketInstanceId,z&&z.box&&B?B:F,p.ID),P&&L&&this.collisionIndex.insertCollisionBox(L.box,_,n.get("icon-ignore-placement"),a.bucketInstanceId,O,p.ID),D&&(I&&this.collisionIndex.insertCollisionCircles(D.circles,g,n.get("text-ignore-placement"),a.bucketInstanceId,F,p.ID),i)){let e=a.bucketInstanceId,t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new eI);for(let e=0;e<D.circles.length;e+=4)t.circles.push(D.circles[e+0]),t.circles.push(D.circles[e+1]),t.circles.push(D.circles[e+2]),t.circles.push(D.collisionDetected?1:0)}if(0===t.crossTileID)throw Error("symbolInstance.crossTileID can't be 0");if(0===a.bucketInstanceId)throw Error("bucket.bucketInstanceId can't be 0");this.placements[t.crossTileID]=new eT(I||k,P||T,E||a.justReloaded),r[t.crossTileID]=!0};if(S){if(0!==t.symbolInstanceStart)throw Error("bucket.bucketInstanceId should be 0");let e=a.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){let r=e[t];P(a.symbolInstances.get(r),a.collisionArrays[r])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)P(a.symbolInstances.get(e),a.collisionArrays[e]);if(i&&a.bucketInstanceId in this.collisionCircleArrays){let t=this.collisionCircleArrays[a.bucketInstanceId];e.as(t.invProjMatrix,s),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1}markUsedJustification(t,r,i,a){let n;for(let s of(n=a===e.ai.vertical?i.verticalPlacedTextSymbolIndex:({left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex})[e.at(r)],[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex]))s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=n>=0&&s!==n?0:i.crossTileID)}markUsedOrientation(t,r,i){let a=r===e.ai.horizontal||r===e.ai.horizontalOnly?r:0,n=r===e.ai.vertical?r:0;for(let e of[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex])t.text.placedSymbolArray.get(e).placedOrientation=a;i.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=n)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let t=this.prevPlacement,r=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;let i=t?t.symbolFadeChange(e):1,a=t?t.opacities:{},n=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(let e in this.placements){let t=this.placements[e],n=a[e];n?(this.opacities[e]=new ek(n,i,t.text,t.icon),r=r||t.text!==n.text.placed||t.icon!==n.icon.placed):(this.opacities[e]=new ek(null,i,t.text,t.icon,t.skipFade),r=r||t.text||t.icon)}for(let e in a){let t=a[e];if(!this.opacities[e]){let a=new ek(t,i,!1,!1);a.isHidden()||(this.opacities[e]=a,r=r||t.text.placed||t.icon.placed)}}for(let e in n)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=n[e]);for(let e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);if(t&&void 0===t.lastPlacementChangeTime)throw Error("Last placement time for previous placement is not defined");r?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){let r={};for(let i of t){let t=i.getBucket(e);t&&i.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,r,i.collisionBoxArray)}}updateBucketOpacities(t,r,i){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let a=t.layers[0],n=a.layout,s=new ek(null,0,!1,!1,!0),o=n.get("text-allow-overlap"),l=n.get("icon-allow-overlap"),u=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===n.get("text-rotation-alignment"),c="map"===n.get("text-pitch-alignment"),d="none"!==n.get("icon-text-fit"),p=new ek(null,0,o&&(l||!t.hasIconData()||n.get("icon-optional")),l&&(o||!t.hasTextData()||n.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);let f=(e,t,r)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(r);e.hasVisibleVertices=e.hasVisibleVertices||r!==eD};for(let i=0;i<t.symbolInstances.length;i++){let a=t.symbolInstances.get(i),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:o,crossTileID:l}=a,m=this.opacities[l];r[l]?m=s:m||(m=p,this.opacities[l]=m),r[l]=!0;let g=a.numIconVertices>0,y=this.placedOrientations[a.crossTileID],_=y===e.ai.vertical,x=y===e.ai.horizontal||y===e.ai.horizontalOnly;if(n>0||o>0){let e=eR(m.text);f(t.text,n,_?eD:e),f(t.text,o,x?eD:e);let r=m.text.isHidden();[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach(e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=r||_?1:0)}),a.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden=r||x?1:0);let i=this.variableOffsets[a.crossTileID];i&&this.markUsedJustification(t,i.anchor,a,y);let s=this.placedOrientations[a.crossTileID];s&&(this.markUsedJustification(t,"left",a,s),this.markUsedOrientation(t,s,a))}if(g){let e=eR(m.icon),r=!(d&&a.verticalPlacedIconSymbolIndex&&_);a.placedIconSymbolIndex>=0&&(f(t.icon,a.numIconVertices,r?e:eD),t.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden=m.icon.isHidden()),a.verticalPlacedIconSymbolIndex>=0&&(f(t.icon,a.numVerticalIconVertices,r?eD:e),t.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let r=t.collisionArrays[i];if(r){let i=new e.P(0,0);if(r.textBox||r.verticalTextBox){let e=!0;if(u){let t=this.variableOffsets[l];t?(i=eE(t.anchor,t.width,t.height,t.textOffset,t.textBoxScale),h&&i._rotate(c?this.transform.angle:-this.transform.angle)):e=!1}r.textBox&&ez(t.textCollisionBox.collisionVertexArray,m.text.placed,!e||_,i.x,i.y),r.verticalTextBox&&ez(t.textCollisionBox.collisionVertexArray,m.text.placed,!e||x,i.x,i.y)}let a=!!(!x&&r.verticalIconBox);r.iconBox&&ez(t.iconCollisionBox.collisionVertexArray,m.icon.placed,a,d?i.x:0,d?i.y:0),r.verticalIconBox&&ez(t.iconCollisionBox.collisionVertexArray,m.icon.placed,!a,d?i.x:0,d?i.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){let e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){let r=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*r>e}setStale(){this.stale=!0}}function ez(e,t,r,i,a){e.emplaceBack(t?1:0,r?1:0,i||0,a||0),e.emplaceBack(t?1:0,r?1:0,i||0,a||0),e.emplaceBack(t?1:0,r?1:0,i||0,a||0),e.emplaceBack(t?1:0,r?1:0,i||0,a||0)}function eR(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;let t=e.placed?1:0,r=Math.floor(127*e.opacity);return 33554432*r+16777216*t+131072*r+65536*t+512*r+256*t+2*r+t}let eD=0;class eL{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,r,i,a){let n=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(n,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,a())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,n.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<n.length;)if(t.placeLayerBucketPart(n[this._currentPartIndex],this._seenCrossTileIDs,r),this._currentPartIndex++,a())return!0;return!1}}class eF{constructor(e,t,r,i,a,n,s,o){this.placement=new eA(e,t,n,s,o),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=a,this._done=!1}isDone(){return this._done}continuePlacement(t,r,i){let a=e.h.now(),n=()=>!this._forceFullPlacement&&e.h.now()-a>2;for(;this._currentPlacementIndex>=0;){let e=r[t[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===e.type&&(!e.minzoom||e.minzoom<=a)&&(!e.maxzoom||e.maxzoom>a)){if(this._inProgressLayer||(this._inProgressLayer=new eL(e)),this._inProgressLayer.continuePlacement(i[e.source],this.placement,this._showCollisionBoxes,e,n))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let eB=512/e.N/2;class eO{constructor(t,r,i){this.tileID=t,this.bucketInstanceId=i,this._symbolsByKey={};let a=new Map;for(let e=0;e<r.length;e++){let t=r.get(e),i=t.key,n=a.get(i);n?n.push(t):a.set(i,[t])}for(let[t,r]of a){let i={positions:r.map(e=>({x:Math.floor(e.anchorX*eB),y:Math.floor(e.anchorY*eB)})),crossTileIDs:r.map(e=>e.crossTileID)};if(i.positions.length>128){let t=new e.av(i.positions.length,16,Uint16Array);for(let{x:e,y:r}of i.positions)t.add(e,r);t.finish(),delete i.positions,i.index=t}this._symbolsByKey[t]=i}}getScaledCoordinates(t,r){let{x:i,y:a,z:n}=this.tileID.canonical,{x:s,y:o,z:l}=r.canonical,u=eB/Math.pow(2,l-n),h=(o*e.N+t.anchorY)*u,c=a*e.N*eB;return{x:Math.floor((s*e.N+t.anchorX)*u-i*e.N*eB),y:Math.floor(h-c)}}findMatches(e,t,r){let i=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let a=0;a<e.length;a++){let n=e.get(a);if(n.crossTileID)continue;let s=this._symbolsByKey[n.key];if(!s)continue;let o=this.getScaledCoordinates(n,t);if(s.index)for(let e of s.index.range(o.x-i,o.y-i,o.x+i,o.y+i).sort()){let t=s.crossTileIDs[e];if(!r[t]){r[t]=!0,n.crossTileID=t;break}}else if(s.positions)for(let e=0;e<s.positions.length;e++){let t=s.positions[e],a=s.crossTileIDs[e];if(Math.abs(t.x-o.x)<=i&&Math.abs(t.y-o.y)<=i&&!r[a]){r[a]=!0,n.crossTileID=a;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class eN{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class eV{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let t=Math.round((e-this.lng)/360);if(0!==t)for(let e in this.indexes){let r=this.indexes[e],i={};for(let e in r){let a=r[e];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+t),i[a.tileID.key]=a}this.indexes[e]=i}this.lng=e}addBucket(e,t,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let i=this.usedCrossTileIDs[e.overscaledZ];for(let r in this.indexes){let a=this.indexes[r];if(Number(r)>e.overscaledZ)for(let r in a){let n=a[r];n.tileID.isChildOf(e)&&n.findMatches(t.symbolInstances,e,i)}else{let n=a[e.scaledTo(Number(r)).key];n&&n.findMatches(t.symbolInstances,e,i)}}for(let e=0;e<t.symbolInstances.length;e++){let a=t.symbolInstances.get(e);a.crossTileID||(a.crossTileID=r.generate(),i[a.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new eO(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(let r of t.getCrossTileIDsLists())for(let t of r)delete this.usedCrossTileIDs[e][t]}removeStaleBuckets(e){let t=!1;for(let r in this.indexes){let i=this.indexes[r];for(let a in i)e[i[a].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,i[a]),delete i[a],t=!0)}return t}}class e${constructor(){this.layerIndexes={},this.crossTileIDs=new eN,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,r){let i=this.layerIndexes[e.id];void 0===i&&(i=this.layerIndexes[e.id]=new eV);let a=!1,n={};for(let s of(i.handleWrapJump(r),t)){let t=s.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(s.tileID,t,this.crossTileIDs)&&(a=!0),n[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(n)&&(a=!0),a}pruneUnusedLayers(e){let t={};for(let r in e.forEach(e=>{t[e]=!0}),this.layerIndexes)t[r]||delete this.layerIndexes[r]}}let ej=(t,r)=>e.x(t,r&&r.filter(e=>"source.canvas"!==e.identifier)),eU=e.F(e.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),eq=e.F(e.ax,["setCenter","setZoom","setBearing","setPitch"]),eZ=e.aw();class eG extends e.E{constructor(t,r={}){super(),this.map=t,this.dispatcher=new R(ei(),this,t._getMapId()),this.imageManager=new I,this.imageManager.setEventedParent(this),this.glyphManager=new E(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new z(256,512),this.crossTileSymbolIndex=new e$,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.az());let i=this;this._rtlTextPluginCallback=eG.registerForPluginStateChange(t=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(t,r)=>{if(e.aA(t),r&&r.every(e=>e))for(let e in i.sourceCaches){let t=i.sourceCaches[e].getSource().type;"vector"!==t&&"geojson"!==t||i.sourceCaches[e].reload()}})}),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;let t=this.sourceCaches[e.sourceId];if(!t)return;let r=t.getSource();if(r&&r.vectorLayerIds)for(let e in this._layers){let t=this._layers[e];t.source===r.id&&this._validateLayer(t)}})}loadURL(t,r={},i){this.fire(new e.k("dataloading",{dataType:"style"})),r.validate="boolean"!=typeof r.validate||r.validate;let a=this.map._requestManager.transformRequest(t,x.Style);this._request=e.f(a,(t,a)=>{this._request=null,t?this.fire(new e.j(t)):a&&this._load(a,r,i)})}loadJSON(t,r={},i){this.fire(new e.k("dataloading",{dataType:"style"})),this._request=e.h.frame(()=>{this._request=null,r.validate=!1!==r.validate,this._load(t,r,i)})}loadEmpty(){this.fire(new e.k("dataloading",{dataType:"style"})),this._load(eZ,{validate:!1})}_load(t,r,i){var a;let n=r.transformStyle?r.transformStyle(i,t):t;if(!r.validate||!ej(this,e.y(n))){for(let e in this._loaded=!0,this.stylesheet=n,n.sources)this.addSource(e,n.sources[e],{validate:!1});n.sprite?this._loadSprite(n.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(n.glyphs),this._createLayers(),this.light=new A(this.stylesheet.light),this.map.setTerrain(null!==(a=this.stylesheet.terrain)&&void 0!==a?a:null),this.fire(new e.k("data",{dataType:"style"})),this.fire(new e.k("style.load"))}}_createLayers(){let t=e.aB(this.stylesheet.layers);for(let r of(this.dispatcher.broadcast("setLayers",t),this._order=t.map(e=>e.id),this._layers={},this._serializedLayers=null,t)){let t=e.aC(r);t.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=t}}_loadSprite(t,r=!1,i){this.imageManager.setLoaded(!1),this._spriteRequest=function(t,r,i,a){let n=S(t),s=n.length,o=i>1?"@2x":"",l={},u={},h={};for(let{id:t,url:i}of n){let n=r.transformRequest(r.normalizeSpriteURL(i,o,".json"),x.SpriteJSON),c=`${t}_${n.url}`;l[c]=e.f(n,(e,r)=>{delete l[c],u[t]=r,k(a,u,h,e,s)});let d=r.transformRequest(r.normalizeSpriteURL(i,o,".png"),x.SpriteImage),p=`${t}_${d.url}`;l[p]=_.getImage(d,(e,r)=>{delete l[p],h[t]=r,k(a,u,h,e,s)})}return{cancel(){for(let e of Object.values(l))e.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(t,a)=>{if(this._spriteRequest=null,t)this.fire(new e.j(t));else if(a)for(let e in a){for(let t of(this._spritesImagesIds[e]=[],this._spritesImagesIds[e]?this._spritesImagesIds[e].filter(e=>!(e in a)):[]))this.imageManager.removeImage(t),this._changedImages[t]=!0;for(let t in a[e]){let i="default"===e?t:`${e}:${t}`;this._spritesImagesIds[e].push(i),i in this.imageManager.images?this.imageManager.updateImage(i,a[e][t],!1):this.imageManager.addImage(i,a[e][t]),r&&(this._changedImages[i]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.k("data",{dataType:"style"})),i&&i(t)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.k("data",{dataType:"style"}))}_validateLayer(t){let r=this.sourceCaches[t.source];if(!r)return;let i=t.sourceLayer;if(!i)return;let a=r.getSource();("geojson"===a.type||a.vectorLayerIds&&-1===a.vectorLayerIds.indexOf(i))&&this.fire(new e.j(Error(`Source layer "${i}" does not exist on source "${a.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e){let t=this._serializedAllLayers();if(!e||0===e.length)return Object.values(t);let r=[];for(let i of e)t[i]&&r.push(t[i]);return r}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;for(let t of(e=this._serializedLayers={},Object.keys(this._layers))){let r=this._layers[t];"custom"!==r.type&&(e[t]=r.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw Error("Style is not done loading.")}update(t){if(!this._loaded)return;let r=this._changed;if(this._changed){let e=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);for(let t in(e.length||r.length)&&this._updateWorkerLayers(e,r),this._updatedSources){let e=this._updatedSources[t];if("reload"===e)this._reloadSource(t);else{if("clear"!==e)throw Error(`Invalid action ${e}`);this._clearSource(t)}}for(let e in this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs(),this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}let i={};for(let e in this.sourceCaches){let t=this.sourceCaches[e];i[e]=t.used,t.used=!1}for(let e of this._order){let r=this._layers[e];r.recalculate(t,this._availableImages),!r.isHidden(t.zoom)&&r.source&&(this.sourceCaches[r.source].used=!0)}for(let t in i){let r=this.sourceCaches[t];i[t]!==r.used&&r.fire(new e.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:t}))}this.light.recalculate(t),this.z=t.zoom,r&&this.fire(new e.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){this._checkLoaded();let i=this.serialize();if(t=r.transformStyle?r.transformStyle(i,t):t,ej(this,e.y(t)))return!1;(t=e.aD(t)).layers=e.aB(t.layers);let a=e.aE(i,t).filter(e=>!(e.command in eq));if(0===a.length)return!1;let n=a.filter(e=>!(e.command in eU));if(n.length>0)throw Error(`Unimplemented: ${n.map(e=>e.command).join(", ")}.`);for(let e of a)"setTransition"!==e.command&&this[e.command].apply(this,e.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,r){if(this.getImage(t))return this.fire(new e.j(Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){if(!this.getImage(t))return this.fire(new e.j(Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,i={}){if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw Error(`Source "${t}" already exists.`);if(!r.type)throw Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(e.y.source,`sources.${t}`,r,null,i))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);let a=this.sourceCaches[t]=new J(t,r,this.dispatcher);a.style=this,a.setEventedParent(this,()=>({isSourceLoaded:a.loaded(),source:a.serialize(),sourceId:t})),a.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw Error("There is no source with this ID");for(let r in this._layers)if(this._layers[r].source===t)return this.fire(new e.j(Error(`Source "${t}" cannot be removed while layer "${r}" is using it.`)));let r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new e.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw Error(`There is no source with this ID=${e}`);let r=this.sourceCaches[e].getSource();if("geojson"!==r.type)throw Error(`geojsonSource.type is ${r.type}, which is !== 'geojson`);r.setData(t),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(t,r,i={}){let a;this._checkLoaded();let n=t.id;if(this.getLayer(n))return void this.fire(new e.j(Error(`Layer "${n}" already exists on this map.`)));if("custom"===t.type){if(ej(this,e.aF(t)))return;a=e.aC(t)}else{if("source"in t&&"object"==typeof t.source&&(this.addSource(n,t.source),t=e.aD(t),t=e.e(t,{source:n})),this._validate(e.y.layer,`layers.${n}`,t,{arrayIndex:-1},i))return;a=e.aC(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:n}})}let s=r?this._order.indexOf(r):this._order.length;if(r&&-1===s)this.fire(new e.j(Error(`Cannot add layer "${n}" before non-existing layer "${r}".`)));else{if(this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=a,this._removedLayers[n]&&a.source&&"custom"!==a.type){let e=this._removedLayers[n];delete this._removedLayers[n],e.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.j(Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;let i=this._order.indexOf(t);this._order.splice(i,1);let a=r?this._order.indexOf(r):this._order.length;r&&-1===a?this.fire(new e.j(Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(a,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();let r=this._layers[t];if(!r)return void this.fire(new e.j(Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);let i=this._order.indexOf(t);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(t,r,i){this._checkLoaded();let a=this.getLayer(t);a?a.minzoom===r&&a.maxzoom===i||(null!=r&&(a.minzoom=r),null!=i&&(a.maxzoom=i),this._updateLayer(a)):this.fire(new e.j(Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,i={}){this._checkLoaded();let a=this.getLayer(t);if(a){if(!e.aG(a.filter,r))return null==r?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(e.y.filter,`layers.${a.id}.filter`,r,null,i)||(a.filter=e.aD(r),this._updateLayer(a)))}else this.fire(new e.j(Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return e.aD(this.getLayer(t).filter)}setLayoutProperty(t,r,i,a={}){this._checkLoaded();let n=this.getLayer(t);n?e.aG(n.getLayoutProperty(r),i)||(n.setLayoutProperty(r,i,a),this._updateLayer(n)):this.fire(new e.j(Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){let i=this.getLayer(t);if(i)return i.getLayoutProperty(r);this.fire(new e.j(Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,i,a={}){this._checkLoaded();let n=this.getLayer(t);n?e.aG(n.getPaintProperty(r),i)||(n.setPaintProperty(r,i,a)&&this._updateLayer(n),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.j(Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(t,r){this._checkLoaded();let i=t.source,a=t.sourceLayer,n=this.sourceCaches[i];if(void 0===n)return void this.fire(new e.j(Error(`The source '${i}' does not exist in the map's style.`)));let s=n.getSource().type;"geojson"===s&&a?this.fire(new e.j(Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||a?(void 0===t.id&&this.fire(new e.j(Error("The feature id parameter must be provided."))),n.setFeatureState(a,t.id,r)):this.fire(new e.j(Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();let i=t.source,a=this.sourceCaches[i];if(void 0===a)return void this.fire(new e.j(Error(`The source '${i}' does not exist in the map's style.`)));let n=a.getSource().type,s="vector"===n?t.sourceLayer:void 0;"vector"!==n||s?r&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.j(Error("A feature id is required to remove its specific state property."))):a.removeFeatureState(s,t.id,r):this.fire(new e.j(Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();let r=t.source,i=t.sourceLayer,a=this.sourceCaches[r];if(void 0!==a)return"vector"!==a.getSource().type||i?(void 0===t.id&&this.fire(new e.j(Error("The feature id parameter must be provided."))),a.getFeatureState(i,t.id)):void this.fire(new e.j(Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new e.j(Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return e.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let t=e.aH(this.sourceCaches,e=>e.serialize()),r=this._serializeByIds(this._order),i=this.map.getTerrain()||void 0,a=this.stylesheet;return e.aI({version:a.version,name:a.name,metadata:a.metadata,light:a.light,center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,sprite:a.sprite,glyphs:a.glyphs,transition:a.transition,sources:t,layers:r,terrain:i},e=>void 0!==e)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.sourceCaches[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let t=e=>"fill-extrusion"===this._layers[e].type,r={},i=[];for(let a=this._order.length-1;a>=0;a--){let n=this._order[a];if(t(n))for(let t of(r[n]=a,e)){let e=t[n];if(e)for(let t of e)i.push(t)}}i.sort((e,t)=>t.intersectionZ-e.intersectionZ);let a=[];for(let n=this._order.length-1;n>=0;n--){let s=this._order[n];if(t(s))for(let e=i.length-1;e>=0;e--){let t=i[e].feature;if(r[t.layer.id]<n)break;a.push(t),i.pop()}else for(let t of e){let e=t[s];if(e)for(let t of e)a.push(t.feature)}}return a}queryRenderedFeatures(t,r,i){r&&r.filter&&this._validate(e.y.filter,"queryRenderedFeatures.filter",r.filter,null,r);let a={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new e.j(Error("parameters.layers must be an Array."))),[];for(let t of r.layers){let r=this._layers[t];if(!r)return this.fire(new e.j(Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];a[r.source]=!0}}let n=[];r.availableImages=this._availableImages;let s=this._serializedAllLayers();for(let o in this.sourceCaches)r.layers&&!a[o]||n.push(function(t,r,i,a,n,s){let o=function(e,t,r){if(e)for(let i of e){let e=t[i];if(e&&e.source===r&&"fill-extrusion"===e.type)return!0}else for(let e in t){let i=t[e];if(i.source===r&&"fill-extrusion"===i.type)return!0}return!1}(n&&n.layers,r,t.id),l=s.maxPitchScaleFactor(),u=t.tilesIn(a,l,o);u.sort(H);let h=[];for(let a of u)h.push({wrappedTileID:a.tileID.wrapped().key,queryResults:a.tile.queryRenderedFeatures(r,i,t._state,a.queryGeometry,a.cameraQueryGeometry,a.scale,n,s,l,function(t,r){let i=e.Z();return e.$(i,i,[1,1,0]),e.a0(i,i,[.5*t.width,.5*t.height,1]),e.a1(i,i,t.calculatePosMatrix(r.toUnwrapped()))}(t.transform,a.tileID))});let c=function(e){let t={},r={};for(let i of e){let e=i.queryResults,a=i.wrappedTileID,n=r[a]=r[a]||{};for(let r in e){let i=e[r],a=n[r]=n[r]||{},s=t[r]=t[r]||[];for(let e of i)a[e.featureIndex]||(a[e.featureIndex]=!0,s.push(e))}}return t}(h);for(let e in c)c[e].forEach(e=>{let r=e.feature,i=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=i});return c}(this.sourceCaches[o],this._layers,s,t,r,i));return this.placement&&n.push(function(e,t,r,i,a,n,s){let o={},l=n.queryRenderedSymbols(i),u=[];for(let e of Object.keys(l).map(Number))u.push(s[e]);for(let r of(u.sort(H),u)){let i=r.featureIndex.lookupSymbolFeatures(l[r.bucketInstanceId],t,r.bucketIndex,r.sourceLayerIndex,a.filter,a.layers,a.availableImages,e);for(let e in i){let t=o[e]=o[e]||[],a=i[e];for(let e of(a.sort((e,t)=>{let i=r.featureSortOrder;if(i){let r=i.indexOf(e.featureIndex);return i.indexOf(t.featureIndex)-r}return t.featureIndex-e.featureIndex}),a))t.push(e)}}for(let t in o)o[t].forEach(i=>{let a=i.feature,n=r[e[t].source].getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=n});return o}(this._layers,s,this.sourceCaches,t,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(n)}querySourceFeatures(t,r){r&&r.filter&&this._validate(e.y.filter,"querySourceFeatures.filter",r.filter,null,r);let i=this.sourceCaches[t];return i?function(e,t){let r=e.getRenderableIds().map(t=>e.getTileByID(t)),i=[],a={};for(let e=0;e<r.length;e++){let n=r[e],s=n.tileID.canonical.key;a[s]||(a[s]=!0,n.querySourceFeatures(i,t))}return i}(i,r):[]}addSourceType(e,t,r){return G(e)?r(Error(`A source type called "${e}" already exists.`)):(Z[e]=t,t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();let i=this.light.getLight(),a=!1;for(let r in t)if(!e.aG(t[r],i[r])){a=!0;break}if(!a)return;let n={now:e.h.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(n)}_validate(t,r,i,a,n={}){return(!n||!1!==n.validate)&&ej(this,t.call(e.y,e.e({key:r,style:this.serialize(),value:i,styleSpec:e.v},a)))}_remove(t=!0){for(let t in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.aJ.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[t].setEventedParent(null);for(let e in this.sourceCaches){let t=this.sourceCaches[e];t.setEventedParent(null),t.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let t in this.sourceCaches)this.sourceCaches[t].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(t,r,i,a,n=!1){let s=!1,o=!1,l={};for(let e of this._order){let r=this._layers[e];if("symbol"!==r.type)continue;if(!l[r.source]){let e=this.sourceCaches[r.source];l[r.source]=e.getRenderableIds(!0).map(t=>e.getTileByID(t)).sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}let i=this.crossTileSymbolIndex.addLayer(r,l[r.source],t.center.lng);s=s||i}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((n=n||this._layerOrderChanged||0===i)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.h.now(),t.zoom))&&(this.pauseablePlacement=new eF(t,this.map.terrain,this._order,n,r,i,a,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.h.now()),o=!0),s&&this.pauseablePlacement.placement.setStale()),o||s)for(let e of this._order){let t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.h.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,r){this.imageManager.getImages(t.icons,r),this._updateTilesForChangedImages();let i=this.sourceCaches[t.source];i&&i.setDependencies(t.tileID.key,t.type,t.icons)}getGlyphs(e,t,r){this.glyphManager.getGlyphs(t.stacks,r);let i=this.sourceCaches[t.source];i&&i.setDependencies(t.tileID.key,t.type,[""])}getResource(t,r,i){return e.m(r,i)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(e.y.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,r,i={},a){this._checkLoaded();let n=[{id:t,url:r}],s=[...S(this.stylesheet.sprite),...n];this._validate(e.y.sprite,"sprite",s,null,i)||(this.stylesheet.sprite=s,this._loadSprite(n,!0,a))}removeSprite(t){this._checkLoaded();let r=S(this.stylesheet.sprite);if(r.find(e=>e.id===t)){if(this._spritesImagesIds[t])for(let e of this._spritesImagesIds[t])this.imageManager.removeImage(e),this._changedImages[e]=!0;r.splice(r.findIndex(e=>e.id===t),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.k("data",{dataType:"style"}))}else this.fire(new e.j(Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return S(this.stylesheet.sprite)}setSprite(t,r={},i){this._checkLoaded(),t&&this._validate(e.y.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,i):(this._unloadSprite(),i&&i(null)))}}eG.registerForPluginStateChange=e.aK;var eH=e.Q([{name:"a_pos",type:"Int16",components:2}]),eW="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";let eX={prelude:eK("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:eK("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:eK("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:eK("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:eK("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:eK("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:eK("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:eK("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:eK("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:eK("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:eK("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:eK("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:eK("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:eK("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:eK("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:eK("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:eK("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:eK("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:eK("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:eK("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:eK("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:eK("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:eK("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:eK("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:eK("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:eK("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:eK("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",eW),terrainDepth:eK("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",eW),terrainCoords:eK("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",eW)};function eK(e,t){let r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=t.match(/attribute ([\w]+) ([\w]+)/g),a=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),n=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=n?n.concat(a):a,o={};return{fragmentSource:e=e.replace(r,(e,t,r,i,a)=>(o[a]=!0,"define"===t?`
#ifndef HAS_UNIFORM_u_${a}
varying ${r} ${i} ${a};
#else
uniform ${r} ${i} u_${a};
#endif
`:`
#ifdef HAS_UNIFORM_u_${a}
    ${r} ${i} ${a} = u_${a};
#endif
`)),vertexSource:t=t.replace(r,(e,t,r,i,a)=>{let n="float"===i?"vec2":"vec4",s=a.match(/color/)?"color":n;return o[a]?"define"===t?`
#ifndef HAS_UNIFORM_u_${a}
uniform lowp float u_${a}_t;
attribute ${r} ${n} a_${a};
varying ${r} ${i} ${a};
#else
uniform ${r} ${i} u_${a};
#endif
`:"vec4"===s?`
#ifndef HAS_UNIFORM_u_${a}
    ${a} = a_${a};
#else
    ${r} ${i} ${a} = u_${a};
#endif
`:`
#ifndef HAS_UNIFORM_u_${a}
    ${a} = unpack_mix_${s}(a_${a}, u_${a}_t);
#else
    ${r} ${i} ${a} = u_${a};
#endif
`:"define"===t?`
#ifndef HAS_UNIFORM_u_${a}
uniform lowp float u_${a}_t;
attribute ${r} ${n} a_${a};
#else
uniform ${r} ${i} u_${a};
#endif
`:"vec4"===s?`
#ifndef HAS_UNIFORM_u_${a}
    ${r} ${i} ${a} = a_${a};
#else
    ${r} ${i} ${a} = u_${a};
#endif
`:`
#ifndef HAS_UNIFORM_u_${a}
    ${r} ${i} ${a} = unpack_mix_${s}(a_${a}, u_${a}_t);
#else
    ${r} ${i} ${a} = u_${a};
#endif
`}),staticAttributes:i,staticUniforms:s}}class eJ{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,r,i,a,n,s,o,l){this.context=e;let u=this.boundPaintVertexBuffers.length!==i.length;for(let e=0;!u&&e<i.length;e++)this.boundPaintVertexBuffers[e]!==i[e]&&(u=!0);!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==r||u||this.boundIndexBuffer!==a||this.boundVertexOffset!==n||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==o||this.boundDynamicVertexBuffer3!==l?this.freshBind(t,r,i,a,n,s,o,l):(e.bindVertexArray.set(this.vao),s&&s.bind(),a&&a.dynamicDraw&&a.bind(),o&&o.bind(),l&&l.bind())}freshBind(e,t,r,i,a,n,s,o){let l=e.numAttributes,u=this.context,h=u.gl;for(let l of(this.vao&&this.destroy(),this.vao=u.createVertexArray(),u.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=i,this.boundVertexOffset=a,this.boundDynamicVertexBuffer=n,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=o,t.enableAttributes(h,e),r))l.enableAttributes(h,e);for(let i of(n&&n.enableAttributes(h,e),s&&s.enableAttributes(h,e),o&&o.enableAttributes(h,e),t.bind(),t.setVertexAttribPointers(h,e,a),r))i.bind(),i.setVertexAttribPointers(h,e,a);n&&(n.bind(),n.setVertexAttribPointers(h,e,a)),i&&i.bind(),s&&(s.bind(),s.setVertexAttribPointers(h,e,a)),o&&(o.bind(),o.setVertexAttribPointers(h,e,a)),u.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function eY(e){let t=[];for(let r=0;r<e.length;r++){if(null===e[r])continue;let i=e[r].split(" ");t.push(i.pop())}return t}class eQ{constructor(t,r,i,a,n,s){let o=t.gl;this.program=o.createProgram();let l=eY(r.staticAttributes),u=i?i.getBinderAttributes():[],h=l.concat(u),c=eX.prelude.staticUniforms?eY(eX.prelude.staticUniforms):[],d=r.staticUniforms?eY(r.staticUniforms):[],p=i?i.getBinderUniforms():[],f=c.concat(d).concat(p),m=[];for(let e of f)0>m.indexOf(e)&&m.push(e);let g=i?i.defines():[];n&&g.push("#define OVERDRAW_INSPECTOR;"),s&&g.push("#define TERRAIN3D;");let y=g.concat(eX.prelude.fragmentSource,r.fragmentSource).join("\n"),_=g.concat(eX.prelude.vertexSource,r.vertexSource).join("\n"),x=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())return void(this.failedToCreate=!0);if(o.shaderSource(x,y),o.compileShader(x),!o.getShaderParameter(x,o.COMPILE_STATUS))throw Error(`Could not compile fragment shader: ${o.getShaderInfoLog(x)}`);o.attachShader(this.program,x);let v=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())return void(this.failedToCreate=!0);if(o.shaderSource(v,_),o.compileShader(v),!o.getShaderParameter(v,o.COMPILE_STATUS))throw Error(`Could not compile vertex shader: ${o.getShaderInfoLog(v)}`);o.attachShader(this.program,v),this.attributes={};let b={};this.numAttributes=h.length;for(let e=0;e<this.numAttributes;e++)h[e]&&(o.bindAttribLocation(this.program,e,h[e]),this.attributes[h[e]]=e);if(o.linkProgram(this.program),!o.getProgramParameter(this.program,o.LINK_STATUS))throw Error(`Program failed to link: ${o.getProgramInfoLog(this.program)}`);o.deleteShader(v),o.deleteShader(x);for(let e=0;e<m.length;e++){let t=m[e];if(t&&!b[t]){let e=o.getUniformLocation(this.program,t);e&&(b[t]=e)}}this.fixedUniforms=a(t,b),this.terrainUniforms={u_depth:new e.aL(t,b.u_depth),u_terrain:new e.aL(t,b.u_terrain),u_terrain_dim:new e.aM(t,b.u_terrain_dim),u_terrain_matrix:new e.aN(t,b.u_terrain_matrix),u_terrain_unpack:new e.aO(t,b.u_terrain_unpack),u_terrain_exaggeration:new e.aM(t,b.u_terrain_exaggeration)},this.binderUniforms=i?i.getUniforms(t,b):[]}draw(e,t,r,i,a,n,s,o,l,u,h,c,d,p,f,m,g,y){let _=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(r),e.setStencilMode(i),e.setColorMode(a),e.setCullFace(n),o)for(let t in e.activeTexture.set(_.TEXTURE2),_.bindTexture(_.TEXTURE_2D,o.depthTexture),e.activeTexture.set(_.TEXTURE3),_.bindTexture(_.TEXTURE_2D,o.texture),this.terrainUniforms)this.terrainUniforms[t].set(o[t]);for(let e in this.fixedUniforms)this.fixedUniforms[e].set(s[e]);f&&f.setUniforms(e,this.binderUniforms,d,{zoom:p});let x=0;switch(t){case _.LINES:x=2;break;case _.TRIANGLES:x=3;break;case _.LINE_STRIP:x=1}for(let r of c.get()){let i=r.vaos||(r.vaos={});(i[l]||(i[l]=new eJ)).bind(e,this,u,f?f.getPaintVertexBuffers():[],h,r.vertexOffset,m,g,y),_.drawElements(t,r.primitiveLength*x,_.UNSIGNED_SHORT,r.primitiveOffset*x*2)}}}function e0(e,t,r){let i=1/ew(r,1,t.transform.tileZoom),a=Math.pow(2,r.tileID.overscaledZ),n=r.tileSize*Math.pow(2,t.transform.tileZoom)/a,s=n*(r.tileID.canonical.x+r.tileID.wrap*a),o=n*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,o>>16],u_pixel_coord_lower:[65535&s,65535&o]}}let e1=(t,r,i,a)=>{var n,s,o,l,u,h,c;let d=r.style.light,p=d.properties.get("position"),f=[p.x,p.y,p.z],m=(n=new e.A(9),e.A!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n);"viewport"===d.properties.get("anchor")&&(o=Math.sin(s=-r.transform.angle),l=Math.cos(s),m[0]=l,m[1]=o,m[2]=0,m[3]=-o,m[4]=l,m[5]=0,m[6]=0,m[7]=0,m[8]=1),u=f[0],h=f[1],c=f[2],f[0]=u*m[0]+h*m[3]+c*m[6],f[1]=u*m[1]+h*m[4]+c*m[7],f[2]=u*m[2]+h*m[5]+c*m[8];let g=d.properties.get("color");return{u_matrix:t,u_lightpos:f,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[g.r,g.g,g.b],u_vertical_gradient:+i,u_opacity:a}},e2=(t,r,i,a,n,s,o)=>e.e(e1(t,r,i,a),e0(s,r,o),{u_height_factor:-Math.pow(2,n.overscaledZ)/o.tileSize/8}),e3=e=>({u_matrix:e}),e5=(t,r,i,a)=>e.e(e3(t),e0(i,r,a)),e4=(e,t)=>({u_matrix:e,u_world:t}),e6=(t,r,i,a,n)=>e.e(e5(t,r,i,a),{u_world:n}),e8=(e,t,r,i)=>{let a,n;let s=e.transform;if("map"===i.paint.get("circle-pitch-alignment")){let e=ew(r,1,s.zoom);a=!0,n=[e,e]}else a=!1,n=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(t.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+a,u_device_pixel_ratio:e.pixelRatio,u_extrude_scale:n}},e9=(e,t,r)=>{let i=ew(r,1,t.zoom),a=Math.pow(2,t.zoom-r.tileID.overscaledZ),n=r.tileID.overscaleFactor();return{u_matrix:e,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:i,u_extrude_scale:[t.pixelsToGLUnits[0]/(i*a),t.pixelsToGLUnits[1]/(i*a)],u_overscale_factor:n}},e7=(e,t,r=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:r}),te=e=>({u_matrix:e}),tt=(e,t,r,i)=>({u_matrix:e,u_extrude_scale:ew(t,1,r),u_intensity:i}),tr=(e,t,r,i)=>{let a=e.transform;return{u_matrix:to(e,t,r,i),u_ratio:1/ew(t,1,a.zoom),u_device_pixel_ratio:e.pixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},ti=(t,r,i,a,n)=>e.e(tr(t,r,i,n),{u_image:0,u_image_height:a}),ta=(e,t,r,i,a)=>{let n=e.transform,s=ts(t,n);return{u_matrix:to(e,t,r,a),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ew(t,1,n.zoom),u_device_pixel_ratio:e.pixelRatio,u_image:0,u_scale:[s,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]]}},tn=(t,r,i,a,n,s)=>{let o=t.lineAtlas,l=ts(r,t.transform),u="round"===i.layout.get("line-cap"),h=o.getDash(a.from,u),c=o.getDash(a.to,u),d=h.width*n.fromScale,p=c.width*n.toScale;return e.e(tr(t,r,i,s),{u_patternscale_a:[l/d,-h.height/2],u_patternscale_b:[l/p,-c.height/2],u_sdfgamma:o.width/(256*Math.min(d,p)*t.pixelRatio)/2,u_image:0,u_tex_y_a:h.y,u_tex_y_b:c.y,u_mix:n.t})};function ts(e,t){return 1/ew(e,1,t.tileZoom)}function to(e,t,r,i){return e.translatePosMatrix(i?i.posMatrix:t.tileID.posMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}let tl=(e,t,r,i,a)=>{var n,s;return{u_matrix:e,u_tl_parent:t,u_scale_parent:r,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*a.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:a.paint.get("raster-brightness-min"),u_brightness_high:a.paint.get("raster-brightness-max"),u_saturation_factor:(s=a.paint.get("raster-saturation"))>0?1-1/(1.001-s):-s,u_contrast_factor:(n=a.paint.get("raster-contrast"))>0?1/(1-n):1+n,u_spin_weights:function(e){let t=Math.sin(e*=Math.PI/180),r=Math.cos(e);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}(a.paint.get("raster-hue-rotate"))}},tu=(e,t,r,i,a,n,s,o,l,u)=>{let h=a.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:h.cameraToCenterDistance,u_pitch:h.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:h.width/h.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:n,u_label_plane_matrix:s,u_coord_matrix:o,u_is_text:+l,u_pitch_with_map:+i,u_texsize:u,u_texture:0}},th=(t,r,i,a,n,s,o,l,u,h,c)=>{let d=n.transform;return e.e(tu(t,r,i,a,n,s,o,l,u,h),{u_gamma_scale:a?Math.cos(d._pitch)*d.cameraToCenterDistance:1,u_device_pixel_ratio:n.pixelRatio,u_is_halo:+c})},tc=(t,r,i,a,n,s,o,l,u,h)=>e.e(th(t,r,i,a,n,s,o,l,!0,u,!0),{u_texsize_icon:h,u_texture_icon:1}),td=(e,t,r)=>({u_matrix:e,u_opacity:t,u_color:r}),tp=(t,r,i,a,n,s)=>e.e(function(e,t,r,i){let a=r.imageManager.getPattern(e.from.toString()),n=r.imageManager.getPattern(e.to.toString()),{width:s,height:o}=r.imageManager.getPixelSize(),l=Math.pow(2,i.tileID.overscaledZ),u=i.tileSize*Math.pow(2,r.transform.tileZoom)/l,h=u*(i.tileID.canonical.x+i.tileID.wrap*l),c=u*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:a.tl,u_pattern_br_a:a.br,u_pattern_tl_b:n.tl,u_pattern_br_b:n.br,u_texsize:[s,o],u_mix:t.t,u_pattern_size_a:a.displaySize,u_pattern_size_b:n.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/ew(i,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,c>>16],u_pixel_coord_lower:[65535&h,65535&c]}}(a,s,i,n),{u_matrix:t,u_opacity:r}),tf={fillExtrusion:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_lightpos:new e.aP(t,r.u_lightpos),u_lightintensity:new e.aM(t,r.u_lightintensity),u_lightcolor:new e.aP(t,r.u_lightcolor),u_vertical_gradient:new e.aM(t,r.u_vertical_gradient),u_opacity:new e.aM(t,r.u_opacity)}),fillExtrusionPattern:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_lightpos:new e.aP(t,r.u_lightpos),u_lightintensity:new e.aM(t,r.u_lightintensity),u_lightcolor:new e.aP(t,r.u_lightcolor),u_vertical_gradient:new e.aM(t,r.u_vertical_gradient),u_height_factor:new e.aM(t,r.u_height_factor),u_image:new e.aL(t,r.u_image),u_texsize:new e.aQ(t,r.u_texsize),u_pixel_coord_upper:new e.aQ(t,r.u_pixel_coord_upper),u_pixel_coord_lower:new e.aQ(t,r.u_pixel_coord_lower),u_scale:new e.aP(t,r.u_scale),u_fade:new e.aM(t,r.u_fade),u_opacity:new e.aM(t,r.u_opacity)}),fill:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix)}),fillPattern:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_image:new e.aL(t,r.u_image),u_texsize:new e.aQ(t,r.u_texsize),u_pixel_coord_upper:new e.aQ(t,r.u_pixel_coord_upper),u_pixel_coord_lower:new e.aQ(t,r.u_pixel_coord_lower),u_scale:new e.aP(t,r.u_scale),u_fade:new e.aM(t,r.u_fade)}),fillOutline:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_world:new e.aQ(t,r.u_world)}),fillOutlinePattern:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_world:new e.aQ(t,r.u_world),u_image:new e.aL(t,r.u_image),u_texsize:new e.aQ(t,r.u_texsize),u_pixel_coord_upper:new e.aQ(t,r.u_pixel_coord_upper),u_pixel_coord_lower:new e.aQ(t,r.u_pixel_coord_lower),u_scale:new e.aP(t,r.u_scale),u_fade:new e.aM(t,r.u_fade)}),circle:(t,r)=>({u_camera_to_center_distance:new e.aM(t,r.u_camera_to_center_distance),u_scale_with_map:new e.aL(t,r.u_scale_with_map),u_pitch_with_map:new e.aL(t,r.u_pitch_with_map),u_extrude_scale:new e.aQ(t,r.u_extrude_scale),u_device_pixel_ratio:new e.aM(t,r.u_device_pixel_ratio),u_matrix:new e.aN(t,r.u_matrix)}),collisionBox:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_camera_to_center_distance:new e.aM(t,r.u_camera_to_center_distance),u_pixels_to_tile_units:new e.aM(t,r.u_pixels_to_tile_units),u_extrude_scale:new e.aQ(t,r.u_extrude_scale),u_overscale_factor:new e.aM(t,r.u_overscale_factor)}),collisionCircle:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_inv_matrix:new e.aN(t,r.u_inv_matrix),u_camera_to_center_distance:new e.aM(t,r.u_camera_to_center_distance),u_viewport_size:new e.aQ(t,r.u_viewport_size)}),debug:(t,r)=>({u_color:new e.aR(t,r.u_color),u_matrix:new e.aN(t,r.u_matrix),u_overlay:new e.aL(t,r.u_overlay),u_overlay_scale:new e.aM(t,r.u_overlay_scale)}),clippingMask:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix)}),heatmap:(t,r)=>({u_extrude_scale:new e.aM(t,r.u_extrude_scale),u_intensity:new e.aM(t,r.u_intensity),u_matrix:new e.aN(t,r.u_matrix)}),heatmapTexture:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_world:new e.aQ(t,r.u_world),u_image:new e.aL(t,r.u_image),u_color_ramp:new e.aL(t,r.u_color_ramp),u_opacity:new e.aM(t,r.u_opacity)}),hillshade:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_image:new e.aL(t,r.u_image),u_latrange:new e.aQ(t,r.u_latrange),u_light:new e.aQ(t,r.u_light),u_shadow:new e.aR(t,r.u_shadow),u_highlight:new e.aR(t,r.u_highlight),u_accent:new e.aR(t,r.u_accent)}),hillshadePrepare:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_image:new e.aL(t,r.u_image),u_dimension:new e.aQ(t,r.u_dimension),u_zoom:new e.aM(t,r.u_zoom),u_unpack:new e.aO(t,r.u_unpack)}),line:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_ratio:new e.aM(t,r.u_ratio),u_device_pixel_ratio:new e.aM(t,r.u_device_pixel_ratio),u_units_to_pixels:new e.aQ(t,r.u_units_to_pixels)}),lineGradient:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_ratio:new e.aM(t,r.u_ratio),u_device_pixel_ratio:new e.aM(t,r.u_device_pixel_ratio),u_units_to_pixels:new e.aQ(t,r.u_units_to_pixels),u_image:new e.aL(t,r.u_image),u_image_height:new e.aM(t,r.u_image_height)}),linePattern:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_texsize:new e.aQ(t,r.u_texsize),u_ratio:new e.aM(t,r.u_ratio),u_device_pixel_ratio:new e.aM(t,r.u_device_pixel_ratio),u_image:new e.aL(t,r.u_image),u_units_to_pixels:new e.aQ(t,r.u_units_to_pixels),u_scale:new e.aP(t,r.u_scale),u_fade:new e.aM(t,r.u_fade)}),lineSDF:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_ratio:new e.aM(t,r.u_ratio),u_device_pixel_ratio:new e.aM(t,r.u_device_pixel_ratio),u_units_to_pixels:new e.aQ(t,r.u_units_to_pixels),u_patternscale_a:new e.aQ(t,r.u_patternscale_a),u_patternscale_b:new e.aQ(t,r.u_patternscale_b),u_sdfgamma:new e.aM(t,r.u_sdfgamma),u_image:new e.aL(t,r.u_image),u_tex_y_a:new e.aM(t,r.u_tex_y_a),u_tex_y_b:new e.aM(t,r.u_tex_y_b),u_mix:new e.aM(t,r.u_mix)}),raster:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_tl_parent:new e.aQ(t,r.u_tl_parent),u_scale_parent:new e.aM(t,r.u_scale_parent),u_buffer_scale:new e.aM(t,r.u_buffer_scale),u_fade_t:new e.aM(t,r.u_fade_t),u_opacity:new e.aM(t,r.u_opacity),u_image0:new e.aL(t,r.u_image0),u_image1:new e.aL(t,r.u_image1),u_brightness_low:new e.aM(t,r.u_brightness_low),u_brightness_high:new e.aM(t,r.u_brightness_high),u_saturation_factor:new e.aM(t,r.u_saturation_factor),u_contrast_factor:new e.aM(t,r.u_contrast_factor),u_spin_weights:new e.aP(t,r.u_spin_weights)}),symbolIcon:(t,r)=>({u_is_size_zoom_constant:new e.aL(t,r.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aL(t,r.u_is_size_feature_constant),u_size_t:new e.aM(t,r.u_size_t),u_size:new e.aM(t,r.u_size),u_camera_to_center_distance:new e.aM(t,r.u_camera_to_center_distance),u_pitch:new e.aM(t,r.u_pitch),u_rotate_symbol:new e.aL(t,r.u_rotate_symbol),u_aspect_ratio:new e.aM(t,r.u_aspect_ratio),u_fade_change:new e.aM(t,r.u_fade_change),u_matrix:new e.aN(t,r.u_matrix),u_label_plane_matrix:new e.aN(t,r.u_label_plane_matrix),u_coord_matrix:new e.aN(t,r.u_coord_matrix),u_is_text:new e.aL(t,r.u_is_text),u_pitch_with_map:new e.aL(t,r.u_pitch_with_map),u_texsize:new e.aQ(t,r.u_texsize),u_texture:new e.aL(t,r.u_texture)}),symbolSDF:(t,r)=>({u_is_size_zoom_constant:new e.aL(t,r.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aL(t,r.u_is_size_feature_constant),u_size_t:new e.aM(t,r.u_size_t),u_size:new e.aM(t,r.u_size),u_camera_to_center_distance:new e.aM(t,r.u_camera_to_center_distance),u_pitch:new e.aM(t,r.u_pitch),u_rotate_symbol:new e.aL(t,r.u_rotate_symbol),u_aspect_ratio:new e.aM(t,r.u_aspect_ratio),u_fade_change:new e.aM(t,r.u_fade_change),u_matrix:new e.aN(t,r.u_matrix),u_label_plane_matrix:new e.aN(t,r.u_label_plane_matrix),u_coord_matrix:new e.aN(t,r.u_coord_matrix),u_is_text:new e.aL(t,r.u_is_text),u_pitch_with_map:new e.aL(t,r.u_pitch_with_map),u_texsize:new e.aQ(t,r.u_texsize),u_texture:new e.aL(t,r.u_texture),u_gamma_scale:new e.aM(t,r.u_gamma_scale),u_device_pixel_ratio:new e.aM(t,r.u_device_pixel_ratio),u_is_halo:new e.aL(t,r.u_is_halo)}),symbolTextAndIcon:(t,r)=>({u_is_size_zoom_constant:new e.aL(t,r.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aL(t,r.u_is_size_feature_constant),u_size_t:new e.aM(t,r.u_size_t),u_size:new e.aM(t,r.u_size),u_camera_to_center_distance:new e.aM(t,r.u_camera_to_center_distance),u_pitch:new e.aM(t,r.u_pitch),u_rotate_symbol:new e.aL(t,r.u_rotate_symbol),u_aspect_ratio:new e.aM(t,r.u_aspect_ratio),u_fade_change:new e.aM(t,r.u_fade_change),u_matrix:new e.aN(t,r.u_matrix),u_label_plane_matrix:new e.aN(t,r.u_label_plane_matrix),u_coord_matrix:new e.aN(t,r.u_coord_matrix),u_is_text:new e.aL(t,r.u_is_text),u_pitch_with_map:new e.aL(t,r.u_pitch_with_map),u_texsize:new e.aQ(t,r.u_texsize),u_texsize_icon:new e.aQ(t,r.u_texsize_icon),u_texture:new e.aL(t,r.u_texture),u_texture_icon:new e.aL(t,r.u_texture_icon),u_gamma_scale:new e.aM(t,r.u_gamma_scale),u_device_pixel_ratio:new e.aM(t,r.u_device_pixel_ratio),u_is_halo:new e.aL(t,r.u_is_halo)}),background:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_opacity:new e.aM(t,r.u_opacity),u_color:new e.aR(t,r.u_color)}),backgroundPattern:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_opacity:new e.aM(t,r.u_opacity),u_image:new e.aL(t,r.u_image),u_pattern_tl_a:new e.aQ(t,r.u_pattern_tl_a),u_pattern_br_a:new e.aQ(t,r.u_pattern_br_a),u_pattern_tl_b:new e.aQ(t,r.u_pattern_tl_b),u_pattern_br_b:new e.aQ(t,r.u_pattern_br_b),u_texsize:new e.aQ(t,r.u_texsize),u_mix:new e.aM(t,r.u_mix),u_pattern_size_a:new e.aQ(t,r.u_pattern_size_a),u_pattern_size_b:new e.aQ(t,r.u_pattern_size_b),u_scale_a:new e.aM(t,r.u_scale_a),u_scale_b:new e.aM(t,r.u_scale_b),u_pixel_coord_upper:new e.aQ(t,r.u_pixel_coord_upper),u_pixel_coord_lower:new e.aQ(t,r.u_pixel_coord_lower),u_tile_units_to_pixels:new e.aM(t,r.u_tile_units_to_pixels)}),terrain:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_texture:new e.aL(t,r.u_texture),u_ele_delta:new e.aM(t,r.u_ele_delta)}),terrainDepth:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_ele_delta:new e.aM(t,r.u_ele_delta)}),terrainCoords:(t,r)=>({u_matrix:new e.aN(t,r.u_matrix),u_texture:new e.aL(t,r.u_texture),u_terrain_coords_id:new e.aM(t,r.u_terrain_coords_id),u_ele_delta:new e.aM(t,r.u_ele_delta)})};class tm{constructor(e,t,r){this.context=e;let i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=!!r,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let t=this.context.gl;if(!this.dynamicDraw)throw Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let tg={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ty{constructor(e,t,r,i){this.length=t.length,this.attributes=r,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.context=e;let a=e.gl;this.buffer=a.createBuffer(),e.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let r=0;r<this.attributes.length;r++){let i=t.attributes[this.attributes[r].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,r){for(let i=0;i<this.attributes.length;i++){let a=this.attributes[i],n=t.attributes[a.name];void 0!==n&&e.vertexAttribPointer(n,a.components,e[tg[a.type]],!1,this.itemSize,a.offset+this.itemSize*(r||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let t_=new WeakMap;function tx(e){var t;if(t_.has(e))return t_.get(e);{let r=null===(t=e.getParameter(e.VERSION))||void 0===t?void 0:t.startsWith("WebGL 2.0");return t_.set(e,r),r}}class tv{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class tb extends tv{getDefault(){return e.aT.transparent}set(e){let t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class tw extends tv{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class tS extends tv{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class tk extends tv{getDefault(){return[!0,!0,!0,!0]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class tT extends tv{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class tI extends tv{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class tC extends tv{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class tP extends tv{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class tE extends tv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class tM extends tv{getDefault(){return[0,1]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class tA extends tv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class tz extends tv{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class tR extends tv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class tD extends tv{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class tL extends tv{getDefault(){return e.aT.transparent}set(e){let t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class tF extends tv{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class tB extends tv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class tO extends tv{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class tN extends tv{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class tV extends tv{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class t$ extends tv{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class tj extends tv{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class tU extends tv{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class tq extends tv{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class tZ extends tv{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class tG extends tv{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class tH extends tv{getDefault(){return null}set(e){let t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class tW extends tv{getDefault(){return null}set(e){var t;if(e===this.current&&!this.dirty)return;let r=this.gl;tx(r)?r.bindVertexArray(e):null===(t=r.getExtension("OES_vertex_array_object"))||void 0===t||t.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class tX extends tv{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class tK extends tv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class tJ extends tv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class tY extends tv{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class tQ extends tY{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class t0 extends tY{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class t1 extends tY{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class t2{constructor(e,t,r,i,a){this.context=e,this.width=t,this.height=r;let n=e.gl,s=this.framebuffer=n.createFramebuffer();if(this.colorAttachment=new tQ(e,s),i)this.depthAttachment=a?new t1(e,s):new t0(e,s);else if(a)throw Error("Stencil cannot be setted without depth");if(n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE)throw Error("Framebuffer is not complete")}destroy(){let e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){let t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class t3{constructor(e,t,r){this.blendFunction=e,this.blendColor=t,this.mask=r}}t3.Replace=[1,0],t3.disabled=new t3(t3.Replace,e.aT.transparent,[!1,!1,!1,!1]),t3.unblended=new t3(t3.Replace,e.aT.transparent,[!0,!0,!0,!0]),t3.alphaBlended=new t3([1,771],e.aT.transparent,[!0,!0,!0,!0]);class t5{constructor(e){var t,r;if(this.gl=e,this.clearColor=new tb(this),this.clearDepth=new tw(this),this.clearStencil=new tS(this),this.colorMask=new tk(this),this.depthMask=new tT(this),this.stencilMask=new tI(this),this.stencilFunc=new tC(this),this.stencilOp=new tP(this),this.stencilTest=new tE(this),this.depthRange=new tM(this),this.depthTest=new tA(this),this.depthFunc=new tz(this),this.blend=new tR(this),this.blendFunc=new tD(this),this.blendColor=new tL(this),this.blendEquation=new tF(this),this.cullFace=new tB(this),this.cullFaceSide=new tO(this),this.frontFace=new tN(this),this.program=new tV(this),this.activeTexture=new t$(this),this.viewport=new tj(this),this.bindFramebuffer=new tU(this),this.bindRenderbuffer=new tq(this),this.bindTexture=new tZ(this),this.bindVertexBuffer=new tG(this),this.bindElementBuffer=new tH(this),this.bindVertexArray=new tW(this),this.pixelStoreUnpack=new tX(this),this.pixelStoreUnpackPremultiplyAlpha=new tK(this),this.pixelStoreUnpackFlipY=new tJ(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),tx(e)){this.HALF_FLOAT=e.HALF_FLOAT;let i=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(t=e.RGBA16F)&&void 0!==t?t:null==i?void 0:i.RGBA16F_EXT,this.RGB16F=null!==(r=e.RGB16F)&&void 0!==r?r:null==i?void 0:i.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let t=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==t?void 0:t.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new tm(this,e,t)}createVertexBuffer(e,t,r){return new ty(this,e,t,r)}createRenderbuffer(e,t,r){let i=this.gl,a=i.createRenderbuffer();return this.bindRenderbuffer.set(a),i.renderbufferStorage(i.RENDERBUFFER,e,t,r),this.bindRenderbuffer.set(null),a}createFramebuffer(e,t,r,i){return new t2(this,e,t,r,i)}clear({color:e,depth:t,stencil:r}){let i=this.gl,a=0;e&&(a|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(a|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==r&&(a|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),i.clear(a)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.aG(t.blendFunction,t3.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var e;return tx(this.gl)?this.gl.createVertexArray():null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var t;return tx(this.gl)?this.gl.deleteVertexArray(e):null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class t4{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}t4.ReadOnly=!1,t4.ReadWrite=!0,t4.disabled=new t4(519,t4.ReadOnly,[0,1]);class t6{constructor(e,t,r,i,a,n){this.test=e,this.ref=t,this.mask=r,this.fail=i,this.depthFail=a,this.pass=n}}t6.disabled=new t6({func:519,mask:0},0,0,7680,7680,7680);class t8{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}function t9(t,r,a,n,s,o,l){var u;let h=t.context,c=h.gl,d=t.useProgram("collisionBox"),p=[],f=0,m=0;for(let i=0;i<n.length;i++){let u=n[i],g=r.getTile(u),y=g.getBucket(a);if(!y)continue;let _=u.posMatrix;0===s[0]&&0===s[1]||(_=t.translatePosMatrix(u.posMatrix,g,s,o));let x=l?y.textCollisionBox:y.iconCollisionBox,v=y.collisionCircleArray;if(v.length>0){let r=e.Z(),i=_;e.aU(r,y.placementInvProjMatrix,t.transform.glCoordMatrix),e.aU(r,r,y.placementViewportMatrix),p.push({circleArray:v,circleOffset:m,transform:i,invTransform:r,coord:u}),f+=v.length/4,m=f}x&&d.draw(h,c.LINES,t4.disabled,t6.disabled,t.colorModeForRenderPass(),t8.disabled,e9(_,t.transform,g),t.style.map.terrain&&t.style.map.terrain.getTerrainData(u),a.id,x.layoutVertexBuffer,x.indexBuffer,x.segments,null,t.transform.zoom,null,null,x.collisionVertexBuffer)}if(!l||!p.length)return;let g=t.useProgram("collisionCircle"),y=new e.aV;y.resize(4*f),y._trim();let _=0;for(let e of p)for(let t=0;t<e.circleArray.length/4;t++){let r=4*t,i=e.circleArray[r+0],a=e.circleArray[r+1],n=e.circleArray[r+2],s=e.circleArray[r+3];y.emplace(_++,i,a,n,s,0),y.emplace(_++,i,a,n,s,1),y.emplace(_++,i,a,n,s,2),y.emplace(_++,i,a,n,s,3)}(!i||i.length<2*f)&&(i=function(t){let r=2*t,i=new e.aX;i.resize(r),i._trim();for(let e=0;e<r;e++){let t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(f));let x=h.createIndexBuffer(i,!0),v=h.createVertexBuffer(y,e.aW.members,!0);for(let r of p){let i={u_matrix:r.transform,u_inv_matrix:r.invTransform,u_camera_to_center_distance:(u=t.transform).cameraToCenterDistance,u_viewport_size:[u.width,u.height]};g.draw(h,c.TRIANGLES,t4.disabled,t6.disabled,t.colorModeForRenderPass(),t8.disabled,i,t.style.map.terrain&&t.style.map.terrain.getTerrainData(r.coord),a.id,v,x,e.S.simpleSegment(0,2*r.circleOffset,r.circleArray.length,r.circleArray.length/2),null,t.transform.zoom,null,null,null)}v.destroy(),x.destroy()}t8.disabled=new t8(!1,1029,2305),t8.backCCW=new t8(!0,1029,2305);let t7=e.ao(new Float32Array(16));function re(t,r,i,a,n,s,o,l,u,h,c,d){let p=t.context,f=p.gl,m=t.transform,g="map"===l,y="map"===u,_="viewport"!==l&&"point"!==i.layout.get("symbol-placement"),x=g&&!y&&!_,v=!i.layout.get("symbol-sort-key").isConstant(),b=!1,w=t.depthModeForSublayer(0,t4.ReadOnly),S=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=[];for(let l of a){let a=r.getTile(l),u=a.getBucket(i);if(!u)continue;let c=n?u.text:u.icon;if(!c||!c.segments.get().length||!c.hasVisibleVertices)continue;let d=c.programConfigurations.get(i.id),p=n||u.sdfIcons,w=n?u.textSizeData:u.iconSizeData,T=y||0!==m.pitch,I=t.useProgram(u.iconsInText&&n?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon",d),C=e.ah(w,m.zoom),P=t.style.map.terrain&&t.style.map.terrain.getTerrainData(l),E,M,A,z,R=[0,0],D=null;if(n)M=a.glyphAtlasTexture,A=f.LINEAR,E=a.glyphAtlasTexture.size,u.iconsInText&&(R=a.imageAtlasTexture.size,D=a.imageAtlasTexture,z=T||t.options.rotating||t.options.zooming||"composite"===w.kind||"camera"===w.kind?f.LINEAR:f.NEAREST);else{let e=1!==i.layout.get("icon-size").constantOr(0)||u.iconsNeedLinear;M=a.imageAtlasTexture,A=p||t.options.rotating||t.options.zooming||e||T?f.LINEAR:f.NEAREST,E=a.imageAtlasTexture.size}let L=ew(a,1,t.transform.zoom),F=eo(l.posMatrix,y,g,t.transform,L),B=el(l.posMatrix,y,g,t.transform,L),O=S&&u.hasTextData(),N="none"!==i.layout.get("icon-text-fit")&&O&&u.hasIconData();if(_){let r=t.style.map.terrain?(e,r)=>t.style.map.terrain.getElevation(l,e,r):null,a="map"===i.layout.get("text-rotation-alignment");!function(t,r,i,a,n,s,o,l,u,h){let c=a?t.textSizeData:t.iconSizeData,d=e.ah(c,i.transform.zoom),p=[256/i.width*2+1,256/i.height*2+1],f=a?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;f.clear();let m=t.lineVertexArray,g=a?t.text.placedSymbolArray:t.icon.placedSymbolArray,y=i.transform.width/i.transform.height,_=!1;for(let a=0;a<g.length;a++){let x;let v=g.get(a);if(v.hidden||v.writingMode===e.ai.vertical&&!_||(_=!1,h?(x=[v.anchorX,v.anchorY,h(v.anchorX,v.anchorY),1],e.ag(x,x,r)):ev(x=[v.anchorX,v.anchorY,0,1],x,r),!function(e,t){let r=e[0]/e[3],i=e[1]/e[3];return r>=-t[0]&&r<=t[0]&&i>=-t[1]&&i<=t[1]}(x,p))){ex(v.numGlyphs,f);continue}let b=eh(i.transform.cameraToCenterDistance,x[3]),w=e.aj(c,d,v),S=o?w/b:w*b,k=new e.P(v.anchorX,v.anchorY),T=eu(k,n,h).point,I={projections:{},offsets:{}},C=ep(v,S,!1,l,r,n,s,t.glyphOffsetArray,m,f,T,k,I,y,u,h);_=C.useVertical,(C.notEnoughRoom||_||C.needsFlipping&&ep(v,S,!0,l,r,n,s,t.glyphOffsetArray,m,f,T,k,I,y,u,h).notEnoughRoom)&&ex(v.numGlyphs,f)}a?t.text.dynamicLayoutVertexBuffer.updateData(f):t.icon.dynamicLayoutVertexBuffer.updateData(f)}(u,l.posMatrix,t,n,F,B,y,h,a,r)}let V=t.translatePosMatrix(l.posMatrix,a,s,o),$=_||n&&S||N?t7:F,j=t.translatePosMatrix(B,a,s,o,!0),U=p&&0!==i.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1),q={program:I,buffers:c,uniformValues:p?u.iconsInText?tc(w.kind,C,x,y,t,V,$,j,E,R):th(w.kind,C,x,y,t,V,$,j,n,E,!0):tu(w.kind,C,x,y,t,V,$,j,n,E),atlasTexture:M,atlasTextureIcon:D,atlasInterpolation:A,atlasInterpolationIcon:z,isSDF:p,hasHalo:U};if(v&&u.canOverlap)for(let t of(b=!0,c.segments.get()))k.push({segments:new e.S([t]),sortKey:t.sortKey,state:q,terrainData:P});else k.push({segments:c.segments,sortKey:0,state:q,terrainData:P})}for(let e of(b&&k.sort((e,t)=>e.sortKey-t.sortKey),k)){let r=e.state;if(p.activeTexture.set(f.TEXTURE0),r.atlasTexture.bind(r.atlasInterpolation,f.CLAMP_TO_EDGE),r.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),r.isSDF){let a=r.uniformValues;r.hasHalo&&(a.u_is_halo=1,rt(r.buffers,e.segments,i,t,r.program,w,c,d,a,e.terrainData)),a.u_is_halo=0}rt(r.buffers,e.segments,i,t,r.program,w,c,d,r.uniformValues,e.terrainData)}}function rt(e,t,r,i,a,n,s,o,l,u){let h=i.context;a.draw(h,h.gl.TRIANGLES,n,s,o,t8.disabled,l,u,r.id,e.layoutVertexBuffer,e.indexBuffer,t,r.paint,i.transform.zoom,e.programConfigurations.get(r.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function rr(e,t,r,i,a){if(!r||!i||!i.imageAtlas)return;let n=i.imageAtlas.patternPositions,s=n[r.to.toString()],o=n[r.from.toString()];if(!s&&o&&(s=o),!o&&s&&(o=s),!s||!o){let e=a.getPaintProperty(t);s=n[e],o=n[e]}s&&o&&e.setConstantPatternPositions(s,o)}function ri(e,t,r,i,a,n,s){let o,l,u,h,c;let d=e.context.gl,p="fill-pattern",f=r.paint.get(p),m=f&&f.constantOr(1),g=r.getCrossfadeParameters();s?(l=m&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",o=d.LINES):(l=m?"fillPattern":"fill",o=d.TRIANGLES);let y=f.constantOr(null);for(let f of i){let i=t.getTile(f);if(m&&!i.patternsLoaded())continue;let _=i.getBucket(r);if(!_)continue;let x=_.programConfigurations.get(r.id),v=e.useProgram(l,x),b=e.style.map.terrain&&e.style.map.terrain.getTerrainData(f);m&&(e.context.activeTexture.set(d.TEXTURE0),i.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),x.updatePaintBuffers(g)),rr(x,p,y,i,r);let w=b?f:null,S=e.translatePosMatrix(w?w.posMatrix:f.posMatrix,i,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(s){h=_.indexBuffer2,c=_.segments2;let t=[d.drawingBufferWidth,d.drawingBufferHeight];u="fillOutlinePattern"===l&&m?e6(S,e,g,i,t):e4(S,t)}else h=_.indexBuffer,c=_.segments,u=m?e5(S,e,g,i):e3(S);v.draw(e.context,o,a,e.stencilModeForClipping(f),n,t8.disabled,u,b,r.id,_.layoutVertexBuffer,h,c,r.paint,e.transform.zoom,x)}}function ra(e,t,r,i,a,n,s){let o=e.context,l=o.gl,u="fill-extrusion-pattern",h=r.paint.get(u),c=h.constantOr(1),d=r.getCrossfadeParameters(),p=r.paint.get("fill-extrusion-opacity"),f=h.constantOr(null);for(let h of i){let i=t.getTile(h),m=i.getBucket(r);if(!m)continue;let g=e.style.map.terrain&&e.style.map.terrain.getTerrainData(h),y=m.programConfigurations.get(r.id),_=e.useProgram(c?"fillExtrusionPattern":"fillExtrusion",y);c&&(e.context.activeTexture.set(l.TEXTURE0),i.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.updatePaintBuffers(d)),rr(y,u,f,i,r);let x=e.translatePosMatrix(h.posMatrix,i,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),v=r.paint.get("fill-extrusion-vertical-gradient"),b=c?e2(x,e,v,p,h,d,i):e1(x,e,v,p);_.draw(o,o.gl.TRIANGLES,a,n,s,t8.backCCW,b,g,r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,r.paint,e.transform.zoom,y,e.style.map.terrain&&m.centroidVertexBuffer)}}let rn=new e.aT(1,0,0,1),rs=new e.aT(0,1,0,1),ro=new e.aT(0,0,1,1),rl=new e.aT(1,0,1,1),ru=new e.aT(0,1,1,1);function rh(e,t,r,i){rd(e,0,t+r/2,e.transform.width,r,i)}function rc(e,t,r,i){rd(e,t-r/2,0,r,e.transform.height,i)}function rd(e,t,r,i,a,n){let s=e.context,o=s.gl;o.enable(o.SCISSOR_TEST),o.scissor(t*e.pixelRatio,r*e.pixelRatio,i*e.pixelRatio,a*e.pixelRatio),s.clear({color:n}),o.disable(o.SCISSOR_TEST)}function rp(e,t,r){let i=e.context,a=i.gl,n=e.colorModeForRenderPass(),s=new t4(a.LEQUAL,t4.ReadWrite,e.depthRangeFor3D),o=e.useProgram("terrain"),l=t.getTerrainMesh();for(let u of(i.bindFramebuffer.set(null),i.viewport.set([0,0,e.width,e.height]),r)){let r=e.renderToTexture.getTexture(u),h=t.getTerrainData(u.tileID);i.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,r.texture);let c={u_matrix:e.transform.calculatePosMatrix(u.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(e.transform.zoom)};o.draw(i,a.TRIANGLES,s,t6.disabled,n,t8.backCCW,c,h,"terrain",l.vertexBuffer,l.indexBuffer,l.segments)}}class rf{constructor(t,r){this.context=new t5(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:e.Z(),renderTime:0},this.setup(),this.numSublayers=J.maxUnderzooming+J.maxOverzooming+1,this.depthEpsilon=1/65536,this.crossTileSymbolIndex=new e$}resize(e,t,r){if(this.width=Math.floor(e*r),this.height=Math.floor(t*r),this.pixelRatio=r,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let e of this.style._order)this.style._layers[e].resize()}setup(){let t=this.context,r=new e.a_;r.emplaceBack(0,0),r.emplaceBack(e.N,0),r.emplaceBack(0,e.N),r.emplaceBack(e.N,e.N),this.tileExtentBuffer=t.createVertexBuffer(r,eH.members),this.tileExtentSegments=e.S.simpleSegment(0,0,4,2);let i=new e.a_;i.emplaceBack(0,0),i.emplaceBack(e.N,0),i.emplaceBack(0,e.N),i.emplaceBack(e.N,e.N),this.debugBuffer=t.createVertexBuffer(i,eH.members),this.debugSegments=e.S.simpleSegment(0,0,4,5);let a=new e.V;a.emplaceBack(0,0,0,0),a.emplaceBack(e.N,0,e.N,0),a.emplaceBack(0,e.N,0,e.N),a.emplaceBack(e.N,e.N,e.N,e.N),this.rasterBoundsBuffer=t.createVertexBuffer(a,$.members),this.rasterBoundsSegments=e.S.simpleSegment(0,0,4,2);let n=new e.a_;n.emplaceBack(0,0),n.emplaceBack(1,0),n.emplaceBack(0,1),n.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(n,eH.members),this.viewportSegments=e.S.simpleSegment(0,0,4,2);let s=new e.a$;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(s);let o=new e.b0;o.emplaceBack(0,1,2),o.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(o);let l=this.context.gl;this.stencilClearMode=new t6({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)}clearStencil(){let t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let i=e.Z();e.aS(i,0,this.width,this.height,0,0,1),e.a0(i,i,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,r.TRIANGLES,t4.disabled,this.stencilClearMode,t3.disabled,t8.disabled,te(i),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,t){if(this.currentStencilSource===e.source||!e.isTileClipped()||!t||!t.length)return;this.currentStencilSource=e.source;let r=this.context,i=r.gl;this.nextStencilID+t.length>256&&this.clearStencil(),r.setColorMode(t3.disabled),r.setDepthMode(t4.disabled);let a=this.useProgram("clippingMask");for(let e of(this._tileClippingMaskIDs={},t)){let t=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,n=this.style.map.terrain&&this.style.map.terrain.getTerrainData(e);a.draw(r,i.TRIANGLES,t4.disabled,new t6({func:i.ALWAYS,mask:0},t,255,i.KEEP,i.KEEP,i.REPLACE),t3.disabled,t8.disabled,te(e.posMatrix),n,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,t=this.context.gl;return new t6({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){let t=this.context.gl;return new t6({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){let t=this.context.gl,r=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),i=r[r.length-1].overscaledZ,a=r[0].overscaledZ-i+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();let e={};for(let r=0;r<a;r++)e[r+i]=new t6({func:t.GEQUAL,mask:255},r+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=a,[e,r]}return[{[i]:t6.disabled},r]}colorModeForRenderPass(){let t=this.context.gl;if(this._showOverdrawInspector){let r=1/8;return new t3([t.CONSTANT_COLOR,t.ONE],new e.aT(r,r,r,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t3.unblended:t3.alphaBlended}depthModeForSublayer(e,t,r){if(!this.opaquePassEnabledForLayer())return t4.disabled;let i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t4(r||this.context.gl.LEQUAL,t,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.h.now()),this.imageManager.beginFrame();let i=this.style._order,a=this.style.sourceCaches,n={},s={},o={};for(let e in a){let t=a[e];t.used&&t.prepare(this.context),n[e]=t.getVisibleCoordinates(),s[e]=n[e].slice().reverse(),o[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<i.length;e++)if(this.style._layers[i[e]].is3D()){this.opaquePassCutoff=e;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;let t=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!e.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||t.length)&&(e.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(t,r){let i=t.context,a=i.gl,n=t3.unblended,s=new t4(a.LEQUAL,t4.ReadWrite,[0,1]),o=r.getTerrainMesh(),l=r.sourceCache.getRenderableTiles(),u=t.useProgram("terrainDepth");for(let h of(i.bindFramebuffer.set(r.getFramebuffer("depth").framebuffer),i.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),i.clear({color:e.aT.transparent,depth:1}),l)){let e=r.getTerrainData(h.tileID),l={u_matrix:t.transform.calculatePosMatrix(h.tileID.toUnwrapped()),u_ele_delta:r.getMeshFrameDelta(t.transform.zoom)};u.draw(i,a.TRIANGLES,s,t6.disabled,n,t8.backCCW,l,e,"terrain",o.vertexBuffer,o.indexBuffer,o.segments)}i.bindFramebuffer.set(null),i.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain),function(t,r){let i=t.context,a=i.gl,n=t3.unblended,s=new t4(a.LEQUAL,t4.ReadWrite,[0,1]),o=r.getTerrainMesh(),l=r.getCoordsTexture(),u=r.sourceCache.getRenderableTiles(),h=t.useProgram("terrainCoords");for(let c of(i.bindFramebuffer.set(r.getFramebuffer("coords").framebuffer),i.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),i.clear({color:e.aT.transparent,depth:1}),r.coordsIndex=[],u)){let e=r.getTerrainData(c.tileID);i.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,l.texture);let u={u_matrix:t.transform.calculatePosMatrix(c.tileID.toUnwrapped()),u_terrain_coords_id:(255-r.coordsIndex.length)/255,u_texture:0,u_ele_delta:r.getMeshFrameDelta(t.transform.zoom)};h.draw(i,a.TRIANGLES,s,t6.disabled,n,t8.backCCW,u,e,"terrain",o.vertexBuffer,o.indexBuffer,o.segments),r.coordsIndex.push(c.tileID.key)}i.bindFramebuffer.set(null),i.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain))}for(let e of(this.renderPass="offscreen",i)){let t=this.style._layers[e];if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;let r=s[t.source];("custom"===t.type||r.length)&&this.renderLayer(this,a[t.source],t,r)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?e.aT.black:e.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){let e=this.style._layers[i[this.currentLayer]],t=a[e.source],r=n[e.source];this._renderTileClippingMasks(e,r),this.renderLayer(this,t,e,r)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){let e=this.style._layers[i[this.currentLayer]],t=a[e.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(e))continue;let r=("symbol"===e.type?o:s)[e.source];this._renderTileClippingMasks(e,n[e.source]),this.renderLayer(this,t,e,r)}if(this.options.showTileBoundaries){let t=function(e,t){let r=null,i=Object.values(e._layers).flatMap(r=>r.source&&!r.isHidden(t)?[e.sourceCaches[r.source]]:[]),a=i.filter(e=>"vector"===e.getSource().type),n=i.filter(e=>"vector"!==e.getSource().type),s=e=>{(!r||r.getSource().maxzoom<e.getSource().maxzoom)&&(r=e)};return a.forEach(e=>s(e)),r||n.forEach(e=>s(e)),r}(this.style,this.transform.zoom);t&&function(t,r,i){for(let a=0;a<i.length;a++)!function(t,r,i){let a=t.context,n=a.gl,s=i.posMatrix,o=t.useProgram("debug"),l=t4.disabled,u=t6.disabled,h=t.colorModeForRenderPass(),c="$debug",d=t.style.map.terrain&&t.style.map.terrain.getTerrainData(i);a.activeTexture.set(n.TEXTURE0);let p=r.getTileByID(i.key).latestRawTileData,f=Math.floor((p&&p.byteLength||0)/1024),m=512/Math.min(r.getTile(i).tileSize,512)*(i.overscaledZ/t.transform.zoom)*.5,g=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(g+=` => ${i.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();let r=e.debugOverlayCanvas,i=e.context.gl,a=e.debugOverlayCanvas.getContext("2d");a.clearRect(0,0,r.width,r.height),a.shadowColor="white",a.shadowBlur=2,a.lineWidth=1.5,a.strokeStyle="white",a.textBaseline="top",a.font="bold 36px Open Sans, sans-serif",a.fillText(t,5,5),a.strokeText(t,5,5),e.debugOverlayTexture.update(r),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,`${g} ${f}kB`),o.draw(a,n.TRIANGLES,l,u,t3.alphaBlended,t8.disabled,e7(s,e.aT.transparent,m),null,c,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments),o.draw(a,n.LINE_STRIP,l,u,h,t8.disabled,e7(s,e.aT.red),d,c,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments)}(t,r,i[a])}(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(e){var t,r;let i=e.transform.padding;rh(e,e.transform.height-(i.top||0),3,rn),rh(e,i.bottom||0,3,rs),rc(e,i.left||0,3,ro),rc(e,e.transform.width-(i.right||0),3,rl);let a=e.transform.centerPoint;t=a.x,r=e.transform.height-a.y,rd(e,t-1,r-10,2,20,ru),rd(e,t-10,r-1,20,2,ru)}(this),this.context.setDefault()}renderLayer(t,r,i,a){if(!i.isHidden(this.transform.zoom)&&("background"===i.type||"custom"===i.type||(a||[]).length))switch(this.id=i.id,i.type){case"symbol":!function(t,r,i,a,n){if("translucent"!==t.renderPass)return;let s=t6.disabled,o=t.colorModeForRenderPass();(i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(t,r,i,a,n,s,o){let l=r.transform,u="map"===n,h="map"===s;for(let n of t){let t=a.getTile(n),s=t.getBucket(i);if(!s||!s.text||!s.text.segments.get().length)continue;let c=e.ah(s.textSizeData,l.zoom),d=ew(t,1,r.transform.zoom),p=eo(n.posMatrix,h,u,r.transform,d),f="none"!==i.layout.get("icon-text-fit")&&s.hasIconData();if(c){let i=Math.pow(2,l.zoom-t.tileID.overscaledZ);(function(t,r,i,a,n,s,o,l,u,h,c){let d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={};p.clear();for(let f=0;f<d.length;f++){let g=d.get(f),y=g.hidden||!g.crossTileID||t.allowVerticalPlacement&&!g.placedOrientation?null:a[g.crossTileID];if(y){let a=new e.P(g.anchorX,g.anchorY),d=eu(a,i?o:s,c),f=eh(n.cameraToCenterDistance,d.signedDistanceFromCamera),_=e.aj(t.textSizeData,u,g)*f/e.ap;i&&(_*=t.tilePixelRatio/l);let{width:x,height:v,anchor:b,textOffset:w,textBoxScale:S}=y,k=function(t,r,i,a,n,s){let{horizontalAlign:o,verticalAlign:l}=e.au(t);return new e.P((-(o-.5)*r/n+a[0])*s,(-(l-.5)*i/n+a[1])*s)}(b,x,v,w,S,_),T=i?eu(a.add(k),s,c).point:d.point.add(r?k.rotate(-n.angle):k),I=t.allowVerticalPlacement&&g.placedOrientation===e.ai.vertical?Math.PI/2:0;for(let t=0;t<g.numGlyphs;t++)e.ak(p,T,I);h&&g.associatedIconIndex>=0&&(m[g.associatedIconIndex]={shiftedAnchor:T,angle:I})}else ex(g.numGlyphs,p)}if(h){f.clear();let r=t.icon.placedSymbolArray;for(let t=0;t<r.length;t++){let i=r.get(t);if(i.hidden)ex(i.numGlyphs,f);else{let r=m[t];if(r)for(let t=0;t<i.numGlyphs;t++)e.ak(f,r.shiftedAnchor,r.angle);else ex(i.numGlyphs,f)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)})(s,u,h,o,l,p,n.posMatrix,i,c,f,r.style.map.terrain?(e,t)=>r.style.map.terrain.getElevation(n,e,t):null)}}}(a,t,i,r,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),n),0!==i.paint.get("icon-opacity").constantOr(1)&&re(t,r,i,a,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),s,o),0!==i.paint.get("text-opacity").constantOr(1)&&re(t,r,i,a,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),s,o),r.map.showCollisionBoxes&&(t9(t,r,i,a,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),t9(t,r,i,a,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))}(t,r,i,a,this.style.placement.variableOffsets);break;case"circle":!function(t,r,i,a){if("translucent"!==t.renderPass)return;let n=i.paint.get("circle-opacity"),s=i.paint.get("circle-stroke-width"),o=i.paint.get("circle-stroke-opacity"),l=!i.layout.get("circle-sort-key").isConstant();if(0===n.constantOr(1)&&(0===s.constantOr(1)||0===o.constantOr(1)))return;let u=t.context,h=u.gl,c=t.depthModeForSublayer(0,t4.ReadOnly),d=t6.disabled,p=t.colorModeForRenderPass(),f=[];for(let n=0;n<a.length;n++){let s=a[n],o=r.getTile(s),u=o.getBucket(i);if(!u)continue;let h=u.programConfigurations.get(i.id),c=t.useProgram("circle",h),d=u.layoutVertexBuffer,p=u.indexBuffer,m=t.style.map.terrain&&t.style.map.terrain.getTerrainData(s),g={programConfiguration:h,program:c,layoutVertexBuffer:d,indexBuffer:p,uniformValues:e8(t,s,o,i),terrainData:m};if(l)for(let t of u.segments.get())f.push({segments:new e.S([t]),sortKey:t.sortKey,state:g});else f.push({segments:u.segments,sortKey:0,state:g})}for(let e of(l&&f.sort((e,t)=>e.sortKey-t.sortKey),f)){let{programConfiguration:r,program:a,layoutVertexBuffer:n,indexBuffer:s,uniformValues:o,terrainData:l}=e.state;a.draw(u,h.TRIANGLES,c,d,p,t8.disabled,o,l,i.id,n,s,e.segments,i.paint,t.transform.zoom,r)}}(t,r,i,a);break;case"heatmap":!function(t,r,i,a){if(0!==i.paint.get("heatmap-opacity")){if("offscreen"===t.renderPass){let n=t.context,s=n.gl,o=t6.disabled,l=new t3([s.ONE,s.ONE],e.aT.transparent,[!0,!0,!0,!0]);(function(e,t,r){let i=e.gl;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);let a=r.heatmapFbo;if(a)i.bindTexture(i.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer);else{let n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),a=r.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1,!1),function(e,t,r,i){var a,n;let s=e.gl,o=null!==(a=e.HALF_FLOAT)&&void 0!==a?a:s.UNSIGNED_BYTE,l=null!==(n=e.RGBA16F)&&void 0!==n?n:s.RGBA;s.texImage2D(s.TEXTURE_2D,0,l,t.width/4,t.height/4,0,s.RGBA,o,null),i.colorAttachment.set(r)}(e,t,n,a)}})(n,t,i),n.clear({color:e.aT.transparent});for(let e=0;e<a.length;e++){let u=a[e];if(r.hasRenderableParent(u))continue;let h=r.getTile(u),c=h.getBucket(i);if(!c)continue;let d=c.programConfigurations.get(i.id),p=t.useProgram("heatmap",d),{zoom:f}=t.transform;p.draw(n,s.TRIANGLES,t4.disabled,o,l,t8.disabled,tt(u.posMatrix,h,f,i.paint.get("heatmap-intensity")),null,i.id,c.layoutVertexBuffer,c.indexBuffer,c.segments,i.paint,t.transform.zoom,d)}n.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,r){let i=t.context,a=i.gl,n=r.heatmapFbo;if(!n)return;i.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,n.colorAttachment.get()),i.activeTexture.set(a.TEXTURE1);let s=r.colorRampTexture;s||(s=r.colorRampTexture=new T(i,r.colorRamp,a.RGBA)),s.bind(a.LINEAR,a.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(i,a.TRIANGLES,t4.disabled,t6.disabled,t.colorModeForRenderPass(),t8.disabled,((t,r,i,a)=>{let n=e.Z();e.aS(n,0,t.width,t.height,0,0,1);let s=t.context.gl;return{u_matrix:n,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:r.paint.get("heatmap-opacity")}})(t,r),null,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,r.paint,t.transform.zoom)}(t,i))}}(t,r,i,a);break;case"line":!function(t,r,i,a){if("translucent"!==t.renderPass)return;let n=i.paint.get("line-opacity"),s=i.paint.get("line-width");if(0===n.constantOr(1)||0===s.constantOr(1))return;let o=t.depthModeForSublayer(0,t4.ReadOnly),l=t.colorModeForRenderPass(),u=i.paint.get("line-dasharray"),h=i.paint.get("line-pattern"),c=h.constantOr(1),d=i.paint.get("line-gradient"),p=i.getCrossfadeParameters(),f=c?"linePattern":u?"lineSDF":d?"lineGradient":"line",m=t.context,g=m.gl,y=!0;for(let n of a){let a=r.getTile(n);if(c&&!a.patternsLoaded())continue;let s=a.getBucket(i);if(!s)continue;let _=s.programConfigurations.get(i.id),x=t.context.program.get(),v=t.useProgram(f,_),b=y||v.program!==x,w=t.style.map.terrain&&t.style.map.terrain.getTerrainData(n),S=h.constantOr(null);if(S&&a.imageAtlas){let e=a.imageAtlas,t=e.patternPositions[S.to.toString()],r=e.patternPositions[S.from.toString()];t&&r&&_.setConstantPatternPositions(t,r)}let k=w?n:null,I=c?ta(t,a,i,p,k):u?tn(t,a,i,u,p,k):d?ti(t,a,i,s.lineClipsArray.length,k):tr(t,a,i,k);if(c)m.activeTexture.set(g.TEXTURE0),a.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),_.updatePaintBuffers(p);else if(u&&(b||t.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),t.lineAtlas.bind(m);else if(d){let a=s.gradients[i.id],o=a.texture;if(i.gradientVersion!==a.version){let l=256;if(i.stepInterpolant){let i=r.getSource().maxzoom,a=n.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-n.canonical.z):1;l=e.ad(e.aY(s.maxLineLength/e.N*1024*a),256,m.maxTextureSize)}a.gradient=e.aZ({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:a.gradient||void 0,clips:s.lineClipsArray}),a.texture?a.texture.update(a.gradient):a.texture=new T(m,a.gradient,g.RGBA),a.version=i.gradientVersion,o=a.texture}m.activeTexture.set(g.TEXTURE0),o.bind(i.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}v.draw(m,g.TRIANGLES,o,t.stencilModeForClipping(n),l,t8.disabled,I,w,i.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,i.paint,t.transform.zoom,_,s.layoutVertexBuffer2),y=!1}}(t,r,i,a);break;case"fill":!function(t,r,i,a){let n=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(0===s.constantOr(1))return;let o=t.colorModeForRenderPass(),l=i.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===n.constantOr(e.aT.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===u){let e=t.depthModeForSublayer(1,"opaque"===t.renderPass?t4.ReadWrite:t4.ReadOnly);ri(t,r,i,a,e,o,!1)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){let e=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,t4.ReadOnly);ri(t,r,i,a,e,o,!0)}}(t,r,i,a);break;case"fill-extrusion":!function(e,t,r,i){let a=r.paint.get("fill-extrusion-opacity");if(0!==a&&"translucent"===e.renderPass){let n=new t4(e.context.gl.LEQUAL,t4.ReadWrite,e.depthRangeFor3D);if(1!==a||r.paint.get("fill-extrusion-pattern").constantOr(1))ra(e,t,r,i,n,t6.disabled,t3.disabled),ra(e,t,r,i,n,e.stencilModeFor3D(),e.colorModeForRenderPass());else{let a=e.colorModeForRenderPass();ra(e,t,r,i,n,t6.disabled,a)}}}(t,r,i,a);break;case"hillshade":!function(t,r,i,a){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;let n=t.context,s=t.depthModeForSublayer(0,t4.ReadOnly),o=t.colorModeForRenderPass(),[l,u]="translucent"===t.renderPass?t.stencilConfigForOverlap(a):[{},a];for(let a of u){let n=r.getTile(a);void 0!==n.needsHillshadePrepare&&n.needsHillshadePrepare&&"offscreen"===t.renderPass?function(t,r,i,a,n,s){let o=t.context,l=o.gl,u=r.dem;if(u&&u.data){let h=u.dim,c=u.stride,d=u.getPixels();if(o.activeTexture.set(l.TEXTURE1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||t.getTileTexture(c),r.demTexture){let e=r.demTexture;e.update(d,{premultiply:!1}),e.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else r.demTexture=new T(o,d,l.RGBA,{premultiply:!1}),r.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);o.activeTexture.set(l.TEXTURE0);let p=r.fbo;if(!p){let e=new T(o,{width:h,height:h,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),(p=r.fbo=o.createFramebuffer(h,h,!0,!1)).colorAttachment.set(e.texture)}o.bindFramebuffer.set(p.framebuffer),o.viewport.set([0,0,h,h]),t.useProgram("hillshadePrepare").draw(o,l.TRIANGLES,a,n,s,t8.disabled,((t,r)=>{let i=r.stride,a=e.Z();return e.aS(a,0,e.N,-e.N,0,0,1),e.$(a,a,[0,-e.N,0]),{u_matrix:a,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ,u_unpack:r.getUnpackVector()}})(r.tileID,u),null,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),r.needsHillshadePrepare=!1}}(t,n,i,s,t6.disabled,o):"translucent"===t.renderPass&&function(t,r,i,a,n,s,o){let l=t.context,u=l.gl,h=i.fbo;if(!h)return;let c=t.useProgram("hillshade"),d=t.style.map.terrain&&t.style.map.terrain.getTerrainData(r);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,h.colorAttachment.get()),c.draw(l,u.TRIANGLES,n,s,o,t8.disabled,((t,r,i,a)=>{let n=i.paint.get("hillshade-shadow-color"),s=i.paint.get("hillshade-highlight-color"),o=i.paint.get("hillshade-accent-color"),l=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(l-=t.transform.angle);let u=!t.options.moving;return{u_matrix:a?a.posMatrix:t.transform.calculatePosMatrix(r.tileID.toUnwrapped(),u),u_image:0,u_latrange:function(t,r){let i=Math.pow(2,r.canonical.z),a=r.canonical.y;return[new e.U(0,a/i).toLngLat().lat,new e.U(0,(a+1)/i).toLngLat().lat]}(0,r.tileID),u_light:[i.paint.get("hillshade-exaggeration"),l],u_shadow:n,u_highlight:s,u_accent:o}})(t,i,a,d?r:null),d,a.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}(t,a,n,i,s,l[a.overscaledZ],o)}n.viewport.set([0,0,t.width,t.height])}(t,r,i,a);break;case"raster":!function(t,r,i,a){if("translucent"!==t.renderPass||0===i.paint.get("raster-opacity")||!a.length)return;let n=t.context,s=n.gl,o=r.getSource(),l=t.useProgram("raster"),u=t.colorModeForRenderPass(),[h,c]=o instanceof j?[{},a]:t.stencilConfigForOverlap(a),d=c[c.length-1].overscaledZ,p=!t.options.moving;for(let a of c){let c,f;let m=t.depthModeForSublayer(a.overscaledZ-d,1===i.paint.get("raster-opacity")?t4.ReadWrite:t4.ReadOnly,s.LESS),g=r.getTile(a);g.registerFadeDuration(i.paint.get("raster-fade-duration"));let y=r.findLoadedParent(a,0),_=function(t,r,i,a,n,s){let o=a.paint.get("raster-fade-duration");if(!s&&o>0){let a=e.h.now(),s=(a-t.timeAdded)/o,l=r?(a-r.timeAdded)/o:-1,u=i.getSource(),h=n.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),c=!r||Math.abs(r.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),d=c&&t.refreshedUponExpiration?1:e.ad(c?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),r?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}(g,y,r,i,t.transform,t.style.map.terrain),x="nearest"===i.paint.get("raster-resampling")?s.NEAREST:s.LINEAR;n.activeTexture.set(s.TEXTURE0),g.texture.bind(x,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),n.activeTexture.set(s.TEXTURE1),y?(y.texture.bind(x,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),c=Math.pow(2,y.tileID.overscaledZ-g.tileID.overscaledZ),f=[g.tileID.canonical.x*c%1,g.tileID.canonical.y*c%1]):g.texture.bind(x,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);let v=t.style.map.terrain&&t.style.map.terrain.getTerrainData(a),b=v?a:null,w=tl(b?b.posMatrix:t.transform.calculatePosMatrix(a.toUnwrapped(),p),f||[0,0],c||1,_,i);o instanceof j?l.draw(n,s.TRIANGLES,m,t6.disabled,u,t8.disabled,w,v,i.id,o.boundsBuffer,t.quadTriangleIndexBuffer,o.boundsSegments):l.draw(n,s.TRIANGLES,m,h[a.overscaledZ],u,t8.disabled,w,v,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}(t,r,i,a);break;case"background":!function(e,t,r,i){let a=r.paint.get("background-color"),n=r.paint.get("background-opacity");if(0===n)return;let s=e.context,o=s.gl,l=e.transform,u=l.tileSize,h=r.paint.get("background-pattern");if(e.isPatternMissing(h))return;let c=!h&&1===a.a&&1===n&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==c)return;let d=t6.disabled,p=e.depthModeForSublayer(0,"opaque"===c?t4.ReadWrite:t4.ReadOnly),f=e.colorModeForRenderPass(),m=e.useProgram(h?"backgroundPattern":"background"),g=i||l.coveringTiles({tileSize:u,terrain:e.style.map.terrain});h&&(s.activeTexture.set(o.TEXTURE0),e.imageManager.bind(e.context));let y=r.getCrossfadeParameters();for(let t of g){let l=i?t.posMatrix:e.transform.calculatePosMatrix(t.toUnwrapped()),c=h?tp(l,n,e,h,{tileID:t,tileSize:u},y):td(l,n,a),g=e.style.map.terrain&&e.style.map.terrain.getTerrainData(t);m.draw(s,o.TRIANGLES,p,d,f,t8.disabled,c,g,r.id,e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments)}}(t,0,i,a);break;case"custom":!function(e,t,r){let i=e.context,a=r.implementation;if("offscreen"===e.renderPass){let t=a.prerender;t&&(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),t.call(a,i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(t6.disabled);let t="3d"===a.renderingMode?new t4(e.context.gl.LEQUAL,t4.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t4.ReadOnly);i.setDepthMode(t),a.render(i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}(t,0,i)}}translatePosMatrix(t,r,i,a,n){if(!i[0]&&!i[1])return t;let s=n?"map"===a?this.transform.angle:0:"viewport"===a?-this.transform.angle:0;if(s){let e=Math.sin(s),t=Math.cos(s);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}let o=[n?i[0]:ew(r,i[0],this.transform.zoom),n?i[1]:ew(r,i[1],this.transform.zoom),0],l=new Float32Array(16);return e.$(l,t,o),l}saveTileTexture(e){let t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let t=this.imageManager.getPattern(e.from.toString()),r=this.imageManager.getPattern(e.to.toString());return!t||!r}useProgram(e,t){this.cache=this.cache||{};let r=e+(t?t.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[r]||(this.cache[r]=new eQ(this.context,eX[e],t,tf[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[r]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:t}=this.context.gl;return this.width!==e||this.height!==t}}class rm{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(t,r,i){let a=Math.pow(2,i),n=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(i=>{let n=1/(i=e.ag([],i,t))[3]/r*a;return e.b3(i,i,[n,n,1/i[3],n])}),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{var t,r,i,a,s,o,l,u,h,c,d,p,f,m,g;let y=(d=[],(g=(p=(r=[],i=b([],n[e[0]],n[e[1]]),a=b([],n[e[2]],n[e[1]]),s=i[0],o=i[1],l=i[2],u=a[0],h=a[1],c=a[2],r[0]=o*c-l*h,r[1]=l*u-s*c,r[2]=s*h-o*u,r)[0])*p+(f=r[1])*f+(m=r[2])*m)>0&&(g=1/Math.sqrt(g)),d[0]=r[0]*g,d[1]=r[1]*g,d[2]=r[2]*g,d),_=-(y[0]*(t=n[e[1]])[0]+y[1]*t[1]+y[2]*t[2]);return y.concat(_)});return new rm(n,s)}}class rg{constructor(e,t){var r,i,a,n;this.min=e,this.max=t,this.center=(n=[],r=[],i=this.min,a=this.max,r[0]=i[0]+a[0],r[1]=i[1]+a[1],r[2]=i[2]+a[2],n[0]=.5*r[0],n[1]=.5*r[1],n[2]=.5*r[2],n)}quadrant(e){let t=[e%2==0,e<2],r=g(this.min),i=g(this.max);for(let e=0;e<t.length;e++)r[e]=t[e]?this.min[e]:this.center[e],i[e]=t[e]?this.center[e]:this.max[e];return i[2]=this.max[2],new rg(r,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(t){let r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],i=!0;for(let a=0;a<t.planes.length;a++){let n=t.planes[a],s=0;for(let t=0;t<r.length;t++)e.b4(n,r[t])>=0&&s++;if(0===s)return 0;s!==r.length&&(i=!1)}if(i)return 2;for(let e=0;e<3;e++){let r=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let a=0;a<t.points.length;a++){let n=t.points[a][e]-this.min[e];r=Math.min(r,n),i=Math.max(i,n)}if(i<0||r>this.max[e]-this.min[e])return 0}return 1}}class ry{constructor(e=0,t=0,r=0,i=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(r)||r<0||isNaN(i)||i<0)throw Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=r,this.right=i}interpolate(t,r,i){return null!=r.top&&null!=t.top&&(this.top=e.B.number(t.top,r.top,i)),null!=r.bottom&&null!=t.bottom&&(this.bottom=e.B.number(t.bottom,r.bottom,i)),null!=r.left&&null!=t.left&&(this.left=e.B.number(t.left,r.left,i)),null!=r.right&&null!=t.right&&(this.right=e.B.number(t.right,r.right,i)),this}getCenter(t,r){let i=e.ad((this.left+t-this.right)/2,0,t),a=e.ad((this.top+r-this.bottom)/2,0,r);return new e.P(i,a)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ry(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class r_{constructor(t,r,i,a,n){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===n||!!n,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=null==i?0:i,this._maxPitch=null==a?60:a,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ry,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){let e=new r_(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this._minEleveationForCurrentTile=e._minEleveationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){var r,i,a,n,s,o,l,u,h,c;let d=-e.b5(t,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(r=new e.A(4),e.A!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r),i=this.rotationMatrix,a=this.rotationMatrix,n=this.angle,s=a[0],o=a[1],l=a[2],u=a[3],h=Math.sin(n),c=Math.cos(n),i[0]=s*c+l*h,i[1]=o*c+u*h,i[2]=-(s*h)+l*c,i[3]=-(o*h)+u*c)}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let r=e.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){let t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._zoom=t,this.tileZoom=Math.max(0,Math.floor(t)),this.scale=this.zoomScale(t),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,r){this._unmodified=!1,this._edgeInsets.interpolate(e,t,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){return Math.max(0,(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize)))}getVisibleUnwrappedCoordinates(t){let r=[new e.b6(0,t)];if(this._renderWorldCopies){let i=this.pointCoordinate(new e.P(0,0)),a=this.pointCoordinate(new e.P(this.width,0)),n=this.pointCoordinate(new e.P(this.width,this.height)),s=this.pointCoordinate(new e.P(0,this.height)),o=Math.floor(Math.min(i.x,a.x,n.x,s.x)),l=Math.floor(Math.max(i.x,a.x,n.x,s.x));for(let i=o-1;i<=l+1;i++)0!==i&&r.push(new e.b6(i,t))}return r}coveringTiles(t){var r,i;let a=this.coveringZoomLevel(t),n=a;if(void 0!==t.minzoom&&a<t.minzoom)return[];void 0!==t.maxzoom&&a>t.maxzoom&&(a=t.maxzoom);let s=this.pointCoordinate(this.getCameraPoint()),o=e.U.fromLngLat(this.center),l=Math.pow(2,a),u=[l*s.x,l*s.y,0],h=[l*o.x,l*o.y,0],c=rm.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a),d=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(d=a);let p=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,f=e=>({aabb:new rg([e*l,0,0],[(e+1)*l,l,0]),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),m=[],g=[],y=a,_=t.reparseOverscaled?n:a;if(this._renderWorldCopies)for(let e=1;e<=3;e++)m.push(f(-e)),m.push(f(e));for(m.push(f(0));m.length>0;){let a=m.pop(),n=a.x,s=a.y,o=a.fullyVisible;if(!o){let e=a.aabb.intersects(c);if(0===e)continue;o=2===e}let l=t.terrain?u:h,f=Math.max(Math.abs(a.aabb.distanceX(l)),Math.abs(a.aabb.distanceY(l)));if(a.zoom===y||f>p+(1<<y-a.zoom)-2&&a.zoom>=d){let t=y-a.zoom,r=u[0]-.5-(n<<t),i=u[1]-.5-(s<<t);g.push({tileID:new e.O(a.zoom===y?_:a.zoom,a.wrap,a.zoom,n,s),distanceSq:w([h[0]-.5-n,h[1]-.5-s]),tileDistanceToCamera:Math.sqrt(r*r+i*i)})}else for(let l=0;l<4;l++){let u=(n<<1)+l%2,h=(s<<1)+(l>>1),c=a.zoom+1,d=a.aabb.quadrant(l);if(t.terrain){let n=new e.O(c,a.wrap,c,u,h),s=t.terrain.getMinMaxElevation(n),o=null!==(r=s.minElevation)&&void 0!==r?r:this.elevation,l=null!==(i=s.maxElevation)&&void 0!==i?i:this.elevation;d=new rg([d.min[0],d.min[1],o],[d.max[0],d.max[1],l])}m.push({aabb:d,zoom:c,x:u,y:h,wrap:a.wrap,fullyVisible:o})}}return g.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){let r=e.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new e.P(e.G(t.lng)*this.worldSize,e.H(r)*this.worldSize)}unproject(t){return new e.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){let r=this.pointLocation(this.centerPoint,t),i=t.getElevationForLngLatZoom(r,this.tileZoom);if(!(this.elevation-i))return;let a=this.getCameraPosition(),n=e.U.fromLngLat(a.lngLat,a.altitude),s=e.U.fromLngLat(r,i),o=n.x-s.x,l=n.y-s.y,u=n.z-s.z,h=Math.sqrt(o*o+l*l+u*u),c=this.scaleZoom(this.cameraToCenterDistance/h/this.tileSize);this._elevation=i,this._center=r,this.zoom=c}setLocationAtPoint(t,r){let i=this.pointCoordinate(r),a=this.pointCoordinate(this.centerPoint),n=this.locationCoordinate(t),s=new e.U(n.x-(i.x-a.x),n.y-(i.y-a.y));this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,t){return t?this.coordinatePoint(this.locationCoordinate(e),t.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,t){return this.coordinateLocation(this.pointCoordinate(e,t))}locationCoordinate(t){return e.U.fromLngLat(t)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(t,r){if(r){let e=r.pointCoordinate(t);if(null!=e)return e}let i=[t.x,t.y,0,1],a=[t.x,t.y,1,1];e.ag(i,i,this.pixelMatrixInverse),e.ag(a,a,this.pixelMatrixInverse);let n=i[3],s=a[3],o=i[1]/n,l=a[1]/s,u=i[2]/n,h=a[2]/s,c=u===h?0:(0-u)/(h-u);return new e.U(e.B.number(i[0]/n,a[0]/s,c)/this.worldSize,e.B.number(o,l,c)/this.worldSize)}coordinatePoint(t,r=0,i=this.pixelMatrix){let a=[t.x*this.worldSize,t.y*this.worldSize,r,1];return e.ag(a,a,i),new e.P(a[0]/a[3],a[1]/a[3])}getBounds(){let t=Math.max(0,this.height/2-this.getHorizon());return(new L).extend(this.pointLocation(new e.P(0,t))).extend(this.pointLocation(new e.P(this.width,t))).extend(this.pointLocation(new e.P(this.width,this.height))).extend(this.pointLocation(new e.P(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new L([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,r=!1){let i=t.key,a=r?this._alignedPosMatrixCache:this._posMatrixCache;if(a[i])return a[i];let n=t.canonical,s=this.worldSize/this.zoomScale(n.z),o=n.x+Math.pow(2,n.z)*t.wrap,l=e.ao(new Float64Array(16));return e.$(l,l,[o*s,n.y*s,0]),e.a0(l,l,[s/e.N,s/e.N,1]),e.a1(l,r?this.alignedProjMatrix:this.projMatrix,l),a[i]=new Float32Array(l),a[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,r,i,a,n=-90,s=90,o=-180,l=180,u=this.size,h=this._unmodified;if(this.latRange){let r=this.latRange;n=e.H(r[1])*this.worldSize,t=(s=e.H(r[0])*this.worldSize)-n<u.y?u.y/(s-n):0}if(this.lngRange){let t=this.lngRange;o=e.b5(e.G(t[0])*this.worldSize,0,this.worldSize),(l=e.b5(e.G(t[1])*this.worldSize,0,this.worldSize))<o&&(l+=this.worldSize),r=l-o<u.x?u.x/(l-o):0}let c=this.point,d=Math.max(r||0,t||0);if(d)return this.center=this.unproject(new e.P(r?(l+o)/2:c.x,t?(s+n)/2:c.y)),this.zoom+=this.scaleZoom(d),this._unmodified=h,void(this._constraining=!1);if(this.latRange){let e=c.y,t=u.y/2;e-t<n&&(a=n+t),e+t>s&&(a=s-t)}if(this.lngRange){let t=(o+l)/2,r=e.b5(c.x,t-this.worldSize/2,t+this.worldSize/2),a=u.x/2;r-a<o&&(i=o+a),r+a>l&&(i=l-a)}void 0===i&&void 0===a||(this.center=this.unproject(new e.P(void 0!==i?i:c.x,void 0!==a?a:c.y)).wrap()),this._unmodified=h,this._constraining=!1}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,r=this.point.x,i=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=e.b7(1,this.center.lat)*this.worldSize;let a=e.ao(new Float64Array(16));e.a0(a,a,[this.width/2,-this.height/2,1]),e.$(a,a,[1,-1,0]),this.labelPlaneMatrix=a,a=e.ao(new Float64Array(16)),e.a0(a,a,[1,-1,1]),e.$(a,a,[-1,-1,0]),e.a0(a,a,[2/this.width,2/this.height,1]),this.glCoordMatrix=a;let n=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),s=Math.min(this.elevation,this._minEleveationForCurrentTile),o=n-s*this._pixelPerMeter/Math.cos(this._pitch),l=s<0?o:n,u=Math.PI/2+this._pitch,h=this._fov*(.5+t.y/this.height),c=Math.sin(h)*l/Math.sin(e.ad(Math.PI-u-h,.01,Math.PI-.01)),d=this.getHorizon(),p=2*Math.atan(d/this.cameraToCenterDistance)*(.5+t.y/(2*d)),f=Math.min(c,Math.sin(p)*l/Math.sin(e.ad(Math.PI-u-p,.01,Math.PI-.01))),m=1.01*(Math.cos(Math.PI/2-this._pitch)*f+l),g=this.height/50;a=new Float64Array(16),e.b8(a,this._fov,this.width/this.height,g,m),a[8]=-(2*t.x)/this.width,a[9]=2*t.y/this.height,e.a0(a,a,[1,-1,1]),e.$(a,a,[0,0,-this.cameraToCenterDistance]),e.b9(a,a,this._pitch),e.ae(a,a,this.angle),e.$(a,a,[-r,-i,0]),this.mercatorMatrix=e.a0([],a,[this.worldSize,this.worldSize,this.worldSize]),e.a0(a,a,[1,1,this._pixelPerMeter]),this.pixelMatrix=e.a1(new Float64Array(16),this.labelPlaneMatrix,a),e.$(a,a,[0,0,-this.elevation]),this.projMatrix=a,this.invProjMatrix=e.as([],a),this.pixelMatrix3D=e.a1(new Float64Array(16),this.labelPlaneMatrix,a);let y=this.width%2/2,_=this.height%2/2,x=Math.cos(this.angle),v=Math.sin(this.angle),b=r-Math.round(r)+x*y+v*_,w=i-Math.round(i)+x*_+v*y,S=new Float64Array(a);if(e.$(S,S,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=S,!(a=e.as(new Float64Array(16),this.pixelMatrix)))throw Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let t=this.pointCoordinate(new e.P(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.ag(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}getCameraQueryGeometry(t){let r=this.getCameraPoint();if(1===t.length)return[t[0],r];{let i=r.x,a=r.y,n=r.x,s=r.y;for(let e of t)i=Math.min(i,e.x),a=Math.min(a,e.y),n=Math.max(n,e.x),s=Math.max(s,e.y);return[new e.P(i,a),new e.P(n,a),new e.P(n,s),new e.P(i,s),new e.P(i,a)]}}}function rx(e,t){let r,i=!1,a=null,n=null,s=()=>{a=null,i&&(e.apply(n,r),a=setTimeout(s,t),i=!1)};return(...e)=>(i=!0,n=this,r=e,a||s(),a)}class rv{constructor(e){this._getCurrentHash=()=>{let e=window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")},this._onHashChange=()=>{let e=this._getCurrentHash();if(e.length>=3&&!e.some(e=>isNaN(e))){let t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let e=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,e)}catch(e){}},this._updateHash=rx(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){let t=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.pow(10,Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10)),a=Math.round(t.lng*i)/i,n=Math.round(t.lat*i)/i,s=this._map.getBearing(),o=this._map.getPitch(),l="";if(l+=e?`/${a}/${n}/${r}`:`${r}/${n}/${a}`,(s||o)&&(l+="/"+Math.round(10*s)/10),o&&(l+=`/${Math.round(o)}`),this._hashName){let e=this._hashName,t=!1,r=window.location.hash.slice(1).split("&").map(r=>{let i=r.split("=")[0];return i===e?(t=!0,`${i}=${l}`):r}).filter(e=>e);return t||r.push(`${e}=${l}`),`#${r.join("&")}`}return`#${l}`}}let rb={linearity:.3,easing:e.ba(0,0,.3,1)},rw=e.e({deceleration:2500,maxSpeed:1400},rb),rS=e.e({deceleration:20,maxSpeed:1400},rb),rk=e.e({deceleration:1e3,maxSpeed:360},rb),rT=e.e({deceleration:1e3,maxSpeed:90},rb);class rI{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.h.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,r=e.h.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let r={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:e}of this._inertiaBuffer)r.zoom+=e.zoomDelta||0,r.bearing+=e.bearingDelta||0,r.pitch+=e.pitchDelta||0,e.panDelta&&r.pan._add(e.panDelta),e.around&&(r.around=e.around),e.pinchAround&&(r.pinchAround=e.pinchAround);let i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(r.pan.mag()){let n=rP(r.pan.mag(),i,e.e({},rw,t||{}));a.offset=r.pan.mult(n.amount/r.pan.mag()),a.center=this._map.transform.center,rC(a,n)}if(r.zoom){let e=rP(r.zoom,i,rS);a.zoom=this._map.transform.zoom+e.amount,rC(a,e)}if(r.bearing){let t=rP(r.bearing,i,rk);a.bearing=this._map.transform.bearing+e.ad(t.amount,-179,179),rC(a,t)}if(r.pitch){let e=rP(r.pitch,i,rT);a.pitch=this._map.transform.pitch+e.amount,rC(a,e)}if(a.zoom||a.bearing){let e=void 0===r.pinchAround?r.around:r.pinchAround;a.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),e.e(a,{noMoveStart:!0})}}function rC(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function rP(t,r,i){let{maxSpeed:a,linearity:n,deceleration:s}=i,o=e.ad(t*n/(r/1e3),-a,a),l=Math.abs(o)/(s*n);return{easing:i.easing,duration:1e3*l,amount:l/2*o}}class rE extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,i,a={}){let n=o.mousePos(r.getCanvasContainer(),i);super(t,e.e({point:n,lngLat:r.unproject(n),originalEvent:i},a)),this._defaultPrevented=!1,this.target=r}}class rM extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,i){let a="touchend"===t?i.changedTouches:i.touches,n=o.touchPos(r.getCanvasContainer(),a),s=n.map(e=>r.unproject(e)),l=n.reduce((e,t,r,i)=>e.add(t.div(i.length)),new e.P(0,0));super(t,{points:n,point:l,lngLats:s,lngLat:r.unproject(l),originalEvent:i}),this._defaultPrevented=!1}}class rA extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){super(e,{originalEvent:r}),this._defaultPrevented=!1}}class rz{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new rA(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new rE(e.type,this._map,e))}mouseup(e){this._map.fire(new rE(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new rE(e.type,this._map,e))}dblclick(e){return this._firePreventable(new rE(e.type,this._map,e))}mouseover(e){this._map.fire(new rE(e.type,this._map,e))}mouseout(e){this._map.fire(new rE(e.type,this._map,e))}touchstart(e){return this._firePreventable(new rM(e.type,this._map,e))}touchmove(e){this._map.fire(new rM(e.type,this._map,e))}touchend(e){this._map.fire(new rM(e.type,this._map,e))}touchcancel(e){this._map.fire(new rM(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rR{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new rE(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rE("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new rE(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rD{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(e.P.convert(t),this._map.terrain)}}class rL{constructor(e,t){this._map=e,this._tr=new rD(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(o.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active||this._lastPos.equals(t)||!this._box&&t.dist(this._startPos)<this._clickTolerance)return;let r=this._startPos;this._lastPos=t,this._box||(this._box=o.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let i=Math.min(r.x,t.x),a=Math.max(r.x,t.x),n=Math.min(r.y,t.y),s=Math.max(r.y,t.y);o.setTransform(this._box,`translate(${i}px,${n}px)`),this._box.style.width=a-i+"px",this._box.style.height=s-n+"px"}mouseupWindow(t,r){if(!this._active||0!==t.button)return;let i=this._startPos;if(this.reset(),o.suppressClick(),i.x!==r.x||i.y!==r.y)return this._map.fire(new e.k("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(i,r,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(o.remove(this._box),this._box=null),o.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new e.k(t,{originalEvent:r}))}}function rF(e,t){if(e.length!==t.length)throw Error(`The number of touches and points are not equal - touches ${e.length}, points ${t.length}`);let r={};for(let i=0;i<e.length;i++)r[e[i].identifier]=t[i];return r}class rB{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){let r=new e.P(0,0);for(let e of t)r._add(e);return r.div(t.length)}(r),this.touches=rF(i,r)))}touchmove(e,t,r){if(this.aborted||!this.centroid)return;let i=rF(r,t);for(let e in this.touches){let t=i[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,r){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){let e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class rO{constructor(e){this.singleTap=new rB(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,r){this.singleTap.touchstart(e,t,r)}touchmove(e,t,r){this.singleTap.touchmove(e,t,r)}touchend(e,t,r){let i=this.singleTap.touchend(e,t,r);if(i){let t=e.timeStamp-this.lastTime<500,r=!this.lastTap||30>this.lastTap.dist(i);if(t&&r||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class rN{constructor(e){this._tr=new rD(e),this._zoomIn=new rO({numTouches:1,numTaps:2}),this._zoomOut=new rO({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,r){this._zoomIn.touchstart(e,t,r),this._zoomOut.touchstart(e,t,r)}touchmove(e,t,r){this._zoomIn.touchmove(e,t,r),this._zoomOut.touchmove(e,t,r)}touchend(e,t,r){let i=this._zoomIn.touchend(e,t,r),a=this._zoomOut.touchend(e,t,r),n=this._tr;return i?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:n.zoom+1,around:n.unproject(i)},{originalEvent:e})}):a?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:n.zoom-1,around:n.unproject(a)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rV{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let t=this._moveFunction(...e);if(t.bearingDelta||t.pitchDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(e,t){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=t.length?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,t){if(!this.isEnabled())return;let r=this._lastPoint;if(!r)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let i=t.length?t[0]:t;return!this._moved&&i.dist(r)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=i,this._move(r,i))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&o.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let r$={0:1,2:2};class rj{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let t=o.mouseButton(e);this._eventButton=t}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(e,t){let r=r$[t];return void 0===e.buttons||(e.buttons&r)!==r}(e,this._eventButton)}isValidEndEvent(e){return o.mouseButton(e)===this._eventButton}}class rU{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return 1===e.targetTouches.length}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}let rq=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=function(e){e.preventDefault()}},rZ=({enable:e,clickTolerance:t,bearingDegreesPerPixelMoved:r=.8})=>new rV({clickTolerance:t,move:(e,t)=>({bearingDelta:(t.x-e.x)*r}),moveStateManager:new rj({checkCorrectEvent:e=>0===o.mouseButton(e)&&e.ctrlKey||2===o.mouseButton(e)}),enable:e,assignEvents:rq}),rG=({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:r=-.5})=>new rV({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*r}),moveStateManager:new rj({checkCorrectEvent:e=>0===o.mouseButton(e)&&e.ctrlKey||2===o.mouseButton(e)}),enable:e,assignEvents:rq});class rH{constructor(e,t){this._minTouches=e.cooperativeGestures?2:1,this._clickTolerance=e.clickTolerance||1,this._map=t,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(e,t,r){return this._calculateTransform(e,t,r)}touchmove(e,t,r){if(this._map._cooperativeGestures&&(2===this._minTouches&&r.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(e,!1,r.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(r.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,t,r)}touchend(e,t,r){this._calculateTransform(e,t,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,i){i.length>0&&(this._active=!0);let a=rF(i,r),n=new e.P(0,0),s=new e.P(0,0),o=0;for(let e in a){let t=a[e],r=this._touches[e];r&&(n._add(t),s._add(t.sub(r)),o++,a[e]=t)}if(this._touches=a,o<this._minTouches||!s.mag())return;let l=s.div(o);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:n.div(o),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rW{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,t,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,r){if(!this._firstTwoTouches)return;e.preventDefault();let[i,a]=this._firstTwoTouches,n=rX(r,t,i),s=rX(r,t,a);if(!n||!s)return;let o=this._aroundCenter?null:n.add(s).div(2);return this._move([n,s],o,e)}touchend(e,t,r){if(!this._firstTwoTouches)return;let[i,a]=this._firstTwoTouches,n=rX(r,t,i),s=rX(r,t,a);n&&s||(this._active&&o.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function rX(e,t,r){for(let i=0;i<e.length;i++)if(e[i].identifier===r)return t[i]}function rK(e,t){return Math.log(e/t)/Math.LN2}class rJ extends rW{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){let r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(.1>Math.abs(rK(this._distance,this._startDistance))))return this._active=!0,{zoomDelta:rK(this._distance,r),pinchAround:t}}}function rY(e,t){return 180*e.angleWith(t)/Math.PI}class rQ extends rW{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){let r=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:rY(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let t=25/(Math.PI*this._minDiameter)*360;return Math.abs(rY(e,this._startVector))<t}}function r0(e){return Math.abs(e.y)>Math.abs(e.x)}class r1 extends rW{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,t,r){super.touchstart(e,t,r),this._currentTouchCount=r.length}_start(e){this._lastPoints=e,r0(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,r){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;let i=e[0].sub(this._lastPoints[0]),a=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(i,a,r.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:-((i.y+a.y)/2*.5)}):void 0}gestureBeginsVertically(e,t,r){if(void 0!==this._valid)return this._valid;let i=e.mag()>=2,a=t.mag()>=2;if(!i&&!a)return;if(!i||!a)return void 0===this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;let n=e.y>0==t.y>0;return r0(e)&&r0(t)&&n}}class r2{constructor(e){this._tr=new rD(e),this._panStep=100,this._bearingStep=15,this._pitchStep=10,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,r=0,i=0,a=0,n=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),a=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),a=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),n=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),n=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:s=>{let o=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:r3,zoom:t?Math.round(o.zoom)+t*(e.shiftKey?2:1):o.zoom,bearing:o.bearing+r*this._bearingStep,pitch:o.pitch+i*this._pitchStep,offset:[-a*this._panStep,-n*this._panStep],center:o.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function r3(e){return e*(2-e)}class r5{constructor(e,t){this._onTimeout=e=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},this._map=e,this._tr=new rD(e),this._el=e.getCanvasContainer(),this._triggerRenderFrame=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,i=e.h.now(),a=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==r&&r%4.000244140625==0?this._type="wheel":0!==r&&4>Math.abs(r)?this._type="trackpad":a>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=200>Math.abs(a*r)?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let r=o.mousePos(this._el,t),i=this._tr;this._around=e.L.convert(this._aroundCenter?i.center:i.unproject(r)),this._aroundPoint=i.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._tr.transform;if(0!==this._delta){let e="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);let i="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(i*r))),"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let r="number"==typeof this._targetZoom?this._targetZoom:t.zoom,i=this._startZoom,a=this._easing,n,s=!1;if("wheel"===this._type&&i&&a){let t=Math.min((e.h.now()-this._lastWheelEventTime)/200,1),o=a(t);n=e.B.number(i,r,o),t<1?this._frameId||(this._frameId=!0):s=!0}else n=r,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!s,zoomDelta:n-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=e.bb;if(this._prevEase){let t=this._prevEase,i=(e.h.now()-t.start)/t.duration,a=t.easing(i+.01)-t.easing(i),n=.27/Math.sqrt(a*a+1e-4)*.01;r=e.ba(n,Math.sqrt(.0729-n*n),.25,1)}return this._prevEase={start:e.h.now(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class r4{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class r6{constructor(e){this._tr=new rD(e),this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class r8{constructor(){this._tap=new rO({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,t,r){if(!this._swipePoint){if(this._tapTime){let i=t[0],a=e.timeStamp-this._tapTime<500,n=30>this._tapPoint.dist(i);a&&n?r.length>0&&(this._swipePoint=i,this._swipeTouch=r[0].identifier):this.reset()}else this._tap.touchstart(e,t,r)}}touchmove(e,t,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;let i=t[0],a=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:a/128}}}else this._tap.touchmove(e,t,r)}touchend(e,t,r){if(this._tapTime)this._swipePoint&&0===r.length&&this.reset();else{let i=this._tap.touchend(e,t,r);i&&(this._tapTime=e.timeStamp,this._tapPoint=i)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class r9{constructor(e,t,r){this._el=e,this._mousePan=t,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class r7{constructor(e,t,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ie{constructor(e,t,r,i){this._el=e,this._touchZoom=t,this._touchRotate=r,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let it=e=>e.zoom||e.drag||e.pitch||e.rotate;class ir extends e.k{}function ii(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class ia{constructor(e,t){this.handleWindowEvent=e=>{this.handleEvent(e,`${e.type}Window`)},this.handleEvent=(e,t)=>{if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;let r="renderFrame"===e.type?void 0:e,i={needsRenderFrame:!1},a={},n={},s=e.touches,l=s?this._getMapTouches(s):void 0,u=l?o.touchPos(this._el,l):o.mousePos(this._el,e);for(let{handlerName:s,handler:o,allowed:h}of this._handlers){let c;o.isEnabled()&&(this._blockedByActive(n,h,s)?o.reset():o[t||e.type]&&(c=o[t||e.type](e,u,l),this.mergeHandlerResult(i,a,c,s,r),c&&c.needsRenderFrame&&this._triggerRenderFrame()),(c||o.isActive())&&(n[s]=o))}let h={};for(let e in this._previousActiveHandlers)n[e]||(h[e]=r);this._previousActiveHandlers=n,(Object.keys(h).length||ii(i))&&(this._changes.push([i,a,h]),this._triggerRenderFrame()),(Object.keys(n).length||ii(i))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:c}=i;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rI(e),this._bearingSnap=t.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(t);let r=this._el;for(let[e,t,i]of(this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]],this._listeners))o.addEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,i)}destroy(){for(let[e,t,r]of this._listeners)o.removeEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){let t=this._map,r=t.getCanvasContainer();this._add("mapEvent",new rz(t,e));let i=t.boxZoom=new rL(t,e);this._add("boxZoom",i),e.interactive&&e.boxZoom&&i.enable();let a=new rN(t),n=new r6(t);t.doubleClickZoom=new r4(n,a),this._add("tapZoom",a),this._add("clickZoom",n),e.interactive&&e.doubleClickZoom&&t.doubleClickZoom.enable();let s=new r8;this._add("tapDragZoom",s);let l=t.touchPitch=new r1(t);this._add("touchPitch",l),e.interactive&&e.touchPitch&&t.touchPitch.enable(e.touchPitch);let u=rZ(e),h=rG(e);t.dragRotate=new r7(e,u,h),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",h,["mouseRotate"]),e.interactive&&e.dragRotate&&t.dragRotate.enable();let c=(({enable:e,clickTolerance:t})=>new rV({clickTolerance:t,move:(e,t)=>({around:t,panDelta:t.sub(e)}),activateOnStart:!0,moveStateManager:new rj({checkCorrectEvent:e=>0===o.mouseButton(e)&&!e.ctrlKey}),enable:e,assignEvents:rq}))(e),d=new rH(e,t);t.dragPan=new r9(r,c,d),this._add("mousePan",c),this._add("touchPan",d,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&t.dragPan.enable(e.dragPan);let p=new rQ,f=new rJ;t.touchZoomRotate=new ie(r,f,p,s),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&t.touchZoomRotate.enable(e.touchZoomRotate);let m=t.scrollZoom=new r5(t,()=>this._triggerRenderFrame());this._add("scrollZoom",m,["mousePan"]),e.interactive&&e.scrollZoom&&t.scrollZoom.enable(e.scrollZoom);let g=t.keyboard=new r2(t);this._add("keyboard",g),e.interactive&&e.keyboard&&t.keyboard.enable(),this._add("blockableMapEvent",new rR(t))}_add(e,t,r){this._handlers.push({handlerName:e,handler:t,allowed:r}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(let{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!it(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,t,r){for(let i in e)if(i!==r&&(!t||0>t.indexOf(i)))return!0;return!1}_getMapTouches(e){let t=[];for(let r of e)this._el.contains(r.target)&&t.push(r);return t}mergeHandlerResult(t,r,i,a,n){if(!i)return;e.e(t,i);let s={handlerName:a,originalEvent:i.originalEvent||n};void 0!==i.zoomDelta&&(r.zoom=s),void 0!==i.panDelta&&(r.drag=s),void 0!==i.pitchDelta&&(r.pitch=s),void 0!==i.bearingDelta&&(r.rotate=s)}_applyChanges(){let t={},r={},i={};for(let[a,n,s]of this._changes)a.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),e.e(r,n),e.e(i,s);this._updateMapTransform(t,r,i),this._changes=[]}_updateMapTransform(e,t,r){let i=this._map,a=i._getTransformForUpdate(),n=i.terrain;if(!(ii(e)||n&&this._terrainMovement))return this._fireEvents(t,r,!0);let{panDelta:s,zoomDelta:o,bearingDelta:l,pitchDelta:u,around:h,pinchAround:c}=e;void 0!==c&&(h=c),i._stop(!0),h=h||i.transform.centerPoint;let d=a.pointLocation(s?h.sub(s):h);l&&(a.bearing+=l),u&&(a.pitch+=u),o&&(a.zoom+=o),n?!this._terrainMovement&&(t.drag||t.zoom)?(this._terrainMovement=!0,this._map._elevationFreeze=!0,a.setLocationAtPoint(d,h),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,a.recalculateZoom(i.terrain)})):t.drag&&this._terrainMovement?a.center=a.pointLocation(a.centerPoint.sub(s)):a.setLocationAtPoint(d,h):a.setLocationAtPoint(d,h),i._applyUpdatedTransform(a),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,r,!0)}_fireEvents(t,r,i){let a;let n=it(this._eventsInProgress),s=it(t),o={};for(let e in t){let{originalEvent:r}=t[e];this._eventsInProgress[e]||(o[`${e}start`]=r),this._eventsInProgress[e]=t[e]}for(let e in!n&&s&&this._fireEvent("movestart",s.originalEvent),o)this._fireEvent(e,o[e]);for(let e in s&&this._fireEvent("move",s.originalEvent),t){let{originalEvent:r}=t[e];this._fireEvent(e,r)}let l={};for(let e in this._eventsInProgress){let{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],a=r[t]||i,l[`${e}end`]=a)}for(let e in l)this._fireEvent(e,l[e]);let u=it(this._eventsInProgress);if(i&&(n||s)&&!u){let t,r;this._updatingCamera=!0;let i=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions);i&&(i.essential||!e.h.prefersReducedMotion)?(0!==(t=i.bearing||this._map.getBearing())&&-this._bearingSnap<t&&t<this._bearingSnap&&(i.bearing=0),i.freezeElevation=!0,this._map.easeTo(i,{originalEvent:a})):(this._map.fire(new e.k("moveend",{originalEvent:a})),0!==(r=this._map.getBearing())&&-this._bearingSnap<r&&r<this._bearingSnap&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new e.k(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new ir("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class is extends e.E{constructor(t,r){super(),this._renderFrameCallback=()=>{let t=Math.min((e.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new e.L(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,r,i){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},r),i)}panTo(t,r,i){return this.easeTo(e.e({center:t},r),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,r,i){return this.easeTo(e.e({zoom:t},r),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,r,i){return this.easeTo(e.e({bearing:t},r),i)}resetNorth(t,r){return this.rotateTo(0,e.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(e.e({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=L.convert(e);let r=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),r,t)}_cameraForBoxAndBearing(t,r,i,a){let n={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=e.e({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){let e=a.padding;a.padding={top:e,bottom:e,right:e,left:e}}a.padding=e.e(n,a.padding);let s=this.transform,o=s.padding,l=s.project(e.L.convert(t)),u=s.project(e.L.convert(r)),h=l.rotate(-i*Math.PI/180),c=u.rotate(-i*Math.PI/180),d=new e.P(Math.max(h.x,c.x),Math.max(h.y,c.y)),p=new e.P(Math.min(h.x,c.x),Math.min(h.y,c.y)),f=d.sub(p),m=(s.width-(o.left+o.right+a.padding.left+a.padding.right))/f.x,g=(s.height-(o.top+o.bottom+a.padding.top+a.padding.bottom))/f.y;if(g<0||m<0)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let y=Math.min(s.scaleZoom(s.scale*Math.min(m,g)),a.maxZoom),_=e.P.convert(a.offset),x=new e.P((a.padding.left-a.padding.right)/2,(a.padding.top-a.padding.bottom)/2).rotate(i*Math.PI/180),v=_.add(x).mult(s.scale/s.zoomScale(y));return{center:s.unproject(l.add(u).div(2).sub(v)),zoom:y,bearing:i}}fitBounds(e,t,r){return this._fitInternal(this.cameraForBounds(e,t),t,r)}fitScreenCoordinates(t,r,i,a,n){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.P.convert(t)),this.transform.pointLocation(e.P.convert(r)),i,a),a,n)}_fitInternal(t,r,i){return t?(delete(r=e.e(t,r)).padding,r.linear?this.easeTo(r,i):this.flyTo(r,i)):this}jumpTo(t,r){this.stop();let i=this._getTransformForUpdate(),a=!1,n=!1,s=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(a=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=e.L.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(n=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(s=!0,i.pitch=+t.pitch),null==t.padding||i.isPaddingEqual(t.padding)||(i.padding=t.padding),this._applyUpdatedTransform(i),this.fire(new e.k("movestart",r)).fire(new e.k("move",r)),a&&this.fire(new e.k("zoomstart",r)).fire(new e.k("zoom",r)).fire(new e.k("zoomend",r)),n&&this.fire(new e.k("rotatestart",r)).fire(new e.k("rotate",r)).fire(new e.k("rotateend",r)),s&&this.fire(new e.k("pitchstart",r)).fire(new e.k("pitch",r)).fire(new e.k("pitchend",r)),this.fire(new e.k("moveend",r))}calculateCameraOptionsFromTo(t,r,i,a=0){let n=e.U.fromLngLat(t,r),s=e.U.fromLngLat(i,a),o=s.x-n.x,l=s.y-n.y,u=s.z-n.z,h=Math.hypot(o,l,u);if(0===h)throw Error("Can't calculate camera options with same From and To");let c=Math.hypot(o,l),d=this.transform.scaleZoom(this.transform.cameraToCenterDistance/h/this.transform.tileSize),p=180*Math.atan2(o,-l)/Math.PI,f=180*Math.acos(c/h)/Math.PI;return f=u<0?90-f:90+f,{center:s.toLngLat(),zoom:d,pitch:f,bearing:p}}easeTo(t,r){let i,a;this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.bb},t)).animate||!t.essential&&e.h.prefersReducedMotion)&&(t.duration=0);let n=this._getTransformForUpdate(),s=this.getZoom(),o=this.getBearing(),l=this.getPitch(),u=this.getPadding(),h="zoom"in t?+t.zoom:s,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,d="pitch"in t?+t.pitch:l,p="padding"in t?t.padding:n.padding,f=e.P.convert(t.offset),m=n.centerPoint.add(f),g=n.pointLocation(m),y=e.L.convert(t.center||g);this._normalizeCenter(y);let _=n.project(g),x=n.project(y).sub(_),v=n.zoomScale(h-s);t.around&&(i=e.L.convert(t.around),a=n.locationPoint(i));let b={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||h!==s,this._rotating=this._rotating||o!==c,this._pitching=this._pitching||d!==l,this._padding=!n.isPaddingEqual(p),this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,b),this.terrain&&this._prepareElevation(y),this._ease(g=>{if(this._zooming&&(n.zoom=e.B.number(s,h,g)),this._rotating&&(n.bearing=e.B.number(o,c,g)),this._pitching&&(n.pitch=e.B.number(l,d,g)),this._padding&&(n.interpolatePadding(u,p,g),m=n.centerPoint.add(f)),this.terrain&&!t.freezeElevation&&this._updateElevation(g),i)n.setLocationAtPoint(i,a);else{let e=n.zoomScale(n.zoom-s),t=Math.pow(h>s?Math.min(2,v):Math.max(.5,v),1-g),r=n.unproject(_.add(x.mult(g*t)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?r.wrap():r,m)}this._applyUpdatedTransform(n),this._fireMoveEvents(r)},e=>{this.terrain&&this._finalizeElevation(),this._afterEase(r,e)},t),this}_prepareEase(t,r,i={}){this._moving=!0,r||i.moving||this.fire(new e.k("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.k("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.k("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.k("pitchstart",t))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){let e=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(e-(r-(e*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.elevation=e.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(e){if(!this.transformCameraUpdate)return;let t=e.clone(),{center:r,zoom:i,pitch:a,bearing:n,elevation:s}=this.transformCameraUpdate(t);r&&(t.center=r),void 0!==i&&(t.zoom=i),void 0!==a&&(t.pitch=a),void 0!==n&&(t.bearing=n),void 0!==s&&(t.elevation=s),this.transform.apply(t)}_fireMoveEvents(t){this.fire(new e.k("move",t)),this._zooming&&this.fire(new e.k("zoom",t)),this._rotating&&this.fire(new e.k("rotate",t)),this._pitching&&this.fire(new e.k("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;let i=this._zooming,a=this._rotating,n=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new e.k("zoomend",t)),a&&this.fire(new e.k("rotateend",t)),n&&this.fire(new e.k("pitchend",t)),this.fire(new e.k("moveend",t))}flyTo(t,r){if(!t.essential&&e.h.prefersReducedMotion){let i=e.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,r)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.bb},t);let i=this._getTransformForUpdate(),a=this.getZoom(),n=this.getBearing(),s=this.getPitch(),o=this.getPadding(),l="zoom"in t?e.ad(+t.zoom,i.minZoom,i.maxZoom):a,u="bearing"in t?this._normalizeBearing(t.bearing,n):n,h="pitch"in t?+t.pitch:s,c="padding"in t?t.padding:i.padding,d=i.zoomScale(l-a),p=e.P.convert(t.offset),f=i.centerPoint.add(p),m=i.pointLocation(f),g=e.L.convert(t.center||m);this._normalizeCenter(g);let y=i.project(m),_=i.project(g).sub(y),x=t.curve,v=Math.max(i.width,i.height),b=v/d,w=_.mag();if("minZoom"in t){let r=e.ad(Math.min(t.minZoom,a,l),i.minZoom,i.maxZoom);x=Math.sqrt(v/i.zoomScale(r-a)/w*2)}let S=x*x;function k(e){let t=(b*b-v*v+(e?-1:1)*S*S*w*w)/(2*(e?b:v)*S*w);return Math.log(Math.sqrt(t*t+1)-t)}function T(e){return(Math.exp(e)-Math.exp(-e))/2}function I(e){return(Math.exp(e)+Math.exp(-e))/2}let C=k(!1),P=function(e){return I(C)/I(C+x*e)},E=function(e){var t;return(I(C)*(T(t=C+x*e)/I(t))-T(C))/S*v/w},M=(k(!0)-C)/x;if(1e-6>Math.abs(w)||!isFinite(M)){if(1e-6>Math.abs(v-b))return this.easeTo(t,r);let e=b<v?-1:1;M=Math.abs(Math.log(b/v))/x,E=function(){return 0},P=function(t){return Math.exp(e*x*t)}}return t.duration="duration"in t?+t.duration:1e3*M/("screenSpeed"in t?+t.screenSpeed/x:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=n!==u,this._pitching=h!==s,this._padding=!i.isPaddingEqual(c),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(g),this._ease(d=>{let m=d*M,x=1/P(m);i.zoom=1===d?l:a+i.scaleZoom(x),this._rotating&&(i.bearing=e.B.number(n,u,d)),this._pitching&&(i.pitch=e.B.number(s,h,d)),this._padding&&(i.interpolatePadding(o,c,d),f=i.centerPoint.add(p)),this.terrain&&!t.freezeElevation&&this._updateElevation(d);let v=1===d?g:i.unproject(y.add(_.mult(E(m))).mult(x));i.setLocationAtPoint(i.renderWorldCopies?v.wrap():v,f),this._applyUpdatedTransform(i),this._fireMoveEvents(r)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}if(!e){let e=this.handlers;e&&e.stop(!1)}return this}_ease(t,r,i){!1===i.animate||0===i.duration?(t(1),r()):(this._easeStart=e.h.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){let i=Math.abs((t=e.b5(t,-180,180))-r);return Math.abs(t-360-r)<i&&(t-=360),Math.abs(t+360-r)<i&&(t+=360),t}_normalizeCenter(e){let t=this.transform;if(!t.renderWorldCopies||t.lngRange)return;let r=e.lng-t.center.lng;e.lng+=r>180?-360:r<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(e.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class io{constructor(e={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=e=>{e&&("metadata"===e.sourceDataType||"visibility"===e.sourceDataType||"style"===e.dataType||"terrain"===e.type)&&this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=o.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=o.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){o.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,t){let r=this._map._getUIString(`AttributionControl.${t}`);e.title=r,e.setAttribute("aria-label",r)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(e=>"string"!=typeof e?"":e)):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}let t=this._map.style.sourceCaches;for(let r in t){let i=t[r];if(i.used||i.usedForTerrain){let t=i.getSource();t.attribution&&0>e.indexOf(t.attribution)&&e.push(t.attribution)}}(e=e.filter(e=>String(e).trim())).sort((e,t)=>e.length-t.length);let r=(e=e.filter((t,r)=>{for(let i=r+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0})).join(" | ");r!==this._attribHTML&&(this._attribHTML=r,e.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class il{constructor(e={}){this._updateCompact=()=>{let e=this._container.children;if(e.length){let t=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&t.classList.add("maplibregl-compact"):t.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=o.create("div","maplibregl-ctrl");let t=o.create("a","maplibregl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://maplibre.org/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){o.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class iu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){let t=this._currentlyRunning;for(let r of t?this._queue.concat(t):this._queue)if(r.id===e)return void(r.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw Error("Attempting to run(), but is already running.");let t=this._currentlyRunning=this._queue;for(let r of(this._queue=[],t))if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}let ih={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var ic=e.Q([{name:"a_pos3d",type:"Int16",components:3}]);class id extends e.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,r){this.sourceCache.update(t,r),this._renderableTilesKeys=[];let i={};for(let a of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r}))i[a.key]=!0,this._renderableTilesKeys.push(a.key),this._tiles[a.key]||(a.posMatrix=new Float64Array(16),e.aS(a.posMatrix,0,e.N,0,e.N,0,1),this._tiles[a.key]=new W(a,this.tileSize));for(let e in this._tiles)i[e]||delete this._tiles[e]}freeRtt(e){for(let t in this._tiles){let r=this._tiles[t];(!e||r.tileID.equals(e)||r.tileID.isChildOf(e)||e.isChildOf(r.tileID))&&(r.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(t){let r={};for(let i of this._renderableTilesKeys){let a=this._tiles[i].tileID;if(a.canonical.equals(t.canonical)){let a=t.clone();a.posMatrix=new Float64Array(16),e.aS(a.posMatrix,0,e.N,0,e.N,0,1),r[i]=a}else if(a.canonical.isChildOf(t.canonical)){let n=t.clone();n.posMatrix=new Float64Array(16);let s=a.canonical.z-t.canonical.z,o=a.canonical.x-(a.canonical.x>>s<<s),l=a.canonical.y-(a.canonical.y>>s<<s),u=e.N>>s;e.aS(n.posMatrix,0,u,0,u,0,1),e.$(n.posMatrix,n.posMatrix,[-o*u,-l*u,0]),r[i]=n}else if(t.canonical.isChildOf(a.canonical)){let n=t.clone();n.posMatrix=new Float64Array(16);let s=t.canonical.z-a.canonical.z,o=t.canonical.x-(t.canonical.x>>s<<s),l=t.canonical.y-(t.canonical.y>>s<<s),u=e.N>>s;e.aS(n.posMatrix,0,e.N,0,e.N,0,1),e.$(n.posMatrix,n.posMatrix,[o*u,l*u,0]),e.a0(n.posMatrix,n.posMatrix,[1/2**s,1/2**s,0]),r[i]=n}}return r}getSourceTile(e,t){let r=this.sourceCache._source,i=e.overscaledZ-this.deltaZoom;if(i>r.maxzoom&&(i=r.maxzoom),i<r.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(i).key);let a=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!a||!a.dem)&&t)for(;i>=r.minzoom&&(!a||!a.dem);)a=this.sourceCache.getTileByID(e.scaledTo(i--).key);return a}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(t=>t.timeAdded>=e)}}class ip{constructor(e,t,r){this.painter=e,this.sourceCache=new id(t),this.options=r,this.exaggeration="number"==typeof r.exaggeration?r.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,i,a=e.N){var n,s,o,l,u,h;if(!(r>=0&&r<a&&i>=0&&i<a))return 0;let c=this.getTerrainData(t),d=null===(n=c.tile)||void 0===n?void 0:n.dem;if(!d)return 0;let p=(s=[],o=[r/a*e.N,i/a*e.N],l=c.u_terrain_matrix,u=o[0],h=o[1],s[0]=l[0]*u+l[4]*h+l[12],s[1]=l[1]*u+l[5]*h+l[13],s),f=[p[0]*d.dim,p[1]*d.dim],m=Math.floor(f[0]),g=Math.floor(f[1]),y=f[0]-m,_=f[1]-g;return d.get(m,g)*(1-y)*(1-_)+d.get(m+1,g)*y*(1-_)+d.get(m,g+1)*(1-y)*_+d.get(m+1,g+1)*y*_}getElevationForLngLatZoom(t,r){let{tileID:i,mercatorX:a,mercatorY:n}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(i,a%e.N,n%e.N,e.N)}getElevation(t,r,i,a=e.N){return this.getDEMElevation(t,r,i,a)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){let t=this.painter.context,r=new e.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new T(t,r,t.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new T(t,new e.R({width:1,height:1}),t.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=e.ao([])}let r=this.sourceCache.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){let e=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new T(e,r.dem.getPixels(),e.gl.RGBA,{premultiply:!1}),r.demTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}let i=r&&r+r.tileID.key+t.key;if(i&&!this._demMatrixCache[i]){let i=this.sourceCache.sourceCache._source.maxzoom,a=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=i?a=t.canonical.z-i:e.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let n=t.canonical.x-(t.canonical.x>>a<<a),s=t.canonical.y-(t.canonical.y>>a<<a),o=e.bc(new Float64Array(16),[1/(e.N<<a),1/(e.N<<a),0]);e.$(o,o,[n*e.N,s*e.N,0]),this._demMatrixCache[t.key]={matrix:o,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:i?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){let t=this.painter,r=t.width/devicePixelRatio,i=t.height/devicePixelRatio;return this._fbo&&(this._fbo.width!==r||this._fbo.height!==i)&&(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new T(t.context,{width:r,height:i,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new T(t.context,{width:r,height:i,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=t.context.createFramebuffer(r,i,!0,!1),this._fbo.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,r,i))),this._fbo.colorAttachment.set("coords"===e?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let e=0,t=0;e<this._coordsTextureSize;e++)for(let i=0;i<this._coordsTextureSize;i++,t+=4)r[t+0]=255&i,r[t+1]=255&e,r[t+2]=i>>8<<4|e>>8,r[t+3]=0;let i=new T(t,new e.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),t.gl.RGBA,{premultiply:!1});return i.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=i,i}pointCoordinate(t){let r=new Uint8Array(4),i=this.painter.context,a=i.gl;i.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),a.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,a.RGBA,a.UNSIGNED_BYTE,r),i.bindFramebuffer.set(null);let n=r[0]+(r[2]>>4<<8),s=r[1]+((15&r[2])<<8),o=this.coordsIndex[255-r[3]],l=o&&this.sourceCache.getTileByID(o);if(!l)return null;let u=this._coordsTextureSize,h=(1<<l.tileID.canonical.z)*u;return new e.U(this._allowMercatorOverflow(t,(l.tileID.canonical.x*u+n)/h),(l.tileID.canonical.y*u+s)/h,this.getElevation(l.tileID,n,s,u))}getTerrainMesh(){if(this._mesh)return this._mesh;let t=this.painter.context,r=new e.bd,i=new e.b0,a=this.meshSize,n=e.N/a,s=a*a;for(let e=0;e<=a;e++)for(let t=0;t<=a;t++)r.emplaceBack(t*n,e*n,0);for(let e=0;e<s;e+=a+1)for(let t=0;t<a;t++)i.emplaceBack(t+e,a+t+e+1,a+t+e+2),i.emplaceBack(t+e,a+t+e+2,t+e+1);let o=r.length,l=o+2*(a+1);for(let t of[0,1])for(let i=0;i<=a;i++)for(let a of[0,1])r.emplaceBack(i*n,t*e.N,a);for(let e=0;e<2*a;e+=2)i.emplaceBack(l+e,l+e+1,l+e+3),i.emplaceBack(l+e,l+e+3,l+e+2),i.emplaceBack(o+e,o+e+3,o+e+1),i.emplaceBack(o+e,o+e+2,o+e+3);let u=r.length,h=u+2*(a+1);for(let t of[0,1])for(let i=0;i<=a;i++)for(let a of[0,1])r.emplaceBack(t*e.N,i*n,a);for(let e=0;e<2*a;e+=2)i.emplaceBack(u+e,u+e+1,u+e+3),i.emplaceBack(u+e,u+e+3,u+e+2),i.emplaceBack(h+e,h+e+3,h+e+1),i.emplaceBack(h+e,h+e+2,h+e+3);return this._mesh={indexBuffer:t.createIndexBuffer(i),vertexBuffer:t.createVertexBuffer(r,ic.members),segments:e.S.simpleSegment(0,0,r.length,i.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*e.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(e,t){var r;let{tileID:i}=this._getOverscaledTileIDFromLngLatZoom(e,t);return null!==(r=this.getMinMaxElevation(i).minElevation)&&void 0!==r?r:0}getMinMaxElevation(e){let t=this.getTerrainData(e).tile,r={minElevation:null,maxElevation:null};return t&&t.dem&&(r.minElevation=t.dem.min*this.exaggeration,r.maxElevation=t.dem.max*this.exaggeration),r}_getOverscaledTileIDFromLngLatZoom(t,r){let i=e.U.fromLngLat(t.wrap()),a=(1<<r)*e.N,n=i.x*a,s=i.y*a,o=Math.floor(n/e.N),l=Math.floor(s/e.N);return{tileID:new e.O(r,0,r,o,l),mercatorX:n,mercatorY:s}}_allowMercatorOverflow(t,r){let i=t.x<this.painter.width/2,a=e.bf(r),n=this.painter.transform.center.lng;return i&&Math.sign(a)>0&&0>Math.sign(n)||!i&&0>Math.sign(a)&&Math.sign(n)>0?(a=360*Math.sign(n)+a,e.G(a)):r}}class im{constructor(e,t,r){this._context=e,this._size=t,this._tileSize=r,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let t=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),r=new T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return r.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),t.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),t.colorAttachment.set(r.texture),{id:e,fbo:t,texture:r,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(t=>e.id!==t),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let e of this._recentlyUsed)if(!this._objects[e].inUse)return this._objects[e];if(this._objects.length>=this._size)throw Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(e=>!e.inUse)}}let ig={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class iy{constructor(e,t){this.painter=e,this.terrain=t,this.pool=new im(e.context,30,t.sourceCache.tileSize*t.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,t){for(let r in this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(r=>!e._layers[r].isHidden(t)),this._coordsDescendingInv={},e.sourceCaches)for(let t of(this._coordsDescendingInv[r]={},e.sourceCaches[r].getVisibleCoordinates())){let e=this.terrain.sourceCache.getTerrainCoords(t);for(let t in e)this._coordsDescendingInv[r][t]||(this._coordsDescendingInv[r][t]=[]),this._coordsDescendingInv[r][t].push(e[t])}for(let t of(this._coordsDescendingInvStr={},e._order)){let r=e._layers[t],i=r.source;if(ig[r.type]&&!this._coordsDescendingInvStr[i])for(let e in this._coordsDescendingInvStr[i]={},this._coordsDescendingInv[i])this._coordsDescendingInvStr[i][e]=this._coordsDescendingInv[i][e].map(e=>e.key).sort().join()}for(let e of this._renderableTiles)for(let t in this._coordsDescendingInvStr){let r=this._coordsDescendingInvStr[t][e.tileID.key];r&&r!==e.rttCoords[t]&&(e.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;let r=t.type,i=this.painter,a=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ig[r]&&(this._prevType&&ig[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(t.id),!a))return!0;if(ig[this._prevType]||ig[r]&&a){this._prevType=r;let t=this._stacks.length-1,a=this._stacks[t]||[];for(let r of this._renderableTiles){if(this.pool.isFull()&&(rp(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(r),r.rtt[t]){let e=this.pool.getObjectForId(r.rtt[t].id);if(e.stamp===r.rtt[t].stamp){this.pool.useObject(e);continue}}let n=this.pool.getOrCreateFreeObject();this.pool.useObject(n),this.pool.stampObject(n),r.rtt[t]={id:n.id,stamp:n.stamp},i.context.bindFramebuffer.set(n.fbo.framebuffer),i.context.clear({color:e.aT.transparent,stencil:0}),i.currentStencilSource=void 0;for(let e=0;e<a.length;e++){let t=i.style._layers[a[e]],s=t.source?this._coordsDescendingInv[t.source][r.tileID.key]:[r.tileID];i.context.viewport.set([0,0,n.fbo.width,n.fbo.height]),i._renderTileClippingMasks(t,s),i.renderLayer(i,i.style.sourceCaches[t.source],t,s),t.source&&(r.rttCoords[t.source]=this._coordsDescendingInvStr[t.source][r.tileID.key])}}return rp(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ig[r]}return!1}}let i_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:e.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ix=e=>{e.touchstart=e.dragStart,e.touchmoveWindow=e.dragMove,e.touchend=e.dragEnd},iv={showCompass:!0,showZoom:!0,visualizePitch:!1};class ib{constructor(t,r,i=!1){this.mousedown=t=>{this.startMouse(e.e({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),o.mousePos(this.element,t)),o.addEventListener(window,"mousemove",this.mousemove),o.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=e=>{this.moveMouse(e,o.mousePos(this.element,e))},this.mouseup=e=>{this.mouseRotate.dragEnd(e),this.mousePitch&&this.mousePitch.dragEnd(e),this.offTemp()},this.touchstart=e=>{1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=o.touchPos(this.element,e.targetTouches)[0],this.startTouch(e,this._startPos),o.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),o.addEventListener(window,"touchend",this.touchend))},this.touchmove=e=>{1!==e.targetTouches.length?this.reset():(this._lastPos=o.touchPos(this.element,e.targetTouches)[0],this.moveTouch(e,this._lastPos))},this.touchend=e=>{0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let a=t.dragRotate._mouseRotate.getClickTolerance(),n=t.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=rZ({clickTolerance:a,enable:!0}),this.touchRotate=(({enable:e,clickTolerance:t,bearingDegreesPerPixelMoved:r=.8})=>new rV({clickTolerance:t,move:(e,t)=>({bearingDelta:(t.x-e.x)*r}),moveStateManager:new rU,enable:e,assignEvents:ix}))({clickTolerance:a,enable:!0}),this.map=t,i&&(this.mousePitch=rG({clickTolerance:n,enable:!0}),this.touchPitch=(({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:r=-.5})=>new rV({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*r}),moveStateManager:new rU,enable:e,assignEvents:ix}))({clickTolerance:n,enable:!0})),o.addEventListener(r,"mousedown",this.mousedown),o.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),o.addEventListener(r,"touchcancel",this.reset)}startMouse(e,t){this.mouseRotate.dragStart(e,t),this.mousePitch&&this.mousePitch.dragStart(e,t),o.disableDrag()}startTouch(e,t){this.touchRotate.dragStart(e,t),this.touchPitch&&this.touchPitch.dragStart(e,t),o.disableDrag()}moveMouse(e,t){let r=this.map,{bearingDelta:i}=this.mouseRotate.dragMove(e,t)||{};if(i&&r.setBearing(r.getBearing()+i),this.mousePitch){let{pitchDelta:i}=this.mousePitch.dragMove(e,t)||{};i&&r.setPitch(r.getPitch()+i)}}moveTouch(e,t){let r=this.map,{bearingDelta:i}=this.touchRotate.dragMove(e,t)||{};if(i&&r.setBearing(r.getBearing()+i),this.touchPitch){let{pitchDelta:i}=this.touchPitch.dragMove(e,t)||{};i&&r.setPitch(r.getPitch()+i)}}off(){let e=this.element;o.removeEventListener(e,"mousedown",this.mousedown),o.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),o.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),o.removeEventListener(window,"touchend",this.touchend),o.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){o.enableDrag(),o.removeEventListener(window,"mousemove",this.mousemove),o.removeEventListener(window,"mouseup",this.mouseup),o.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),o.removeEventListener(window,"touchend",this.touchend)}}function iw(t,r,i){if(t=new e.L(t.lng,t.lat),r){let a=new e.L(t.lng-360,t.lat),n=new e.L(t.lng+360,t.lat),s=i.locationPoint(t).distSqr(r);i.locationPoint(a).distSqr(r)<s?t=a:i.locationPoint(n).distSqr(r)<s&&(t=n)}for(;Math.abs(t.lng-i.center.lng)>180;){let e=i.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}let iS={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ik(e,t,r){let i=e.classList;for(let e in iS)i.remove(`maplibregl-${r}-anchor-${e}`);i.add(`maplibregl-${r}-anchor-${t}`)}class iT extends e.E{constructor(t){if(super(),this._onKeyPress=e=>{let t=e.code,r=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==r&&13!==r||this.togglePopup()},this._onMapClick=e=>{let t=e.originalEvent.target,r=this._element;this._popup&&(t===r||r.contains(t))&&this.togglePopup()},this._update=e=>{if(!this._map)return;let t=this._map.loaded()&&!this._map.isMoving();"terrain"!==(null==e?void 0:e.type)&&("render"!==(null==e?void 0:e.type)||t)||this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=iw(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let r="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?r=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let i="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?i="rotateX(0deg)":"map"===this._pitchAlignment&&(i=`rotateX(${this._map.getPitch()}deg)`),e&&"moveend"!==e.type||(this._pos=this._pos.round()),o.setTransform(this._element,`${iS[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${i} ${r}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{let e=this._map.unproject(this._pos),t=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=e.distanceTo(this._lngLat)>20*t?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=t=>{if(!this._isDragging){let e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.k("dragstart"))),this.fire(new e.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.k("dragend")),this._state="inactive"},this._addDragHandler=e=>{this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=o.create("div"),this._element.setAttribute("aria-label","Map marker");let r=o.createNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height","41px"),r.setAttributeNS(null,"width","27px"),r.setAttributeNS(null,"viewBox","0 0 27 41");let i=o.createNS("http://www.w3.org/2000/svg","g");i.setAttributeNS(null,"stroke","none"),i.setAttributeNS(null,"stroke-width","1"),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"fill-rule","evenodd");let a=o.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");let n=o.createNS("http://www.w3.org/2000/svg","g");for(let e of(n.setAttributeNS(null,"transform","translate(3.0, 29.0)"),n.setAttributeNS(null,"fill","#000000"),[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}])){let t=o.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),n.appendChild(t)}let s=o.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill",this._color);let l=o.createNS("http://www.w3.org/2000/svg","path");l.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),s.appendChild(l);let u=o.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"opacity","0.25"),u.setAttributeNS(null,"fill","#000000");let h=o.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),u.appendChild(h);let c=o.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"transform","translate(6.0, 7.0)"),c.setAttributeNS(null,"fill","#FFFFFF");let d=o.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"transform","translate(8.0, 8.0)");let p=o.createNS("http://www.w3.org/2000/svg","circle");p.setAttributeNS(null,"fill","#000000"),p.setAttributeNS(null,"opacity","0.25"),p.setAttributeNS(null,"cx","5.5"),p.setAttributeNS(null,"cy","5.5"),p.setAttributeNS(null,"r","5.4999962");let f=o.createNS("http://www.w3.org/2000/svg","circle");f.setAttributeNS(null,"fill","#FFFFFF"),f.setAttributeNS(null,"cx","5.5"),f.setAttributeNS(null,"cy","5.5"),f.setAttributeNS(null,"r","5.4999962"),d.appendChild(p),d.appendChild(f),a.appendChild(n),a.appendChild(s),a.appendChild(u),a.appendChild(c),a.appendChild(d),r.appendChild(a),r.setAttributeNS(null,"height",41*this._scale+"px"),r.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(r),this._offset=e.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()}),ik(this._element,this._anchor,"marker"),t&&t.className)for(let e of t.className.split(" "))this._element.classList.add(e);this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),o.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let t=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[t,-1*(24.6+t)],"bottom-right":[-t,-1*(24.6+t)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return e&&(e.isOpen()?e.remove():e.addTo(this._map)),this}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}let iI={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},iC=0,iP=!1,iE={maxWidth:100,unit:"metric"};function iM(e,t,r){let i=r&&r.maxWidth||100,a=e._container.clientHeight/2,n=e.unproject([0,a]),s=e.unproject([i,a]),o=n.distanceTo(s);if(r&&"imperial"===r.unit){let r=3.2808*o;r>5280?iA(t,i,r/5280,e._getUIString("ScaleControl.Miles")):iA(t,i,r,e._getUIString("ScaleControl.Feet"))}else r&&"nautical"===r.unit?iA(t,i,o/1852,e._getUIString("ScaleControl.NauticalMiles")):o>=1e3?iA(t,i,o/1e3,e._getUIString("ScaleControl.Kilometers")):iA(t,i,o,e._getUIString("ScaleControl.Meters"))}function iA(e,t,r,i){let a=function(e){let t=Math.pow(10,`${Math.floor(e)}`.length-1),r=e/t;return t*(r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:r>=1?1:function(e){let t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(r))}(r);e.style.width=a/r*t+"px",e.innerHTML=`${a}&nbsp;${i}`}let iz={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"};class iR{static get version(){return s}static get workerCount(){return et.workerCount}static set workerCount(e){et.workerCount=e}static get maxParallelImageRequests(){return e.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){e.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return e.c.WORKER_URL}static set workerUrl(t){e.c.WORKER_URL=t}static addProtocol(t,r){e.c.REGISTERED_PROTOCOLS[t]=r}static removeProtocol(t){delete e.c.REGISTERED_PROTOCOLS[t]}}return iR.Map=class extends is{constructor(t){if(e.bg.mark(e.bh.create),null!=(t=e.e({},i_,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw Error("maxPitch must be less than or equal to 85");if(super(new r_(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._cooperativeGesturesOnWheel=e=>{this._onCooperativeGesture(e,e[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new e.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._cooperativeGestures=t.cooperativeGestures,this._metaKey=0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new iu,this._controls=[],this._mapId=e.a2(),this._locale=e.e({},ih,t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this._imageQueueHandle=_.addThrottleControl(()=>this.isMoving()),this._requestManager=new f(t.transformRequest),"string"==typeof t.container){if(this._container=document.getElementById(t.container),!this._container)throw Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let e=!1,t=rx(e=>{this._trackResize&&!this._removed&&this.resize(e)._update()},50);this._resizeObserver=new ResizeObserver(r=>{e?t(r):e=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ia(this,t),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=t.hash&&new rv("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new io({customAttribution:t.customAttribution})),t.maplibreLogo&&this.addControl(new il,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new e.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new e.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new e.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(t,r){if(void 0===r&&(r=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.j(Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let i=t.onAdd(this);this._controls.push(t);let a=this._controlPositions[r];return -1!==r.indexOf("bottom")?a.insertBefore(i,a.firstChild):a.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.j(Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let r=this._controls.indexOf(t);return r>-1&&this._controls.splice(r,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}calculateCameraOptionsFromTo(e,t,r,i){return null==i&&this.terrain&&(i=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(e,t,r,i)}resize(t){var r;let i=this._containerDimensions(),a=i[0],n=i[1],s=this._getClampedPixelRatio(a,n);if(this._resizeCanvas(a,n,s),this.painter.resize(a,n,s),this.painter.overLimit()){let e=this.painter.context.gl;this._maxCanvasSize=[e.drawingBufferWidth,e.drawingBufferHeight];let t=this._getClampedPixelRatio(a,n);this._resizeCanvas(a,n,t),this.painter.resize(a,n,t)}this.transform.resize(a,n),null===(r=this._requestedCameraState)||void 0===r||r.resize(a,n);let o=!this._moving;return o&&(this.stop(),this.fire(new e.k("movestart",t)).fire(new e.k("move",t))),this.fire(new e.k("resize",t)),o&&this.fire(new e.k("moveend",t)),this}_getClampedPixelRatio(e,t){let{0:r,1:i}=this._maxCanvasSize,a=this.getPixelRatio(),n=e*a,s=t*a;return Math.min(n>r?r/n:1,s>i?i/s:1)*a}getPixelRatio(){var e;return null!==(e=this._overridePixelRatio)&&void 0!==e?e:devicePixelRatio}setPixelRatio(e){this._overridePixelRatio=e,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(L.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?60:e)>85)throw Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(t){return this.transform.locationPoint(e.L.convert(t),this.style&&this.terrain)}unproject(t){return this.transform.pointLocation(e.P.convert(t),this.terrain)}isMoving(){var e;return this._moving||(null===(e=this.handlers)||void 0===e?void 0:e.isMoving())}isZooming(){var e;return this._zooming||(null===(e=this.handlers)||void 0===e?void 0:e.isZooming())}isRotating(){var e;return this._rotating||(null===(e=this.handlers)||void 0===e?void 0:e.isRotating())}_createDelegatedListener(e,t,r){if("mouseenter"===e||"mouseover"===e){let i=!1;return{layer:t,listener:r,delegates:{mousemove:a=>{let n=this.getLayer(t)?this.queryRenderedFeatures(a.point,{layers:[t]}):[];n.length?i||(i=!0,r.call(this,new rE(e,this,a.originalEvent,{features:n}))):i=!1},mouseout:()=>{i=!1}}}}if("mouseleave"===e||"mouseout"===e){let i=!1;return{layer:t,listener:r,delegates:{mousemove:a=>{(this.getLayer(t)?this.queryRenderedFeatures(a.point,{layers:[t]}):[]).length?i=!0:i&&(i=!1,r.call(this,new rE(e,this,a.originalEvent)))},mouseout:t=>{i&&(i=!1,r.call(this,new rE(e,this,t.originalEvent)))}}}}return{layer:t,listener:r,delegates:{[e]:e=>{let i=this.getLayer(t)?this.queryRenderedFeatures(e.point,{layers:[t]}):[];i.length&&(e.features=i,r.call(this,e),delete e.features)}}}}on(e,t,r){if(void 0===r)return super.on(e,t);let i=this._createDelegatedListener(e,t,r);for(let t in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i),i.delegates)this.on(t,i.delegates[t]);return this}once(e,t,r){if(void 0===r)return super.once(e,t);let i=this._createDelegatedListener(e,t,r);for(let e in i.delegates)this.once(e,i.delegates[e]);return this}off(e,t,r){return void 0===r?super.off(e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&(i=>{let a=this._delegatedListeners[e];for(let e=0;e<a.length;e++){let i=a[e];if(i.layer===t&&i.listener===r){for(let e in i.delegates)this.off(e,i.delegates[e]);return a.splice(e,1),this}}})(),this)}queryRenderedFeatures(t,r){let i;if(!this.style)return[];let a=t instanceof e.P||Array.isArray(t),n=a?t:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(a?{}:t)||{},n instanceof e.P||"number"==typeof n[0])i=[e.P.convert(n)];else{let t=e.P.convert(n[0]),r=e.P.convert(n[1]);i=[t,new e.P(r.x,t.y),r,new e.P(t.x,r.y),t]}return this.style.queryRenderedFeatures(i,r,this.transform)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(t,r){return!1!==(r=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(t,r))}setTransformRequest(e){return this._requestManager.setTransformRequest(e),this}_getUIString(e){let t=this._locale[e];if(null==t)throw Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(e,t));let r=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!e)),e?(this.style=new eG(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,t,r):this.style.loadJSON(e,t,r)):delete this.style,this}_lazyInitEmptyStyle(){this.style||(this.style=new eG(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,r){if("string"==typeof t){let i=this._requestManager.transformRequest(t,x.Style);e.f(i,(t,i)=>{t?this.fire(new e.j(t)):i&&this._updateDiff(i,r)})}else"object"==typeof t&&this._updateDiff(t,r)}_updateDiff(t,r){try{this.style.setState(t,r)&&this._update(!0)}catch(i){e.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(t,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.w("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(t){let r=this.style&&this.style.sourceCaches[t];if(void 0!==r)return r.loaded();this.fire(new e.j(Error(`There is no source with ID '${t}'`)))}setTerrain(t){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),t){let r=this.style.sourceCaches[t.source];if(!r)throw Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);for(let r in this.style._layers){let i=this.style._layers[r];"hillshade"===i.type&&i.source===t.source&&e.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ip(this.painter,r,t),this.painter.renderToTexture=new iy(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=e=>{"style"===e.dataType?this.terrain.sourceCache.freeRtt():"source"===e.dataType&&e.tile&&(e.sourceId!==t.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(e.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new e.k("terrain",{terrain:t})),this}getTerrain(){var e,t;return null!==(t=null===(e=this.terrain)||void 0===e?void 0:e.options)&&void 0!==t?t:null}areTilesLoaded(){let e=this.style&&this.style.sourceCaches;for(let t in e){let r=e[t]._tiles;for(let e in r){let t=r[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,r)}removeSource(e){return this.style.removeSource(e),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,r,i={}){let{pixelRatio:a=1,sdf:n=!1,stretchX:s,stretchY:o,content:l}=i;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||e.a(r))){if(void 0===r.width||void 0===r.height)return this.fire(new e.j(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:i,height:u,data:h}=r;return this.style.addImage(t,{data:new e.R({width:i,height:u},new Uint8Array(h)),pixelRatio:a,stretchX:s,stretchY:o,content:l,sdf:n,version:0,userImage:r}),r.onAdd&&r.onAdd(this,t),this}}{let{width:i,height:u,data:h}=e.h.getImageData(r);this.style.addImage(t,{data:new e.R({width:i,height:u},h),pixelRatio:a,stretchX:s,stretchY:o,content:l,sdf:n,version:0})}}updateImage(t,r){let i=this.style.getImage(t);if(!i)return this.fire(new e.j(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let{width:a,height:n,data:s}=r instanceof HTMLImageElement||e.a(r)?e.h.getImageData(r):r;if(void 0===a||void 0===n)return this.fire(new e.j(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==i.data.width||n!==i.data.height)return this.fire(new e.j(Error("The width and height of the updated image must be that same as the previous version of the image")));let o=!(r instanceof HTMLImageElement||e.a(r));return i.data.replace(s,o),this.style.updateImage(t,i),this}getImage(e){return this.style.getImage(e)}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.j(Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){_.getImage(this._requestManager.transformRequest(e,x.Image),t)}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(e,t,r){return this.style.setLayerZoomRange(e,t,r),this._update(!0)}setFilter(e,t,r={}){return this.style.setFilter(e,t,r),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,r,i={}){return this.style.setPaintProperty(e,t,r,i),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,r,i={}){return this.style.setLayoutProperty(e,t,r,i),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setGlyphs(e,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(e,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(e,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(e,t,r,e=>{e||this._update(!0)}),this}removeSprite(e){return this._lazyInitEmptyStyle(),this.style.removeSprite(e),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(e,t,e=>{e||this._update(!0)}),this}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_setupContainer(){let e=this._container;e.classList.add("maplibregl-map");let t=this._canvasContainer=o.create("div","maplibregl-canvas-container",e);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=o.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let r=this._containerDimensions(),i=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],i);let a=this._controlContainer=o.create("div","maplibregl-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(e=>{n[e]=o.create("div",`maplibregl-ctrl-${e} `,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=o.create("div","maplibregl-cooperative-gesture-screen",this._container);let e="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(e="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${e}</div>
            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){o.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(e,t,r){this._canvas.width=Math.floor(r*e),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_setupPainter(){let e={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},t=null;this._canvas.addEventListener("webglcontextcreationerror",r=>{t={requestedAttributes:e},r&&(t.statusMessage=r.statusMessage,t.type=r.type)},{once:!0});let r=this._canvas.getContext("webgl2",e)||this._canvas.getContext("webgl",e);if(!r){let e="Failed to initialize WebGL";throw t?(t.message=e,Error(JSON.stringify(t))):Error(e)}this.painter=new rf(r,this.transform),l.testSupport(r)}_onCooperativeGesture(e,t,r){return!t&&r<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&this.style._loaded&&(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(t){let r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._removed)return;let i=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let t=this.transform.zoom,a=e.h.now();this.style.zoomHistory.update(t,a);let n=new e.a8(t,{now:a,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),s=n.crossFadingFactor();1===s&&s===this._crossFadingFactor||(i=!0,this._crossFadingFactor=s),this.style.update(n)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new e.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,e.bg.mark(e.bh.load),this.fire(new e.k("load"))),this.style&&(this.style.hasTransitions()||i)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,e.bg.mark(e.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var t;for(let e of(this._hash&&this._hash.remove(),this._controls))e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),_.removeThrottleControl(this._imageQueueHandle),null===(t=this._resizeObserver)||void 0===t||t.disconnect();let r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),o.remove(this._canvasContainer),o.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),e.bg.clearMetrics(),this._removed=!0,this.fire(new e.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=e.h.frame(t=>{e.bg.frame(t),this._frame=null,this._render(t)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get version(){return s}getCameraTargetElevation(){return this.transform.elevation}},iR.NavigationControl=class{constructor(t){this._updateZoomButtons=()=>{let e=this._map.getZoom(),t=e===this._map.getMaxZoom(),r=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())},this._rotateCompassArrow=()=>{let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,t)=>{let r=this._map._getUIString(`NavigationControl.${t}`);e.title=r,e.setAttribute("aria-label",r)},this.options=e.e({},iv,t),this._container=o.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),o.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),o.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=o.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ib(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){o.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){let r=o.create("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}},iR.GeolocateControl=class extends e.E{constructor(t){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new e.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{let r=new e.L(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,a=this._map.getBearing(),n=e.e({bearing:a},this.options.fitBoundsOptions),s=L.fromLngLat(r,i);this._map.fitBounds(s,n,{geolocateSource:!0})},this._updateMarker=t=>{if(t){let r=new e.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation){if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&iP)return;this._setErrorState()}}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new e.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=o.create("button","maplibregl-ctrl-geolocate",this._container),o.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{let e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new iT({element:this._dotElement}),this._circleElement=o.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new iT({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new e.k("trackuserlocationend")))})}},this.options=e.e({},iI,t)}onAdd(e){return this._map=e,this._container=o.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(e,t=!1){void 0===a||t?void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(t=>{e(a="denied"!==t.state)}).catch(()=>{e(a=!!window.navigator.geolocation)}):e(a=!!window.navigator.geolocation):e(a)}(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),o.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,iC=0,iP=!1}_isOutOfMapMaxBounds(e){let t=this._map.getMaxBounds(),r=e.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let e=this._map.getBounds(),t=e.getSouthEast(),r=e.getNorthEast(),i=t.distanceTo(r),a=Math.ceil(this._accuracy/(i/this._map._container.clientHeight)*2);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":iC--,iP=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new e.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.k("trackuserlocationstart"));break;default:throw Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++iC>1?(e={maximumAge:6e5,timeout:0},iP=!0):(e=this.options.positionOptions,iP=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},iR.AttributionControl=io,iR.LogoControl=il,iR.ScaleControl=class{constructor(t){this._onMove=()=>{iM(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,iM(this._map,this._container,this.options)},this.options=e.e({},iE,t)}getDefaultPosition(){return"bottom-left"}onAdd(e){return this._map=e,this._container=o.create("div","maplibregl-ctrl maplibregl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){o.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},iR.FullscreenControl=class extends e.E{constructor(t={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=o.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){o.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let e=this._fullscreenButton=o.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);o.create("span","maplibregl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new e.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new e.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},iR.TerrainControl=class{constructor(e){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=e}onAdd(e){return this._map=e,this._container=o.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=o.create("button","maplibregl-ctrl-terrain",this._container),o.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){o.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},iR.Popup=class extends e.E{constructor(t){super(),this.remove=()=>(this._content&&o.remove(this._content),this._container&&(o.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new e.k("close")),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=o.create("div","maplibregl-popup",this._map.getContainer()),this._tip=o.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let e of this.options.className.split(" "))this._container.classList.add(e);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=iw(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;let r=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat),i=this.options.anchor,a=function t(r){if(r){if("number"==typeof r){let t=Math.round(Math.abs(r)/Math.SQRT2);return{center:new e.P(0,0),top:new e.P(0,r),"top-left":new e.P(t,t),"top-right":new e.P(-t,t),bottom:new e.P(0,-r),"bottom-left":new e.P(t,-t),"bottom-right":new e.P(-t,-t),left:new e.P(r,0),right:new e.P(-r,0)}}if(r instanceof e.P||Array.isArray(r)){let t=e.P.convert(r);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:e.P.convert(r.center||[0,0]),top:e.P.convert(r.top||[0,0]),"top-left":e.P.convert(r["top-left"]||[0,0]),"top-right":e.P.convert(r["top-right"]||[0,0]),bottom:e.P.convert(r.bottom||[0,0]),"bottom-left":e.P.convert(r["bottom-left"]||[0,0]),"bottom-right":e.P.convert(r["bottom-right"]||[0,0]),left:e.P.convert(r.left||[0,0]),right:e.P.convert(r.right||[0,0])}}return t(new e.P(0,0))}(this.options.offset);if(!i){let e;let t=this._container.offsetWidth,n=this._container.offsetHeight;e=r.y+a.bottom.y<n?["top"]:r.y>this._map.transform.height-n?["bottom"]:[],r.x<t/2?e.push("left"):r.x>this._map.transform.width-t/2&&e.push("right"),i=0===e.length?"bottom":e.join("-")}let n=r.add(a[i]).round();o.setTransform(this._container,`${iS[i]} translate(${n.x}px,${n.y}px)`),ik(this._container,i,"popup")},this._onClose=()=>{this.remove()},this.options=e.e(Object.create(iz),t)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new e.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.L.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){let t;let r=document.createDocumentFragment(),i=document.createElement("body");for(i.innerHTML=e;t=i.firstChild;)r.appendChild(t);return this.setDOMContent(r)}getMaxWidth(){var e;return null===(e=this._container)||void 0===e?void 0:e.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=o.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){this._container&&this._container.classList.add(e)}removeClassName(e){this._container&&this._container.classList.remove(e)}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}_createCloseButton(){this.options.closeButton&&(this._closeButton=o.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let e=this._container.querySelector("a[href], [tabindex]:not([tabindex='-1']), [contenteditable]:not([contenteditable='false']), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled])");e&&e.focus()}},iR.Marker=iT,iR.Style=eG,iR.LngLat=e.L,iR.LngLatBounds=L,iR.Point=e.P,iR.MercatorCoordinate=e.U,iR.Evented=e.E,iR.AJAXError=e.bi,iR.config=e.c,iR.CanvasSource=q,iR.GeoJSONSource=V,iR.ImageSource=j,iR.RasterDEMTileSource=N,iR.RasterTileSource=O,iR.VectorTileSource=B,iR.VideoSource=U,iR.setRTLTextPlugin=e.bj,iR.getRTLTextPluginStatus=e.bk,iR.prewarm=function(){ei().acquire(ee)},iR.clearPrewarmedResources=function(){let e=r;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(ee),r=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},({extend:(t,...r)=>e.e(t,...r),run(e){e()},logToElement(e,t=!1,r="log"){let i=window.document.getElementById(r);i&&(t&&(i.innerHTML=""),i.innerHTML+=`<br>${e}`)}}).extend(iR,{isSafari:e.ac,getPerformanceMetrics:e.bg.getPerformanceMetrics}),iR}),r},e.exports=t()}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,6779,7608],()=>r(57234));module.exports=i})();