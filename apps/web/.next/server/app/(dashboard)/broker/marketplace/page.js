(()=>{var e={};e.id=3404,e.ids=[3404],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},58364:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>c,pages:()=>u,routeModule:()=>m,tree:()=>d}),r(75272),r(32029),r(11930),r(12523);var a=r(23191),n=r(88716),s=r(37922),i=r.n(s),l=r(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let d=["",{children:["(dashboard)",{children:["broker",{children:["marketplace",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,75272)),"C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\(dashboard)\\broker\\marketplace\\page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,32029)),"C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\layout.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,11930)),"C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,12523)),"C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\not-found.tsx"]}],u=["C:\\Users\\moise\\IdeaProjects\\truckercore1\\apps\\web\\src\\app\\(dashboard)\\broker\\marketplace\\page.tsx"],c="/(dashboard)/broker/marketplace/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/(dashboard)/broker/marketplace/page",pathname:"/broker/marketplace",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},14811:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,12994,23)),Promise.resolve().then(r.t.bind(r,96114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,79671,23)),Promise.resolve().then(r.t.bind(r,41868,23)),Promise.resolve().then(r.t.bind(r,84759,23))},22462:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,79404,23))},12100:(e,t,r)=>{Promise.resolve().then(r.bind(r,86263))},35303:()=>{},86263:(e,t,r)=>{"use strict";r.d(t,{OpenLoadsList:()=>h});var a=r(10326),n=r(17577),s=r(48083),i=r(28468),l=r(57608);function o(e,t,r){return{status:t??("number"==typeof e?.status?e.status:500),code:e?.code??"unknown",message:e?.message??"Unexpected error",requestId:r}}function d(e){let t="https://dummy.supabase.co",r="dummy_key_here_for_build";return t&&r?{client:(0,l.eI)(t,r,{global:{headers:{"x-request-id":e}}})}:{error:{status:500,code:"env_missing",message:"Supabase env not set",requestId:e}}}async function u(e={}){let t=crypto.randomUUID(),{status:r="open",pickupFrom:a,pickupTo:n,origin:s,destination:i,equipment:l,limit:u=50,cursor:c}=e;try{let{client:e,error:p}=d(t);if(p)return{data:null,error:p,requestId:t};let m=e.from("marketplace_loads").select("id,status,origin,destination,equipment,pickup_at,pay_usd,broker_id",{count:"exact"}).eq("status",r).order("pickup_at",{ascending:!1}).order("id",{ascending:!1});a&&(m=m.gte("pickup_at",a)),n&&(m=m.lte("pickup_at",n)),s&&(m=m.ilike("origin",`%${s}%`)),i&&(m=m.ilike("destination",`%${i}%`)),l&&(m=m.eq("equipment",l)),m=c?m.lt("pickup_at",c.pickup_at).limit(u):m.limit(u);let{data:x,error:f,status:g}=await m;if(f)return{data:null,error:o(f,g,t),requestId:t};let h=x??[],b=null;if(h.length===u){let e=h[h.length-1];b={pickup_at:e.pickup_at,id:e.id}}return{data:{rows:h,nextCursor:b},error:null,requestId:t}}catch(e){return{data:null,error:o(e,500,t),requestId:t}}}async function c(e){let t=crypto.randomUUID();try{let{client:r,error:a}=d(t);if(a)return{data:null,error:a,requestId:t};let{data:n,error:s,status:i}=await r.from("marketplace_loads").select("id,origin,destination,equipment").eq("id",e.loadId).single();if(s||!n)return{data:null,error:o(s,i,t),requestId:t};let{data:l,error:u,status:c}=await r.from("marketplace_offers").insert({load_id:e.loadId,carrier_id:e.carrierId,driver_id:e.driverId??null,price:e.bidUsd,message:e.message??null,metadata:e.idempotencyKey?{idempotencyKey:e.idempotencyKey}:null},{returning:"representation"}).select("id,load_id,carrier_id,price,created_at").single();if(u||!l)return{data:null,error:o(u,c,t),requestId:t};let p=`${n.origin} → ${n.destination}`,{data:m,error:x,status:f}=await r.from("quote_events").insert({side:"carrier",lane:p,equipment:n.equipment??null,quoted_usd:e.bidUsd,won:!1,metadata:e.idempotencyKey?{idempotencyKey:e.idempotencyKey}:null}).select("id,load_id,broker_id,type,created_at").single();if(x||!m)return{data:null,error:o(x,f,t),requestId:t};return{data:{offer:l,quote:m},error:null,requestId:t}}catch(e){return{data:null,error:o(e,500,t),requestId:t}}}async function p(e){let t=crypto.randomUUID();try{let{client:r,error:a}=d(t);if(a)return{data:null,error:a,requestId:t};let{origin:n,destination:s}=e.lane,i=r.from("market_rates_daily").select("p50,p80,confidence,source,sample_size").eq("origin",n).eq("destination",s).order("service_date",{ascending:!1}).limit(1);e.equipment&&(i=i.eq("equipment",e.equipment)),e.date&&(i=i.lte("service_date",e.date));let{data:l,error:u,status:c}=await i;if(u)return{data:null,error:o(u,c,t),requestId:t};let p=l?.[0];return{data:{p50:p?.p50??null,p80:p?.p80??null,confidence:p?.confidence??null,source:p?.source??null,sample_size:p?.sample_size??null},error:null,requestId:t}}catch(e){return{data:null,error:o(e,500,t),requestId:t}}}async function m(e){let t=crypto.randomUUID();try{let{client:r,error:a}=d(t);if(a)return{data:null,error:a,requestId:t};let{data:n,error:s,status:i}=await r.from("broker_credit").select("tier,d2p_days,bond_ok,insurance_ok,updated_at").eq("broker_id",e.brokerId).limit(1);if(s)return{data:null,error:o(s,i,t),requestId:t};let l=n?.[0]||null;return{data:l?{tier:l.tier??null,d2p_days:l.d2p_days??null,bond_ok:l.bond_ok??null,insurance_ok:l.insurance_ok??null,updated_at:l.updated_at??null}:{tier:null},error:null,requestId:t}}catch(e){return{data:null,error:o(e,500,t),requestId:t}}}function x({open:e,onClose:t,load:r,onApplyOffer:n}){return e&&r?(0,a.jsxs)("div",{className:"fixed inset-0 z-50",children:[a.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:t}),(0,a.jsxs)("div",{className:"absolute right-0 top-0 h-full w-full max-w-lg bg-white shadow-xl p-4 overflow-y-auto",children:[a.jsx(f,{load:r}),a.jsx("div",{className:"mt-4 space-y-4",children:a.jsx(g,{load:r,onApplyOffer:n})})]})]}):null}function f({load:e}){let t=function(e){let{data:t}=(0,s.a)({queryKey:["broker","credit","drawer",e],queryFn:async()=>e?(await m({brokerId:e})).data:null,enabled:!!e,staleTime:3e5});if(!e)return null;let r=function(e){if(!e)return null;let t=e.tier;if("A"===t||"B"===t||"C"===t)return t;let r=e.d2p_days,a=!0===e.bond_ok,n=!0===e.insurance_ok;return null!=r&&a&&n?r<=20&&a&&n?"A":r>=21&&r<=35&&a&&n?"B":"C":"C"}(t);if(!r)return a.jsx("span",{className:"text-xs rounded px-1 border text-gray-500",children:"No credit info"});let n="A"===r?"bg-green-100 text-green-700 border-green-300":"B"===r?"bg-yellow-100 text-yellow-700 border-yellow-300":"bg-red-100 text-red-700 border-red-300",i=t?`D2P: ${t.d2p_days??"—"} \xb7 Updated: ${t.updated_at?new Date(t.updated_at).toLocaleDateString():"—"}`:"—";return a.jsx("span",{title:i,className:`text-xs rounded px-1 border ${n}`,children:r})}(e.broker_id);return(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsxs)("span",{children:[e.origin," → ",e.destination]}),t]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.equipment??"—"," \xb7 ",e.pickup_at?new Date(e.pickup_at).toLocaleString():""]})]}),a.jsx("button",{className:"text-gray-500 hover:text-black","aria-label":"Close",onClick:e=>{e.preventDefault()}})]})}function g({load:e,onApplyOffer:t}){let[r,s]=(0,n.useState)(0),[i,l]=(0,n.useState)(0),[o,d]=(0,n.useState)(null),[u,c]=(0,n.useState)(null),[m,x]=(0,n.useState)(!1);async function f(){x(!0),c(null),d(null),performance.now();try{let t=await p({lane:{origin:e.origin,destination:e.destination},equipment:e.equipment??null,date:e.pickup_at??null});if(t.error){c(`Insufficient market data${t.error.message?": "+t.error.message:""}`);try{await fetch("/api/audit/log",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({action:"bid_assist",target:e.id,status:"error",requestId:t.requestId,details:{message:t.error.message}})})}catch{}}else{let a=t.data?.p50??null,n=t.data?.p80??null;if(null==a&&null==n){c("Insufficient market data for this lane");try{await fetch("/api/audit/log",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({action:"bid_assist",target:e.id,status:"error",requestId:t.requestId,details:{message:"no_data"}})})}catch{}}else{let s=a??n??0,l=s*(1+r/100+i/100),o=[`Base ${null!=a?"p50":"p80"}: $${s.toFixed(0)}`,r?`Deadhead adj: ${r}%`:"Deadhead adj: 0%",i?`Service window adj: ${i}%`:"Service window adj: 0%"],u=Math.round(l);d({p50:a,p80:n,suggested:u,rationale:o});try{await fetch("/api/audit/log",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({action:"bid_assist",target:e.id,status:"ok",requestId:t.requestId,details:{p50:a,p80:n,suggested:u,deadheadPct:r,servicePct:i}})})}catch{}}}}finally{performance.now(),x(!1)}}return(0,a.jsxs)("div",{className:"rounded border p-3",children:[a.jsx("div",{className:"font-medium mb-2",children:"Bid Assist"}),(0,a.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[(0,a.jsxs)("label",{className:"text-sm",children:["Deadhead %",a.jsx("input",{type:"number",className:"block border rounded p-1 w-24",value:r,onChange:e=>s(Number(e.target.value||0))})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Service window %",a.jsx("input",{type:"number",className:"block border rounded p-1 w-24",value:i,onChange:e=>l(Number(e.target.value||0))})]}),a.jsx("button",{className:"ml-auto px-3 py-1 rounded bg-blue-600 text-white",onClick:f,disabled:m,children:m?"Suggesting…":"Suggest Bid"})]}),u?a.jsx("div",{className:"mt-2 text-sm text-red-600",children:u}):null,o&&(0,a.jsxs)("div",{className:"mt-3 text-sm",children:[(0,a.jsxs)("div",{className:"font-semibold",children:["Suggested: $",o.suggested?.toFixed(0)]}),(0,a.jsxs)("div",{className:"text-gray-700",children:["Band: $",o.p50??"—"," – $",o.p80??"—"]}),a.jsx("ul",{className:"list-disc pl-5 mt-1 text-gray-700",children:o.rationale.map((e,t)=>a.jsx("li",{children:e},t))}),a.jsx("button",{className:"mt-2 px-3 py-1 rounded border",onClick:()=>o?.suggested!=null&&t(o.suggested),children:"Apply to Offer"})]})]})}function h(){let{data:e,error:t,isLoading:r}=(0,s.a)({queryKey:["marketplace","openLoads"],queryFn:()=>u().then(e=>({...e,rows:e.data?.rows??[]}))}),[l,o]=(0,n.useState)(!1),[d,p]=(0,n.useState)(null),m=(0,i.D)({mutationFn:async({amount:e})=>{if(!d)throw Error("No load selected");let t=await c({loadId:d.id,carrierId:"demo-carrier",bidUsd:e});if(t.error||!t.data)throw Object.assign(Error(t.error?.message??"Offer failed"),{requestId:t.requestId});return t.data},onSuccess:e=>{alert("Offer submitted successfully")},onError:e=>{alert(`Offer failed${e?.message?": "+e.message:""}${e?.requestId?" \xb7 requestId="+e.requestId:""}`)}});if(r)return a.jsx("div",{className:"p-4",children:"Loading loads…"});if(t)return(0,a.jsxs)("div",{className:"p-4 text-red-600",children:["Error loading: ",t.message]});let f=e?.rows??[];return f.length?(0,a.jsxs)(a.Fragment,{children:[a.jsx("ul",{className:"divide-y rounded border bg-white",children:f.map(e=>(0,a.jsxs)("li",{className:"p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer",onClick:()=>{p({id:e.id,origin:e.origin,destination:e.destination,equipment:e.equipment??null,pickup_at:e.pickup_at??null,broker_id:e.broker_id??null}),o(!0)},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium flex items-center gap-2",children:[(0,a.jsxs)("span",{children:[e.origin," → ",e.destination]}),a.jsx(b,{brokerId:e.broker_id})]}),a.jsx("div",{className:"text-sm text-gray-500",children:e.equipment??"—"})]}),a.jsx("div",{className:"text-sm",children:e.pickup_at?new Date(e.pickup_at).toLocaleString():""})]},e.id))}),a.jsx(x,{open:l,onClose:()=>o(!1),load:d,onApplyOffer:e=>m.mutate({amount:e})})]}):a.jsx("div",{className:"p-4 text-gray-600",children:"No open loads"})}function b({brokerId:e}){let{data:t}=(0,s.a)({queryKey:["broker","credit",e],queryFn:async()=>e?(await m({brokerId:e})).data:null,enabled:!!e,staleTime:3e5});if(!e)return null;let r=function(e){if(!e)return null;let t=e.tier;if("A"===t||"B"===t||"C"===t)return t;let r=e.d2p_days,a=!0===e.bond_ok,n=!0===e.insurance_ok;return null!=r&&a&&n?r<=20&&a&&n?"A":r>=21&&r<=35&&a&&n?"B":"C":"C"}(t);if(!r)return a.jsx("span",{className:"text-xs rounded px-1 border text-gray-500",children:"No credit info"});let n="A"===r?"bg-green-100 text-green-700 border-green-300":"B"===r?"bg-yellow-100 text-yellow-700 border-yellow-300":"bg-red-100 text-red-700 border-red-300",i=t?`D2P: ${t.d2p_days??"—"} \xb7 Updated: ${t.updated_at?new Date(t.updated_at).toLocaleDateString():"—"}`:"—";return a.jsx("span",{title:i,className:`text-xs rounded px-1 border ${n}`,children:r})}},75272:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(19510);let n=(0,r(68570).createProxy)(String.raw`C:\Users\moise\IdeaProjects\truckercore1\apps\web\src\features\broker\marketplace\OpenLoadsList.tsx#OpenLoadsList`);function s(){return(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[a.jsx("h1",{className:"text-xl font-semibold",children:"Broker Marketplace"}),a.jsx(n,{})]})}},32029:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s,metadata:()=>n});var a=r(19510);let n={title:"TruckerCore",description:"Trucking Management System"};function s({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{children:e})})}},11930:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(19510);function n(){return(0,a.jsxs)("div",{style:s.container,children:[a.jsx("div",{style:s.spinner}),a.jsx("p",{style:s.text,children:"Loading..."})]})}let s={container:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#0F1216",color:"#ffffff"},spinner:{width:"48px",height:"48px",border:"4px solid #2A313A",borderTop:"4px solid #58A6FF",borderRadius:"50%",animation:"spin 1s linear infinite"},text:{marginTop:"16px",fontSize:"16px",color:"#8B949E"}}},12523:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(19510),n=r(57371);function s(){return(0,a.jsxs)("div",{style:i.container,children:[a.jsx("h1",{style:i.title,children:"404"}),a.jsx("h2",{style:i.subtitle,children:"Page Not Found"}),a.jsx("p",{style:i.description,children:"The page you're looking for doesn't exist or has been moved."}),(0,a.jsxs)("div",{style:i.links,children:[a.jsx(n.default,{href:"/",style:i.primaryLink,children:"Go Home"}),a.jsx(n.default,{href:"https://app.truckercore.com",style:i.secondaryLink,children:"Launch App"})]})]})}let i={container:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"24px",backgroundColor:"#0F1216",color:"#ffffff",textAlign:"center"},title:{fontSize:"96px",fontWeight:700,background:"linear-gradient(135deg, #58A6FF 0%, #79C0FF 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",marginBottom:"16px"},subtitle:{fontSize:"32px",fontWeight:600,marginBottom:"16px",color:"#ffffff"},description:{fontSize:"18px",color:"#8B949E",marginBottom:"32px",maxWidth:"500px"},links:{display:"flex",gap:"16px",flexWrap:"wrap",justifyContent:"center"},primaryLink:{padding:"14px 32px",backgroundColor:"#58A6FF",color:"#000",borderRadius:"8px",fontWeight:600,fontSize:"16px",transition:"all 0.2s"},secondaryLink:{padding:"14px 32px",border:"2px solid #58A6FF",color:"#58A6FF",borderRadius:"8px",fontWeight:600,fontSize:"16px",transition:"all 0.2s"}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,6779,7608,3193],()=>r(58364));module.exports=a})();