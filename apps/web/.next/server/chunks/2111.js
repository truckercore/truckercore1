exports.id=2111,exports.ids=[2111],exports.modules={88467:(e,t,s)=>{e.exports={RBTree:s(61849),BinTree:s(22083)}},22083:(e,t,s)=>{var r=s(41512);function i(e){this.data=e,this.left=null,this.right=null}function a(e){this._root=null,this._comparator=e,this.size=0}i.prototype.get_child=function(e){return e?this.right:this.left},i.prototype.set_child=function(e,t){e?this.right=t:this.left=t},a.prototype=new r,a.prototype.insert=function(e){if(null===this._root)return this._root=new i(e),this.size++,!0;for(var t=0,s=null,r=this._root;;){if(null===r)return r=new i(e),s.set_child(t,r),ret=!0,this.size++,!0;if(0===this._comparator(r.data,e))return!1;t=0>this._comparator(r.data,e),s=r,r=r.get_child(t)}},a.prototype.remove=function(e){if(null===this._root)return!1;var t=new i(void 0),s=t;s.right=this._root;for(var r=null,a=null,n=1;null!==s.get_child(n);){r=s,s=s.get_child(n);var o=this._comparator(e,s.data);n=o>0,0===o&&(a=s)}return null!==a&&(a.data=s.data,r.set_child(r.right===s,s.get_child(null===s.left)),this._root=t.right,this.size--,!0)},e.exports=a},61849:(e,t,s)=>{var r=s(41512);function i(e){this.data=e,this.left=null,this.right=null,this.red=!0}function a(e){this._root=null,this._comparator=e,this.size=0}function n(e){return null!==e&&e.red}function o(e,t){var s=e.get_child(!t);return e.set_child(!t,s.get_child(t)),s.set_child(t,e),e.red=!0,s.red=!1,s}function l(e,t){return e.set_child(!t,o(e.get_child(!t),!t)),o(e,t)}i.prototype.get_child=function(e){return e?this.right:this.left},i.prototype.set_child=function(e,t){e?this.right=t:this.left=t},a.prototype=new r,a.prototype.insert=function(e){var t=!1;if(null===this._root)this._root=new i(e),t=!0,this.size++;else{var s=new i(void 0),r=0,a=0,c=null,h=s,u=null,p=this._root;for(h.right=this._root;;){if(null===p?(p=new i(e),u.set_child(r,p),t=!0,this.size++):n(p.left)&&n(p.right)&&(p.red=!0,p.left.red=!1,p.right.red=!1),n(p)&&n(u)){var m=h.right===c;p===u.get_child(a)?h.set_child(m,o(c,!a)):h.set_child(m,l(c,!a))}var d=this._comparator(p.data,e);if(0===d)break;a=r,r=d<0,null!==c&&(h=c),c=u,u=p,p=p.get_child(r)}this._root=s.right}return this._root.red=!1,t},a.prototype.remove=function(e){if(null===this._root)return!1;var t=new i(void 0),s=t;s.right=this._root;for(var r=null,a=null,c=null,h=1;null!==s.get_child(h);){var u=h;a=r,r=s,s=s.get_child(h);var p=this._comparator(e,s.data);if(h=p>0,0===p&&(c=s),!n(s)&&!n(s.get_child(h))){if(n(s.get_child(!h))){var m=o(s,h);r.set_child(u,m),r=m}else if(!n(s.get_child(!h))){var d=r.get_child(!u);if(null!==d){if(n(d.get_child(!u))||n(d.get_child(u))){var f=a.right===r;n(d.get_child(u))?a.set_child(f,l(r,u)):n(d.get_child(!u))&&a.set_child(f,o(r,u));var g=a.get_child(f);g.red=!0,s.red=!0,g.left.red=!1,g.right.red=!1}else r.red=!1,d.red=!0,s.red=!0}}}}return null!==c&&(c.data=s.data,r.set_child(r.right===s,s.get_child(null===s.left)),this.size--),this._root=t.right,null!==this._root&&(this._root.red=!1),null!==c},e.exports=a},41512:e=>{function t(){}function s(e){this._tree=e,this._ancestors=[],this._cursor=null}t.prototype.clear=function(){this._root=null,this.size=0},t.prototype.find=function(e){for(var t=this._root;null!==t;){var s=this._comparator(e,t.data);if(0===s)return t.data;t=t.get_child(s>0)}return null},t.prototype.findIter=function(e){for(var t=this._root,s=this.iterator();null!==t;){var r=this._comparator(e,t.data);if(0===r)return s._cursor=t,s;s._ancestors.push(t),t=t.get_child(r>0)}return null},t.prototype.lowerBound=function(e){for(var t=this._root,s=this.iterator(),r=this._comparator;null!==t;){var i=r(e,t.data);if(0===i)return s._cursor=t,s;s._ancestors.push(t),t=t.get_child(i>0)}for(var a=s._ancestors.length-1;a>=0;--a)if(0>r(e,(t=s._ancestors[a]).data))return s._cursor=t,s._ancestors.length=a,s;return s._ancestors.length=0,s},t.prototype.upperBound=function(e){for(var t=this.lowerBound(e),s=this._comparator;null!==t.data()&&0===s(t.data(),e);)t.next();return t},t.prototype.min=function(){var e=this._root;if(null===e)return null;for(;null!==e.left;)e=e.left;return e.data},t.prototype.max=function(){var e=this._root;if(null===e)return null;for(;null!==e.right;)e=e.right;return e.data},t.prototype.iterator=function(){return new s(this)},t.prototype.each=function(e){for(var t,s=this.iterator();null!==(t=s.next());)if(!1===e(t))return},t.prototype.reach=function(e){for(var t,s=this.iterator();null!==(t=s.prev());)if(!1===e(t))return},s.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},s.prototype.next=function(){if(null===this._cursor){var e,t=this._tree._root;null!==t&&this._minNode(t)}else if(null===this._cursor.right)do if(e=this._cursor,this._ancestors.length)this._cursor=this._ancestors.pop();else{this._cursor=null;break}while(this._cursor.right===e);else this._ancestors.push(this._cursor),this._minNode(this._cursor.right);return null!==this._cursor?this._cursor.data:null},s.prototype.prev=function(){if(null===this._cursor){var e,t=this._tree._root;null!==t&&this._maxNode(t)}else if(null===this._cursor.left)do if(e=this._cursor,this._ancestors.length)this._cursor=this._ancestors.pop();else{this._cursor=null;break}while(this._cursor.left===e);else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left);return null!==this._cursor?this._cursor.data:null},s.prototype._minNode=function(e){for(;null!==e.left;)this._ancestors.push(e),e=e.left;this._cursor=e},s.prototype._maxNode=function(e){for(;null!==e.right;)this._ancestors.push(e),e=e.right;this._cursor=e},e.exports=t},92111:(e,t,s)=>{"use strict";t.register=s(5661).globalRegistry,t.Registry=s(5661),t.Registry.PROMETHEUS_CONTENT_TYPE,t.Registry.OPENMETRICS_CONTENT_TYPE,s(86401).validateMetricName,t.Counter=s(19995),s(99377),t.Histogram=s(34857),s(28518),s(72098),s(58729),s(58729),t.collectDefaultMetrics=s(29412),s(31240).aggregators,s(82340)},58729:(e,t)=>{},82340:(e,t,s)=>{"use strict";let r=s(5661),{Grouper:i}=s(44442),{aggregators:a}=s(31240),n=()=>{let e=s(89798);return n=()=>e,e},o="prom-client:getMetricsReq",l="prom-client:getMetricsRes",c=[r.globalRegistry],h=0,u=!1,p=new Map;class m extends r{constructor(e=r.PROMETHEUS_CONTENT_TYPE){super(e),!u&&(u=!0,n().isMaster&&n().on("message",(e,t)=>{if(t.type===l){let e=p.get(t.requestId);if(t.error){e.done(Error(t.error));return}if(t.metrics.forEach(t=>e.responses.push(t)),e.pending--,0===e.pending){p.delete(t.requestId),clearTimeout(e.errorTimeout);let s=m.aggregate(e.responses).metrics();e.done(null,s)}}}),n().isWorker&&process.on("message",e=>{e.type===o&&Promise.all(c.map(e=>e.getMetricsAsJSON())).then(t=>{process.send({type:l,requestId:e.requestId,metrics:t})}).catch(t=>{process.send({type:l,requestId:e.requestId,error:t.message})})}))}clusterMetrics(){let e=h++;return new Promise((t,s)=>{let r=!1;function i(e,i){r||(r=!0,e?s(e):t(i))}let a={responses:[],pending:0,done:i,errorTimeout:setTimeout(()=>{let e=Error("Operation timed out.");a.done(e)},5e3)};p.set(e,a);let l={type:o,requestId:e};for(let e in n().workers)n().workers[e].isConnected()&&(n().workers[e].send(l),a.pending++);0===a.pending&&(clearTimeout(a.errorTimeout),process.nextTick(()=>i(null,"")))})}get contentType(){return super.contentType}static aggregate(e,t=r.PROMETHEUS_CONTENT_TYPE){let s=new r,n=new i;return s.setContentType(t),e.forEach(e=>{e.forEach(e=>{n.add(e.name,e)})}),n.forEach(e=>{let t=e[0].aggregator,r=a[t];if("function"!=typeof r)throw Error(`'${t}' is not a defined aggregator.`);let i=r(e);if(i){let e=Object.assign({get:()=>i},i);s.registerMetric(e)}}),s}static setRegistries(e){Array.isArray(e)||(e=[e]),e.forEach(e=>{if(!(e instanceof r))throw TypeError(`Expected Registry, got ${typeof e}`)}),c=e}}e.exports=m},19995:(e,t,s)=>{"use strict";let r=s(21764),{hashObject:i,isObject:a,getLabels:n,removeLabels:o,nowTimestamp:l}=s(44442),{validateLabel:c}=s(86401),{Metric:h}=s(73580),u=s(35562);class p extends h{constructor(e){super(e),this.type="counter",this.defaultLabels={},this.defaultValue=1,this.defaultExemplarLabelSet={},e.enableExemplars?(this.enableExemplars=!0,this.inc=this.incWithExemplar):this.inc=this.incWithoutExemplar}incWithoutExemplar(e,t){let s="";if(a(e)?(s=i(e,this.sortedLabelNames),c(this.labelNames,e)):(t=e,e={}),t&&!Number.isFinite(t))throw TypeError(`Value is not a valid number: ${r.format(t)}`);if(t<0)throw Error("It is not possible to decrease a counter");return null==t&&(t=1),m(this.hashMap,t,e,s),{labelHash:s}}incWithExemplar({labels:e=this.defaultLabels,value:t=this.defaultValue,exemplarLabels:s=this.defaultExemplarLabelSet}={}){let r=this.incWithoutExemplar(e,t);this.updateExemplar(s,t,r.labelHash)}updateExemplar(e,t,s){e!==this.defaultExemplarLabelSet&&(a(this.hashMap[s].exemplar)||(this.hashMap[s].exemplar=new u),this.hashMap[s].exemplar.validateExemplarLabelSet(e),this.hashMap[s].exemplar.labelSet=e,this.hashMap[s].exemplar.value=t||1,this.hashMap[s].exemplar.timestamp=l())}reset(){this.hashMap={},0===this.labelNames.length&&m(this.hashMap,0)}async get(){if(this.collect){let e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:this.type,values:Object.values(this.hashMap),aggregator:this.aggregator}}labels(...e){let t=n(this.labelNames,e)||{};return{inc:this.inc.bind(this,t)}}remove(...e){let t=n(this.labelNames,e)||{};return c(this.labelNames,t),o.call(this,this.hashMap,t,this.sortedLabelNames)}}function m(e,t,s={},r=""){return e[r]?e[r].value+=t:e[r]={value:t,labels:s},e}e.exports=p},29412:(e,t,s)=>{"use strict";let{isObject:r}=s(44442),i=s(28940),a=s(24465),n=s(20554),o=s(51095),l=s(97213),c=s(7882),h=s(77601),u=s(39599),p=s(21489),m=s(77424),d=s(10302),f=s(36457),g=s(80400),_={processCpuTotal:i,processStartTime:a,osMemoryHeap:n,processOpenFileDescriptors:o,processMaxFileDescriptors:l,eventLoopLag:c,..."function"==typeof process.getActiveResourcesInfo?{processResources:p}:{},processHandles:h,processRequests:u,heapSizeAndUsed:m,heapSpacesSizeAndUsed:d,version:f,gc:g},b=Object.keys(_);e.exports=function(e){if(null!=e&&!r(e))throw TypeError("config must be null, undefined, or an object");for(let t of(e={eventLoopMonitoringPrecision:10,...e},Object.values(_)))t(e.register,e)},e.exports.metricsList=b},35562:e=>{"use strict";class t{constructor(e={},t=null){this.labelSet=e,this.value=t}validateExemplarLabelSet(e){let t="";for(let[s,r]of Object.entries(e))t+=`${s}${r}`;if(t.length>128)throw RangeError("Label set size must be smaller than 128 UTF-8 chars")}}e.exports=t},99377:(e,t,s)=>{"use strict";let r=s(21764),{setValue:i,setValueDelta:a,getLabels:n,hashObject:o,isObject:l,removeLabels:c}=s(44442),{validateLabel:h}=s(86401),{Metric:u}=s(73580);class p extends u{constructor(e){super(e),this.type="gauge"}set(e,t){var s,a;s=e,a=t,t=l(s)?a:s,function(e,t,s){if("number"!=typeof s)throw TypeError(`Value is not a valid number: ${r.format(s)}`);h(e.labelNames,t),i(e.hashMap,s,t)}(this,e=d(e),t)}reset(){this.hashMap={},0===this.labelNames.length&&i(this.hashMap,0,{})}inc(e,t){var s,r;s=e,r=t,t=l(s)?r:s,e=d(e),void 0===t&&(t=1),m(this,e,t)}dec(e,t){var s,r;s=e,r=t,t=l(s)?r:s,e=d(e),void 0===t&&(t=1),m(this,e,-t)}setToCurrentTime(e){let t=Date.now()/1e3;void 0===e?this.set(t):this.set(e,t)}startTimer(e){let t=process.hrtime();return s=>{let r=process.hrtime(t),i=r[0]+r[1]/1e9;return this.set(Object.assign({},e,s),i),i}}async get(){if(this.collect){let e=this.collect();e instanceof Promise&&await e}return{help:this.help,name:this.name,type:this.type,values:Object.values(this.hashMap),aggregator:this.aggregator}}_getValue(e){let t=o(e||{},this.sortedLabelNames);return this.hashMap[t]?this.hashMap[t].value:0}labels(...e){let t=n(this.labelNames,e);return h(this.labelNames,t),{inc:this.inc.bind(this,t),dec:this.dec.bind(this,t),set:this.set.bind(this,t),setToCurrentTime:this.setToCurrentTime.bind(this,t),startTimer:this.startTimer.bind(this,t)}}remove(...e){let t=n(this.labelNames,e);h(this.labelNames,t),c.call(this,this.hashMap,t,this.sortedLabelNames)}}function m(e,t,s){if("number"!=typeof s)throw TypeError(`Delta is not a valid number: ${r.format(s)}`);h(e.labelNames,t);let i=o(t,e.sortedLabelNames);a(e.hashMap,s,t,i)}function d(e){return l(e)?e:{}}e.exports=p},34857:(e,t,s)=>{"use strict";let r=s(21764),{getLabels:i,hashObject:a,isObject:n,removeLabels:o,nowTimestamp:l}=s(44442),{validateLabel:c}=s(86401),{Metric:h}=s(73580),u=s(35562);class p extends h{constructor(e){for(let t of(super(e,{buckets:[.005,.01,.025,.05,.1,.25,.5,1,2.5,5,10]}),this.type="histogram",this.defaultLabels={},this.defaultExemplarLabelSet={},this.enableExemplars=!1,this.labelNames))if("le"===t)throw Error("le is a reserved label keyword");this.upperBounds=this.buckets,this.bucketValues=this.upperBounds.reduce((e,t)=>(e[t]=0,e),{}),e.enableExemplars?(this.enableExemplars=!0,this.bucketExemplars=this.upperBounds.reduce((e,t)=>(e[t]=null,e),{}),Object.freeze(this.bucketExemplars),this.observe=this.observeWithExemplar):this.observe=this.observeWithoutExemplar,Object.freeze(this.bucketValues),Object.freeze(this.upperBounds),0===this.labelNames.length&&(this.hashMap={[a({})]:b({},this.bucketValues,this.bucketExemplars)})}observeWithoutExemplar(e,t){_.call(this,0===e?0:e||{})(t)}observeWithExemplar({labels:e=this.defaultLabels,value:t,exemplarLabels:s=this.defaultExemplarLabelSet}={}){_.call(this,0===e?0:e||{})(t),this.updateExemplar(e,t,s)}updateExemplar(e,t,s){if(0===Object.keys(s).length)return;let r=a(e,this.sortedLabelNames),i=g(this.upperBounds,t),{bucketExemplars:o}=this.hashMap[r],c=o[i];n(c)||(c=new u,o[i]=c),c.validateExemplarLabelSet(s),c.labelSet=s,c.value=t,c.timestamp=l()}async get(){let e=await this.getForPromString();return e.values=e.values.map(y),e}async getForPromString(){var e;if(this.collect){let e=this.collect();e instanceof Promise&&await e}let t=Object.values(this.hashMap).map(function(e){let t=`${e.name}_bucket`;return s=>{let r=0;return{buckets:e.upperBounds.map(e=>(r+=s.bucketValues[e],f({le:e},r,t,s.bucketExemplars?s.bucketExemplars[e]:null,s.labels))),data:s}}}(this)).reduce((e=this,(t,s)=>(t.push(...s.buckets),t.push(f({le:"+Inf"},s.data.count,`${e.name}_bucket`,s.data.bucketExemplars?s.data.bucketExemplars["-1"]:null,s.data.labels),f({},s.data.sum,`${e.name}_sum`,void 0,s.data.labels),f({},s.data.count,`${e.name}_count`,void 0,s.data.labels)),t)),[]);return{name:this.name,help:this.help,type:this.type,values:t,aggregator:this.aggregator}}reset(){this.hashMap={}}zero(e){let t=a(e,this.sortedLabelNames);this.hashMap[t]=b(e,this.bucketValues,this.bucketExemplars)}startTimer(e,t){return this.enableExemplars?d.call(this,e,t)():m.call(this,e)()}labels(...e){let t=i(this.labelNames,e);return c(this.labelNames,t),{observe:_.call(this,t),startTimer:m.call(this,t)}}remove(...e){let t=i(this.labelNames,e);c(this.labelNames,t),o.call(this,this.hashMap,t,this.sortedLabelNames)}}function m(e){return()=>{let t=process.hrtime();return s=>{let r=process.hrtime(t),i=r[0]+r[1]/1e9;return this.observe(Object.assign({},e,s),i),i}}}function d(e,t){return()=>{let s=process.hrtime();return(r,i)=>{let a=process.hrtime(s),n=a[0]+a[1]/1e9;return this.observe({labels:Object.assign({},e,r),value:n,exemplarLabels:Object.assign({},t,i)}),n}}}function f(e,t,s,r,i={}){return{labels:e,sharedLabels:i,value:t,metricName:s,exemplar:r}}function g(e,t){for(let s=0;s<e.length;s++){let r=e[s];if(t<=r)return r}return -1}function _(e){return t=>{let s=n(e)?{labels:e,value:t}:{value:e,labels:{}};if(c(this.labelNames,s.labels),!Number.isFinite(s.value))throw TypeError(`Value is not a valid number: ${r.format(s.value)}`);let i=a(s.labels,this.sortedLabelNames),o=this.hashMap[i];o||(o=b(s.labels,this.bucketValues,this.bucketExemplars));let l=g(this.upperBounds,s.value);o.sum+=s.value,o.count+=1,Object.prototype.hasOwnProperty.call(o.bucketValues,l)&&(o.bucketValues[l]+=1),this.hashMap[i]=o}}function b(e,t,s){let r={labels:e,bucketValues:{...t},sum:0,count:0};return s&&(r.bucketExemplars={...s}),r}function y(e){let{sharedLabels:t,labels:s,...r}=e;for(let e of Object.keys(t))s[e]=t[e];return r.labels=s,r}e.exports=p},73580:(e,t,s)=>{"use strict";let r=s(5661),{isObject:i}=s(44442),{validateMetricName:a,validateLabelName:n}=s(86401);class o{constructor(e,t={}){if(!i(e))throw TypeError("constructor expected a config object");if(Object.assign(this,{labelNames:[],registers:[r.globalRegistry],aggregator:"sum",enableExemplars:!1},t,e),this.registers||(this.registers=[r.globalRegistry]),!this.help)throw Error("Missing mandatory help parameter");if(!this.name)throw Error("Missing mandatory name parameter");if(!a(this.name))throw Error("Invalid metric name");if(!n(this.labelNames))throw Error("Invalid label name");if(this.collect&&"function"!=typeof this.collect)throw Error('Optional "collect" parameter must be a function');for(let e of(this.labelNames?this.sortedLabelNames=[...this.labelNames].sort():this.sortedLabelNames=[],this.reset(),this.registers)){if(this.enableExemplars&&e.contentType===r.PROMETHEUS_CONTENT_TYPE)throw TypeError("Exemplars are supported only on OpenMetrics registries");e.registerMetric(this)}}reset(){}}e.exports={Metric:o}},31240:(e,t,s)=>{"use strict";let{Grouper:r,hashObject:i}=s(44442);function a(e){return t=>{if(0===t.length)return;let s={help:t[0].help,name:t[0].name,type:t[0].type,values:[],aggregator:t[0].aggregator},a=new r;return t.forEach(e=>{e.values.forEach(e=>{let t=i(e.labels);a.add(`${e.metricName}_${t}`,e)})}),a.forEach(t=>{if(0===t.length)return;let r={value:e(t),labels:t[0].labels};t[0].metricName&&(r.metricName=t[0].metricName),s.values.push(r)}),s}}t.AggregatorFactory=a,t.aggregators={sum:a(e=>e.reduce((e,t)=>e+t.value,0)),first:a(e=>e[0].value),omit:()=>{},average:a(e=>e.reduce((e,t)=>e+t.value,0)/e.length),min:a(e=>e.reduce((e,t)=>Math.min(e,t.value),1/0)),max:a(e=>e.reduce((e,t)=>Math.max(e,t.value),-1/0))}},7882:(e,t,s)=>{"use strict";let r;let i=s(99377);try{r=s(96119)}catch{}let a="nodejs_eventloop_lag_seconds",n="nodejs_eventloop_lag_min_seconds",o="nodejs_eventloop_lag_max_seconds",l="nodejs_eventloop_lag_mean_seconds",c="nodejs_eventloop_lag_stddev_seconds",h="nodejs_eventloop_lag_p50_seconds",u="nodejs_eventloop_lag_p90_seconds",p="nodejs_eventloop_lag_p99_seconds";function m(e,t,s){let r=process.hrtime(e),i=1e9*r[0]+r[1];t.set(s,i/1e9)}e.exports=(e,t={})=>{let s=t.prefix?t.prefix:"",d=t.labels?t.labels:{},f=Object.keys(d),g=e?[e]:void 0,_=()=>{setImmediate(m,process.hrtime(),b,d)};if(r&&r.monitorEventLoopDelay)try{let e=r.monitorEventLoopDelay({resolution:t.eventLoopMonitoringPrecision});e.enable(),_=()=>{let t=process.hrtime();setImmediate(m,t,b,d),y.set(d,e.min/1e9),v.set(d,e.max/1e9),E.set(d,e.mean/1e9),x.set(d,e.stddev/1e9),N.set(d,e.percentile(50)/1e9),w.set(d,e.percentile(90)/1e9),T.set(d,e.percentile(99)/1e9),e.reset()}}catch(e){if("ERR_NOT_IMPLEMENTED"===e.code)return;throw e}let b=new i({name:s+a,help:"Lag of event loop in seconds.",registers:g,labelNames:f,aggregator:"average",collect:_}),y=new i({name:s+n,help:"The minimum recorded event loop delay.",registers:g,labelNames:f,aggregator:"min"}),v=new i({name:s+o,help:"The maximum recorded event loop delay.",registers:g,labelNames:f,aggregator:"max"}),E=new i({name:s+l,help:"The mean of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"}),x=new i({name:s+c,help:"The standard deviation of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"}),N=new i({name:s+h,help:"The 50th percentile of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"}),w=new i({name:s+u,help:"The 90th percentile of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"}),T=new i({name:s+p,help:"The 99th percentile of the recorded event loop delays.",registers:g,labelNames:f,aggregator:"average"})},e.exports.metricNames=[a,n,o,l,c,h,u,p]},80400:(e,t,s)=>{"use strict";let r;let i=s(34857);try{r=s(96119)}catch{}let a="nodejs_gc_duration_seconds",n=[.001,.01,.1,1,2,5],o=[];r&&r.constants&&(o[r.constants.NODE_PERFORMANCE_GC_MAJOR]="major",o[r.constants.NODE_PERFORMANCE_GC_MINOR]="minor",o[r.constants.NODE_PERFORMANCE_GC_INCREMENTAL]="incremental",o[r.constants.NODE_PERFORMANCE_GC_WEAKCB]="weakcb"),e.exports=(e,t={})=>{if(!r)return;let s=t.prefix?t.prefix:"",l=t.labels?t.labels:{},c=new i({name:s+a,help:"Garbage collection duration by kind, one of major, minor, incremental or weakcb.",labelNames:["kind",...Object.keys(l)],enableExemplars:!1,buckets:t.gcDurationBuckets?t.gcDurationBuckets:n,registers:e?[e]:void 0});new r.PerformanceObserver(e=>{let t=e.getEntries()[0],s=t.detail?o[t.detail.kind]:o[t.kind];c.observe(Object.assign({kind:s},l),t.duration/1e3)}).observe({entryTypes:["gc"]})},e.exports.metricNames=[a]},77424:(e,t,s)=>{"use strict";let r=s(99377),i=s(91335),a="nodejs_heap_size_total_bytes",n="nodejs_heap_size_used_bytes",o="nodejs_external_memory_bytes";e.exports=(e,t={})=>{if("function"!=typeof process.memoryUsage)return;let s=t.labels?t.labels:{},l=Object.keys(s),c=e?[e]:void 0,h=t.prefix?t.prefix:"",u=new r({name:h+a,help:"Process heap size from Node.js in bytes.",registers:c,labelNames:l,collect:()=>{let e=i();e&&(u.set(s,e.heapTotal),p.set(s,e.heapUsed),void 0!==e.external&&m.set(s,e.external))}}),p=new r({name:h+n,help:"Process heap size used from Node.js in bytes.",registers:c,labelNames:l}),m=new r({name:h+o,help:"Node.js external memory size in bytes.",registers:c,labelNames:l})},e.exports.metricNames=[a,n,o]},10302:(e,t,s)=>{"use strict";let r=s(99377),i=s(99672),a=["total","used","available"],n={};a.forEach(e=>{n[e]=`nodejs_heap_space_size_${e}_bytes`}),e.exports=(e,t={})=>{try{i.getHeapSpaceStatistics()}catch(e){if("ERR_NOT_IMPLEMENTED"===e.code)return;throw e}let s=e?[e]:void 0,o=t.prefix?t.prefix:"",l=t.labels?t.labels:{},c=["space",...Object.keys(l)],h={};a.forEach(e=>{h[e]=new r({name:o+n[e],help:`Process heap space size ${e} from Node.js in bytes.`,labelNames:c,registers:s})}),h.total.collect=()=>{for(let e of i.getHeapSpaceStatistics()){let t=e.space_name.substr(0,e.space_name.indexOf("_space"));h.total.set({space:t,...l},e.space_size),h.used.set({space:t,...l},e.space_used_size),h.available.set({space:t,...l},e.space_available_size)}}},e.exports.metricNames=Object.values(n)},57546:e=>{"use strict";e.exports={aggregateByObjectName:function(e){let t={};for(let s=0;s<e.length;s++){let r=e[s];r&&void 0!==r.constructor&&(Object.hasOwnProperty.call(t,r.constructor.name)?t[r.constructor.name]+=1:t[r.constructor.name]=1)}return t},updateMetrics:function(e,t,s){for(let r in e.reset(),t)e.set(Object.assign({type:r},s||{}),t[r])}}},91335:e=>{"use strict";e.exports=function(){try{return process.memoryUsage()}catch{return}}},20554:(e,t,s)=>{"use strict";let r=s(99377),i=s(81646),a=s(91335),n="process_resident_memory_bytes";e.exports=(e,t)=>"linux"===process.platform?i(e,t):function(e,t={}){let s=t.prefix?t.prefix:"",i=t.labels?t.labels:{};new r({name:s+n,help:"Resident memory size in bytes.",registers:e?[e]:void 0,labelNames:Object.keys(i),collect(){let e=a();e&&this.set(i,e.rss)}})}(e,t),e.exports.metricNames="linux"===process.platform?i.metricNames:[n]},81646:(e,t,s)=>{"use strict";let r=s(99377),i=s(92048),a=["VmSize","VmRSS","VmData"],n="process_resident_memory_bytes",o="process_virtual_memory_bytes",l="process_heap_bytes";e.exports=(e,t={})=>{let s=e?[e]:void 0,c=t.prefix?t.prefix:"",h=t.labels?t.labels:{},u=Object.keys(h),p=new r({name:c+n,help:"Resident memory size in bytes.",registers:s,labelNames:u,collect(){try{let e=i.readFileSync("/proc/self/status","utf8").split("\n").reduce((e,t)=>{if(!a.some(e=>t.startsWith(e)))return e;let s=t.split(":"),r=s[1].trim();return r=1024*Number(r=r.substr(0,r.length-3)),e[s[0]]=r,e},{});p.set(h,e.VmRSS),m.set(h,e.VmSize),d.set(h,e.VmData)}catch{}}}),m=new r({name:c+o,help:"Virtual memory size in bytes.",registers:s,labelNames:u}),d=new r({name:c+l,help:"Process heap size in bytes.",registers:s,labelNames:u})},e.exports.metricNames=[n,o,l]},28940:(e,t,s)=>{"use strict";let r=s(57165),i=s(19995),a="process_cpu_user_seconds_total",n="process_cpu_system_seconds_total",o="process_cpu_seconds_total";e.exports=(e,t={})=>{let s=e?[e]:void 0,l=t.prefix?t.prefix:"",c=t.labels?t.labels:{},h=!!t.enableExemplars&&t.enableExemplars,u=Object.keys(c),p=process.cpuUsage(),m=new i({name:l+a,help:"Total user CPU time spent in seconds.",enableExemplars:h,registers:s,labelNames:u,collect(){let e=process.cpuUsage(),t=e.user-p.user,s=e.system-p.system;if(p=e,this.enableExemplars){let e={},i=r.trace.getSpan(r.context.active());i&&(e={traceId:i.spanContext().traceId,spanId:i.spanContext().spanId}),m.inc({labels:c,value:t/1e6,exemplarLabels:e}),d.inc({labels:c,value:s/1e6,exemplarLabels:e}),f.inc({labels:c,value:(t+s)/1e6,exemplarLabels:e})}else m.inc(c,t/1e6),d.inc(c,s/1e6),f.inc(c,(t+s)/1e6)}}),d=new i({name:l+n,help:"Total system CPU time spent in seconds.",enableExemplars:h,registers:s,labelNames:u}),f=new i({name:l+o,help:"Total user and system CPU time spent in seconds.",enableExemplars:h,registers:s,labelNames:u})},e.exports.metricNames=[a,n,o]},77601:(e,t,s)=>{"use strict";let{aggregateByObjectName:r}=s(57546),{updateMetrics:i}=s(57546),a=s(99377),n="nodejs_active_handles",o="nodejs_active_handles_total";e.exports=(e,t={})=>{if("function"!=typeof process._getActiveHandles)return;let s=e?[e]:void 0,l=t.prefix?t.prefix:"",c=t.labels?t.labels:{},h=Object.keys(c);new a({name:l+n,help:"Number of active libuv handles grouped by handle type. Every handle type is C++ class name.",labelNames:["type",...h],registers:s,collect(){i(this,r(process._getActiveHandles()),c)}}),new a({name:l+o,help:"Total number of active handles.",registers:s,labelNames:h,collect(){let e=process._getActiveHandles();this.set(c,e.length)}})},e.exports.metricNames=[n,o]},97213:(e,t,s)=>{"use strict";let r;let i=s(99377),a=s(92048),n="process_max_fds";e.exports=(e,t={})=>{if(void 0===r)try{for(let e of a.readFileSync("/proc/self/limits","utf8").split("\n"))if(e.startsWith("Max open files")){let t=e.split(/  +/);r=Number(t[1]);break}}catch{return}if(void 0===r)return;let s=t.prefix?t.prefix:"",o=t.labels?t.labels:{};new i({name:s+n,help:"Maximum number of open file descriptors.",registers:e?[e]:void 0,labelNames:Object.keys(o),collect(){void 0!==r&&this.set(o,r)}})},e.exports.metricNames=[n]},51095:(e,t,s)=>{"use strict";let r=s(99377),i=s(92048),a=s(35816),n="process_open_fds";e.exports=(e,t={})=>{if("linux"!==a.platform)return;let s=t.prefix?t.prefix:"",o=t.labels?t.labels:{};new r({name:s+n,help:"Number of open file descriptors.",registers:e?[e]:void 0,labelNames:Object.keys(o),collect(){try{let e=i.readdirSync("/proc/self/fd");this.set(o,e.length-1)}catch{}}})},e.exports.metricNames=[n]},39599:(e,t,s)=>{"use strict";let r=s(99377),{aggregateByObjectName:i}=s(57546),{updateMetrics:a}=s(57546),n="nodejs_active_requests",o="nodejs_active_requests_total";e.exports=(e,t={})=>{if("function"!=typeof process._getActiveRequests)return;let s=t.prefix?t.prefix:"",l=t.labels?t.labels:{},c=Object.keys(l);new r({name:s+n,help:"Number of active libuv requests grouped by request type. Every request type is C++ class name.",labelNames:["type",...c],registers:e?[e]:void 0,collect(){a(this,i(process._getActiveRequests()),l)}}),new r({name:s+o,help:"Total number of active requests.",registers:e?[e]:void 0,labelNames:c,collect(){let e=process._getActiveRequests();this.set(l,e.length)}})},e.exports.metricNames=[n,o]},21489:(e,t,s)=>{"use strict";let r=s(99377),{updateMetrics:i}=s(57546),a="nodejs_active_resources",n="nodejs_active_resources_total";e.exports=(e,t={})=>{if("function"!=typeof process.getActiveResourcesInfo)return;let s=t.prefix?t.prefix:"",o=t.labels?t.labels:{},l=Object.keys(o);new r({name:s+a,help:"Number of active resources that are currently keeping the event loop alive, grouped by async resource type.",labelNames:["type",...l],registers:e?[e]:void 0,collect(){let e=process.getActiveResourcesInfo(),t={};for(let s=0;s<e.length;s++){let r=e[s];Object.hasOwn(t,r)?t[r]+=1:t[r]=1}i(this,t,o)}}),new r({name:s+n,help:"Total number of active resources.",registers:e?[e]:void 0,labelNames:l,collect(){let e=process.getActiveResourcesInfo();this.set(o,e.length)}})},e.exports.metricNames=[a,n]},24465:(e,t,s)=>{"use strict";let r=s(99377),i=Math.round(Date.now()/1e3-process.uptime()),a="process_start_time_seconds";e.exports=(e,t={})=>{let s=t.prefix?t.prefix:"",n=t.labels?t.labels:{};new r({name:s+a,help:"Start time of the process since unix epoch in seconds.",registers:e?[e]:void 0,labelNames:Object.keys(n),aggregator:"omit",collect(){this.set(n,i)}})},e.exports.metricNames=[a]},36457:(e,t,s)=>{"use strict";let r=s(99377),i=process.version,a=i.slice(1).split(".").map(Number),n="nodejs_version_info";e.exports=(e,t={})=>{let s=t.prefix?t.prefix:"",o=t.labels?t.labels:{};new r({name:s+n,help:"Node.js version info.",labelNames:["version","major","minor","patch",...Object.keys(o)],registers:e?[e]:void 0,aggregator:"first",collect(){this.labels(i,a[0],a[1],a[2],...Object.values(o)).set(1)}})},e.exports.metricNames=[n]},72098:(e,t,s)=>{"use strict";let r=s(17360),i=s(32615),a=s(35240),{gzipSync:n}=s(71568),{globalRegistry:o}=s(5661);class l{constructor(e,t,s){s||(s=o),this.registry=s,this.gatewayUrl=e;let{requireJobName:r,...i}={requireJobName:!0,...t};this.requireJobName=r,this.requestOptions=i}pushAdd(e={}){if(this.requireJobName&&!e.jobName)throw Error("Missing jobName parameter");return c.call(this,"POST",e.jobName,e.groupings)}push(e={}){if(this.requireJobName&&!e.jobName)throw Error("Missing jobName parameter");return c.call(this,"PUT",e.jobName,e.groupings)}delete(e={}){if(this.requireJobName&&!e.jobName)throw Error("Missing jobName parameter");return c.call(this,"DELETE",e.jobName,e.groupings)}}async function c(e,t,s){let o=r.parse(this.gatewayUrl),l=o.pathname&&"/"!==o.pathname?o.pathname:"",c=t?`/job/${encodeURIComponent(t)}${s?Object.keys(s).map(e=>`/${encodeURIComponent(e)}/${encodeURIComponent(s[e])}`).join(""):""}`:"",h=`${l}/metrics${c}`,u=r.resolve(this.gatewayUrl,h),p=r.parse(u),m=-1!==p.href.search(/^https/)?a:i,d=Object.assign(p,this.requestOptions,{method:e});return new Promise((t,s)=>{"DELETE"===e&&d.headers&&delete d.headers["Content-Encoding"];let r=m.request(d,e=>{let r="";e.setEncoding("utf8"),e.on("data",e=>{r+=e}),e.on("end",()=>{e.statusCode>=400?s(Error(`push failed with status ${e.statusCode}, ${r}`)):t({resp:e,body:r})})});r.on("error",e=>{s(e)}),r.on("timeout",()=>{r.destroy(Error("Pushgateway request timed out"))}),"DELETE"!==e?this.registry.metrics().then(e=>{d.headers&&"gzip"===d.headers["Content-Encoding"]&&(e=n(e)),r.write(e),r.end()}).catch(e=>{s(e)}):r.end()})}e.exports=l},5661:(e,t,s)=>{"use strict";let{getValueAsString:r}=s(44442);class i{static get PROMETHEUS_CONTENT_TYPE(){return"text/plain; version=0.0.4; charset=utf-8"}static get OPENMETRICS_CONTENT_TYPE(){return"application/openmetrics-text; version=1.0.0; charset=utf-8"}constructor(e=i.PROMETHEUS_CONTENT_TYPE){if(this._metrics={},this._collectors=[],this._defaultLabels={},e!==i.PROMETHEUS_CONTENT_TYPE&&e!==i.OPENMETRICS_CONTENT_TYPE)throw TypeError(`Content type ${e} is unsupported`);this._contentType=e}getMetricsAsArray(){return Object.values(this._metrics)}async getMetricsAsString(e){let t="function"==typeof e.getForPromString?await e.getForPromString():await e.get(),s=o(t.name),l=[`# HELP ${s} ${o(t.help)}`,`# TYPE ${s} ${t.type}`],c=Object.keys(this._defaultLabels).length>0?this._defaultLabels:null,h=this.contentType===i.OPENMETRICS_CONTENT_TYPE;for(let e of t.values||[]){let{metricName:i=s,labels:o={}}=e,{sharedLabels:u={}}=e;h&&"counter"===t.type&&(i=`${i}_total`),c&&(o={...o,...c,...o});let p=[...a(o,u),function(e){let t=n.get(e);if(t)return t;let s=a(e).join(",");return n.set(e,s),s}(u)].filter(Boolean),m=p.length?`{${p.join(",")}}`:"",d=`${i}${m} ${r(e.value)}`,{exemplar:f}=e;if(f&&h){let e=a(f.labelSet);d+=` # {${e.join(",")}} ${r(f.value)} ${f.timestamp}`}l.push(d)}return l.join("\n")}async metrics(){let e=this.contentType===i.OPENMETRICS_CONTENT_TYPE,t=this.getMetricsAsArray().map(t=>(e&&"counter"===t.type&&(t.name=t.name.replace(/_total$/,"")),this.getMetricsAsString(t))),s=await Promise.all(t);return e?`${s.join("\n")}
# EOF
`:`${s.join("\n\n")}
`}registerMetric(e){if(this._metrics[e.name]&&this._metrics[e.name]!==e)throw Error(`A metric with the name ${e.name} has already been registered.`);this._metrics[e.name]=e}clear(){this._metrics={},this._defaultLabels={}}async getMetricsAsJSON(){let e=[],t=Object.keys(this._defaultLabels),s=[];for(let e of this.getMetricsAsArray())s.push(e.get());for(let r of(await Promise.all(s))){if(r.values&&t.length>0)for(let e of r.values)for(let s of(e.labels=Object.assign({},e.labels),t))e.labels[s]=e.labels[s]||this._defaultLabels[s];e.push(r)}return e}removeSingleMetric(e){delete this._metrics[e]}getSingleMetricAsString(e){return this.getMetricsAsString(this._metrics[e])}getSingleMetric(e){return this._metrics[e]}setDefaultLabels(e){this._defaultLabels=e}resetMetrics(){for(let e in this._metrics)this._metrics[e].reset()}get contentType(){return this._contentType}setContentType(e){if(e===i.OPENMETRICS_CONTENT_TYPE||e===i.PROMETHEUS_CONTENT_TYPE)this._contentType=e;else throw Error(`Content type ${e} is unsupported`)}static merge(e){let t=e[0].contentType;for(let s of e)if(s.contentType!==t)throw Error("Registers can only be merged if they have the same content type");let s=new i(t);return e.reduce((e,t)=>e.concat(t.getMetricsAsArray()),[]).forEach(s.registerMetric,s),s}}function a(e,t){let{hasOwnProperty:s}=Object.prototype,r=[];for(let[i,a]of Object.entries(e))t&&s.call(t,i)||r.push(`${i}="${"string"!=typeof a?a:o(a).replace(/"/g,'\\"')}"`);return r}let n=new WeakMap;function o(e){return e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n")}e.exports=i,e.exports.globalRegistry=new i},28518:(e,t,s)=>{"use strict";let r=s(21764),{getLabels:i,hashObject:a,removeLabels:n}=s(44442),{validateLabel:o}=s(86401),{Metric:l}=s(73580),c=s(53453);class h extends l{constructor(e){for(let t of(super(e,{percentiles:[.01,.05,.5,.9,.95,.99,.999],compressCount:1e3,hashMap:{}}),this.type="summary",this.labelNames))if("quantile"===t)throw Error("quantile is a reserved label keyword");0===this.labelNames.length&&(this.hashMap={[a({})]:{labels:{},td:new c(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}})}observe(e,t){p.call(this,0===e?0:e||{})(t)}async get(){if(this.collect){let e=this.collect();e instanceof Promise&&await e}let e=Object.keys(this.hashMap),t=[];return e.forEach(e=>{var s;let r=this.hashMap[e];r&&(this.pruneAgedBuckets&&0===r.td.size()?delete this.hashMap[e]:((s=this.percentiles,r.td.compress(),s.map(e=>{let t=r.td.percentile(e);return{labels:Object.assign({quantile:e},r.labels),value:t||0}})).forEach(e=>{t.push(e)}),t.push({metricName:`${this.name}_sum`,labels:r.labels,value:r.sum}),t.push({metricName:`${this.name}_count`,labels:r.labels,value:r.count})))}),{name:this.name,help:this.help,type:this.type,values:t,aggregator:this.aggregator}}reset(){Object.values(this.hashMap).forEach(e=>{e.td.reset(),e.count=0,e.sum=0})}startTimer(e){return u.call(this,e)()}labels(...e){let t=i(this.labelNames,e);return o(this.labelNames,t),{observe:p.call(this,t),startTimer:u.call(this,t)}}remove(...e){let t=i(this.labelNames,e);o(this.labelNames,t),n.call(this,this.hashMap,t,this.sortedLabelNames)}}function u(e){return()=>{let t=process.hrtime();return s=>{let r=process.hrtime(t),i=r[0]+r[1]/1e9;return this.observe(Object.assign({},e,s),i),i}}}function p(e){return t=>{let s=void 0===t?{value:e,labels:{}}:{labels:e,value:t};if(o(this.labelNames,e),!Number.isFinite(s.value))throw TypeError(`Value is not a valid number: ${r.format(s.value)}`);let i=a(s.labels,this.sortedLabelNames),n=this.hashMap[i];n||(n={labels:s.labels,td:new c(this.maxAgeSeconds,this.ageBuckets),count:0,sum:0}),n.td.push(s.value),n.count++,n.count%this.compressCount==0&&n.td.compress(),n.sum+=s.value,this.hashMap[i]=n}}e.exports=h},53453:(e,t,s)=>{"use strict";let{TDigest:r}=s(60286);class i{constructor(e,t){this.maxAgeSeconds=e||0,this.ageBuckets=t||0,this.shouldRotate=e&&t,this.ringBuffer=Array(t).fill(new r),this.currentBuffer=0,this.lastRotateTimestampMillis=Date.now(),this.durationBetweenRotatesMillis=1e3*e/t||1/0}size(){return a.call(this).size()}percentile(e){return a.call(this).percentile(e)}push(e){a.call(this),this.ringBuffer.forEach(t=>{t.push(e)})}reset(){this.ringBuffer.forEach(e=>{e.reset()})}compress(){this.ringBuffer.forEach(e=>{e.compress()})}}function a(){let e=Date.now()-this.lastRotateTimestampMillis;for(;e>this.durationBetweenRotatesMillis&&this.shouldRotate;)this.ringBuffer[this.currentBuffer]=new r,++this.currentBuffer>=this.ringBuffer.length&&(this.currentBuffer=0),e-=this.durationBetweenRotatesMillis,this.lastRotateTimestampMillis+=this.durationBetweenRotatesMillis;return this.ringBuffer[this.currentBuffer]}e.exports=i},44442:(e,t)=>{"use strict";function s(e,t){if(0===e.length)return"";let s="";for(let r=0;r<e.length;r++){let i=e[r],a=t[i];void 0!==a&&(s+=`${i}:${a},`)}return s}function r(e,t){if(t)return s(t,e);let r=Object.keys(e);return r.length>1&&r.sort(),s(r,e)}t.getValueAsString=function(e){return Number.isNaN(e)?"Nan":Number.isFinite(e)?`${e}`:e<0?"-Inf":"+Inf"},t.removeLabels=function(e,t,s){let i=r(t,s);delete e[i]},t.setValue=function(e,t,s){return e[r(s)]={value:"number"==typeof t?t:0,labels:s||{}},e},t.setValueDelta=function(e,t,s,r=""){let i="number"==typeof t?t:0;return e[r]?e[r].value+=i:e[r]={value:i,labels:s},e},t.getLabels=function(e,t){if("object"==typeof t[0])return t[0];if(e.length!==t.length)throw Error(`Invalid number of arguments (${t.length}): "${t.join(", ")}" for label names (${e.length}): "${e.join(", ")}".`);let s={};for(let r=0;r<e.length;r++)s[e[r]]=t[r];return s},t.hashObject=r,t.isObject=function(e){return null!==e&&"object"==typeof e},t.nowTimestamp=function(){return Date.now()/1e3};class i extends Map{add(e,t){this.has(e)?this.get(e).push(t):this.set(e,[t])}}t.Grouper=i},86401:(e,t,s)=>{"use strict";let r=s(21764),i=/^[a-zA-Z_:][a-zA-Z0-9_:]*$/,a=/^[a-zA-Z_][a-zA-Z0-9_]*$/;t.validateMetricName=function(e){return i.test(e)},t.validateLabelName=function(e=[]){return e.every(e=>a.test(e))},t.validateLabel=function(e,t){for(let s in t)if(!e.includes(s))throw Error(`Added label "${s}" is not included in initial labelset: ${r.inspect(e)}`)}},60286:(e,t,s)=>{var r=s(88467).RBTree;function i(e,t,s){this.discrete=!1===e,this.delta=e||.01,this.K=void 0===t?25:t,this.CX=void 0===s?1.1:s,this.centroids=new r(a),this.nreset=0,this.reset()}function a(e,t){return e.mean>t.mean?1:e.mean<t.mean?-1:0}function n(e,t){return e.mean_cumn-t.mean_cumn}function o(e){this.config=e||{},this.mode=this.config.mode||"auto",i.call(this,"cont"===this.mode&&e.delta),this.digest_ratio=this.config.ratio||.9,this.digest_thresh=this.config.thresh||1e3,this.n_unique=0}i.prototype.reset=function(){this.centroids.clear(),this.n=0,this.nreset+=1,this.last_cumulate=0},i.prototype.size=function(){return this.centroids.size},i.prototype.toArray=function(e){var t=[];return e?(this._cumulate(!0),this.centroids.each(function(e){t.push(e)})):this.centroids.each(function(e){t.push({mean:e.mean,n:e.n})}),t},i.prototype.summary=function(){return[(this.discrete?"exact ":"approximating ")+this.n+" samples using "+this.size()+" centroids","min = "+this.percentile(0),"Q1  = "+this.percentile(.25),"Q2  = "+this.percentile(.5),"Q3  = "+this.percentile(.75),"max = "+this.percentile(1)].join("\n")},i.prototype.push=function(e,t){t=t||1,e=Array.isArray(e)?e:[e];for(var s=0;s<e.length;s++)this._digest(e[s],t)},i.prototype.push_centroid=function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++)this._digest(e[t].mean,e[t].n)},i.prototype._cumulate=function(e){if(this.n!==this.last_cumulate&&(e||!this.CX||!(this.CX>this.n/this.last_cumulate))){var t=0;this.centroids.each(function(e){e.mean_cumn=t+e.n/2,t=e.cumn=t+e.n}),this.n=this.last_cumulate=t}},i.prototype.find_nearest=function(e){if(0===this.size())return null;var t=this.centroids.lowerBound({mean:e}),s=null===t.data()?t.prev():t.data();if(s.mean===e||this.discrete)return s;var r=t.prev();return r&&Math.abs(r.mean-e)<Math.abs(s.mean-e)?r:s},i.prototype._new_centroid=function(e,t,s){var r={mean:e,n:t,cumn:s};return this.centroids.insert(r),this.n+=t,r},i.prototype._addweight=function(e,t,s){t!==e.mean&&(e.mean+=s*(t-e.mean)/(e.n+s)),e.cumn+=s,e.mean_cumn+=s/2,e.n+=s,this.n+=s},i.prototype._digest=function(e,t){var s=this.centroids.min(),r=this.centroids.max(),i=this.find_nearest(e);if(i&&i.mean===e)this._addweight(i,e,t);else if(i===s)this._new_centroid(e,t,0);else if(i===r)this._new_centroid(e,t,this.n);else if(this.discrete)this._new_centroid(e,t,i.cumn);else{var a=i.mean_cumn/this.n;Math.floor(4*this.n*this.delta*a*(1-a))-i.n>=t?this._addweight(i,e,t):this._new_centroid(e,t,i.cumn)}this._cumulate(!1),!this.discrete&&this.K&&this.size()>this.K/this.delta&&this.compress()},i.prototype.bound_mean=function(e){var t=this.centroids.upperBound({mean:e}),s=t.prev(),r=s.mean===e?s:t.next();return[s,r]},i.prototype.p_rank=function(e){var t=(Array.isArray(e)?e:[e]).map(this._p_rank,this);return Array.isArray(e)?t:t[0]},i.prototype._p_rank=function(e){if(0!==this.size()){if(e<this.centroids.min().mean)return 0;if(e>this.centroids.max().mean)return 1;this._cumulate(!0);var t=this.bound_mean(e),s=t[0],r=t[1];if(this.discrete)return s.cumn/this.n;var i=s.mean_cumn;return s!==r&&(i+=(e-s.mean)*(r.mean_cumn-s.mean_cumn)/(r.mean-s.mean)),i/this.n}},i.prototype.bound_mean_cumn=function(e){this.centroids._comparator=n;var t=this.centroids.upperBound({mean_cumn:e});this.centroids._comparator=a;var s=t.prev(),r=s&&s.mean_cumn===e?s:t.next();return[s,r]},i.prototype.percentile=function(e){var t=(Array.isArray(e)?e:[e]).map(this._percentile,this);return Array.isArray(e)?t:t[0]},i.prototype._percentile=function(e){if(0!==this.size()){this._cumulate(!0);var t=this.n*e,s=this.bound_mean_cumn(t),r=s[0],i=s[1];return i===r||null===r||null===i?(r||i).mean:this.discrete?t<=r.cumn?r.mean:i.mean:r.mean+(t-r.mean_cumn)*(i.mean-r.mean)/(i.mean_cumn-r.mean_cumn)}},i.prototype.compress=function(){if(!this.compressing){var e=this.toArray();for(this.reset(),this.compressing=!0;e.length>0;)this.push_centroid(function(e){var t=Math.floor(Math.random()*e.length);return e.splice(t,1)[0]}(e));this._cumulate(!0),this.compressing=!1}},o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.push=function(e){i.prototype.push.call(this,e),this.check_continuous()},o.prototype._new_centroid=function(e,t,s){this.n_unique+=1,i.prototype._new_centroid.call(this,e,t,s)},o.prototype._addweight=function(e,t,s){1===e.n&&(this.n_unique-=1),i.prototype._addweight.call(this,e,t,s)},o.prototype.check_continuous=function(){return!("auto"!==this.mode||this.size()<this.digest_thresh)&&this.n_unique/this.size()>this.digest_ratio&&(this.mode="cont",this.discrete=!1,this.delta=this.config.delta||.01,this.compress(),!0)},e.exports={TDigest:i,Digest:o}}};